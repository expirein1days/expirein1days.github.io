{"version":3,"sources":["../node_modules/jsdom/lib/jsdom sync","assets sync /^/.//normal.*/.svg$","assets sync /^/.//Save.*/.svg$","assets sync /^/.//Album.*/.svg$","routes/Done/AlertModal.js","components/RequestActivityIndicator.js","utils/FontManager.js","utils/addCopyrightToCanvas.js","utils/checkCopyright.js","utils/getEffectType.js","utils/getStamps.js","utils/getQualityFromEnv.js","routes/Done/ShareButton.js","routes/Done/utidButton.js","routes/Done/AddCartButton.js","routes/Done/compositeDesign.js","routes/Done/SaveButton.js","hooks/useTotalMemory.js","hooks/usePlatform.js","routes/Done/index.js","assets sync /^/.//.*/.svg$","utils/fabric.js"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","map","./normal.svg","./normal_press.svg","webpackContext","webpackContextResolve","__webpack_require__","Object","./Save.svg","./Save_Press.svg","./Album.svg","./Album_press.svg","AlertModal","props","languageType","useContext","LocaleContext","visible","title","description","_props$footer","footer","text","onPress","onClick","style","fontWeight","color","height","lineHeight","fontSize","background","react_default","a","createElement","es","transparent","maskClosable","animationType","className","wrapClassName","item","padding","paddingBottom","fontFamily","current","textAlign","Locale","whiteSpace","params","localeParams","RequestActivityIndicator","error","_props$hideTiming","hideTiming","type","state","_props$onHideStart","onHideStart","_props$autoHideStates","autoHideStates","useEffect","includes","setTimeout","animated","position","top","left","transform","backgroundColor","zIndex","width","display","alignItems","justifyContent","margin","flexDirection","marginBottom","src","require","bottom","asyncState","fulfilled","FontManager","addCopyrightToCanvas","_x","_x2","_addCopyrightToCanvas","apply","this","arguments","_callee","canvas","copyrightText","font","txtWidth","txtHeight","path","path1","ctx","regenerator_default","wrap","_context","prev","next","load","sent","getAdvanceWidth","getPath","fill","stroke","strokeWidth","getContext","draw","abrupt","stop","checkCopyright","layers","copyRight","index","length","layer","hasOwnProperty","String","indexOf","replace","_cache","fontPath","Promise","reject","err","sourceEnums","paint","photo","stamp","effectEnums","1","2","3","4","5","6","7","getEffectType","result","forEach","source","effect","mixType","push","getStamps","arr","stampIds","join","labelAndQualityNumberPair","full","high","medium","low","getQualityFromEnv","MODAL_HIDE_TIMING","NAVIGATE_TIMING","ShareButton","make","MakeContext","ItemContext","_useState","useState","_useState2","slicedToArray","shareLimit","setShareLimit","_useState3","_useState4","alertModelVisible","setAlertModelVisible","_useState5","_useState6","errorModelVisible","setErrorModelVisible","_useState7","_useState8","modalVisible","setModalVisible","_useState9","_useState10","cartConfirmURL","setCartConfirmURL","_useState11","none","_useState12","uploadDesignState","setUploadDesignState","_useState13","_useState14","uploadDesignError","setUploadDesignError","_useState15","_useState16","setType","realWidth","realHeight","_item$canvasArea","canvasArea","_handlePressAddCart","asyncToGenerator","mark","images","scaledCanvas","imageURL","printImageId","pending","invoke","routeName","uri","closeBtn","Array","isArray","loadImages","data","topLayer","imageTools","mergeImage","filter","Boolean","scaleImage","toDataURL","uuid","v4","imageName","imageData","requestType","itemCode","getBaseItem","item_code","effectType","JSON","stringify","stamps","success","url","t0","flagList","checkLimit","Fragment","window","innerWidth","concat","alt","marginLeft","rejected","UtidButton","uploadBtnTime","uploadBtnCnt","showUtidVisible","setShowUtidVisible","getUtidVisible","setGetUtidVisible","utid","setUtid","_getMessage","fromStore","onlyUpload","originalText","message","name","t_shirt_hash","begin","Date","getTime","opacity","components_AlertModal","getMessage","AddCartButton","cartItemCode","setCartItemCode","handlePressAddCart","confirm_url","InitializationThrottle","throttle","marginTop","getBase64Image","_ref","bottomImg","middleImg","topImg","scale","activeItem","newCopyrightData","doneImageStyle","doneStyle","doneMultiply","document","globalCompositeOperation","drawImage","compositeDesign","_x3","_compositeDesign","designData","topImgData","bottomImgData","canvas2","loremIpsumDolor","copyrightData","_ref2","_ref3","_args","undefined","doneImageSrc","fabric","Canvas","enableRetinaScaling","selection","Text","setCoords","add","getObjects","set","scaleX","scaleY","setPositionByOrigin","Point","renderAll","image","SaveToAlbumButton","loadingVisible","setLoadingVisible","panelVisible","setPanelVisible","isSavePhoto","isSavedToAPP","setIsSavedToAPP","isSavedToAlbum","setIsSavedToAlbum","saveDesignModalVisible","setSaveDesignModalVisible","saveDesignState","setSaveDesignState","_useState17","_useState18","saveDesignError","setSaveDesignError","_useState19","_useState20","router","useRouter","callback","measureText","fillStyle","strokeStyle","strokeText","fillText","_handlePressSaveData","middleImgData","thumb","passProps","decodeURI","query","isSingleWebView","cache","all","designId","setRevokeToMake","_handlePressSavePhoto","_callee3","_context3","then","_callee2","_context2","float","LoadingModal","setVisible","popup","onClose","overflow","flex","borderTop","borderBottom","stopPropagation","borderWidth","borderStyle","borderColor","formatMemory","raw","level","num","Number","list","Math","pow","useTotalMemory","_React$useState","React","UAParser","getOS","OS","injectImages","isAgainEdit","setIsAgainEdit","addLimitVisible","setAddLimitVisible","useLimitVisible","setUseLimitVisible","moreHeight","setMoreHeight","itemType","setItemType","upStep","setUpStep","totalMemory","_React$useState2","memory","setMemory","_React$useState3","asyncEnums","_React$useState4","setState","_React$useState5","_React$useState6","setError","invokeTotalMemory","useCallback","platform","usePlatform","revokeToMake","previousPage","zoom","setZoom","copyRightDone","addCopyRight","getElementById","lineWidth","addlayer","_addlayer","getDeviceLayersNumberLimit","toConsumableArray","to","hasLayer","itemModal","process","REACT_APP_ADD_LAYER_LIMIT_MODE","minMemoryLimitNumber","REACT_APP_ADD_LAYER_LIMIT_NUMBER","isNaN","layersNumberLimit","limitArr","stampFlag","stampRule","flag_layer_paint","flag_layer_text","flag_layer_stamp","flag_layer_photo","newTop","marginSize","innerHeight","element","right","mixData","navbar","page","revoke","ViewPort","size","Enlarge","showStatus","border","key","letterSpacing","components_isAgainEdit","status","isAgainFu","./Actions.svg","./AddToCart.svg","./AlwaysInFront.svg","./Arrow.svg","./Arrows.svg","./Attention.svg","./Back_Normal.svg","./Back_Pressed.svg","./Back_Pressed_Circle.svg","./BrushStyle_Normal.svg","./Btn/Glitch/Normal/01.svg","./Btn/Glitch/Normal/02.svg","./Btn/Glitch/Normal/03.svg","./Btn/Glitch/Pressed/01.svg","./Btn/Glitch/Pressed/02.svg","./Btn/Glitch/Pressed/03.svg","./Btn/Moma/Normal/01.svg","./Btn/Moma/Normal/02.svg","./Btn/Moma/Normal/03.svg","./Btn/Moma/Pressed/01.svg","./Btn/Moma/Pressed/02.svg","./Btn/Moma/Pressed/03.svg","./Btn/layout/Normal/01.svg","./Btn/layout/Normal/02.svg","./Btn/layout/Normal/03.svg","./Btn/layout/Pressed/01.svg","./Btn/layout/Pressed/02.svg","./Btn/layout/Pressed/03.svg","./Btn/mosaic/Normal/01.svg","./Btn/mosaic/Normal/02.svg","./Btn/mosaic/Normal/03.svg","./Btn/mosaic/Pressed/01.svg","./Btn/mosaic/Pressed/02.svg","./Btn/mosaic/Pressed/03.svg","./Btn/none/Normal/01.svg","./Btn/none/Normal/02.svg","./Btn/none/Normal/03.svg","./Btn/none/Pressed/Pressed.svg","./Btn/splash/Normal/01.svg","./Btn/splash/Normal/02.svg","./Btn/splash/Normal/03.svg","./Btn/splash/Pressed/01.svg","./Btn/splash/Pressed/02.svg","./Btn/splash/Pressed/03.svg","./Btn/xmoma/Normal/01.svg","./Btn/xmoma/Normal/02.svg","./Btn/xmoma/Normal/03.svg","./Btn/xmoma/Pressed/01.svg","./Btn/xmoma/Pressed/02.svg","./Btn/xmoma/Pressed/03.svg","./Camera.svg","./Camera_press.svg","./CannotContribute.svg","./CannotProduce.svg","./Close_Normal.svg","./Close_Pressed.svg","./Color_Normal_01.svg","./Color_Normal_02.svg","./Color_Normal_03.svg","./Color_Normal_04.svg","./Color_Normal_05.svg","./Color_Normal_06.svg","./Color_Normal_07.svg","./Color_Normal_08.svg","./Color_Normal_09.svg","./Complete.svg","./DeleteStampIcon.svg","./DottedStyle_Normal.svg","./Effects.svg","./Help_Normal.svg","./Help_Pressed.svg","./LayerAdd_Normal.svg","./LayerNone_Normal.svg","./Layers.svg","./LineStyle_Normal.svg","./More.svg","./NOAUTODESIGNER.svg","./NODuplicateSameSticker.svg","./NOGLITCH.svg","./NOMOSAIC.svg","./NOMoMACollage.svg","./NOMoMAEarlyMordenStyle.svg","./NOOverlap.svg","./NOPAINT.svg","./NOPHOTO.svg","./NOReverse.svg","./NORotate.svg","./NOSPLASH.svg","./NOSTAMP.svg","./NOTYPOGRAPHY.svg","./NOUseMultipleStickers.svg","./New.svg","./News.svg","./Next_Normal.svg","./Publish_Normal.svg","./RestrictedFunctions.svg","./Return_Normal.svg","./Return_Pressed.svg","./Return_Pressed_Circle.svg","./Shake_text/EN/Remix_Disable_EN.svg","./Shake_text/EN/Text_AutoDesigner_EN.svg","./Shake_text/EN/Text_AutoDesigner_EN_Pressed.svg","./Shake_text/EN/Text_Glitch_EN.svg","./Shake_text/EN/Text_Glitch_EN_Pressed.svg","./Shake_text/EN/Text_MoMACollage_EN.svg","./Shake_text/EN/Text_MoMACollage_EN_Pressed.svg","./Shake_text/EN/Text_MoMAEarlyModernStyle_EN.svg","./Shake_text/EN/Text_MoMAEarlyModernStyle_EN_Pressed.svg","./Shake_text/EN/Text_Mosaic_EN.svg","./Shake_text/EN/Text_Mosaic_EN_Pressed.svg","./Shake_text/EN/Text_NoRemix_EN.svg","./Shake_text/EN/Text_NoRemix_EN_Pressed.svg","./Shake_text/EN/Text_Splash_EN.svg","./Shake_text/EN/Text_Splash_EN_Pressed.svg","./Shake_text/JP/Remix_Disable_JP.svg","./Shake_text/JP/Text_AutoDesigner.svg","./Shake_text/JP/Text_AutoDesigner_Pressed.svg","./Shake_text/JP/Text_Glitch.svg","./Shake_text/JP/Text_Glitch_Pressed.svg","./Shake_text/JP/Text_MoMACollage.svg","./Shake_text/JP/Text_MoMACollage_Pressed.svg","./Shake_text/JP/Text_MoMAEarlyModernStyle.svg","./Shake_text/JP/Text_MoMAEarlyModernStyle_Pressed.svg","./Shake_text/JP/Text_Mosaic.svg","./Shake_text/JP/Text_Mosaic_Pressed.svg","./Shake_text/JP/Text_NoRemix.svg","./Shake_text/JP/Text_NoRemix_Pressed.svg","./Shake_text/JP/Text_Splash.svg","./Shake_text/JP/Text_Splash_Pressed.svg","./Shape/Shape_Circle.svg","./Shape/Shape_Flower_1.svg","./Shape/Shape_Flower_2.svg","./Shape/Shape_Flower_3.svg","./Shape/Shape_Flower_4.svg","./Shape/Shape_Heart.svg","./Shape/Shape_Hexagon.svg","./Shape/Shape_Parallelogram_1.svg","./Shape/Shape_Parallelogram_2.svg","./Shape/Shape_Parallelogram_3.svg","./Shape/Shape_Parallelogram_4.svg","./Shape/Shape_Quarter_circle_1.svg","./Shape/Shape_Quarter_circle_2.svg","./Shape/Shape_Quarter_circle_3.svg","./Shape/Shape_Quarter_circle_4.svg","./Shape/Shape_Rectangle.svg","./Shape/Shape_Rhombus.svg","./Shape/Shape_Right_triangle_1.svg","./Shape/Shape_Right_triangle_2.svg","./Shape/Shape_Right_triangle_3.svg","./Shape/Shape_Right_triangle_4.svg","./Shape/Shape_Rounded.svg","./Shape/Shape_Square.svg","./Shape/Shape_Star.svg","./Shape/Shape_Triangle_1.svg","./Shape/Shape_Triangle_2.svg","./Shape/Shape_Triangle_3.svg","./Shape/Shape_Triangle_4.svg","./Shape/Shape_Zebra_crossing_1.svg","./Shape/Shape_Zebra_crossing_2.svg","./Shape/Shape_Zebra_crossing_3.svg","./Shape/Shape_Zebra_crossing_4.svg","./ShapeNew/Shape_Circle.svg","./ShapeNew/Shape_Circle_Fill.svg","./ShapeNew/Shape_Flower_1.svg","./ShapeNew/Shape_Flower_1_Fill.svg","./ShapeNew/Shape_Flower_2.svg","./ShapeNew/Shape_Flower_2_Fill.svg","./ShapeNew/Shape_Flower_3.svg","./ShapeNew/Shape_Flower_3_Fill.svg","./ShapeNew/Shape_Flower_4.svg","./ShapeNew/Shape_Flower_4_Fill.svg","./ShapeNew/Shape_Heart.svg","./ShapeNew/Shape_Heart_Fill.svg","./ShapeNew/Shape_Hexagon.svg","./ShapeNew/Shape_Hexagon_Fill.svg","./ShapeNew/Shape_Parallelogram_1.svg","./ShapeNew/Shape_Parallelogram_1_Fill.svg","./ShapeNew/Shape_Parallelogram_2.svg","./ShapeNew/Shape_Parallelogram_2_Fill.svg","./ShapeNew/Shape_Parallelogram_3.svg","./ShapeNew/Shape_Parallelogram_3_Fill.svg","./ShapeNew/Shape_Parallelogram_4.svg","./ShapeNew/Shape_Parallelogram_4_Fill.svg","./ShapeNew/Shape_QuarterCircle_1.svg","./ShapeNew/Shape_QuarterCircle_1_Fill.svg","./ShapeNew/Shape_QuarterCircle_2.svg","./ShapeNew/Shape_QuarterCircle_2_Fill.svg","./ShapeNew/Shape_QuarterCircle_3.svg","./ShapeNew/Shape_QuarterCircle_3_Fill.svg","./ShapeNew/Shape_QuarterCircle_4.svg","./ShapeNew/Shape_QuarterCircle_4_Fill.svg","./ShapeNew/Shape_Rectangle.svg","./ShapeNew/Shape_Rectangle_Fill.svg","./ShapeNew/Shape_Rhombus.svg","./ShapeNew/Shape_Rhombus_Fill.svg","./ShapeNew/Shape_RightTriangle_1.svg","./ShapeNew/Shape_RightTriangle_1_Fill.svg","./ShapeNew/Shape_RightTriangle_2.svg","./ShapeNew/Shape_RightTriangle_2_Fill.svg","./ShapeNew/Shape_RightTriangle_3.svg","./ShapeNew/Shape_RightTriangle_3_Fill.svg","./ShapeNew/Shape_RightTriangle_4.svg","./ShapeNew/Shape_RightTriangle_4_Fill.svg","./ShapeNew/Shape_Rounded.svg","./ShapeNew/Shape_Rounded_Fill.svg","./ShapeNew/Shape_Square.svg","./ShapeNew/Shape_Square_Fill.svg","./ShapeNew/Shape_Star.svg","./ShapeNew/Shape_Star_Fill.svg","./ShapeNew/Shape_Triangle_1.svg","./ShapeNew/Shape_Triangle_1_Fill.svg","./ShapeNew/Shape_Triangle_2.svg","./ShapeNew/Shape_Triangle_2_Fill.svg","./ShapeNew/Shape_Triangle_3.svg","./ShapeNew/Shape_Triangle_3_Fill.svg","./ShapeNew/Shape_Triangle_4.svg","./ShapeNew/Shape_Triangle_4_Fill.svg","./ShapeNew/Shape_ZebraCrossing_1.svg","./ShapeNew/Shape_ZebraCrossing_1_Fill.svg","./ShapeNew/Shape_ZebraCrossing_2.svg","./ShapeNew/Shape_ZebraCrossing_2_Fill.svg","./ShapeNew/Shape_ZebraCrossing_3.svg","./ShapeNew/Shape_ZebraCrossing_3_Fill.svg","./ShapeNew/Shape_ZebraCrossing_4.svg","./ShapeNew/Shape_ZebraCrossing_4_Fill.svg","./Tips_Stop.svg","./and.svg","./arrow2.svg","./back/back_normal.svg","./back/back_pressed.svg","./blend-alpha-pressed.svg","./blend-alpha.svg","./blend-mask-pressed.svg","./blend-mask.svg","./blend-multiply-pressed.svg","./blend-multiply.svg","./blend-normal-pressed.svg","./blend-normal.svg","./blend-screen-pressed.svg","./blend-screen.svg","./brush-style-pressed.svg","./brush-style.svg","./centerAlign.svg","./check.svg","./close-normal.svg","./close-normalchange.svg","./color.svg","./dotted-style-pressed.svg","./dotted-style.svg","./editArea.svg","./eraser.svg","./eraser_selected_normal.svg","./eraser_selected_pressed.svg","./error.svg","./failed.svg","./font-normal.svg","./home/en/paint_text_normal.170x110.svg","./home/en/paint_text_normal.svg","./home/en/paint_text_pressed.170x110.svg","./home/en/paint_text_pressed.svg","./home/en/pic_text_normal.170x110.svg","./home/en/pic_text_normal.svg","./home/en/pic_text_pressed.170x110.svg","./home/en/pic_text_pressed.svg","./home/en/stamp_text_normal.170x110.svg","./home/en/stamp_text_normal.svg","./home/en/stamp_text_pressed.170x110.svg","./home/en/stamp_text_pressed.svg","./home/en/text_text_normal.170x110.svg","./home/en/text_text_normal.svg","./home/en/text_text_pressed.170x110.svg","./home/en/text_text_pressed.svg","./home/jp/Text_Text_pressed-1.svg","./home/jp/paint_text_normal.170x110.svg","./home/jp/paint_text_normal.svg","./home/jp/paint_text_pressed.170x110.svg","./home/jp/paint_text_pressed.svg","./home/jp/pic_text_normal.170x110.svg","./home/jp/pic_text_normal.svg","./home/jp/pic_text_pressed.170x110.svg","./home/jp/pic_text_pressed.svg","./home/jp/stamp_text_normal.170x110.svg","./home/jp/stamp_text_normal.svg","./home/jp/stamp_text_pressed.170x110.svg","./home/jp/stamp_text_pressed.svg","./home/jp/text_text_normal.170x110.svg","./home/jp/text_text_normal.svg","./home/jp/text_text_pressed.170x110.svg","./home/jp/text_text_pressed.svg","./icon-brush.svg","./keyboard/keyboard_normal_black.svg","./keyboard/keyboard_normal_white.svg","./keyboard/keyboard_pressed_black.svg","./leftAlign.svg","./line-style-pressed.svg","./line-style.svg","./link.svg","./make_text/paint_text_normal_en_android.svg","./make_text/paint_text_normal_en_ios.svg","./make_text/paint_text_normal_ja_android.svg","./make_text/paint_text_normal_ja_ios.svg","./make_text/paint_text_pressed_en_android.svg","./make_text/paint_text_pressed_en_ios.svg","./make_text/paint_text_pressed_ja_android.svg","./make_text/paint_text_pressed_ja_ios.svg","./make_text/photo_text_normal_en_android.svg","./make_text/photo_text_normal_en_ios.svg","./make_text/photo_text_normal_ja_android.svg","./make_text/photo_text_normal_ja_ios.svg","./make_text/photo_text_pressed_en_android.svg","./make_text/photo_text_pressed_en_ios.svg","./make_text/photo_text_pressed_ja_android.svg","./make_text/photo_text_pressed_ja_ios.svg","./make_text/stamp_text_normal_en_android.svg","./make_text/stamp_text_normal_en_ios.svg","./make_text/stamp_text_normal_ja_android.svg","./make_text/stamp_text_normal_ja_ios.svg","./make_text/stamp_text_pressed_en_android.svg","./make_text/stamp_text_pressed_en_ios.svg","./make_text/stamp_text_pressed_ja_android.svg","./make_text/stamp_text_pressed_ja_ios.svg","./make_text/text_text_normal_en_android.svg","./make_text/text_text_normal_en_ios.svg","./make_text/text_text_normal_ja_android.svg","./make_text/text_text_normal_ja_ios.svg","./make_text/text_text_pressed_en_android.svg","./make_text/text_text_pressed_en_ios.svg","./make_text/text_text_pressed_ja_android.svg","./make_text/text_text_pressed_ja_ios.svg","./mix-1.svg","./mix-2.svg","./mix-3.svg","./mix-4.svg","./mix-5.svg","./mix-6.svg","./mode-normal.svg","./moma-normal-02.svg","./moma-normal.svg","./mosaic-circle-pressed.svg","./mosaic-circle-style-pressed.svg","./mosaic-circle-style.svg","./mosaic-circle.svg","./mosaic-normal.svg","./mosaic-round-rect-pressed.svg","./mosaic-round-rect-style-pressed.svg","./mosaic-round-rect-style.svg","./mosaic-round-rect.svg","./mosaic-square-pressed.svg","./mosaic-square-style-pressed.svg","./mosaic-square-style.svg","./mosaic-square.svg","./mosaicCircle_Normal.svg","./mosaicCircle_Pressed.svg","./mosaicSquare_Normal.svg","./mosaicSquare_Pressed.svg","./newSave.svg","./next-disabel.svg","./next_disabel.svg","./paint.svg","./photo.svg","./play-normal.svg","./prohibit.svg","./prohibit/allowed/NODuplicateSameSticker.svg","./prohibit/allowed/NOOverlap.svg","./prohibit/allowed/NOReverse.svg","./prohibit/allowed/NORotate.svg","./prohibit/allowed/NOUseMultipleStickers.svg","./prohibit/allowed/duplicate-same-sticker-normal.svg","./prohibit/allowed/overlap-normal.svg","./prohibit/allowed/reverse-normal.svg","./prohibit/allowed/rotate-normal.svg","./prohibit/allowed/use-multiple-stickers-normal.svg","./prohibit/effects/NOAUTODESIGNER.svg","./prohibit/effects/NOGLITCH.svg","./prohibit/effects/NOMOSAIC.svg","./prohibit/effects/NOMoMACollage.svg","./prohibit/effects/NOMoMAEarlyMordenStyle.svg","./prohibit/effects/NOSPLASH.svg","./prohibit/effects/autodesigner-normal.svg","./prohibit/effects/glitch-normal.svg","./prohibit/effects/mo-ma-collage-normal.svg","./prohibit/effects/mo-ma-early-morden-style-normal.svg","./prohibit/effects/mosaic-normal.svg","./prohibit/effects/splash-normal.svg","./prohibit/layers/NOPAINT.svg","./prohibit/layers/NOPHOTO.svg","./prohibit/layers/NOSTAMP.svg","./prohibit/layers/NOTYPOGRAPHY.svg","./prohibit/layers/paint-normal.svg","./prohibit/layers/photo-normal.svg","./prohibit/layers/stamp-normal.svg","./prohibit/layers/typography-normal.svg","./prohibit/restricted/AlwaysInFront.svg","./prohibit/restricted/CannotContribute.svg","./prohibit/restricted/CannotProduce.svg","./remix_gif/none_Normal.svg","./remix_gif/none_Pressed.svg","./return-normal.svg","./return-normalchange.svg","./return-pressed.svg","./return/return_normal.svg","./return/return_pressed.svg","./rightAlign.svg","./rotate-normal.svg","./shape-normals/Shape_Circle_normal.svg","./shape-normals/Shape_Flower_normal_1.svg","./shape-normals/Shape_Flower_normal_2.svg","./shape-normals/Shape_Flower_normal_3.svg","./shape-normals/Shape_Flower_normal_4.svg","./shape-normals/Shape_Heart_normal.svg","./shape-normals/Shape_Hexagon_normal.svg","./shape-normals/Shape_Parallelogram_normal_1.svg","./shape-normals/Shape_Parallelogram_normal_2.svg","./shape-normals/Shape_Parallelogram_normal_3.svg","./shape-normals/Shape_Parallelogram_normal_4.svg","./shape-normals/Shape_Quarter_circle_normal_1.svg","./shape-normals/Shape_Quarter_circle_normal_2.svg","./shape-normals/Shape_Quarter_circle_normal_3.svg","./shape-normals/Shape_Quarter_circle_normal_4.svg","./shape-normals/Shape_Rectangle_normal.svg","./shape-normals/Shape_Rhombus_normal.svg","./shape-normals/Shape_Right_triangle_normal_1.svg","./shape-normals/Shape_Right_triangle_normal_2.svg","./shape-normals/Shape_Right_triangle_normal_3.svg","./shape-normals/Shape_Right_triangle_normal_4.svg","./shape-normals/Shape_Rounded_normal.svg","./shape-normals/Shape_Square_normal.svg","./shape-normals/Shape_Star_normal.svg","./shape-normals/Shape_Triangle_normal_1.svg","./shape-normals/Shape_Triangle_normal_2.svg","./shape-normals/Shape_Triangle_normal_3.svg","./shape-normals/Shape_Triangle_normal_4.svg","./shape-normals/Shape_Zebra_crossing_normal_1.svg","./shape-normals/Shape_Zebra_crossing_normal_2.svg","./shape-normals/Shape_Zebra_crossing_normal_3.svg","./shape-normals/Shape_Zebra_crossing_normal_4.svg","./stamp.svg","./stop-normal.svg","./text-color-normal.svg","./text.svg","./textBoxIconBackground.svg","./thick_brush_selected_Pressed.svg","./thick_brush_selected_normal.svg","./thin-brush.svg","./thin_brush_selected_normal.svg","./thin_brush_selected_pressed.svg","./triangle.svg","./typeColorBtnRed.svg","./warning.svg","Buffer","proto","version","jsdom","decodeURIComponent","features","FetchExternalResources","jsdomImplForWrapper","implForWrapper","nodeCanvas","defaultView","DOMParser","isTouchSupported","navigator","maxTouchPoints","isLikelyNode","SHARED_ATTRIBUTES","DPI","reNum","fontPaths","iMatrix","canvasModule","perfLimitSizeTotal","maxCacheSideLimit","minCacheSideLimit","charWidthsCache","textureSize","enableGLFiltering","devicePixelRatio","webkitDevicePixelRatio","mozDevicePixelRatio","browserShadowBlurConstant","arcToSegmentsCache","boundsOfCurveCache","cachesBoundsOfCurve","initFilterBackend","isWebglSupported","WebglFilterBackend","tileSize","Canvas2dFilterBackend","eventjs","root","modifyEventListener","modifySelectors","configure","conf","isFinite","eventListenersAgumented","augmentEventListeners","selectorsAugmented","augmentSelectors","target","listener","eventManager","remove","returnFalse","event","cancelBubble","cancelBubbleCount","prevent","preventDefault","preventManipulation","returnValue","cancel","blur","node","activeElement","nodeName","contentEditable","getEventSupport","setAttribute","removeAttribute","isSupported","clone","obj","temp","constructor","trigger","fromOverwrite","param","value","ret","split","o","k","n","eventjs_stallOnReady","time","timeout","ms","interval","setInterval","clearInterval","querySelector","querySelectorAll","createError","events","n0","length0","createBatchCommands","toLowerCase","n1","length1","substr","useCapture","getID","Gesture","_gestureHandlers","wrappers","useCall","tmp","self","call","gesture","proxy","eventId","eventList","getEventList","console","pointerDefs","msPointer","touch","mouse","pointerDetect","MSPointerDown","MSPointerMove","MSPointerUp","touchstart","touchmove","touchend","mousedown","mousemove","mouseup","supports","msPointerEnabled","prefix","addEventListener","idx","types","counter","object","uniqueID","removeEventListener","createPointerEvent","preventRecord","eventName","pts","changedTouches","getCoords","pt","pointers","pageX","pageY","x","y","newEvent","createEvent","initEvent","originalEvent","oldListener","HTMLElement","augmentEventListener","recall","handle","handler","userAgent","match","HTMLDivElement","prototype","HTMLCanvasElement","NodeList","pointerSetup","doc","ownerDocument","minFingers","fingers","maxFingers","Infinity","enabled","env","defaultListener","onPointerDown","onPointerMove","onPointerUp","reset","pause","opt","move","up","resume","tracker","sp","isMouse","isMSPointer","isTouch","pointerStart","toUpperCase","addTouchStart","sid","bbox","track","offsetX","offsetY","x1","y1","scrollLeft","scrollTop","rotation","startTime","moveTime","start","isTouchStart","touches","i","identifier","ids","rid","getBoundingBox","pointerEnd","exists","gestureFingers","pointerId","documentElement","clientX","clientY","getCoord","pX","pY","getPropertyAsFloat","parseFloat","getPropertyValue","body","bcr","getBoundingClientRect","offsetWidth","offsetHeight","getComputedStyle","x2","y2","parentNode","scrollBodyLeft","pageXOffset","scrollBodyTop","pageYOffset","metaKeys","agent","mac","91","93","224","17","metaTrackerReset","fnKey","metaKey","escKey","ctrlKey","shiftKey","altKey","metaTracker","isKeyDown","keyCode","MutationObserver","WebKitMutationObserver","MozMutationObserver","DOMAttrModifiedSupported","p","flag","fn","attachEvent","container","mutations","attributeName","observe","subtree","attributes","attrName","propertyName","click","pointer","newbbox","point","dbltap","dblclick","time0","time1","pointer0","pointer1","clearTimeout","ax","ay","abs","dragElement","that","drag","monitor","RAD_DEG","PI","getCentroid","points","centroidx","centroidy","sids","parseInt","distance","dx","dy","sqrt","angle","atan2","rotate","DEG2","DEG1","pointerdown","pointermove","pointerup","isPointerEmitter","isDown","shake","acceleration","accelerationIncludingGravity","onDeviceMotion","lastShake","gravity","z","delta","count","now","letter","ACCELERATION","DELTA","span","swipe","snap","threshold","velocity1","degree1","endx","endy","xdist","ydist","degree2","velocity2","velocity","longpress","tap","timestamp","delay","driftDeviance","end","wheelPreventElasticBounce","el","preventElasticBounce","wheel","wheelDelta","scrollHeight","onMouseWheel","detail","Event","copyGLTo2DDrawImage","gl","pipelineState","glCanvas","targetCanvas","translate","sourceY","copyGLTo2DPutImageData","dWidth","destinationWidth","dHeight","destinationHeight","numBytes","u8","Uint8Array","imageBuffer","u8Clamped","Uint8ClampedArray","readPixels","RGBA","UNSIGNED_BYTE","imgData","ImageData","putImageData","orientation","previous","onOrientationChange","DeviceOrientationEvent","_removeEventListener","__eventListeners","eventListener","util","array","prop","on","stopObserving","fire","options","listenersForEvent","len","Observable","off","Collection","_objects","_onObjectAdded","renderOnAddRemove","requestRenderAll","insertAt","nonSplicing","objects","splice","somethingRemoved","_onObjectRemoved","forEachObject","context","isEmpty","contains","complexity","reduce","memo","CommonMethods","_setOptions","_initGradient","filler","property","colorStops","Gradient","_initPattern","Pattern","_initClipping","clipTo","functionBody","getFunctionBody","Function","_setObject","_set","get","toggle","global","PiBy180","PiBy2","cos","sin","sign","removeFromArray","getRandomInt","min","max","floor","random","degreesToRadians","degrees","radiansToDegrees","radians","rotatePoint","origin","subtractEquals","v","rotateVector","addEquals","vector","transformPoint","t","ignoreOffset","makeBoundingBoxFromPoints","xPoints","minX","yPoints","minY","invertTransform","r","toFixed","number","fractionDigits","parseUnit","unit","exec","DEFAULT_SVG_FONT_SIZE","falseFunction","getKlass","namespace","string","camelize","charAt","slice","resolveNamespace","getSvgAttributes","parts","loadImage","crossOrigin","img","createImage","onLoadCallback","onload","onerror","log","substring","loadImageInDom","div","appendChild","removeChild","enlivenObjects","reviver","onLoaded","numLoadedObjects","numTotalObjects","enlivenedObjects","fromObject","enlivenPatterns","patterns","numLoadedPatterns","numPatterns","enlivenedPatterns","pattern","groupSVGElements","elements","centerPoint","Group","sourcePath","populateWithProperties","destination","properties","toString","drawDashedLine","da","rot","dc","di","save","moveTo","restore","createCanvasElement","copyCanvasElement","newCanvas","clipContext","receiver","beginPath","clip","multiplyTransformMatrices","b","is2x2","qrDecompose","denom","skewX","skewY","translateX","translateY","customTransformMatrix","skewMatrixX","tan","scaleMatrix","resetObjectTransform","flipX","flipY","saveObjectTransform","isTransparent","tolerance","_isTransparent","l","getImageData","parsePreserveAspectRatioAttribute","attribute","align","meetOrSlice","aspectRatioAttrs","pop","alignX","alignY","clearFabricFontCache","limitDimsByArea","ar","maximumArea","roughWidth","perfLimitSizeY","capValue","findScaleToFit","findScaleToCover","_join","arcToSegments","toX","toY","rx","ry","large","sweep","rotateX","argsString","th","sinTh","cosTh","fromX","fromY","px","py","rx2","ry2","py2","px2","pl","s","cx","cy","cx1","cy1","mTheta","calcVectorAngle","dtheta","segments","ceil","mDelta","mT","th3","segmentToBezier","th2","costh2","sinth2","costh3","sinth3","ux","uy","vx","vy","ta","tb","getBoundsOfCurve","x0","y0","x3","y3","c","t1","t2","b2ac","sqrtb2ac","tvalues","bounds","mt","j","jlen","drawArc","fx","fy","coords","segs","segsNorm","bezierCurveTo","getBoundsOfArc","tx","ty","bound","find","byProperty","condition","method","args","value1","value2","extend","deep","Element","getWholeChar","str","charCodeAt","character","capitalize","firstLetterOnly","escapeXml","graphemeSplit","textstring","chr","graphemes","emptyFunction","IS_DONTENUM_BUGGY","addMethods","klass","parent","superclass","valueOf","Subclass","callSuper","methodName","parentMethod","_this","superClassMethod","createClass","initialize","shift","subclasses","unknown","areHostMethods","methodNames","test","getElement","setElement","getUniqueId","uid","__uniqueID","createWrappedHandler","addListener","removeListener","shouldUseAddListenerRemoveListener","shouldUseAttachEventDetachEvent","listeners","handlers","wrappedHandler","createListener","detachEvent","existingHandler","handlersForEvent","createDispatcher","pointerX","pointerY","_getPointer","pageProp","clientProp","eventTouchProp","getPointer","srcElement","scroll","getScrollLeftTop","parseEl","supportsOpacity","supportsFilters","reOpacity","setOpacity","currentStyle","hasLayout","setStyle","styles","elementStyle","cssText","styleFloat","_slice","sliceCanConvertNodelists","getElementStyle","toArray","arrayLike","childNodes","makeElement","tagName","htmlFor","docElement","host","nodeType","attr","selectProp","makeElementUnselectable","onselectstart","unselectable","makeElementSelectable","getScript","headEl","getElementsByTagName","scriptEl","loading","onreadystatechange","readyState","getById","addClass","wrapElement","wrapper","replaceChild","getElementOffset","docElem","scrollLeftTop","box","offset","offsetAttributes","borderLeftWidth","borderTopWidth","paddingLeft","paddingTop","clientLeft","clientTop","getNodeCanvas","impl","_canvas","_image","cleanUpJsdomNode","_currentSrc","_attributes","_classList","emptyFn","request","onComplete","xhr","XMLHttpRequest","parameters","addParamToUrl","open","setRequestHeader","send","warn","noop","_requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","_cancelAnimFrame","cancelAnimationFrame","requestAnimFrame","animate","duration","finish","onChange","abort","easing","d","startValue","endValue","byValue","onStart","tick","ticktime","currentTime","timePerc","valuePerc","cancelAnimFrame","animateColor","fromColor","toColor","startColor","Color","getSource","endColor","pos","calculateColor","colorEasing","normalize","asin","elastic","opts","easeInBounce","easeOutBounce","ease","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInOutBounce","attributesMap","visibility","fill-opacity","fill-rule","font-family","font-size","font-style","font-weight","letter-spacing","paint-order","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-decoration","text-anchor","clip-path","clip-rule","colorAttributes","normalizeAttr","normalizeValue","parentAttributes","parsed","transformMatrix","parseTransformAttribute","fillIndex","strokeIndex","getSvgRegex","RegExp","_getMultipleNodes","nodeNames","nodeList","nodeArray","elementMatchesRule","selectors","firstMatching","parentMatching","selectorMatches","selector","doesSomeParentMatch","matcher","classNames","getAttribute","elementById","nodelist","svgValidTagNamesRegEx","svgViewBoxElementsRegEx","svgInvalidAncestorsRegEx","svgValidParentsRegEx","cssRules","gradientDefs","clipPaths","skewMatrix","matrix","commaWsp","reTransformList","reTransform","attributeValue","matrices","m","operation","translateMatrix","rotateMatrix","multiplierX","multiplierY","combinedMatrix","reViewBoxAttrValue","applyViewboxTransform","viewBoxWidth","viewBoxHeight","viewBoxAttr","widthAttr","heightAttr","preserveAspectRatio","missingViewBox","missingDimAttr","toBeParsed","parsedDim","widthDiff","heightDiff","viewboxTransform","firstChild","recursivelyParseGradientsXlink","gradient","referencedGradient","hasAttribute","children","referenceClone","cloneNode","parseSVGDocument","parsingOptions","attrs","xlink","el2","currentTrans","oldLength","el3","nodeValue","parseUseDirectives","svgUid","__uid","descendants","selectNodes","hasAncestorWithNodeName","getGradientDefs","getCSSRules","parseElements","instances","reFontDeclaration","parseFontDeclaration","oStyle","fontStyle","elList","parseAttributes","parentFontSize","ownAttributes","rule","getGlobalStylesForElement","parseStyleAttribute","normalizedAttr","normalizedValue","normalizedStyle","mergedAttrs","setAlpha","getAlpha","toRgba","_setStrokeFillOpacity","ElementsParser","parse","chunk","pair","trim","parseStyleString","parseStyleObject","parsePointsAttribute","parsedPoints","allRules","styleContents","textContent","ruleObj","propertyValuePairs","_rule","loadSVGFromURL","xml","responseXML","ActiveXObject","responseText","async","loadXML","results","_options","allElements","loadSVGFromString","parser","parseFromString","regexUrl","numElements","createObjects","createObject","findTag","fromElement","createCallback","checkIfDone","resolveGradient","Image","_originalElement","_removeTransformMatrix","resolveClipPath","extractPropertyDefinition","storage","lastIndex","gradientDef","createClipPathCallback","_newObj","fillRule","clipRule","objTransformInv","gTransform","clipPath","calcTransformMatrix","scalarAdd","scalar","scalarAddEquals","subtract","scalarSubtract","scalarSubtractEquals","multiply","multiplyEquals","divide","divideEquals","eq","lt","lte","gt","gte","lerp","distanceFrom","midPointFrom","setXY","setX","setY","setFromPoint","swap","Intersection","appendPoint","appendPoints","intersectLineLine","a1","a2","b1","b2","uaT","ubT","uB","ua","ub","intersectLinePolygon","inter","intersectPolygonPolygon","points1","points2","intersectPolygonRectangle","r1","r2","topRight","bottomLeft","inter1","inter2","inter3","inter4","_tryParsingColor","setSource","hue2rgb","q","colorNameMap","sourceFromHex","sourceFromRgb","sourceFromHsl","_rgbToHsl","g","h","round","_source","toRgb","toHsl","hsl","toHsla","toHex","toHexa","alpha","toGrayscale","average","currentAlpha","toBlackWhite","overlayWith","otherColor","otherSource","reRGBa","reHSLa","reHex","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgrey","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","fromRgb","fromSource","fromRgba","fromHsl","fromHsla","fromHex","isShortNotation","isRGBa","oColor","getColorStop","colorAlpha","keyValuePairs","_convertPercentUnitsToValues","gradientUnits","propValue","addFactor","multFactor","ellipseMatrix","scaleFactor","gradientTransform","addColorStop","toObject","propertiesToInclude","toSVG","markup","commonAttributes","needsSwap","sort","pathOffset","reverse","minRadius","percentageShift","colorStop","toLive","createLinearGradient","createRadialGradient","instance","colorStopEls","getLinearCoords","getRadialCoords","forObject","repeat","patternTransform","setOptions","NUM_FRACTION_DIGITS","patternSource","patternWidth","patternHeight","patternOffsetX","patternOffsetY","patternImgSrc","complete","naturalWidth","naturalHeight","createPattern","Shadow","affectStroke","includeDefaultValues","_parseShadow","shadow","shadowStr","offsetsAndBlur","reOffsetsAndBlur","fBoxX","fBoxY","StaticCanvas","CANVAS_INIT_ERROR","renderAndResetBound","renderAndReset","bind","requestRenderAllBound","_initStatic","backgroundImage","overlayColor","overlayImage","stateful","controlsAboveOverlay","allowTouchScrolling","imageSmoothingEnabled","viewportTransform","backgroundVpt","overlayVpt","onBeforeScaleRotate","vptCoords","skipOffscreen","cb","_createLowerCanvas","_initOptions","_setImageSmoothing","interactive","_initRetinaScaling","setOverlayImage","setBackgroundImage","setBackgroundColor","setOverlayColor","calcOffset","_isRetinaScaling","getRetinaScaling","lowerCanvasEl","contextContainer","_offset","__setBgOverlayImage","__setBgOverlayColor","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","_createCanvasElement","canvasEl","_applyCanvasStyle","getWidth","getHeight","setWidth","setDimensions","setHeight","dimensions","cssValue","cssOnly","_setBackstoreDimension","hasLostContext","backstoreOnly","_setCssDimension","_isCurrentlyDrawing","freeDrawingBrush","_setBrushStyles","upperCanvasEl","cacheCanvasEl","wrapperEl","getZoom","setViewportTransform","vpt","activeObject","_activeObject","group","calcViewportBoundaries","zoomToPoint","before","after","absolutePan","relativePan","setupState","clearContext","clearRect","clear","_hasITextHandlers","_mouseUpITextHandler","_iTextInstances","canvasToDrawOn","renderCanvas","isRendering","iVpt","tl","br","tr","bl","cancelRequestedRender","_renderBackground","_renderObjects","drawControls","shouldCache","_transformDone","renderCache","forClipping","drawClipPathOnCanvas","_renderOverlay","zoomX","zoomY","_cacheCanvas","cacheTranslationX","cacheTranslationY","render","_renderBackgroundOrOverlay","fillRect","getCenter","centerObjectH","_centerObject","getCenterPoint","centerObjectV","centerObject","center","viewportCenterObject","vpCenter","getVpCenter","viewportCenterObjectH","viewportCenterObjectV","toDatalessJSON","toDatalessObject","_toObjectMethod","_toObjects","__serializeBgOverlay","excludeFromExport","_toObject","originalValue","bgImage","overlay","svgViewportTransformation","_setSVGPreamble","_setSVGHeader","clipPathId","_setSVGBgOverlayColor","_setSVGBgOverlayImage","_setSVGObjects","suppressPreamble","encoding","viewBox","createSVGFontFacesMarkup","createSVGRefElementsMarkup","createSVGClipPathMarkup","toClipPathSVG","row","rowIndex","charIndex","fontList","_setSVGObject","finalWidth","finalHeight","sendToBack","objs","activeSelection","unshift","bringToFront","sendBackwards","intersecting","newIdx","objsMoved","_findNewLowerIndex","intersectsWithObject","isContainedWithinObject","bringForward","_findNewUpperIndex","dispose","DataURLExporter","EMPTY_JSON","setLineDash","toJSON","createPNGStream","createJPEGStream","BaseBrush","strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeDashArray","setShadow","contextTop","lineCap","miterLimit","lineJoin","_saveAndTransform","_setShadow","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","_resetShadow","PencilBrush","_points","_drawSegment","p1","p2","midPoint","quadraticCurveTo","onMouseDown","_prepareForDrawing","_captureDrawingPath","_render","onMouseMove","needsFullRender","oldEnd","onMouseUp","_finalizeAndAddPath","_reset","_addPoint","pointerPoint","lineTo","convertPointsToSVGPath","multSignX","multSignY","manyPoints","createPath","pathData","Path","translateToGivenOrigin","originX","originY","closePath","CircleBrush","drawDot","addPoint","arc","radius","originalRenderOnAddRemove","circles","circle","Circle","circleRadius","circleColor","SprayBrush","density","dotWidth","dotWidthVariance","randomOpacity","optimizeOverlapping","sprayChunks","addSprayChunk","sprayChunkPoints","rects","ilen","sprayChunk","rect","Rect","_getOptimizedRects","uniqueRects","uniqueRectsArray","globalAlpha","PatternBrush","getPatternSrc","patternCanvas","patternCtx","getPatternSrcFunction","getPattern","topLeft","_getLeftTopCoords","supportLineDash","_initInteractive","_createCacheCanvas","uniScaleTransform","uniScaleKey","centeredScaling","centeredRotation","centeredKey","altActionKey","selectionKey","altSelectionKey","selectionColor","selectionDashArray","selectionBorderColor","selectionLineWidth","selectionFullyContained","hoverCursor","moveCursor","defaultCursor","freeDrawingCursor","rotationCursor","notAllowedCursor","containerClass","perPixelTargetFind","targetFindTolerance","skipTargetFind","isDrawingMode","preserveObjectStacking","snapAngle","snapThreshold","stopContextMenu","fireRightClick","fireMiddleClick","_currentTransform","_groupSelector","_initWrapperElement","_createUpperCanvas","_initEventListeners","_chooseObjectsToRender","objsToRender","activeGroupObjects","activeObjects","getActiveObjects","contextTopDirty","renderTopLayer","_drawSelection","renderTop","_resetCurrentTransform","original","_shouldCenterTransform","mouseXSign","mouseYSign","containsPoint","xy","_normalizePointer","_findTargetCorner","invertedM","vptPointer","restorePointerVpt","isTargetTransparent","normalizedPointer","targetRelativeX","targetRelativeY","_cacheContext","contextCache","originalColor","selectionBackgroundColor","_renderControls","hasBorders","transparentCorners","_isSelectionKeyPressed","_shouldClearSelection","evented","selectable","centerTransform","action","_getOriginFromCorner","corner","_getActionFromCorner","alreadySelected","_setupCurrentTransform","ex","ey","lastX","lastY","theta","_beforeTransform","_translateObject","newLeft","moveX","moveY","_changeSkewTransformOrigin","mouseMove","by","origins","0","skew","originA","originB","flipSign","skewSign","_skewObject","skewed","lockSkewingX","lockSkewingY","actualMouseByOrigin","constraintPosition","actualMouseByCenter","toLocalPoint","lastMouseByCenter","dim","_getTransformedDimensions","translateToOriginPoint","_setObjectSkew","localMouse","_dim","newValue","newDim","dimNoSkew","otherBy","_otherBy","_by","newDimMouse","atan","_scaleObject","lockScalingX","lockScalingY","lockScalingFlip","scaled","_setLocalMouse","_setObjectScale","changeX","changeY","forbidScalingX","forbidScalingY","_scaleObjectEqually","newScaleX","newScaleY","_flipObject","dist","lastDist","signX","signY","_rotateObject","lockRotation","lastAngle","curAngle","hasRotated","rightAngleLocked","leftAngleLocked","setCursor","cursor","groupSelector","aleft","atop","_setLineDash","strokeRect","findTarget","skipGroup","activeTarget","activeTargetSubs","aObjects","targets","_searchPossibleTargets","_checkTarget","globalPointer","isEditing","subTarget","objToCheck","pointerToUse","subTargetCheck","ignoreZoom","_absolutePointer","_pointer","cssScale","boundsWidth","boundsHeight","lowerCanvasClass","_copyCanvasStyle","class","touch-action","fromEl","toEl","getSelectionContext","getSelectionElement","getActiveObject","active","_discardActiveObject","_hoveredTarget","_fireSelectionEvents","oldObjects","somethingChanged","added","removed","oldObject","selected","deselected","updated","setActiveObject","currentActives","_setActiveObject","onSelect","onDeselect","discardActiveObject","removeListeners","originalProperties","_realizeGroupTransformOnObject","_unwindGroupTransformOnObject","originalValues","realizeTransform","clearContextTop","_setCursorFromEvent","cursorOffset","mr","mb","ml","addEventOptions","passive","checkClick","which","button","cursorMap","_bindEvents","addOrRemove","functor","eventjsFunctor","_onResize","_onMouseDown","_onMouseMove","_onMouseOut","_onMouseEnter","_onMouseWheel","_onContextMenu","_onDoubleClick","_onDragOver","_onDragEnter","_onDragLeave","_onDrop","_onGesture","_onDrag","_onOrientationChange","_onShake","_onLongPress","_onMouseUp","eventsBound","_simpleEventHandler","__onTransformGesture","__onDrag","__onMouseWheel","hiddenTextarea","focus","__onOrientationChange","__onShake","__onLongPress","_fireEnterLeaveEvents","_cacheTransformEventData","_handleEvent","_resetTransformEventData","__onMouseDown","__onMouseUp","__onMouseMove","_shouldRender","shouldRender","isClick","_target","_onMouseUpInDrawingMode","_finalizeCurrentTransform","actionPerformed","_maybeGroupObjects","isMoving","__corner","eventType","subTargets","absolutePointer","_scaling","hasStateChanged","_addEventOptions","_fire","_onMouseDownInDrawingMode","_onMouseMoveInDrawingMode","_previousPointer","shouldGroup","_shouldGroup","_handleGrouping","saveState","_transformObject","_fireOverOutEvents","fireSynteticInOutEvents","targetName","canvasEvtOut","evtOut","canvasEvtIn","evtIn","config","inOpt","outOpt","inFires","oldTarget","targetChanged","previousTarget","nextTarget","_beforeScaleTransform","_performTransformAction","_onScale","_isUniscalePossible","currentAction","getCornerCursor","actionIsDisabled","_getRotatedCornerCursor","hasRotatingPoint","_updateActiveSelection","_createActiveSelection","currentActiveObjects","removeWithUpdate","addWithUpdate","_createGroup","groupObjects","exitEditing","ActiveSelection","_groupSelectedObjects","aGroup","_collectObjects","currentObject","selectionX1Y1","selectionX2Y2","allowIntersect","intersectsWithRect","isContainedWithinRect","supportQuality","format","quality","multiplier","cropping","__toDataURLWithMultiplier","origWidth","origHeight","scaledWidth","scaledHeight","newZoom","vp","newVp","originalInteractive","originalSkipOffScreen","needsResize","__toDataURL","loadFromDatalessJSON","json","loadFromJSON","serialized","_enlivenObjects","_setBgOverlay","loaded","cbIfLoaded","__setBgOverlay","enlivedObject","_toDataURL","_toDataURLWithMultiplier","toDataURLWithMultiplier","cloneWithoutData","backgroundImageOpacity","backgroundImageStretch","__gesturesParams","__gesturesRenderer","_scaleObjectBy","_rotateObjectByAngle","supportsLineDash","objectCaching","cornerSize","borderDashArray","cornerColor","cornerStrokeColor","cornerStyle","cornerDashArray","strokeDashOffset","borderOpacityWhenMoving","borderScaleFactor","minScaleLimit","hasControls","rotatingPointOffset","lockMovementX","lockMovementY","lockUniScaling","statefullCache","noScaleCache","dirty","paintFirst","stateProperties","cacheProperties","inverted","absolutePositioned","_cacheProperties","_updateCacheCanvas","_limitCacheSize","dims","limitedDims","capped","_getCacheCanvasDimensions","objectScale","getTotalObjectScaling","_getNonTransformedDimensions","drawingWidth","drawingHeight","minCacheSize","dimensionsChanged","cacheWidth","cacheHeight","zoomChanged","shouldRedraw","additionalWidth","additionalHeight","shouldResizeCanvas","canvasWidth","canvasHeight","sizeGrowing","setTransform","calcOwnMatrix","_removeDefaultValues","getObjectScaling","scaling","retina","getObjectOpacity","shouldConstrainValue","isChanged","groupNeedsUpdate","_constrainScale","isOnACache","setOnGroup","getViewportTransform","isNotVisible","isOnScreen","_setupCompositeOperation","drawSelectionBackground","_setOpacity","drawCacheOnCanvas","_removeCacheCanvas","drawObject","propertySet","isCacheDirty","needsItsOwnCache","ownCaching","willDrawShadow","drawClipPathOnCache","_setClippingProperties","_setStrokeStyles","_setFillStyles","_drawClipPath","skipCanvas","_removeShadow","decl","lineDashOffset","dashArray","alternative","styleOverride","drawBorders","forActiveSelection","drawBordersInGroup","multX","multY","_applyPatternGradientTransform","_renderPaintInOrder","_renderStroke","_renderFill","_renderDashedStroke","_findCenterFromElement","_assignTransformMatrixProps","preserveAspectRatioOptions","cropX","cropY","offsetLeft","offsetTop","objectForm","_fromObject","cloneAsImage","dataUrl","utils","origParams","originalShadow","withoutTransform","withoutShadow","boundingRect","getBoundingRect","shadowOffset","originalCanvas","isType","setGradient","setPatternFill","setColor","shouldCenterOrigin","_setOriginToCenter","_resetOrigin","centerH","viewportCenterH","centerV","viewportCenterV","viewportCenter","getLocalPointer","pClicked","objectLeftTop","createAccessors","extraParam","enlivedProps","originXOffset","originYOffset","fromOriginX","fromOriginY","toOriginX","toOriginY","translateToCenterPoint","leftTop","getPointByOrigin","adjustPosition","offsetFrom","offsetTo","hypotFull","getScaledWidth","xFull","yFull","_originalOriginX","_originalOriginY","originPoint","multiplyMatrices","oCoords","aCoords","ownMatrixCache","matrixCache","absolute","calculate","calcCoords","pointTL","pointBR","other","lines","_getImageLines","_findCrossPoints","_containsCenterOfCanvas","isPartiallyOnScreen","topline","rightline","bottomline","leftline","xi","iLine","xcount","lineKey","getScaledHeight","scaleToWidth","boundingRectFactor","scaleToHeight","_calcRotateMatrix","_calcTranslateMatrix","startMatrix","finalMatrix","w","cosP","sinP","cosPSinP","cosPMinusSinP","mtr","skipAbsolute","_setCornerCoords","transformMatrixKey","dimensionMatrix","_calcDimensionsTransformMatrix","flipping","dimX","dimY","_calculateCurrentDimensions","getSvgColorString","getSvgStyles","skipShadow","getSvgFilter","getSvgSpanStyles","useWhiteSpace","textDecoration","getSvgTextDecoration","deltaY","overline","underline","linethrough","getSvgCommons","getSvgTransform","additionalTransform","getSvgTransformMatrix","_setSVGBg","textBgRects","_getFillAttributes","_createBaseSVGMarkup","_toSVG","_createBaseClipPathSVGMarkup","objectMarkup","commonPieces","clipPathMarkup","noStyle","withShadow","styleInfo","shadowInfo","absoluteClipPath","addPaintOrder","saveProps","tmpObj","dashedPropertySet","_isEqual","origValue","currentValue","firstPass","_controlsVisibility","isControlVisible","newTheta","cornerHypotenuse","cosHalfOffset","sinHalfOffset","wh","drawRotatingPoint","rotateHeight","scaleOffset","_drawControl","control","controlName","_getControlsVisibility","setControlVisible","setControlsVisibility","FX_DURATION","fxCenterObjectH","callbacks","empty","fxCenterObjectV","fxRemove","skipCallbacks","propsToAnimate","_animate","propPair","from","valueProgress","timeProgress","coordProps","makeEdgeToOriginGetter","propertyNames","originValues","axis1","axis2","dimension","nearest","farthest","Line","_setWidthHeight","_getLeftToOriginX","_getTopToOriginY","calcLinePoints","origStrokeStyle","xMult","yMult","ATTRIBUTE_NAMES","parsedAttributes","pi","startAngle","endAngle","setRadius","svgString","startX","startY","endX","endY","largeFlag","getRadiusX","getRadiusY","Triangle","widthBy2","heightBy2","piBy2","Ellipse","getRx","getRy","_initRxRy","isRounded","Polyline","calcDim","_calcDimensions","diffX","diffY","commonRender","Polygon","_toString","commandLengths","repeatedCommands","M","fromArray","_parsePath","_setPositionDimensions","_parseDimensions","_renderPathCommands","tempX","tempY","subpathStartX","subpathStartY","controlX","controlY","_getOffsetTransform","digits","currentPath","coordsStr","coordsParsed","re","command","commandLength","repeatedCommand","klen","aX","aY","pathUrl","useSetOnGroup","isAlreadyGrouped","_updateObjectsACoords","_calcBounds","_updateObjectsCoords","_updateObjectCoords","objectLeft","objectTop","_restoreObjectsState","_includeDefaultValues","objsToObject","originalDefaults","_obj","ownCache","_restoreObjectState","destroy","toActiveSelection","ungroupOnCanvas","setObjectsCoords","onlyWidthHeight","iLen","jLen","_getBounds","minXY","maxXY","enlivedClipPath","toGroup","newGroup","childrenOverride","_lastScaleX","_lastScaleY","_filterScalingX","_filterScalingY","minimumScaleTrigger","cacheKey","filters","_initElement","_element","removeTexture","_initConfig","applyFilters","resizeFilter","applyResizeFilters","backend","filterBackend","evictCachesForKey","setCrossOrigin","getOriginalSize","_stroke","filterObj","getSrc","hasCrop","strokeSvg","imageMarkup","getSvgSrc","origFill","filtered","setSrc","minimumScale","elementToFilter","_filteredEl","sourceWidth","sourceHeight","isNeutralState","imgElement","_needsResize","sW","sH","elementToDraw","_resetWidthHeight","CSS_CANVAS","_initFilters","pAR","rWidth","rHeight","pWidth","pHeight","_object","resizeFilters","fromURL","imgOptions","_getAngleValueForStraighten","straighten","fxStraighten","straightenObject","fxStraightenObject","testPrecision","precision","fragmentSource","fragmentShader","createShader","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","setupGLContext","captureGPUInfo","maxTextureSize","getParameter","MAX_TEXTURE_SIZE","precisions","webGlPrecision","resources","createWebGLCanvas","aPosition","Float32Array","chooseFastestCopyGLTo2DMethod","canUseImageData","canMeasurePerf","performance","canUseArrayBuffer","ArrayBuffer","canUseUint8Clamped","drawImageTime","testContext","copyGLTo2D","glOptions","premultipliedAlpha","depth","stencil","antialias","clearColor","cachedTexture","getCachedTexture","originalWidth","originalHeight","sourceTexture","createTexture","targetTexture","originalTexture","passes","webgl","programCache","pass","tempFbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","applyTo","resizeCanvasIfNeeded","bindTexture","TEXTURE_2D","deleteTexture","deleteFramebuffer","applyFiltersDebug","glError","getError","NO_ERROR","errorString","glErrorToString","glErrorCode","errorCode","INVALID_ENUM","INVALID_VALUE","INVALID_OPERATION","INVALID_FRAMEBUFFER_OPERATION","OUT_OF_MEMORY","CONTEXT_LOST_WEBGL","clearWebGLCaches","textureCache","textureImageSource","texture","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","uniqueId","gpuInfo","ext","getExtension","renderer","vendor","UNMASKED_RENDERER_WEBGL","UNMASKED_VENDOR_WEBGL","sourceElement","originalImageData","originalEl","BaseFilter","vertexSource","createProgram","vertexShader","VERTEX_SHADER","getShaderInfoLog","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","attributeLocations","getAttributeLocations","uniformLocations","getUniformLocations","uStepW","getUniformLocation","uStepH","getAttribLocation","sendAttributeData","aPositionData","attributeLocation","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","enableVertexAttribArray","vertexAttribPointer","FLOAT","bufferData","STATIC_DRAW","_setupFrameBuffer","framebufferTexture2D","COLOR_ATTACHMENT0","_swapTextures","main","mainParameter","_class","applyToWebGL","applyTo2d","retrieveShader","shader","useProgram","uniform1f","sendUniformData","viewport","drawArrays","TRIANGLE_STRIP","bindAdditionalTexture","textureUnit","activeTexture","TEXTURE0","unbindAdditionalTexture","getMainParameter","setMainParameter","createHelpLayer","helpLayer","mainP","ColorMatrix","colorsOnly","uColorMatrix","uConstants","constants","uniformMatrix4fv","uniform4fv","Brightness","brightness","uBrightness","Convolute","opaque","Convolute_3_1","Convolute_3_0","Convolute_5_1","Convolute_5_0","Convolute_7_1","Convolute_7_0","Convolute_9_1","Convolute_9_0","dstOff","scx","scy","srcOff","wt","weights","side","halfSide","sw","sh","output","createImageData","dst","alphaFac","uMatrix","uOpaque","uHalfSize","uSize","uniform1fv","Grayscale","lightness","luminosity","mode","uMode","uniform1i","Invert","invert","uInvert","Noise","noise","rand","uNoise","uSeed","Pixelate","blocksize","_i","_j","_iLen","_jLen","uBlocksize","RemoveColor","useAlpha","lowC","highC","uLow","uHigh","Brownie","Vintage","Kodachrome","Technicolor","Polaroid","Sepia","BlackWhite","BlendColor","screen","diff","lighten","darken","exclusion","tint","buildSource","tg","alpha1","uColor","BlendImage","mask","TEXTURE1","calculateMatrix","canvas1","blendData","blendImage","uTransformMatrix","uImage","uniformMatrix3fv","Resize","resizeType","lanczosLobes","uDelta","uTaps","uniform2fv","horizontal","taps","filterWindow","getFilterWindow","generateShader","tempScale","getTaps","lobeFunction","lanczosCreate","offsets","fragmentSourceTOP","dW","dH","lobes","xx","rcpScaleX","rcpScaleY","newData","oW","oH","sliceByTwo","hermiteFastResize","bilinearFiltering","lanczosResize","tmpCanvas","doneW","doneH","stepW","stepH","sX","sY","dX","dY","srcData","destImg","destData","lanczos","ratioX","ratioY","rcpRatioX","rcpRatioY","range2X","range2Y","cacheLanc","icenter","u","weight","fX","fY","xDiff","yDiff","chnl","origPix","w4","pixels","destImage","destPixels","ratioW","ratioH","ratioWHalf","ratioHHalf","img2","data2","weightsAlpha","gxR","gxG","gxB","gxA","centerY","yy","centerX","w0","Contrast","contrast","contrastF","uContrast","Saturation","saturation","adjust","uSaturation","Blur","aspectRatio","simpleBlur","blurLayer1","blurLayer2","percent","ctx1","ctx2","newImageData","chooseRightDelta","blurScale","Gamma","gamma","rInv","gInv","bInv","rVals","gVals","bVals","uGamma","uniform3fv","Composed","subFilters","some","HueRotation","rad","aThirdSqtSin","OneMinusCos","_dimensionAffectingProps","_reNewline","_reSpacesAndTabs","_reSpaceAndTab","_reWords","superscript","baseline","subscript","textBackgroundColor","_fontSizeFraction","_fontSizeMult","charSpacing","_measuringContext","_styleProperties","__charBounds","CACHE_FONT_SIZE","MIN_TEXT_WIDTH","__skipDimension","initDimensions","getMeasuringContext","_splitText","newLines","_splitTextIntoLines","textLines","_textLines","graphemeLines","_unwrappedTextLines","_unwrappedLines","_text","graphemeText","_clearCache","calcTextWidth","cursorWidth","enlargeSpaces","calcTextHeight","diffSpace","currentLineWidth","numberOfSpaces","accumulatedSpace","line","charBound","spaces","isEndOfWrapping","getLineWidth","kernedWidth","lineIndex","_setTextStyles","_renderTextLinesBackground","_renderTextDecoration","_renderText","_renderTextStroke","_renderTextFill","charStyle","forMeasuring","textBaseline","_getFontDeclaration","maxWidth","_renderTextLine","_renderChars","styleHas","heightOfLine","lineLeftOffset","lastColor","charBox","currentColor","lineTopOffset","originalFill","leftOffset","_getLeftOffset","topOffset","_getTopOffset","boxStart","boxWidth","getHeightOfLine","_getLineLeftOffset","getValueOfPropertyAt","getFontCache","cacheProp","_applyCharStyles","styleDeclaration","_measureChar","_char","previousChar","prevCharStyle","coupleWidth","previousWidth","fontCache","couple","stylesAreEqual","fontMultiplier","getHeightOfChar","char","measureLine","lineInfo","_measureLine","_getWidthOfCharSpacing","grapheme","prevGrapheme","graphemeInfo","lineBounds","_getGraphemeBox","numOfSpaces","skipLeft","getCompleteStyleDeclaration","prevStyle","info","previousBox","__lineHeights","maxHeight","_renderTextCommon","lineHeights","isEmptyStyles","actualStyle","nextStyle","timeToRender","isJustify","charsToRender","shortCut","_renderChar","_hasStyleChanged","_getStyleDeclaration","fullDecl","shouldFill","shouldStroke","setSuperscript","_setScript","setSubscript","schema","loc","get2DCursorLocation","setSelectionStyles","thisStyle","_hasStyleChangedForSvg","__lineWidths","_shouldClearDimensionCache","shouldClear","_forceClearCache","_size","_dy","lastDecoration","currentDecoration","currentFill","lastFill","styleObject","family","fontIsGeneric","genericFonts","newLine","newText","additionalProperties","needsDims","_key","parsedAnchor","textAnchor","originalStrokeWidth","textHeightScaleFactor","scaledDiff","textHeight","offX","p3","cleanStyle","letterCount","stylePropertyValue","stylesCount","allStyleObjectPropertiesMatch","graphemeCount","removeStyle","lineNum","charNum","_extendStyles","_getLineStyle","_setLineStyle","_setStyleDeclaration","selectionStart","skipWrapping","getSelectionStyles","startIndex","endIndex","selectionEnd","getStyleAtPosition","lineStyle","_deleteStyleDeclaration","_deleteLineStyle","parseDecoration","IText","editable","editingBorderColor","cursorColor","cursorDelay","cursorDuration","caching","_reSpace","_currentCursorOpacity","_selectionDirection","_abortCursorAnimation","__widthOfSpace","inCompositionMode","initBehavior","setSelectionStart","_updateAndFire","setSelectionEnd","_fireSelectionChanged","_updateTextarea","initDelayedCursor","cursorOffsetCache","renderCursorOrSelection","skipRestore","_clearTextArea","boundaries","_getCursorBoundaries","renderCursor","renderSelection","_getCursorBoundariesOffsets","cursorPosition","cursorLocation","charHeight","__isMousedown","compositionStart","startLine","endLine","startChar","endChar","realLineHeight","lineOffset","boxEnd","compositionColor","getCurrentCharFontSize","cp","_getCurrentCharIndex","getCurrentCharColor","initAddedHandler","initRemovedHandler","initCursorSelectionHandlers","initDoubleClickSimulation","mouseMoveHandler","_initCanvasHandlers","_removeCanvasHandlers","_tick","_currentTickState","_animateCursor","targetOpacity","completeMethod","tickState","isAborted","_onTickComplete","_cursorTimeout1","_currentTickCompleteState","restart","abortCursorAnimation","_cursorTimeout2","selectAll","getSelectedText","findWordBoundaryLeft","startFrom","findWordBoundaryRight","findLineBoundaryLeft","findLineBoundaryRight","searchWordBoundary","direction","reNonWord","selectWord","newSelectionStart","newSelectionEnd","selectLine","enterEditing","exitEditingOnOthers","initHiddenTextarea","_saveEditingProps","_setEditingProps","_textBeforeEdit","initMouseMoveHandler","getSelectionStartFromPointer","currentStart","currentEnd","__selectionStartOnMouseDown","restartCursorIfNeeded","fromStringToGraphemeSelection","smallerTextStart","graphemeStart","smallerTextEnd","fromGraphemeToStringSelection","newSelection","updateTextareaPosition","updateFromTextArea","_calcTextareaPosition","desiredPostion","upperCanvas","upperCanvasWidth","upperCanvasHeight","clientWidth","clientHeight","_savedProps","_restoreEditingProps","isTextChanged","_removeExtraneousStyles","removeStyleFromTo","styleObj","cursorStart","cursorEnd","lineStart","charStart","lineEnd","charEnd","shiftLineStyles","numericChar","clonedStyles","numericLine","insertNewlineStyleObject","qty","copiedStyle","currentCharStyle","newLineStyles","somethingAdded","numIndex","insertCharStyleObject","quantity","currentLineStyles","currentLineStylesCloned","numericIndex","newStyle","insertNewStyleBlock","insertedText","cursorLoc","addedLines","linesLenght","setSelectionStartEndWithShift","setSelectionInBoundaries","__lastClickTime","__lastLastClickTime","__lastPointer","__newClickTime","newPointer","isTripleClick","_stopEvent","__lastIsEditing","__lastSelected","initMousedownHandler","initMouseupHandler","initClicks","_mouseDownHandler","setCursorByClick","_mouseDownHandlerBefore","mouseUpHandler","currentActive","mouseOffset","prevWidth","_getNewSelectionStartFromOffset","distanceBtwLastCharAndCursor","distanceBtwNextCharAndCursor","onKeyDown","onKeyUp","onInput","copy","paste","onCompositionStart","onCompositionUpdate","onCompositionEnd","_clickHandlerInitialized","keysMap","9","27","33","34","35","36","37","38","39","40","ctrlKeysMapUp","67","88","ctrlKeysMapDown","65","stopImmediatePropagation","_copyDone","fromPaste","removedText","nextText","charCount","nextCharCount","charDiff","textareaSelection","backDelete","copiedText","copiedTextStyle","compositionEnd","_getClipboardData","clipboardData","_getWidthBeforeCursor","widthBeforeCursor","getDownCursorOffset","isRight","selectionProp","_getSelectionForOffset","indexOnOtherLine","_getIndexOnLine","getUpCursorOffset","textBeforeCursor","charWidth","foundMatch","widthOfCharsOnLine","indexOnLine","leftEdge","rightEdge","offsetFromLeftEdge","moveCursorDown","_moveCursorUpOrDown","moveCursorUp","moveCursorWithShift","moveCursorWithoutShift","moveCursorLeft","_moveCursorLeftOrRight","_move","_moveLeft","_moveRight","moveCursorLeftWithoutShift","change","moveCursorLeftWithShift","moveCursorRight","actionName","moveCursorRightWithShift","moveCursorRightWithoutShift","changed","removeChars","insertChars","multipleSpacesRegex","_getSVGLeftTopOffsets","textAndBg","_getSVGTextAndBg","textTop","textLeft","internalMarkup","_wrapSVGTextAndBg","lineTop","textSpans","textTopOffset","textLeftOffset","_setSVGTextLineBg","_setSVGTextLineText","_createTextCharSpan","styleDecl","shouldUseWhitespace","styleProps","fillStyles","dySpan","_pushTextBgRect","fillColor","_getSVGLineTopOffset","lastHeight","Textbox","minWidth","dynamicMinWidth","__cachedLines","_styleMap","_generateStyleMap","textInfo","realLineCount","realLineCharCount","isWrapping","nextOffset","shouldLimit","mapNextLine","_wrapText","desiredWidth","wrapped","_wrapLine","MAX_SAFE_INTEGER","_measureWord","word","charOffset","_line","reservedSpace","words","wordWidth","infixWidth","largestWordWidth","lineJustStarted","additionalSpace","getMinWidth","setObjectScaleOverridden","tw"],"mappings":"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","file":"static/js/12.7204500e.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 1062;","var map = {\n\t\"./normal.svg\": 687,\n\t\"./normal_press.svg\": 688\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1756;","var map = {\n\t\"./Save.svg\": 580,\n\t\"./Save_Press.svg\": 581\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1758;","var map = {\n\t\"./Album.svg\": 576,\n\t\"./Album_press.svg\": 577\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1759;","import { Modal } from 'antd-mobile'\nimport Locale from '../../components/Locale'\nimport React, { useContext } from 'react'\nimport { LocaleContext } from '../../contexts/LocaleContext'\nimport './alertModal.css'\n\nexport default function AlertModal (props) {\n  const languageType = useContext(LocaleContext)\n\n  const {\n    visible,\n    title,\n    description,\n    footer = [\n      {\n        text: 'OK',\n        onPress: props.onClick,\n        style: {\n          fontWeight: 'bold',\n          color: '#007aff',\n          height: '43px',\n          lineHeight: '43px',\n          fontSize: '17px',\n          background: 'none'\n        }\n      }\n    ]\n  } = props\n  return (\n    <Modal\n      transparent\n      maskClosable={false}\n      visible={visible}\n      animationType='fade'\n      className='alertModel'\n      wrapClassName='WrapAlertModelClass'\n      footer={footer.map(item => {\n        return (\n          item\n        )\n      })}\n    >\n      <div style={{ padding: '0 15px', paddingBottom: '21.5px', background: 'none' }}>\n        {title ? <div>\n          <span\n            style={{\n              fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Bold' : 'initial',\n              fontWeight: languageType.current === 'ja' ? 'initial' : 'bold',\n              fontSize: languageType.current === 'ja' ? '17px' : '17px',\n              textAlign: 'center',\n              color: '#1b1b1b',\n              lineHeight: languageType.current === 'ja' ? '24px' : '22px'\n            }}\n          ><Locale code={title} /></span></div> : ''\n        }\n        {description ? <div\n          style={{\n            fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Regular' : 'initial',\n            // fontWeight: languageType.current === 'ja' ? 'initial' : 'normal',\n            fontSize: languageType.current === 'ja' ? '13px' : '13px',\n            textAlign: 'center',\n            color: '#1b1b1b',\n            whiteSpace: 'pre-wrap'\n          }}>\n          <Locale code={description} params={props.localeParams} />\n        </div> : ''\n        }\n      </div>\n    </Modal>\n  )\n}\n","import React, { useEffect } from 'react'\nimport { Modal } from 'antd-mobile'\nimport asyncState from '../utils/asyncStates'\n\nexport default function RequestActivityIndicator (props) {\n  const {\n    error,\n    visible,\n    hideTiming = 800,\n    type,\n    state,\n    onHideStart = () => {},\n    autoHideStates = []\n  } = props\n\n  useEffect(() => {\n    if (autoHideStates.includes(state)) {\n      setTimeout(onHideStart, hideTiming)\n    }\n  }, [state])\n\n  return (\n    <Modal\n      maskClosable={false}\n      visible={visible}\n      animated={false}\n      style={{\n        position: 'absolute',\n        top: '50%',\n        left: '50%',\n        transform: 'translate(-50%,-50%)',\n        backgroundColor: '#ffffff',\n        zIndex: 8,\n        width: '120px',\n        height: '120px'\n      // padding: '0!important'\n      // borderRadius: 10\n      }}\n    >\n      <div\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          width: '120px',\n          height: '120px',\n          margin: 0\n        }}\n      >\n        {(() => {\n          if (error) {\n            return (\n              <div\n                style={{\n                  display: 'flex',\n                  color: '#1b1b1b',\n                  fontSize: '15px',\n                  fontWeight: 'bold',\n                  alignItems: 'center',\n                  flexDirection: 'column'\n                }}\n              >\n                <img width={50} height={50} style={{ marginBottom: 40 }} src={require('../assets/failed.svg')} />\n                <div style={{\n                  position: 'absolute',\n                  bottom: 17,\n                  height: 22,\n                  left:'50%',\n                  transform:'translateX(-50%)',\n                  fontWeight: 'bold'\n                }}>FAILED</div>\n              </div>\n            )\n          }\n          if (state !== asyncState.fulfilled) {\n            return (\n              <div\n                style={{\n                  display: 'flex',\n                  color: '#1b1b1b',\n                  fontSize: '15px',\n                  fontWeight: 'bold',\n                  alignItems: 'center',\n                  flexDirection: 'column'\n                }}\n              ><img width={50} style={{ marginBottom: 30 }} src={require('../assets/LOADING.gif')} />\n                <div style={{\n                  position: 'absolute',\n                  bottom: 20,\n                  left:'50%',\n                  transform:'translateX(-50%)',\n                  fontWeight: 'bold'\n                }}>{type || 'LOADING'}\n                </div>\n              </div>\n            )\n          }\n          if (state === asyncState.fulfilled) {\n            return (\n              <div\n                style={{\n                  display: 'flex',\n                  color: '#1b1b1b',\n                  fontSize: '15px',\n                  fontWeight: 'bold',\n                  alignItems: 'center',\n                  flexDirection: 'column'\n                }}\n              >\n                <img width={50} height={50} style={{ marginBottom: 44 }} src={require('../assets/Complete.svg')} />\n                <div style={{\n                  position: 'absolute',\n                  bottom: 17,\n                  left:'50%',\n                  transform:'translateX(-50%)',\n                  height: 22,\n                  fontWeight: 'bold'\n                }}>COMPLETE</div>\n              </div>\n            )\n          }\n        })()}\n      </div>\n    </Modal>\n  )\n}\n","\nexport default class FontManager {\n  static _cache = {\n\n  }\n\n  /**\n   * @param {string} fontPath\n   */\n  static load = async (fontPath) => {\n    if (FontManager._cache[fontPath]) return FontManager._cache[fontPath]\n    const font = await new Promise((resolve, reject) => {\n      const opentype = require('opentype.js')\n\n      opentype.load(fontPath, function (err, font) {\n        if (err) {\n          reject(err)\n        } else {\n          resolve(font)\n        }\n      })\n    })\n    FontManager._cache[fontPath] = font\n    return font\n  }\n}\n","import FontManager from './FontManager'\n\n/**\n   *\n   * @param {HTMLCanvasElement} canvas\n   * @param {String} copyrightText\n   * @returns {string}\n   */\nexport default async function addCopyrightToCanvas (canvas, copyrightText) {\n  const font = await FontManager.load('./fonts/NotoSansCJKjp-Regular.otf')\n  const txtWidth = canvas.width - font.getAdvanceWidth(copyrightText, 22) - 9\n  const txtHeight = canvas.height - 9.6\n  const path = font.getPath(copyrightText, txtWidth, txtHeight, 22)\n  const path1 = font.getPath(copyrightText, txtWidth, txtHeight, 22)\n  // const path2 = font.getPath(copyrightText, txtWidth, txtHeight, 11)\n  // const path3 = font.getPath(copyrightText, txtWidth, txtHeight, 11)\n  path.fill = 'transparent'\n  path.stroke = 'rgba(255,255,255,0.75)'\n  path.strokeWidth = '6'\n  path1.fill = '#1b1b1b'\n  // path2.fill = '#1b1b1b'\n  // path3.fill = '#1b1b1b'\n  const ctx = canvas.getContext('2d')\n  path.draw(ctx)\n  path1.draw(ctx)\n  // path2.draw(ctx)\n  // path3.draw(ctx)\n  return canvas\n}\n","\n/**\n   * @param {object[]} layers\n   * @returns {string}\n   */\nexport default function checkCopyright (layers) {\n  let copyRight = ''\n  for (let index = 0; index < layers.length; index++) {\n    let layer = layers[index]\n    if (layer.hasOwnProperty('copyRight') && layer.copyRight != null && String(layer.copyRight).length > 0) {\n      if (String(layer.copyRight).indexOf('(L)') > -1) {\n        layer.copyRight = String(layer.copyRight).replace('(L)', '')\n      }\n      copyRight = layer.copyRight\n      break\n    }\n  }\n  return copyRight\n}\n","\nconst sourceEnums = {\n  paint: 1,\n  text: 2,\n  photo: 3,\n  stamp: 4\n}\n\nconst effectEnums = {\n  '1': 5, // MoMA Eary Modern\n  '2': 6, // MoAM Pop Art\n  '3': 4, // AUTO DESIGNER\n  '4': 1, // SPLASH\n  '5': 2, // GLITCH\n  '6': 3, // MOSAIC\n  '7': 0\n}\n\n/**\n *\n * @param {object[]} layers\n * @param {(\"1\"|\"2\"|\"3\"|\"4\"|\"5\"|\"6\")} layers[].mixType\n * @param {(\"paint\"|\"text\"|\"picture\"|\"stamp\")} layers[].type\n * @returns {any[]}\n */\nexport default function getEffectType (layers) {\n  let result = []\n  layers.forEach(layer => {\n    let source = sourceEnums[layer.type]\n    let effect = effectEnums[String(layer.mixType)] || 0\n    if (effect === 0) {\n      result.push([source])\n    } else {\n      result.push([source, effect])\n    }\n  })\n  return result\n}\n","export default function getStamps (layers) {\n  let arr = []\n  layers.map((item) => {\n    if (item && item.stampIds) {\n      arr.push(item.stampIds)\n    }\n  })\n  return arr.join('|')\n}\n","\nconst labelAndQualityNumberPair = {\n  full: 1,\n  high: 0.92,\n  medium: 0.72,\n  low: 0.52\n}\n\nexport default function getQualityFromEnv () {\n  const QUALITY = process.env.REACT_APP_UPLOAD_DESIGN_QUALITY || 'high'\n  return labelAndQualityNumberPair[QUALITY] || labelAndQualityNumberPair.high\n}\n","import React, { useContext, useState, useEffect } from 'react'\nimport { MakeContext } from '../MakeContext'\nimport asyncState from '../../utils/asyncStates'\nimport invoke from '../../utils/invoke'\nimport { LocaleContext } from '../../contexts/LocaleContext'\nimport Locale from '../../components/Locale'\nimport { ItemContext } from '../../contexts/ItemContext'\nimport AlertModal from './AlertModal'\nimport imageTools from '../../utils/imageTools'\nimport loadImages from '../../utils/loadImages'\nimport uuid from '../../utils/uuid'\nimport RequestActivityIndicator from '../../components/RequestActivityIndicator'\nimport addCopyrightToCanvas from '../../utils/addCopyrightToCanvas'\nimport checkCopyright from '../../utils/checkCopyright'\nimport getEffectType from '../../utils/getEffectType'\nimport getStamps from '../../utils/getStamps'\nimport getQualityFromEnv from '../../utils/getQualityFromEnv'\n\nconst MODAL_HIDE_TIMING = 800 // millisecond\nconst NAVIGATE_TIMING = 600\nexport default function ShareButton (props) {\n  const languageType = useContext(LocaleContext)\n  const make = useContext(MakeContext)\n  const item = useContext(ItemContext)\n  const [shareLimit, setShareLimit] = useState(false)\n  const [alertModelVisible, setAlertModelVisible] = useState(false)\n  const [errorModelVisible, setErrorModelVisible] = useState(false)\n  const [modalVisible, setModalVisible] = useState(false)\n  const [cartConfirmURL, setCartConfirmURL] = useState(null)\n  const [uploadDesignState, setUploadDesignState] = useState(asyncState.none)\n  const [uploadDesignError, setUploadDesignError] = useState(null)\n  const [type, setType] = useState('GENERATING')\n  const { realWidth, realHeight, canvasArea: { width, height } } = item\n\n  function checkLimit () {\n    for (let index = 0; index < make.layers.length; index++) {\n      let layer = make.layers[index]\n      if (layer.hasOwnProperty('flagList') && layer.flagList === 'NG') {\n        setShareLimit(true)\n        break\n      }\n    }\n  }\n\n  async function handlePressAddCart () {\n    try {\n      if (shareLimit) {\n        setAlertModelVisible(true)\n        return\n      }\n      if (uploadDesignState === asyncState.pending) return\n\n      if (uploadDesignState === asyncState.fulfilled) {\n        invoke('navigateTo', {\n          routeName: 'URLScreen',\n          params: {\n            uri: cartConfirmURL,\n            closeBtn: true\n          }\n        })\n        return\n      }\n\n      setModalVisible(true)\n      setType('GENERATING')\n\n      if (!Array.isArray(make.layers) || make.layers.length === 0) {\n        // TODO i18n\n        // throw new Error('')\n        setUploadDesignError(true)\n      } else {\n        setUploadDesignState(asyncState.pending)\n        let images = await loadImages(props.data, props.topLayer/*, bottomImgData && bottomImgData.image */)\n        let scaledCanvas = imageTools.mergeImage(width, height, images.filter(Boolean), true)\n        if (process.env.REACT_APP_SCALE_IMAGE_BEFORE_UPLOAD === 'always') {\n          scaledCanvas = imageTools.scaleImage(\n            scaledCanvas,\n            width,\n            height,\n            realWidth,\n            realHeight\n          )\n        }\n\n        let copyrightText = checkCopyright(make.layers)\n        if (copyrightText) {\n          scaledCanvas = await addCopyrightToCanvas(scaledCanvas, copyrightText)\n        }\n\n        const imageURL = scaledCanvas.toDataURL('image/png', getQualityFromEnv())\n        scaledCanvas = null\n        const printImageId = uuid.v4()\n        await invoke('storeImage', { imageName: printImageId, imageData: imageURL })\n        setType('UPLOADING')\n        // invoke('log', 'make.getBaseItem().item_code:' + JSON.stringify(make.getBaseItem().item_code) + 'effectType:' + JSON.stringify(getEffectType()) + 'printImageBase64:' + JSON.stringify(image))\n        const result = await invoke('uploadDesign', {\n          requestType: 'market',\n          itemCode: make.getBaseItem().item_code || '000000',\n          effectType: JSON.stringify(getEffectType(make.layers)),\n          printImageId,\n          stamps: getStamps(make.layers)\n        })\n        if (!result.success) {\n          // TODO i18n\n          // throw new Error('')\n          setUploadDesignError(true)\n          setUploadDesignState(asyncState.none)\n        } else {\n          setCartConfirmURL(result.url)\n          setUploadDesignError(null)\n          setUploadDesignState(asyncState.fulfilled)\n          setType('COMPLETE')\n        }\n      }\n    } catch (e) {\n      setErrorModelVisible(true)\n      setUploadDesignError(e)\n      setUploadDesignState(asyncState.none)\n    }\n    setTimeout(() => {\n      setModalVisible(false)\n      setUploadDesignError(null)\n      setUploadDesignState(asyncState.none)\n      setType('GENERATING')\n    }, 800)\n  }\n\n  useEffect(() => {\n    checkLimit()\n\n    if (cartConfirmURL) {\n      setTimeout(() => {\n        setModalVisible(false)\n        invoke('navigateTo', {\n          routeName: 'URLScreen',\n          params: {\n            closeBtn: true,\n            uri: cartConfirmURL\n          }\n        })\n      }, NAVIGATE_TIMING)\n    }\n  }, [cartConfirmURL])\n\n  return (\n    <>\n      <div\n        className='operation'\n        onClick={handlePressAddCart}\n        style={{ width: (window.innerWidth - 45) / 2 }}\n      >\n        <img src={require(`../../assets/normal${shareLimit ? '_press' : ''}.svg`)} alt='' style={{ position: 'relative', top: 8 }} />\n        <span className='operationText' style={{\n          lineHeight: '52px',\n          top: -2,\n          marginLeft: '7px',\n          fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Bold' : 'UniqloPro-Bold',\n          color: shareLimit ? '#ababab' : '#1b1b1b',\n          fontSize: languageType.current === 'ja' ? '15px' : '16px'\n        }}>\n          <Locale code='make.done.listBtn' />\n        </span>\n      </div>\n      {/* <LoadingModal\n        type={type}\n        setVisible={() => setModalVisible(false)}\n        visible={modalVisible}\n        state={uploadDesignState}\n        error={uploadDesignError}\n      /> */}\n      <RequestActivityIndicator\n        onHideStart={() => setModalVisible(false)}\n        hideTiming={MODAL_HIDE_TIMING}\n        visible={modalVisible}\n        autoHideStates={[asyncState.rejected, asyncState.fulfilled]}\n        state={uploadDesignState}\n        error={uploadDesignError}\n        type={type}\n      />\n      <AlertModal visible={alertModelVisible} title='make.done.shareLimit' text='OK' onClick={() => { setAlertModelVisible(false) }} />\n      <AlertModal visible={errorModelVisible} title='error.network.title' description='error.network.description' text='OK' onClick={() => { setErrorModelVisible(false) }} />\n    </>\n  )\n}\n","import React, { useContext, useState, useEffect } from 'react'\nimport { MakeContext } from '../MakeContext'\nimport asyncState from '../../utils/asyncStates'\nimport invoke from '../../utils/invoke'\nimport { LocaleContext } from '../../contexts/LocaleContext'\nimport { ItemContext } from '../../contexts/ItemContext'\nimport loadImages from '../../utils/loadImages'\n// import { throttle, InitializationThrottle } from '../../utils/throttle'\nimport RequestActivityIndicator from '../../components/RequestActivityIndicator'\nimport imageTools from '../../utils/imageTools'\nimport AlertModal from '../../components/AlertModal'\nimport uuid from '../../utils/uuid'\nimport addCopyrightToCanvas from '../../utils/addCopyrightToCanvas'\nimport checkCopyright from '../../utils/checkCopyright'\nimport getEffectType from '../../utils/getEffectType'\nimport getStamps from '../../utils/getStamps'\nimport getQualityFromEnv from '../../utils/getQualityFromEnv'\n\nconst MODAL_HIDE_TIMING = 800 // millisecond\n\nexport default function UtidButton (props) {\n  let uploadBtnTime = 0\n  let uploadBtnCnt = 0\n  const make = useContext(MakeContext)\n  const item = useContext(ItemContext)\n  const languageType = useContext(LocaleContext)\n  const [modalVisible, setModalVisible] = useState(false)\n  const [showUtidVisible, setShowUtidVisible] = useState(false)\n  const [getUtidVisible, setGetUtidVisible] = useState(null)\n  const [uploadDesignState, setUploadDesignState] = useState(asyncState.none)\n  const [uploadDesignError, setUploadDesignError] = useState(null)\n  const [type, setType] = useState('GENERATING')\n  const [alertModelVisible, setAlertModelVisible] = useState(false)\n  const [utid, setUtid] = useState('')\n  const { realWidth, realHeight, canvasArea: { width, height } } = item\n\nasync function getMessage(){\n    try {\n        if (uploadDesignState === asyncState.pending) return\n        setUploadDesignError(null)\n        setModalVisible(true)\n        setUploadDesignState(asyncState.pending)\n        setType('GENERATING')\n  \n        if (!Array.isArray(make.layers) || make.layers.length === 0) {\n          // TODO i18n UI\n          throw new Error('')\n        } else {\n          let images = await loadImages(props.data, props.topLayer/*, bottomImgData && bottomImgData.image */)\n          let scaledCanvas = imageTools.mergeImage(width, height, images.filter(Boolean), true)\n          if (process.env.REACT_APP_SCALE_IMAGE_BEFORE_UPLOAD === 'always') {\n            scaledCanvas = imageTools.scaleImage(\n              scaledCanvas,\n              width,\n              height,\n              realWidth,\n              realHeight\n            )\n          }\n  \n          let copyrightText = checkCopyright(make.layers)\n          if (copyrightText) {\n            scaledCanvas = await addCopyrightToCanvas(scaledCanvas, copyrightText)\n          }\n  \n          const imageURL = scaledCanvas.toDataURL('image/png', getQualityFromEnv())\n          scaledCanvas = null\n          const printImageId = uuid.v4()\n          await invoke('storeImage', { imageName: printImageId, imageData: imageURL })\n          setType('UPLOADING')\n          const result = await invoke('getUtid', {\n            fromStore: '1',\n            itemCode: make.getBaseItem().item_code || '000000',\n            effectType: JSON.stringify(getEffectType(make.layers)),\n            onlyUpload: '1',\n            stamps: getStamps(make.layers),\n            originalText: '',\n            printImageId\n          })\n          invoke('log','utid')\n          invoke('log',result)\n          if (result.error) {\n            let error = new Error(result.message)\n            error.name = result.message\n            throw new Error(error)\n          }\n          if (!result.success) {\n            // TODO i18n UI\n            throw new Error('')\n          } else {\n          //   setCartConfirmURL(result.confirm_url)\n            setUploadDesignError(null)\n            setUploadDesignState(asyncState.fulfilled)\n            // setType('COMPLETE')\n            setModalVisible(false)\n            setUtid(JSON.stringify(result.t_shirt_hash))\n            setShowUtidVisible(true)\n          }\n        }\n      } catch (e) {\n        setAlertModelVisible(true)\n        setUploadDesignError(e)\n        setUploadDesignState(asyncState.rejected)\n      }\n}\n\nfunction getUtid () {\n    let begin = new Date().getTime()\n    invoke('log',begin)\n    if (begin - uploadBtnTime > 500) {\n      invoke('log','')\n      uploadBtnCnt = 0\n    }\n    uploadBtnCnt++\n    uploadBtnTime = begin\n    invoke('log',uploadBtnCnt)\n    if(uploadBtnCnt === 5) {\n        setGetUtidVisible(true)\n        uploadBtnTime = 0\n        uploadBtnCnt = 0\n    }\n  }\n\n  return (\n    <div\n      onClick={getUtid}\n      style={{\n        width: window.innerWidth - 260,\n        height: '60px',\n        position: 'absolute',\n        left: (window.innerWidth - (window.innerWidth - 260)) / 2,\n        zIndex: 1000,\n        opacity: 0,\n        backgroundColor: '#1b1b1b',\n      }}>\n     <AlertModal\n        visible={getUtidVisible}\n        title='make.done.getUtid.title'\n        description='make.done.getUtid'\n        footer={[\n            {\n                text: languageType.current === 'ja' ? '' : 'No',\n                onPress: ()=>{\n                    setGetUtidVisible(false)\n                },\n                style: {\n                  fontWeight: 400,\n                  color: '#007aff',\n                  height: '43px',\n                  lineHeight: '43px',\n                  fontSize: '17px',\n                  background: 'none'\n                }\n            },\n            {\n              text: languageType.current === 'ja' ? '' : 'Yes',\n              onPress: ()=>{\n                setGetUtidVisible(false)\n                  getMessage()\n              },\n              style: {\n                fontWeight: 'bold',\n                color: '#007aff',\n                height: '43px',\n                lineHeight: '43px',\n                fontSize: '17px',\n                background: 'none'\n              }\n            }\n          ]}\n      />\n      <AlertModal visible={alertModelVisible} title='error.network.title' description='error.network.description' text='OK' onClick={() => { setAlertModelVisible(false) }} />\n      <RequestActivityIndicator\n        onHideStart={() => setModalVisible(false)}\n        hideTiming={MODAL_HIDE_TIMING}\n        visible={modalVisible}\n        autoHideStates={[asyncState.rejected, asyncState.fulfilled]}\n        state={uploadDesignState}\n        error={uploadDesignError}\n        type={type}\n      />\n      {\n        utid.length>0?\n            <AlertModal visible={showUtidVisible} utid={utid} title='make.done.showUtid.title' description='make.done.showUtid' text='OK' onClick={() => { setShowUtidVisible(false) }} />\n        :''\n      }\n    </div>\n  )\n}\n","import React, { useContext, useState, useEffect } from 'react'\nimport { MakeContext } from '../MakeContext'\nimport asyncState from '../../utils/asyncStates'\nimport invoke from '../../utils/invoke'\nimport { LocaleContext } from '../../contexts/LocaleContext'\nimport Locale from '../../components/Locale'\nimport { ItemContext } from '../../contexts/ItemContext'\nimport loadImages from '../../utils/loadImages'\nimport { throttle, InitializationThrottle } from '../../utils/throttle'\nimport RequestActivityIndicator from '../../components/RequestActivityIndicator'\nimport imageTools from '../../utils/imageTools'\nimport AlertModal from '../../components/AlertModal'\nimport uuid from '../../utils/uuid'\nimport addCopyrightToCanvas from '../../utils/addCopyrightToCanvas'\nimport checkCopyright from '../../utils/checkCopyright'\nimport getEffectType from '../../utils/getEffectType'\nimport getStamps from '../../utils/getStamps'\nimport getQualityFromEnv from '../../utils/getQualityFromEnv'\n\nconst MODAL_HIDE_TIMING = 800 // millisecond\nconst NAVIGATE_TIMING = 600\n\nexport default function AddCartButton (props) {\n  const make = useContext(MakeContext)\n  const item = useContext(ItemContext)\n  const languageType = useContext(LocaleContext)\n  const [modalVisible, setModalVisible] = useState(false)\n  const [cartConfirmURL, setCartConfirmURL] = useState(null)\n  const [uploadDesignState, setUploadDesignState] = useState(asyncState.none)\n  const [uploadDesignError, setUploadDesignError] = useState(null)\n  const [type, setType] = useState('GENERATING')\n  const [cartItemCode, setCartItemCode] = useState('')\n  const [alertModelVisible, setAlertModelVisible] = useState(false)\n  const { realWidth, realHeight, canvasArea: { width, height } } = item\n\n  useEffect(() => {\n    InitializationThrottle()\n  }, [])\n\n  useEffect(() => {\n    if (cartConfirmURL) {\n      setTimeout(() => {\n        setModalVisible(false)\n        invoke('navigateTo', {\n          routeName: 'URLScreen',\n          params: {\n            closeBtn: true,\n            uri: cartConfirmURL\n          }\n        })\n      }, NAVIGATE_TIMING)\n    }\n  }, [cartConfirmURL])\n\n  async function handlePressAddCart () {\n    try {\n      if (uploadDesignState === asyncState.pending) return\n      if (uploadDesignState === asyncState.fulfilled && make.getBaseItem().item_code === cartItemCode) {\n        invoke('navigateTo', {\n          routeName: 'URLScreen',\n          params: {\n            uri: cartConfirmURL,\n            closeBtn: true\n          }\n        })\n        return\n      }\n      setUploadDesignError(null)\n      setModalVisible(true)\n      setUploadDesignState(asyncState.pending)\n      setType('GENERATING')\n\n      if (!Array.isArray(make.layers) || make.layers.length === 0) {\n        // TODO i18n UI\n        throw new Error('')\n      } else {\n        let images = await loadImages(props.data, props.topLayer/*, bottomImgData && bottomImgData.image */)\n        let scaledCanvas = imageTools.mergeImage(width, height, images.filter(Boolean), true)\n        if (process.env.REACT_APP_SCALE_IMAGE_BEFORE_UPLOAD === 'always') {\n          scaledCanvas = imageTools.scaleImage(\n            scaledCanvas,\n            width,\n            height,\n            realWidth,\n            realHeight\n          )\n        }\n\n        let copyrightText = checkCopyright(make.layers)\n        if (copyrightText) {\n          scaledCanvas = await addCopyrightToCanvas(scaledCanvas, copyrightText)\n        }\n\n        const imageURL = scaledCanvas.toDataURL('image/png', getQualityFromEnv())\n        scaledCanvas = null\n        setCartItemCode(make.getBaseItem().item_code)\n        const printImageId = uuid.v4()\n        await invoke('storeImage', { imageName: printImageId, imageData: imageURL })\n        setType('UPLOADING')\n        const result = await invoke('uploadDesign', {\n          itemCode: make.getBaseItem().item_code || '000000',\n          effectType: JSON.stringify(getEffectType(make.layers)),\n          onlyUpload: '',\n          stamps: getStamps(make.layers),\n          originalText: '',\n          printImageId\n        })\n        if (result.error) {\n          let error = new Error(result.message)\n          error.name = result.message\n          throw new Error(error)\n        }\n        if (!result.success) {\n          // TODO i18n UI\n          throw new Error('')\n        } else {\n          setCartConfirmURL(result.confirm_url)\n          setUploadDesignError(null)\n          setUploadDesignState(asyncState.fulfilled)\n          setType('COMPLETE')\n        }\n      }\n    } catch (e) {\n      // alert(e.message)\n      // setAlertModelVisible(true)\n      setUploadDesignError(e)\n      setUploadDesignState(asyncState.rejected)\n    }\n  }\n\n  return (\n    <div\n      onClick={() => throttle(handlePressAddCart)}\n      style={{\n        width: window.innerWidth - 30,\n        height: '52px',\n        // marginLeft: (window.innerWidth - 345) / 2,\n        marginLeft: 15,\n        marginTop: 15,\n        textAlign: 'center',\n        color: 'white',\n        backgroundColor: '#1b1b1b',\n        fontSize: 17\n      }}>\n      <AlertModal visible={alertModelVisible} title='error.network.title' description='error.network.description' text='OK' onClick={() => { setAlertModelVisible(false) }} />\n      <img src={require('../../assets/AddToCart.svg')} alt='' style={{ position: 'relative', top: 4 }} />\n      <span className='operationText'\n        style={{\n          lineHeight: '52px',\n          marginLeft: '7px',\n          fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Bold' : 'UniqloPro-Bold',\n          fontSize: languageType.current === 'ja' ? '15px' : '16px'\n        }}>\n\n        <Locale code='make.done.addToCart' />\n      </span>\n      <RequestActivityIndicator\n        onHideStart={() => setModalVisible(false)}\n        hideTiming={MODAL_HIDE_TIMING}\n        visible={modalVisible}\n        autoHideStates={[asyncState.rejected, asyncState.fulfilled]}\n        state={uploadDesignState}\n        error={uploadDesignError}\n        type={type}\n      />\n    </div>\n  )\n}\n","import invoke from '../../utils/invoke'\nimport loadImages from '../../utils/loadImages'\nimport { fabric } from '../../utils/fabric'\n\nfunction getBase64Image ({ doneImageStyle, doneStyle, doneMultiply }, bottomImg, middleImg, topImg, copyRight, scale, activeItem, newCopyrightData) {\n  const canvas = document.createElement('canvas')\n  canvas.width = doneImageStyle.width * scale\n  canvas.height = doneImageStyle.height * scale\n  const ctx = canvas.getContext('2d')\n  if(doneMultiply) {\n    ctx.globalCompositeOperation = 'multiply';\n  }\n  ctx.drawImage(\n    bottomImg,\n    0,\n    0,\n    canvas.width,\n    canvas.height\n  )\n  if (middleImg) {\n    ctx.drawImage(\n      middleImg,\n      doneStyle.left * scale,\n      doneStyle.top * scale,\n      doneStyle.width * scale,\n      doneStyle.height * scale\n    )\n  }\n  if (topImg) {\n    ctx.drawImage(\n      topImg,\n      doneStyle.left * scale,\n      doneStyle.top * scale,\n      doneStyle.width * scale,\n      doneStyle.height * scale\n    )\n  }\n  // ctx.font = `${22 * doneStyle.width * scale / realWidth}px NotoSansCJKjp`\n  // ctx.fillStyle = '#1b1b1b'\n  // const txtWidth = doneStyle.width * scale + doneStyle.left * scale - ctx.measureText(copyRight).width - 4.2\n  // const txtHeight = doneStyle.height * scale + doneStyle.top * scale - 5.6\n  if (newCopyrightData) {\n    // ctx.fillText(copyRight, txtWidth, txtHeight) // ctx.drawImage(copyrightData, 0, doneStyle.top + (doneStyle.height * 1) + 16, doneStyle.width * scale - 2, doneStyle.height * scale - 2)\n    ctx.drawImage(newCopyrightData, -15, 0, canvas.width - 20, canvas.width - 20)\n  }\n  // ctx.filter = 'blur(0px)'\n  // ctx.strokeStyle = '#ffffff'\n  // ctx.strokeText(copyRight, txtWidth, txtHeight)\n  // ctx.fillText(copyRight, txtWidth, txtHeight)\n  const dataURL = canvas.toDataURL('image/png')\n  return dataURL\n}\n\nexport default async function compositeDesign (item, designData, topImgData, scale = 1, copyRight, activeItem) {\n  if (!designData && !topImgData) {\n    throw new Error('Cannot load design data.')\n  }\n  const bottomImgData = await invoke('downloadFile', item.doneImageSrc)\n  var canvas2 = new fabric.Canvas('copyrightCan', { enableRetinaScaling: false })\n  // canvas\n  canvas2.selection = false\n  var loremIpsumDolor = new fabric.Text(copyRight, {\n    fontFamily: 'NotoSansCJKjp',\n    stroke: 'white',\n    strokeWidth: 1,\n    top: item.doneStyle.top + item.doneStyle.height - 10,\n    textAlign: 'right',\n    fontSize: 40\n  })\n  loremIpsumDolor.setCoords()\n  canvas2.add(loremIpsumDolor)\n  canvas2.getObjects()[0].set({\n    scaleX: 0.1,\n    scaleY: 0.1,\n    textAlign: 'right'\n  }).setCoords()\n  canvas2.getObjects()[0].setPositionByOrigin(new fabric.Point(item.doneImageStyle.left + item.doneImageStyle.width, item.doneStyle.top + item.doneStyle.height + 10), 'right', 'top')\n  canvas2.getObjects()[0].setCoords()\n  canvas2.renderAll()\n  const copyrightData = canvas2.toDataURL()\n  const [bottomImg, middleImg, topImg, newCopyrightData] = await loadImages(bottomImgData.image, designData, topImgData, copyrightData)\n  return getBase64Image(item, bottomImg, middleImg, topImg, copyRight, scale, activeItem, newCopyrightData)\n}\n","import React, { useContext, useState, useEffect } from 'react'\nimport { MakeContext } from '../MakeContext'\nimport asyncState from '../../utils/asyncStates'\nimport invoke from '../../utils/invoke'\nimport { Modal } from 'antd-mobile'\nimport { LocaleContext } from '../../contexts/LocaleContext'\nimport Locale from '../../components/Locale'\nimport { ItemContext } from '../../contexts/ItemContext'\nimport LoadingModal from './LoadingModal'\nimport compositeDesign from './compositeDesign'\nimport code from '../../utils/code'\nimport useRouter from '../../hooks/useRouter'\nimport loadImages from '../../utils/loadImages'\nimport { fabric } from '../../utils/fabric'\nimport AlertModal from '../../components/AlertModal'\nimport isSingleWebView from '../../utils/isSingleWebView'\nimport imageTools from '../../utils/imageTools'\nexport default function SaveToAlbumButton (props) {\n  const make = useContext(MakeContext)\n  const item = useContext(ItemContext)\n  const languageType = useContext(LocaleContext)\n  const [loadingVisible, setLoadingVisible] = useState(false)\n  const [panelVisible, setPanelVisible] = useState(false)\n  const [isSavedToAPP, setIsSavedToAPP] = useState(!make.isSavePhoto)\n  const [isSavedToAlbum, setIsSavedToAlbum] = useState(false)\n  const [uploadDesignState, setUploadDesignState] = useState(asyncState.none)\n  const [uploadDesignError, setUploadDesignError] = useState(null)\n  const [saveDesignModalVisible, setSaveDesignModalVisible] = useState(false)\n  const [saveDesignState, setSaveDesignState] = useState(asyncState.none)\n  const [saveDesignError, setSaveDesignError] = useState(null)\n  const [alertModelVisible, setAlertModelVisible] = useState(false)\n  const router = useRouter()\n  let activeItem = make.activeItem\n  function handleClickSavePhoto () {\n    setPanelVisible(true)\n  }\n\n  function handleCancel (e) {\n    e.stopPropagation()\n    setPanelVisible(false)\n  }\n\n  function getBase64Image (bottomImg, middleImg, topImg, callback) {\n    const { doneImageStyle, doneStyle, realWidth, doneMultiply } = item\n    const canvas = document.createElement('canvas')\n    //  1280 * 1280\n    const size = 1280\n    const scale = size / doneImageStyle.width\n    canvas.width = size\n    canvas.height = size\n\n    const ctx = canvas.getContext('2d')\n    if (doneMultiply) {\n      ctx.globalCompositeOperation = 'multiply'\n    }\n    ctx.drawImage(bottomImg, 0, 0, size, size)\n    // ctx.rect(item.doneStyle.left, item.doneStyle.top, item.doneStyle.width, item.doneStyle.height)\n    // ctx.stroke()\n    if (middleImg) {\n      ctx.drawImage(middleImg, doneStyle.left * scale, doneStyle.top * scale, doneStyle.width * scale, doneStyle.height * scale)\n    }\n    if (topImg) {\n      ctx.drawImage(topImg, doneStyle.left * scale, doneStyle.top * scale - 8, doneStyle.width * scale - 2, doneStyle.height * scale - 2)\n    }\n    let copyRight = ''\n    for (let index = 0; index < make.layers.length; index++) {\n      let layer = make.layers[index]\n      if (layer.hasOwnProperty('copyRight') && layer.copyRight != null && String(layer.copyRight).length > 0) {\n        if (String(layer.copyRight).indexOf('(L)') > -1) {\n          layer.copyRight = String(layer.copyRight).replace('(L)', '')\n        }\n        copyRight = layer.copyRight\n        break\n      }\n    }\n    if (copyRight) {\n      ctx.font = `${22 * doneStyle.width * scale / realWidth}px arial`\n      // if (activeItem[2].name === 'BLACK' || activeItem[2].name === 'GRAY' || activeItem[2].name === 'NAVY') {\n      //   ctx.fillStyle = '#fff'\n      // } else {\n      // ctx.fillStyle = '#1b1b1b'\n      // }\n      const txtWidth = doneStyle.width * scale + doneStyle.left * scale - ctx.measureText(copyRight).width - 4.2\n      const txtHeight = doneStyle.height * scale + doneStyle.top * scale\n      // invoke('log', 'txtWidth-->' + txtWidth + ';txtHeight-->' + txtHeight)\n      // ctx.fillText(copyRight, txtWidth, txtHeight)\n\n      // ctx.font = '22px \"NotoSansCJKjp\"'\n      ctx.fillStyle = '#1b1b1b'\n      // let txtWidth = realWidth - ctx.measureText(copyRight).width\n      // let txtHeight = realHeight - 5.6\n      ctx.filter = 'blur(0px)'\n      ctx.strokeStyle = '#ffffff'\n      ctx.strokeText(copyRight, txtWidth, txtHeight)\n      ctx.fillText(copyRight, txtWidth, txtHeight)\n    }\n\n    const dataURL = canvas.toDataURL('image/png')\n\n    callback(dataURL)\n  }\n\n  async function handlePressSaveData () {\n    try {\n      if (isSavedToAPP) return\n      if (saveDesignState === asyncState.pending) return\n\n      setPanelVisible(false)\n      setSaveDesignModalVisible(true)\n      setSaveDesignState(asyncState.pending)\n\n      let layers = make.layers\n      /**\n       * 320\n       * \n       */\n      const middleImgData = props.data\n      const topImgData = props.topLayer\n      let copyRight = ''\n      for (let index = 0; index < make.layers.length; index++) {\n        let layer = make.layers[index]\n        if (layer.hasOwnProperty('copyRight') && layer.copyRight != null && String(layer.copyRight).length > 0) {\n          if (String(layer.copyRight).indexOf('(L)') > -1) {\n            layer.copyRight = String(layer.copyRight).replace('(L)', '')\n          }\n          copyRight = layer.copyRight\n          break\n        }\n      }\n      const thumb = await compositeDesign(item, middleImgData, topImgData, 320 / item.doneImageStyle.width, copyRight, activeItem)\n      const passProps = code.decodeURI(router.query.passProps || '{}')\n      if (isSingleWebView() && imageTools.cache) {\n        await Promise.all([\n          invoke('storeImage', { imageName: `back-${layers.length}`, imageData: middleImgData }),\n          topImgData && invoke('storeImage', { imageName: 'topLayer', imageData: topImgData })\n        ])\n      }\n      await invoke('saveDesign', { layers, thumb, designId: passProps.designId })\n      setIsSavedToAPP(true)\n      setSaveDesignState(asyncState.fulfilled)\n      make.setRevokeToMake(true)\n    } catch (e) {\n      setAlertModelVisible(true)\n      setSaveDesignState(asyncState.rejected)\n      setSaveDesignError(e)\n    }\n    setTimeout(() => {\n      setSaveDesignModalVisible(false)\n      setSaveDesignState(asyncState.none)\n      setSaveDesignError(null)\n    }, 800)\n  }\n\n  async function handlePressSavePhoto () {\n    try {\n      if (isSavedToAlbum) return\n      if (uploadDesignState === asyncState.pending) return\n\n      if (uploadDesignState === asyncState.fulfilled) {\n        return\n      }\n\n      setPanelVisible(false)\n      setLoadingVisible(true)\n      setUploadDesignState(asyncState.pending)\n\n      // invoke('log', '------item------')\n      // invoke('log', item)\n      const bottomImgData = await invoke('downloadFile', item.doneImageSrc)\n      loadImages(bottomImgData.image, props.data, props.topLayer)\n        .then(([bottomImg, middleImg, topImg, copyrightData]) => {\n          getBase64Image(bottomImg, middleImg, topImg, async (imageData) => {\n            const result = await invoke('saveToAppOrLocalAlbum', { imageData })\n            if (result.success) {\n              setIsSavedToAlbum(true)\n              setUploadDesignState(asyncState.fulfilled)\n            }\n            // else {\n            // setUploadDesignState(asyncState.rejected)\n            // setUploadDesignError(true)\n            // }\n            setTimeout(() => {\n              setLoadingVisible(false)\n              setUploadDesignState(asyncState.none)\n              setUploadDesignError(null)\n            }, 800)\n          })\n        })\n    } catch (e) {\n      setUploadDesignState(asyncState.rejected)\n      setUploadDesignError(e)\n      setTimeout(() => {\n        setLoadingVisible(false)\n        setUploadDesignState(asyncState.none)\n        setUploadDesignError(null)\n      }, 800)\n    }\n  }\n\n  return (\n    <div>\n      <AlertModal visible={alertModelVisible} title='error.network.title' description='error.network.description' text='OK' onClick={() => { setAlertModelVisible(false) }} />\n      <div onClick={handleClickSavePhoto} className='operation' style={{ float: 'right', width: (window.innerWidth - 45) / 2 }}>\n        <img src={require('../../assets/newSave.svg')} alt='' style={{ position: 'relative', top: 8 }} />\n        <span style={{\n          position: 'relative',\n          lineHeight: '52px',\n          top: '-2px',\n          marginLeft: '7px',\n          fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Bold' : 'UniqloPro-Bold',\n          fontSize: languageType.current === 'ja' ? '15px' : '16px'\n        }}>\n          <Locale code='make.done.save' />\n        </span>\n      </div>\n      <LoadingModal\n        type='SAVING'\n        setVisible={() => setLoadingVisible(false)}\n        visible={loadingVisible}\n        state={uploadDesignState}\n        error={uploadDesignError}\n      />\n      <LoadingModal\n        type='SAVING'\n        setVisible={() => setSaveDesignModalVisible(false)}\n        visible={saveDesignModalVisible}\n        state={saveDesignState}\n        error={saveDesignError}\n      />\n      <Modal\n        popup\n        onClose={() => setPanelVisible(false)}\n        visible={panelVisible}\n        animationType='slide-up'\n        // style={{\n        //   position: 'absolute',\n        //   backgroundColor: '#fff',\n        //   left: 0,\n        //   bottom: 0,\n        //   margin: 0,\n        //   width: window.innerWidth,\n        //   height: '194px'\n        // }}\n      >\n        <div style={{\n          display: 'flex',\n          flexDirection: 'column',\n          height: '194px',\n          overflow: 'hidden'\n        }}>\n          <div onClick={handlePressSaveData} style={{\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            padding: '0 16px',\n            height: '56px'\n          }}>\n            <div>\n              <img style={{\n                width: 24,\n                height: 24\n              }} src={require(`../../assets/Save${isSavedToAPP ? '_Press' : ''}.svg`)} />\n            </div>\n            <div style={{\n              flex: 1,\n              textAlign: 'center',\n              fontWeight: 'bold',\n              height: '56px',\n              display: 'flex',\n              flexDirection: 'column'\n            }}>\n              <span style={{\n                fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Bold' : 'initial',\n                fontWeight: languageType.current === 'ja' ? 'initial' : 'bold',\n                fontSize: languageType.current === 'ja' ? '17px' : '20px',\n                color: isSavedToAPP ? '#ababab' : '#1b1b1b',\n                marginTop: '5px'\n              }}>\n                <Locale code='make.done.saveToApp' />\n              </span>\n              <span style={{\n                fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Bold' : 'initial',\n                fontWeight: languageType.current === 'ja' ? 'initial' : 'bold',\n                fontSize: languageType.current === 'ja' ? '11px' : '10px',\n                color: isSavedToAPP ? '#ababab' : '#7d7d7d'\n              }}>\n                <Locale code='make.done.saveToApp.desc' />\n              </span>\n            </div>\n          </div>\n          <div onClick={handlePressSavePhoto} style={{\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            padding: '0 16px',\n            height: '56px',\n            borderTop: 'solid 1px #dadada',\n            borderBottom: 'solid 1px #dadada'\n          }}>\n            <div>\n              <img style={{\n                width: 24,\n                height: 24\n              }} src={require(`../../assets/Album${isSavedToAlbum ? '_press' : ''}.svg`)} />\n            </div>\n            <div style={{\n              flex: 1,\n              textAlign: 'center',\n              fontWeight: 'bold',\n              height: '56px',\n              display: 'flex',\n              flexDirection: 'column'\n            }}>\n              <span style={{\n                fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Bold' : 'initial',\n                fontWeight: languageType.current === 'ja' ? 'initial' : 'bold',\n                fontSize: languageType.current === 'ja' ? '17px' : '20px',\n                color: isSavedToAlbum ? '#ababab' : '#1b1b1b',\n                marginTop: '5px'\n              }}>\n                <Locale code='make.done.saveToAlbum' />\n              </span>\n              <span style={{\n                fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Bold' : 'initial',\n                fontWeight: languageType.current === 'ja' ? 'initial' : 'bold',\n                fontSize: languageType.current === 'ja' ? '11px' : '10px',\n                color: isSavedToAlbum ? '#ababab' : '#7d7d7d'\n              }}>\n                <Locale code='make.done.saveToAlbum.desc' />\n              </span>\n            </div>\n          </div>\n          <div onClick={handleCancel} style={{ height: '52px', padding: '15px' }}>\n            <button type='button' style={{\n              borderWidth: 1,\n              borderStyle: 'solid',\n              borderColor: '#1b1b1b',\n              height: '52px',\n              // fontWeight: 'bold',\n              textAlign: 'center',\n              fontSize: '17px',\n              width: '100%',\n              color: '#000',\n              backgroundColor: '#fff'\n            }}>\n              <span style={{\n                fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Bold' : 'UniqloPro-Bold',\n                fontSize: languageType.current === 'ja' ? '15px' : '16px'\n              }}>\n                <Locale code='make.done.save.cancel' />\n              </span>\n            </button>\n          </div>\n        </div>\n      </Modal>\n    </div>\n  )\n}\n","import React from 'react'\nimport invoke from '../utils/invoke'\nimport asyncEnums from '../utils/asyncStates'\n\nfunction formatMemory (raw, level = 'GB') {\n  const num = Number(raw)\n  const list = [2]\n  let index = 0\n  while (num >= list[index]) {\n    index++\n    list.push(Math.pow(2, index))\n  }\n  const byte = list[list.length - 2] || 0\n  return byte / Math.pow(1024, ['B', 'MB', 'GB'].indexOf(level) + 1)\n}\n\nexport default function useTotalMemory () {\n  const [memory, setMemory] = React.useState(null)\n  const [state, setState] = React.useState(asyncEnums.none)\n  const [error, setError] = React.useState(null)\n\n  const invokeTotalMemory = React.useCallback(async () => {\n    try {\n      setError(null)\n      setState(asyncEnums.pending)\n      const result = await invoke('getDeviceInfo', 'getTotalMemory')\n      if (process.env.NODE_ENV === 'development') {\n        invoke('log', `current device memory is ${formatMemory(result)}GB.`)\n      }\n      setMemory(formatMemory(result), 'GB')\n      setState(asyncEnums.fulfilled)\n    } catch (e) {\n      setError(e)\n      setState(asyncEnums.rejected)\n    }\n  }, [])\n\n  React.useEffect(() => {\n    invokeTotalMemory()\n  }, [invokeTotalMemory])\n\n  return {\n    pending: [asyncEnums.none, asyncEnums.pending].includes(state),\n    error,\n    memory\n  }\n}\n","import React from 'react'\nimport UAParser from 'ua-parser-js'\n\nfunction getOS () {\n  const parser = new UAParser()\n  const UAOS = parser.getOS()\n  return UAOS.name === 'iOS' ? 'ios' : 'android'\n}\n\nexport default function useTotalMemory () {\n  const [OS] = React.useState(getOS())\n  return {\n    OS\n  }\n}\n","import React, { useContext, useState, useEffect } from 'react'\nimport { MakeContext } from '../MakeContext'\nimport ShareButton from './ShareButton'\nimport Navbar from '../navbar'\nimport { ItemContext } from '../../contexts/ItemContext'\nimport invoke from '../../utils/invoke'\nimport Locale from '../../components/Locale'\nimport { LocaleContext } from '../../contexts/LocaleContext'\nimport './done.css'\nimport IsAgainEdit from '../../components/isAgainEdit'\nimport UtidButton from './utidButton'\nimport AddCartButton from './AddCartButton'\nimport Enlarge from '../../components/Enlarge'\nimport ViewPort from '../../components/ViewPort'\nimport SaveButton from './SaveButton'\nimport { throttle, InitializationThrottle } from '../../utils/throttle'\nimport AlertModal from './AlertModal'\nimport injectImages from '../../hoc/injectImages'\nimport useTotalMemory from '../../hooks/useTotalMemory'\nimport usePlatform from '../../hooks/usePlatform'\n\nfunction Done (props) {\n  const make = useContext(MakeContext)\n  const item = useContext(ItemContext)\n  const languageType = useContext(LocaleContext)\n  const [isAgainEdit, setIsAgainEdit] = useState(false)\n  const [addLimitVisible, setAddLimitVisible] = useState(false)\n  const [useLimitVisible, setUseLimitVisible] = useState(false)\n  const [moreHeight, setMoreHeight] = useState(0)\n  const [alertModelVisible, setAlertModelVisible] = useState(false)\n  const [itemType, setItemType] = useState(true)\n  const [upStep, setUpStep] = useState(0)\n  const totalMemory = useTotalMemory()\n  const platform = usePlatform()\n\n  const {\n    layers,\n    revokeToMake,\n    setRevokeToMake,\n    previousPage\n  } = make\n  const { zoom, setZoom } = item\n  let copyRightDone = ''\n  layers.forEach(element => {\n    if (element.copyRight && copyRightDone === '') {\n      copyRightDone = element.copyRight\n    }\n  })\n\n  // \n  useEffect(() => {\n    InitializationThrottle()\n    // invoke\n    // invoke('log', layers[layers.length - 1].mixData)\n    if ((window.innerWidth - 30) > (window.innerHeight - (244 + 50 * layers.length))) {\n      setMoreHeight((window.innerHeight - (244 + 50 * layers.length)))\n    } else {\n      setMoreHeight((window.innerWidth - 30))\n    }\n  }, [])\n  useEffect(() => {\n    if (copyRightDone && item.doneStyle && item.doneImageStyle) {\n      try {\n        if (itemType) {\n          // item.doneImageStyle.widthitem\n          setUpStep(item.doneImageStyle.width)\n          setItemType(false)\n          addCopyRight()\n        } else {\n          if (upStep === item.doneImageStyle.width) {\n            // \n          } else {\n            addCopyRight()\n          }\n        }\n      } catch (e) {\n\n      }\n    }\n  }, [item])\n  function addCopyRight () {\n    // doneImageStylecopyright(item)\n    setUpStep(item.doneImageStyle.width)\n    const newCan = document.getElementById('copyright')\n    const ctx = newCan.getContext('2d')\n    ctx.font = '2.8px arial'\n    ctx.fillStyle = '#1b1b1b'\n    ctx.filter = 'blur(0px)'\n    ctx.strokeStyle = 'rgba(255,255,255,0.25)'\n    ctx.lineWidth = '1'\n    let txtWidth = (item.doneStyle.width + item.doneStyle.left) - ctx.measureText(copyRightDone).width\n    let txtHeight = (item.doneStyle.top + item.doneStyle.height) - 2.5\n    ctx.strokeText(copyRightDone, txtWidth, txtHeight)\n    ctx.fillText(copyRightDone, txtWidth, txtHeight)\n  }\n  async function addlayer () {\n    if (layers.length > (getDeviceLayersNumberLimit() - 1)) {\n      return setAddLimitVisible(true)\n    } else if (checkLimit()) {\n      return setUseLimitVisible(true)\n    } else {\n      try {\n        let stampOnly = await invoke('getStampOnly')\n        if (stampOnly === true) {\n          await invoke('setLayers', [...layers, { type: 'stamp' }])\n          invoke('navigateTo', {\n            to: '/make/stamp',\n            params: { hasLayer: 1, previousPage }\n          })\n        } else {\n          await invoke('setLayers', [...layers, {}])\n          invoke('navigateTo', {\n            to: '/make',\n            params: { itemModal: 'show', hasLayer: 1, previousPage }\n          })\n        }\n      } catch (error) {\n        setAlertModelVisible(true)\n      }\n    }\n  }\n\n  function change () {\n    if (revokeToMake) {\n      invoke('navigateTo', {\n        routeName: 'Make'\n      })\n    } else {\n      setIsAgainEdit(true)\n      setRevokeToMake(false)\n    }\n  }\n\n  function isAgainFu (e) {\n    setIsAgainEdit(false)\n  }\n\n  function getDeviceLayersNumberLimit () {\n    if (process.env.REACT_APP_ADD_LAYER_LIMIT_MODE === 'min-memory') {\n      let minMemoryLimitNumber = Number(process.env.REACT_APP_ADD_LAYER_LIMIT_NUMBER)\n      if (isNaN(minMemoryLimitNumber)) minMemoryLimitNumber = 1\n\n      if (make.layers.length > (minMemoryLimitNumber - 1)) {\n        if (platform.OS === 'android') {\n          if (totalMemory.memory < 4) return minMemoryLimitNumber\n        } else if (platform.OS === 'ios') {\n          if (totalMemory.memory <= 2) return minMemoryLimitNumber\n        }\n      }\n    }\n\n    return 3\n  }\n\n  function checkLimit () {\n    const layersNumberLimit = getDeviceLayersNumberLimit()\n\n    let limitArr = {}\n    layers.map(layer => {\n      if (layer.type === 'stamp') {\n        let stampFlag = layer.stampRule.stampFlag\n        limitArr.flag_layer_paint = stampFlag.flag_layer_paint === 'NG' ? 'NG' : ''\n        limitArr.flag_layer_text = stampFlag.flag_layer_text === 'NG' ? 'NG' : ''\n        limitArr.flag_layer_stamp = stampFlag.flag_layer_stamp === 'NG' ? 'NG' : ''\n        limitArr.flag_layer_photo = stampFlag.flag_layer_photo === 'NG' ? 'NG' : ''\n      }\n    })\n    return (limitArr.flag_layer_paint === 'NG' && limitArr.flag_layer_text === 'NG' && limitArr.flag_layer_stamp === 'NG' && limitArr.flag_layer_photo === 'NG') || make.layers.length > (layersNumberLimit - 1)\n  }\n\n  function enlarge () {\n    setZoom(!zoom)\n  }\n\n  function newTop () {\n    let marginSize = 0\n    if ((window.innerWidth - 30) < (window.innerHeight - (244 + 50 * layers.length))) {\n      marginSize = ((window.innerHeight - (244 + 50 * layers.length)) - (window.innerWidth - 30)) / 2\n    }\n    return marginSize - 10\n  }\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        left: 0,\n        right: 0,\n        bottom: 0,\n        top: 0,\n        overflow: 'hidden'\n      }}\n    >\n      <UtidButton data={props.mixData} topLayer={props.topLayer} />\n      <AlertModal visible={alertModelVisible} title='error.network.title' description='error.network.description' text='OK' onClick={() => { setAlertModelVisible(false) }} />\n      {\n        !zoom ? <Navbar page='done' revoke={() => {\n          change()\n        }} /> : ''\n      }\n      <div className='doneContainer'\n        onClick={() => enlarge()}\n        style={{\n          height: (window.innerWidth - 30) > (window.innerHeight - (244 + 50 * layers.length)) ? (window.innerHeight - (244 + 50 * layers.length)) : (window.innerWidth - 30),\n          width: '100%',\n          position: 'absolute',\n          zIndex: 1,\n          marginTop: zoom ? 'initial' : newTop()\n        }}\n      >\n        <div style={{ display: zoom ? 'block' : 'none', position: 'fixed', top: 0, right: 0, left: 0, bottom: 0, backgroundColor: '#fff' }} />\n        <ViewPort\n          topLayer={props.topLayer}\n          data={props.mixData}\n          size={(window.innerWidth - 30) > (window.innerHeight - (244 + 50 * layers.length)) ? (window.innerHeight - (244 + 50 * layers.length)) : (window.innerWidth - 30)}>\n          <div style={{ position: 'absolute', top: 0, left: 0 }}>\n            <canvas id={'copyright'} width={item.doneImageStyle.width} height={item.doneImageStyle.height} />\n            <canvas id={'copyrightCan'} width={item.doneImageStyle.width} height={item.doneImageStyle.height} style={{ display: 'none' }} />\n          </div>\n          {/* canvas */}\n          <div style={{ position: 'absolute', left: 0, top: 0, width: item.doneImageStyle.width, height: item.doneImageStyle.height, background: 'rgba(0,0,0,0)' }} />\n        </ViewPort>\n\n      </div>\n      <Enlarge showStatus={!zoom ? 'show' : 'hidden'}\n        right={15}\n        top={newTop() + moreHeight + 15}\n        width={40}\n        height={40}\n      />\n      <div id='operationContainer' style={{\n        overflow: 'hidden',\n        position: 'absolute',\n        bottom: 15,\n        zIndex: zoom ? 'initial' : 2\n      }}\n      >\n        {(() => {\n          if (process.env.REACT_APP_ADD_LAYER_LIMIT_MODE === 'min-memory') {\n            if (totalMemory.pending) return null\n          }\n          return (\n            <div style={{\n              width: '120px',\n              height: '42px',\n              backgroundColor: 'white',\n              border: '1px solid #dadada',\n              color: checkLimit() ? '#ababab' : '#1b1b1b',\n              marginLeft: (window.innerWidth - 120) / 2,\n              marginTop: 10,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center'\n            }} onClick={() => throttle(addlayer)}>\n              <img src={require(checkLimit() ? '../../assets/prohibit.svg' : '../../assets/LayerAdd_Normal.svg')} alt='' />\n              <span style={{\n                fontWeight: '500',\n                marginLeft: '7px',\n                fontFamily: languageType.current === 'ja' ? 'NotoSansCJKjp-Bold' : 'UniqloPro-Bold',\n                fontSize: languageType.current === 'ja' ? '11px' : '13px'\n              }}>\n                <Locale code='make.done.addlayer' />\n              </span>\n            </div>\n          )\n        })()}\n        {\n          make.layers.map((item, index) => {\n            if (!item.type) { return }\n            return <div key={index} style={{\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              marginTop: index === 0 ? 12 : 10,\n              width: 345,\n              marginLeft: (window.innerWidth - 345) / 2,\n              letterSpacing: '0.4px'\n            }}>\n              <img style={{\n                width: 40,\n                height: 40\n              }} src={require(`../../assets/${item.type}.svg`)} />\n              {\n                item.mixType === 7 ? ''\n                  : <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center'\n                  }}>\n                    <img style={{ margin: '0 5px' }} src={require(`../../assets/and.svg`)} />\n                    <img src={require(`../../assets/${item.mixType === 7 ? 'no-mix' : `mix-${item.mixType}`}.svg`)} />\n                  </div>\n              }\n            </div>\n          })\n        }\n        <div style={{\n          // width: ' 346px',\n          width: window.innerWidth - 30,\n          height: '52px',\n          marginLeft: 15,\n          marginTop: 12\n        }}>\n          <ShareButton data={props.mixData} topLayer={props.topLayer} />\n          <SaveButton data={props.mixData} topLayer={props.topLayer} />\n        </div>\n        <AddCartButton data={props.mixData} topLayer={props.topLayer} />\n      </div>\n      <IsAgainEdit status={isAgainEdit} isAgainFu={isAgainFu} />\n      <AlertModal\n        visible={addLimitVisible}\n        title='make.done.addLimit.title'\n        description='make.done.addLimit'\n        localeParams={[getDeviceLayersNumberLimit()]}\n        onClick={() => {\n          setAddLimitVisible(false)\n        }}\n      />\n      <AlertModal visible={useLimitVisible} title='make.done.useLimit' onClick={() => {\n        setUseLimitVisible(false)\n      }} />\n    </div>\n  )\n}\n\nexport default injectImages('back')(Done)\n","var map = {\n\t\"./Actions.svg\": 516,\n\t\"./AddToCart.svg\": 575,\n\t\"./Album.svg\": 576,\n\t\"./Album_press.svg\": 577,\n\t\"./AlwaysInFront.svg\": 741,\n\t\"./Arrow.svg\": 565,\n\t\"./Arrows.svg\": 742,\n\t\"./Attention.svg\": 743,\n\t\"./Back_Normal.svg\": 569,\n\t\"./Back_Pressed.svg\": 744,\n\t\"./Back_Pressed_Circle.svg\": 745,\n\t\"./BrushStyle_Normal.svg\": 746,\n\t\"./Btn/Glitch/Normal/01.svg\": 747,\n\t\"./Btn/Glitch/Normal/02.svg\": 748,\n\t\"./Btn/Glitch/Normal/03.svg\": 749,\n\t\"./Btn/Glitch/Pressed/01.svg\": 750,\n\t\"./Btn/Glitch/Pressed/02.svg\": 751,\n\t\"./Btn/Glitch/Pressed/03.svg\": 752,\n\t\"./Btn/Moma/Normal/01.svg\": 753,\n\t\"./Btn/Moma/Normal/02.svg\": 754,\n\t\"./Btn/Moma/Normal/03.svg\": 755,\n\t\"./Btn/Moma/Pressed/01.svg\": 756,\n\t\"./Btn/Moma/Pressed/02.svg\": 757,\n\t\"./Btn/Moma/Pressed/03.svg\": 758,\n\t\"./Btn/layout/Normal/01.svg\": 759,\n\t\"./Btn/layout/Normal/02.svg\": 760,\n\t\"./Btn/layout/Normal/03.svg\": 761,\n\t\"./Btn/layout/Pressed/01.svg\": 762,\n\t\"./Btn/layout/Pressed/02.svg\": 763,\n\t\"./Btn/layout/Pressed/03.svg\": 764,\n\t\"./Btn/mosaic/Normal/01.svg\": 765,\n\t\"./Btn/mosaic/Normal/02.svg\": 766,\n\t\"./Btn/mosaic/Normal/03.svg\": 767,\n\t\"./Btn/mosaic/Pressed/01.svg\": 768,\n\t\"./Btn/mosaic/Pressed/02.svg\": 769,\n\t\"./Btn/mosaic/Pressed/03.svg\": 770,\n\t\"./Btn/none/Normal/01.svg\": 771,\n\t\"./Btn/none/Normal/02.svg\": 772,\n\t\"./Btn/none/Normal/03.svg\": 773,\n\t\"./Btn/none/Pressed/Pressed.svg\": 774,\n\t\"./Btn/splash/Normal/01.svg\": 775,\n\t\"./Btn/splash/Normal/02.svg\": 776,\n\t\"./Btn/splash/Normal/03.svg\": 777,\n\t\"./Btn/splash/Pressed/01.svg\": 778,\n\t\"./Btn/splash/Pressed/02.svg\": 779,\n\t\"./Btn/splash/Pressed/03.svg\": 780,\n\t\"./Btn/xmoma/Normal/01.svg\": 781,\n\t\"./Btn/xmoma/Normal/02.svg\": 782,\n\t\"./Btn/xmoma/Normal/03.svg\": 783,\n\t\"./Btn/xmoma/Pressed/01.svg\": 784,\n\t\"./Btn/xmoma/Pressed/02.svg\": 785,\n\t\"./Btn/xmoma/Pressed/03.svg\": 786,\n\t\"./Camera.svg\": 787,\n\t\"./Camera_press.svg\": 788,\n\t\"./CannotContribute.svg\": 789,\n\t\"./CannotProduce.svg\": 790,\n\t\"./Close_Normal.svg\": 791,\n\t\"./Close_Pressed.svg\": 792,\n\t\"./Color_Normal_01.svg\": 517,\n\t\"./Color_Normal_02.svg\": 518,\n\t\"./Color_Normal_03.svg\": 519,\n\t\"./Color_Normal_04.svg\": 520,\n\t\"./Color_Normal_05.svg\": 521,\n\t\"./Color_Normal_06.svg\": 522,\n\t\"./Color_Normal_07.svg\": 523,\n\t\"./Color_Normal_08.svg\": 524,\n\t\"./Color_Normal_09.svg\": 525,\n\t\"./Complete.svg\": 243,\n\t\"./DeleteStampIcon.svg\": 578,\n\t\"./DottedStyle_Normal.svg\": 793,\n\t\"./Effects.svg\": 526,\n\t\"./Help_Normal.svg\": 794,\n\t\"./Help_Pressed.svg\": 795,\n\t\"./LayerAdd_Normal.svg\": 579,\n\t\"./LayerNone_Normal.svg\": 796,\n\t\"./Layers.svg\": 527,\n\t\"./LineStyle_Normal.svg\": 797,\n\t\"./More.svg\": 528,\n\t\"./NOAUTODESIGNER.svg\": 798,\n\t\"./NODuplicateSameSticker.svg\": 799,\n\t\"./NOGLITCH.svg\": 800,\n\t\"./NOMOSAIC.svg\": 801,\n\t\"./NOMoMACollage.svg\": 802,\n\t\"./NOMoMAEarlyMordenStyle.svg\": 803,\n\t\"./NOOverlap.svg\": 804,\n\t\"./NOPAINT.svg\": 805,\n\t\"./NOPHOTO.svg\": 806,\n\t\"./NOReverse.svg\": 807,\n\t\"./NORotate.svg\": 808,\n\t\"./NOSPLASH.svg\": 809,\n\t\"./NOSTAMP.svg\": 810,\n\t\"./NOTYPOGRAPHY.svg\": 811,\n\t\"./NOUseMultipleStickers.svg\": 812,\n\t\"./New.svg\": 456,\n\t\"./News.svg\": 813,\n\t\"./Next_Normal.svg\": 449,\n\t\"./Publish_Normal.svg\": 814,\n\t\"./RestrictedFunctions.svg\": 529,\n\t\"./Return_Normal.svg\": 815,\n\t\"./Return_Pressed.svg\": 816,\n\t\"./Return_Pressed_Circle.svg\": 817,\n\t\"./Save.svg\": 580,\n\t\"./Save_Press.svg\": 581,\n\t\"./Shake_text/EN/Remix_Disable_EN.svg\": 38,\n\t\"./Shake_text/EN/Text_AutoDesigner_EN.svg\": 157,\n\t\"./Shake_text/EN/Text_AutoDesigner_EN_Pressed.svg\": 164,\n\t\"./Shake_text/EN/Text_Glitch_EN.svg\": 159,\n\t\"./Shake_text/EN/Text_Glitch_EN_Pressed.svg\": 166,\n\t\"./Shake_text/EN/Text_MoMACollage_EN.svg\": 156,\n\t\"./Shake_text/EN/Text_MoMACollage_EN_Pressed.svg\": 163,\n\t\"./Shake_text/EN/Text_MoMAEarlyModernStyle_EN.svg\": 155,\n\t\"./Shake_text/EN/Text_MoMAEarlyModernStyle_EN_Pressed.svg\": 162,\n\t\"./Shake_text/EN/Text_Mosaic_EN.svg\": 160,\n\t\"./Shake_text/EN/Text_Mosaic_EN_Pressed.svg\": 167,\n\t\"./Shake_text/EN/Text_NoRemix_EN.svg\": 161,\n\t\"./Shake_text/EN/Text_NoRemix_EN_Pressed.svg\": 168,\n\t\"./Shake_text/EN/Text_Splash_EN.svg\": 158,\n\t\"./Shake_text/EN/Text_Splash_EN_Pressed.svg\": 165,\n\t\"./Shake_text/JP/Remix_Disable_JP.svg\": 39,\n\t\"./Shake_text/JP/Text_AutoDesigner.svg\": 171,\n\t\"./Shake_text/JP/Text_AutoDesigner_Pressed.svg\": 178,\n\t\"./Shake_text/JP/Text_Glitch.svg\": 173,\n\t\"./Shake_text/JP/Text_Glitch_Pressed.svg\": 180,\n\t\"./Shake_text/JP/Text_MoMACollage.svg\": 170,\n\t\"./Shake_text/JP/Text_MoMACollage_Pressed.svg\": 177,\n\t\"./Shake_text/JP/Text_MoMAEarlyModernStyle.svg\": 169,\n\t\"./Shake_text/JP/Text_MoMAEarlyModernStyle_Pressed.svg\": 176,\n\t\"./Shake_text/JP/Text_Mosaic.svg\": 174,\n\t\"./Shake_text/JP/Text_Mosaic_Pressed.svg\": 181,\n\t\"./Shake_text/JP/Text_NoRemix.svg\": 175,\n\t\"./Shake_text/JP/Text_NoRemix_Pressed.svg\": 182,\n\t\"./Shake_text/JP/Text_Splash.svg\": 172,\n\t\"./Shake_text/JP/Text_Splash_Pressed.svg\": 179,\n\t\"./Shape/Shape_Circle.svg\": 582,\n\t\"./Shape/Shape_Flower_1.svg\": 583,\n\t\"./Shape/Shape_Flower_2.svg\": 584,\n\t\"./Shape/Shape_Flower_3.svg\": 585,\n\t\"./Shape/Shape_Flower_4.svg\": 586,\n\t\"./Shape/Shape_Heart.svg\": 587,\n\t\"./Shape/Shape_Hexagon.svg\": 588,\n\t\"./Shape/Shape_Parallelogram_1.svg\": 589,\n\t\"./Shape/Shape_Parallelogram_2.svg\": 590,\n\t\"./Shape/Shape_Parallelogram_3.svg\": 591,\n\t\"./Shape/Shape_Parallelogram_4.svg\": 592,\n\t\"./Shape/Shape_Quarter_circle_1.svg\": 593,\n\t\"./Shape/Shape_Quarter_circle_2.svg\": 594,\n\t\"./Shape/Shape_Quarter_circle_3.svg\": 595,\n\t\"./Shape/Shape_Quarter_circle_4.svg\": 596,\n\t\"./Shape/Shape_Rectangle.svg\": 597,\n\t\"./Shape/Shape_Rhombus.svg\": 598,\n\t\"./Shape/Shape_Right_triangle_1.svg\": 599,\n\t\"./Shape/Shape_Right_triangle_2.svg\": 600,\n\t\"./Shape/Shape_Right_triangle_3.svg\": 601,\n\t\"./Shape/Shape_Right_triangle_4.svg\": 602,\n\t\"./Shape/Shape_Rounded.svg\": 603,\n\t\"./Shape/Shape_Square.svg\": 604,\n\t\"./Shape/Shape_Star.svg\": 605,\n\t\"./Shape/Shape_Triangle_1.svg\": 606,\n\t\"./Shape/Shape_Triangle_2.svg\": 607,\n\t\"./Shape/Shape_Triangle_3.svg\": 608,\n\t\"./Shape/Shape_Triangle_4.svg\": 609,\n\t\"./Shape/Shape_Zebra_crossing_1.svg\": 610,\n\t\"./Shape/Shape_Zebra_crossing_2.svg\": 611,\n\t\"./Shape/Shape_Zebra_crossing_3.svg\": 612,\n\t\"./Shape/Shape_Zebra_crossing_4.svg\": 613,\n\t\"./ShapeNew/Shape_Circle.svg\": 614,\n\t\"./ShapeNew/Shape_Circle_Fill.svg\": 615,\n\t\"./ShapeNew/Shape_Flower_1.svg\": 616,\n\t\"./ShapeNew/Shape_Flower_1_Fill.svg\": 617,\n\t\"./ShapeNew/Shape_Flower_2.svg\": 618,\n\t\"./ShapeNew/Shape_Flower_2_Fill.svg\": 619,\n\t\"./ShapeNew/Shape_Flower_3.svg\": 620,\n\t\"./ShapeNew/Shape_Flower_3_Fill.svg\": 621,\n\t\"./ShapeNew/Shape_Flower_4.svg\": 622,\n\t\"./ShapeNew/Shape_Flower_4_Fill.svg\": 623,\n\t\"./ShapeNew/Shape_Heart.svg\": 624,\n\t\"./ShapeNew/Shape_Heart_Fill.svg\": 625,\n\t\"./ShapeNew/Shape_Hexagon.svg\": 626,\n\t\"./ShapeNew/Shape_Hexagon_Fill.svg\": 627,\n\t\"./ShapeNew/Shape_Parallelogram_1.svg\": 628,\n\t\"./ShapeNew/Shape_Parallelogram_1_Fill.svg\": 629,\n\t\"./ShapeNew/Shape_Parallelogram_2.svg\": 630,\n\t\"./ShapeNew/Shape_Parallelogram_2_Fill.svg\": 631,\n\t\"./ShapeNew/Shape_Parallelogram_3.svg\": 632,\n\t\"./ShapeNew/Shape_Parallelogram_3_Fill.svg\": 633,\n\t\"./ShapeNew/Shape_Parallelogram_4.svg\": 634,\n\t\"./ShapeNew/Shape_Parallelogram_4_Fill.svg\": 635,\n\t\"./ShapeNew/Shape_QuarterCircle_1.svg\": 636,\n\t\"./ShapeNew/Shape_QuarterCircle_1_Fill.svg\": 637,\n\t\"./ShapeNew/Shape_QuarterCircle_2.svg\": 638,\n\t\"./ShapeNew/Shape_QuarterCircle_2_Fill.svg\": 639,\n\t\"./ShapeNew/Shape_QuarterCircle_3.svg\": 640,\n\t\"./ShapeNew/Shape_QuarterCircle_3_Fill.svg\": 641,\n\t\"./ShapeNew/Shape_QuarterCircle_4.svg\": 642,\n\t\"./ShapeNew/Shape_QuarterCircle_4_Fill.svg\": 643,\n\t\"./ShapeNew/Shape_Rectangle.svg\": 644,\n\t\"./ShapeNew/Shape_Rectangle_Fill.svg\": 645,\n\t\"./ShapeNew/Shape_Rhombus.svg\": 646,\n\t\"./ShapeNew/Shape_Rhombus_Fill.svg\": 647,\n\t\"./ShapeNew/Shape_RightTriangle_1.svg\": 648,\n\t\"./ShapeNew/Shape_RightTriangle_1_Fill.svg\": 649,\n\t\"./ShapeNew/Shape_RightTriangle_2.svg\": 650,\n\t\"./ShapeNew/Shape_RightTriangle_2_Fill.svg\": 651,\n\t\"./ShapeNew/Shape_RightTriangle_3.svg\": 652,\n\t\"./ShapeNew/Shape_RightTriangle_3_Fill.svg\": 653,\n\t\"./ShapeNew/Shape_RightTriangle_4.svg\": 654,\n\t\"./ShapeNew/Shape_RightTriangle_4_Fill.svg\": 655,\n\t\"./ShapeNew/Shape_Rounded.svg\": 656,\n\t\"./ShapeNew/Shape_Rounded_Fill.svg\": 657,\n\t\"./ShapeNew/Shape_Square.svg\": 658,\n\t\"./ShapeNew/Shape_Square_Fill.svg\": 659,\n\t\"./ShapeNew/Shape_Star.svg\": 660,\n\t\"./ShapeNew/Shape_Star_Fill.svg\": 661,\n\t\"./ShapeNew/Shape_Triangle_1.svg\": 662,\n\t\"./ShapeNew/Shape_Triangle_1_Fill.svg\": 663,\n\t\"./ShapeNew/Shape_Triangle_2.svg\": 664,\n\t\"./ShapeNew/Shape_Triangle_2_Fill.svg\": 665,\n\t\"./ShapeNew/Shape_Triangle_3.svg\": 666,\n\t\"./ShapeNew/Shape_Triangle_3_Fill.svg\": 667,\n\t\"./ShapeNew/Shape_Triangle_4.svg\": 668,\n\t\"./ShapeNew/Shape_Triangle_4_Fill.svg\": 669,\n\t\"./ShapeNew/Shape_ZebraCrossing_1.svg\": 670,\n\t\"./ShapeNew/Shape_ZebraCrossing_1_Fill.svg\": 671,\n\t\"./ShapeNew/Shape_ZebraCrossing_2.svg\": 672,\n\t\"./ShapeNew/Shape_ZebraCrossing_2_Fill.svg\": 673,\n\t\"./ShapeNew/Shape_ZebraCrossing_3.svg\": 674,\n\t\"./ShapeNew/Shape_ZebraCrossing_3_Fill.svg\": 675,\n\t\"./ShapeNew/Shape_ZebraCrossing_4.svg\": 676,\n\t\"./ShapeNew/Shape_ZebraCrossing_4_Fill.svg\": 677,\n\t\"./Tips_Stop.svg\": 678,\n\t\"./and.svg\": 679,\n\t\"./arrow2.svg\": 457,\n\t\"./back/back_normal.svg\": 148,\n\t\"./back/back_pressed.svg\": 151,\n\t\"./blend-alpha-pressed.svg\": 818,\n\t\"./blend-alpha.svg\": 819,\n\t\"./blend-mask-pressed.svg\": 820,\n\t\"./blend-mask.svg\": 821,\n\t\"./blend-multiply-pressed.svg\": 822,\n\t\"./blend-multiply.svg\": 823,\n\t\"./blend-normal-pressed.svg\": 824,\n\t\"./blend-normal.svg\": 680,\n\t\"./blend-screen-pressed.svg\": 825,\n\t\"./blend-screen.svg\": 826,\n\t\"./brush-style-pressed.svg\": 827,\n\t\"./brush-style.svg\": 828,\n\t\"./centerAlign.svg\": 570,\n\t\"./check.svg\": 438,\n\t\"./close-normal.svg\": 458,\n\t\"./close-normalchange.svg\": 829,\n\t\"./color.svg\": 573,\n\t\"./dotted-style-pressed.svg\": 830,\n\t\"./dotted-style.svg\": 831,\n\t\"./editArea.svg\": 832,\n\t\"./eraser.svg\": 530,\n\t\"./eraser_selected_normal.svg\": 531,\n\t\"./eraser_selected_pressed.svg\": 833,\n\t\"./error.svg\": 477,\n\t\"./failed.svg\": 242,\n\t\"./font-normal.svg\": 515,\n\t\"./home/en/paint_text_normal.170x110.svg\": 834,\n\t\"./home/en/paint_text_normal.svg\": 532,\n\t\"./home/en/paint_text_pressed.170x110.svg\": 835,\n\t\"./home/en/paint_text_pressed.svg\": 836,\n\t\"./home/en/pic_text_normal.170x110.svg\": 837,\n\t\"./home/en/pic_text_normal.svg\": 533,\n\t\"./home/en/pic_text_pressed.170x110.svg\": 838,\n\t\"./home/en/pic_text_pressed.svg\": 839,\n\t\"./home/en/stamp_text_normal.170x110.svg\": 840,\n\t\"./home/en/stamp_text_normal.svg\": 534,\n\t\"./home/en/stamp_text_pressed.170x110.svg\": 841,\n\t\"./home/en/stamp_text_pressed.svg\": 842,\n\t\"./home/en/text_text_normal.170x110.svg\": 843,\n\t\"./home/en/text_text_normal.svg\": 535,\n\t\"./home/en/text_text_pressed.170x110.svg\": 844,\n\t\"./home/en/text_text_pressed.svg\": 845,\n\t\"./home/jp/Text_Text_pressed-1.svg\": 846,\n\t\"./home/jp/paint_text_normal.170x110.svg\": 847,\n\t\"./home/jp/paint_text_normal.svg\": 536,\n\t\"./home/jp/paint_text_pressed.170x110.svg\": 848,\n\t\"./home/jp/paint_text_pressed.svg\": 849,\n\t\"./home/jp/pic_text_normal.170x110.svg\": 850,\n\t\"./home/jp/pic_text_normal.svg\": 537,\n\t\"./home/jp/pic_text_pressed.170x110.svg\": 851,\n\t\"./home/jp/pic_text_pressed.svg\": 852,\n\t\"./home/jp/stamp_text_normal.170x110.svg\": 853,\n\t\"./home/jp/stamp_text_normal.svg\": 538,\n\t\"./home/jp/stamp_text_pressed.170x110.svg\": 854,\n\t\"./home/jp/stamp_text_pressed.svg\": 855,\n\t\"./home/jp/text_text_normal.170x110.svg\": 856,\n\t\"./home/jp/text_text_normal.svg\": 539,\n\t\"./home/jp/text_text_pressed.170x110.svg\": 857,\n\t\"./home/jp/text_text_pressed.svg\": 858,\n\t\"./icon-brush.svg\": 540,\n\t\"./keyboard/keyboard_normal_black.svg\": 567,\n\t\"./keyboard/keyboard_normal_white.svg\": 568,\n\t\"./keyboard/keyboard_pressed_black.svg\": 566,\n\t\"./leftAlign.svg\": 571,\n\t\"./line-style-pressed.svg\": 859,\n\t\"./line-style.svg\": 860,\n\t\"./link.svg\": 681,\n\t\"./make_text/paint_text_normal_en_android.svg\": 478,\n\t\"./make_text/paint_text_normal_en_ios.svg\": 479,\n\t\"./make_text/paint_text_normal_ja_android.svg\": 480,\n\t\"./make_text/paint_text_normal_ja_ios.svg\": 481,\n\t\"./make_text/paint_text_pressed_en_android.svg\": 482,\n\t\"./make_text/paint_text_pressed_en_ios.svg\": 483,\n\t\"./make_text/paint_text_pressed_ja_android.svg\": 484,\n\t\"./make_text/paint_text_pressed_ja_ios.svg\": 485,\n\t\"./make_text/photo_text_normal_en_android.svg\": 486,\n\t\"./make_text/photo_text_normal_en_ios.svg\": 487,\n\t\"./make_text/photo_text_normal_ja_android.svg\": 488,\n\t\"./make_text/photo_text_normal_ja_ios.svg\": 489,\n\t\"./make_text/photo_text_pressed_en_android.svg\": 490,\n\t\"./make_text/photo_text_pressed_en_ios.svg\": 491,\n\t\"./make_text/photo_text_pressed_ja_android.svg\": 492,\n\t\"./make_text/photo_text_pressed_ja_ios.svg\": 493,\n\t\"./make_text/stamp_text_normal_en_android.svg\": 494,\n\t\"./make_text/stamp_text_normal_en_ios.svg\": 495,\n\t\"./make_text/stamp_text_normal_ja_android.svg\": 496,\n\t\"./make_text/stamp_text_normal_ja_ios.svg\": 497,\n\t\"./make_text/stamp_text_pressed_en_android.svg\": 498,\n\t\"./make_text/stamp_text_pressed_en_ios.svg\": 499,\n\t\"./make_text/stamp_text_pressed_ja_android.svg\": 500,\n\t\"./make_text/stamp_text_pressed_ja_ios.svg\": 501,\n\t\"./make_text/text_text_normal_en_android.svg\": 502,\n\t\"./make_text/text_text_normal_en_ios.svg\": 503,\n\t\"./make_text/text_text_normal_ja_android.svg\": 504,\n\t\"./make_text/text_text_normal_ja_ios.svg\": 505,\n\t\"./make_text/text_text_pressed_en_android.svg\": 506,\n\t\"./make_text/text_text_pressed_en_ios.svg\": 507,\n\t\"./make_text/text_text_pressed_ja_android.svg\": 508,\n\t\"./make_text/text_text_pressed_ja_ios.svg\": 509,\n\t\"./mix-1.svg\": 861,\n\t\"./mix-2.svg\": 862,\n\t\"./mix-3.svg\": 863,\n\t\"./mix-4.svg\": 864,\n\t\"./mix-5.svg\": 865,\n\t\"./mix-6.svg\": 866,\n\t\"./mode-normal.svg\": 682,\n\t\"./moma-normal-02.svg\": 867,\n\t\"./moma-normal.svg\": 683,\n\t\"./mosaic-circle-pressed.svg\": 868,\n\t\"./mosaic-circle-style-pressed.svg\": 869,\n\t\"./mosaic-circle-style.svg\": 870,\n\t\"./mosaic-circle.svg\": 871,\n\t\"./mosaic-normal.svg\": 684,\n\t\"./mosaic-round-rect-pressed.svg\": 872,\n\t\"./mosaic-round-rect-style-pressed.svg\": 873,\n\t\"./mosaic-round-rect-style.svg\": 874,\n\t\"./mosaic-round-rect.svg\": 875,\n\t\"./mosaic-square-pressed.svg\": 876,\n\t\"./mosaic-square-style-pressed.svg\": 877,\n\t\"./mosaic-square-style.svg\": 878,\n\t\"./mosaic-square.svg\": 879,\n\t\"./mosaicCircle_Normal.svg\": 880,\n\t\"./mosaicCircle_Pressed.svg\": 881,\n\t\"./mosaicSquare_Normal.svg\": 882,\n\t\"./mosaicSquare_Pressed.svg\": 883,\n\t\"./newSave.svg\": 685,\n\t\"./next-disabel.svg\": 459,\n\t\"./next_disabel.svg\": 686,\n\t\"./normal.svg\": 687,\n\t\"./normal_press.svg\": 688,\n\t\"./paint.svg\": 884,\n\t\"./photo.svg\": 885,\n\t\"./play-normal.svg\": 689,\n\t\"./prohibit.svg\": 241,\n\t\"./prohibit/allowed/NODuplicateSameSticker.svg\": 690,\n\t\"./prohibit/allowed/NOOverlap.svg\": 691,\n\t\"./prohibit/allowed/NOReverse.svg\": 692,\n\t\"./prohibit/allowed/NORotate.svg\": 693,\n\t\"./prohibit/allowed/NOUseMultipleStickers.svg\": 694,\n\t\"./prohibit/allowed/duplicate-same-sticker-normal.svg\": 541,\n\t\"./prohibit/allowed/overlap-normal.svg\": 542,\n\t\"./prohibit/allowed/reverse-normal.svg\": 543,\n\t\"./prohibit/allowed/rotate-normal.svg\": 544,\n\t\"./prohibit/allowed/use-multiple-stickers-normal.svg\": 545,\n\t\"./prohibit/effects/NOAUTODESIGNER.svg\": 695,\n\t\"./prohibit/effects/NOGLITCH.svg\": 696,\n\t\"./prohibit/effects/NOMOSAIC.svg\": 697,\n\t\"./prohibit/effects/NOMoMACollage.svg\": 698,\n\t\"./prohibit/effects/NOMoMAEarlyMordenStyle.svg\": 699,\n\t\"./prohibit/effects/NOSPLASH.svg\": 700,\n\t\"./prohibit/effects/autodesigner-normal.svg\": 546,\n\t\"./prohibit/effects/glitch-normal.svg\": 547,\n\t\"./prohibit/effects/mo-ma-collage-normal.svg\": 548,\n\t\"./prohibit/effects/mo-ma-early-morden-style-normal.svg\": 549,\n\t\"./prohibit/effects/mosaic-normal.svg\": 550,\n\t\"./prohibit/effects/splash-normal.svg\": 551,\n\t\"./prohibit/layers/NOPAINT.svg\": 701,\n\t\"./prohibit/layers/NOPHOTO.svg\": 702,\n\t\"./prohibit/layers/NOSTAMP.svg\": 703,\n\t\"./prohibit/layers/NOTYPOGRAPHY.svg\": 704,\n\t\"./prohibit/layers/paint-normal.svg\": 552,\n\t\"./prohibit/layers/photo-normal.svg\": 553,\n\t\"./prohibit/layers/stamp-normal.svg\": 554,\n\t\"./prohibit/layers/typography-normal.svg\": 555,\n\t\"./prohibit/restricted/AlwaysInFront.svg\": 705,\n\t\"./prohibit/restricted/CannotContribute.svg\": 706,\n\t\"./prohibit/restricted/CannotProduce.svg\": 707,\n\t\"./remix_gif/none_Normal.svg\": 153,\n\t\"./remix_gif/none_Pressed.svg\": 154,\n\t\"./return-normal.svg\": 445,\n\t\"./return-normalchange.svg\": 886,\n\t\"./return-pressed.svg\": 455,\n\t\"./return/return_normal.svg\": 149,\n\t\"./return/return_pressed.svg\": 152,\n\t\"./rightAlign.svg\": 572,\n\t\"./rotate-normal.svg\": 448,\n\t\"./shape-normals/Shape_Circle_normal.svg\": 465,\n\t\"./shape-normals/Shape_Flower_normal_1.svg\": 708,\n\t\"./shape-normals/Shape_Flower_normal_2.svg\": 709,\n\t\"./shape-normals/Shape_Flower_normal_3.svg\": 710,\n\t\"./shape-normals/Shape_Flower_normal_4.svg\": 711,\n\t\"./shape-normals/Shape_Heart_normal.svg\": 466,\n\t\"./shape-normals/Shape_Hexagon_normal.svg\": 467,\n\t\"./shape-normals/Shape_Parallelogram_normal_1.svg\": 712,\n\t\"./shape-normals/Shape_Parallelogram_normal_2.svg\": 713,\n\t\"./shape-normals/Shape_Parallelogram_normal_3.svg\": 714,\n\t\"./shape-normals/Shape_Parallelogram_normal_4.svg\": 715,\n\t\"./shape-normals/Shape_Quarter_circle_normal_1.svg\": 716,\n\t\"./shape-normals/Shape_Quarter_circle_normal_2.svg\": 717,\n\t\"./shape-normals/Shape_Quarter_circle_normal_3.svg\": 718,\n\t\"./shape-normals/Shape_Quarter_circle_normal_4.svg\": 719,\n\t\"./shape-normals/Shape_Rectangle_normal.svg\": 468,\n\t\"./shape-normals/Shape_Rhombus_normal.svg\": 469,\n\t\"./shape-normals/Shape_Right_triangle_normal_1.svg\": 720,\n\t\"./shape-normals/Shape_Right_triangle_normal_2.svg\": 721,\n\t\"./shape-normals/Shape_Right_triangle_normal_3.svg\": 722,\n\t\"./shape-normals/Shape_Right_triangle_normal_4.svg\": 723,\n\t\"./shape-normals/Shape_Rounded_normal.svg\": 470,\n\t\"./shape-normals/Shape_Square_normal.svg\": 471,\n\t\"./shape-normals/Shape_Star_normal.svg\": 472,\n\t\"./shape-normals/Shape_Triangle_normal_1.svg\": 724,\n\t\"./shape-normals/Shape_Triangle_normal_2.svg\": 725,\n\t\"./shape-normals/Shape_Triangle_normal_3.svg\": 726,\n\t\"./shape-normals/Shape_Triangle_normal_4.svg\": 727,\n\t\"./shape-normals/Shape_Zebra_crossing_normal_1.svg\": 728,\n\t\"./shape-normals/Shape_Zebra_crossing_normal_2.svg\": 729,\n\t\"./shape-normals/Shape_Zebra_crossing_normal_3.svg\": 730,\n\t\"./shape-normals/Shape_Zebra_crossing_normal_4.svg\": 731,\n\t\"./stamp.svg\": 887,\n\t\"./stop-normal.svg\": 732,\n\t\"./text-color-normal.svg\": 733,\n\t\"./text.svg\": 888,\n\t\"./textBoxIconBackground.svg\": 734,\n\t\"./thick_brush_selected_Pressed.svg\": 889,\n\t\"./thick_brush_selected_normal.svg\": 556,\n\t\"./thin-brush.svg\": 557,\n\t\"./thin_brush_selected_normal.svg\": 558,\n\t\"./thin_brush_selected_pressed.svg\": 890,\n\t\"./triangle.svg\": 574,\n\t\"./typeColorBtnRed.svg\": 244,\n\t\"./warning.svg\": 735\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 439;","/* global ActiveXObject */\n\n/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */\n\nvar fabric = fabric || { version: '2.4.6' };\nif (typeof exports !== 'undefined') {\n  exports.fabric = fabric;\n}\n/* _AMD_START_ */\n// else if (typeof define === 'function' && define.amd) {\n//   define([], function() { return fabric; });\n// }\n/* _AMD_END_ */\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  fabric.document = document;\n  fabric.window = window;\n}\nelse {\n  // assume we're running under node.js when document/window are not present\n  fabric.document = require('jsdom')\n    .jsdom(\n      decodeURIComponent('%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E'),\n      { features: {\n        FetchExternalResources: ['img']\n      }\n      });\n  fabric.jsdomImplForWrapper = require('jsdom/lib/jsdom/living/generated/utils').implForWrapper;\n  fabric.nodeCanvas = require('jsdom/lib/jsdom/utils').Canvas;\n  fabric.window = fabric.document.defaultView;\n  DOMParser = require('xmldom').DOMParser;\n}\n\n/**\n * True when in environment that supports touch events\n * @type boolean\n */\nfabric.isTouchSupported = 'ontouchstart' in fabric.window || 'ontouchstart' in fabric.document ||\n  (fabric.window && fabric.window.navigator && fabric.window.navigator.maxTouchPoints > 0);\n\n/**\n * True when in environment that's probably Node.js\n * @type boolean\n */\nfabric.isLikelyNode = typeof Buffer !== 'undefined' &&\n                      typeof window === 'undefined';\n\n/* _FROM_SVG_START_ */\n/**\n * Attributes parsed from all SVG elements\n * @type array\n */\nfabric.SHARED_ATTRIBUTES = [\n  'display',\n  'transform',\n  'fill', 'fill-opacity', 'fill-rule',\n  'opacity',\n  'stroke', 'stroke-dasharray', 'stroke-linecap', 'stroke-dashoffset',\n  'stroke-linejoin', 'stroke-miterlimit',\n  'stroke-opacity', 'stroke-width',\n  'id', 'paint-order',\n  'instantiated_by_use', 'clip-path'\n];\n/* _FROM_SVG_END_ */\n\n/**\n * Pixel per Inch as a default value set to 96. Can be changed for more realistic conversion.\n */\nfabric.DPI = 96;\nfabric.reNum = '(?:[-+]?(?:\\\\d+|\\\\d*\\\\.\\\\d+)(?:e[-+]?\\\\d+)?)';\nfabric.fontPaths = { };\nfabric.iMatrix = [1, 0, 0, 1, 0, 0];\nfabric.canvasModule = 'canvas';\n\n/**\n * Pixel limit for cache canvases. 1Mpx , 4Mpx should be fine.\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.perfLimitSizeTotal = 2097152;\n\n/**\n * Pixel limit for cache canvases width or height. IE fixes the maximum at 5000\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.maxCacheSideLimit = 4096;\n\n/**\n * Lowest pixel limit for cache canvases, set at 256PX\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.minCacheSideLimit = 256;\n\n/**\n * Cache Object for widths of chars in text rendering.\n */\nfabric.charWidthsCache = { };\n\n/**\n * if webgl is enabled and available, textureSize will determine the size\n * of the canvas backend\n * @since 2.0.0\n * @type Number\n * @default\n */\nfabric.textureSize = 2048;\n\n/**\n * Enable webgl for filtering picture is available\n * A filtering backend will be initialized, this will both take memory and\n * time since a default 2048x2048 canvas will be created for the gl context\n * @since 2.0.0\n * @type Boolean\n * @default\n */\nfabric.enableGLFiltering = true;\n\n/**\n * Device Pixel Ratio\n * @see https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/SettingUptheCanvas/SettingUptheCanvas.html\n */\nfabric.devicePixelRatio = fabric.window.devicePixelRatio ||\n                          fabric.window.webkitDevicePixelRatio ||\n                          fabric.window.mozDevicePixelRatio ||\n                          1;\n/**\n * Browser-specific constant to adjust CanvasRenderingContext2D.shadowBlur value,\n * which is unitless and not rendered equally across browsers.\n *\n * Values that work quite well (as of October 2017) are:\n * - Chrome: 1.5\n * - Edge: 1.75\n * - Firefox: 0.9\n * - Safari: 0.95\n *\n * @since 2.0.0\n * @type Number\n * @default 1\n */\nfabric.browserShadowBlurConstant = 1;\n\n/**\n * This object contains the result of arc to beizer conversion for faster retrieving if the same arc needs to be converted again.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.arcToSegmentsCache = { };\n\n/**\n * This object keeps the results of the boundsOfCurve calculation mapped by the joined arguments necessary to calculate it.\n * It does speed up calculation, if you parse and add always the same paths, but in case of heavy usage of freedrawing\n * you do not get any speed benefit and you get a big object in memory.\n * The object was a private variable before, while now is appended to the lib so that you have access to it and you\n * can eventually clear it.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.boundsOfCurveCache = { };\n\n/**\n * If disabled boundsOfCurveCache is not used. For apps that make heavy usage of pencil drawing probably disabling it is better\n * @default true\n */\nfabric.cachesBoundsOfCurve = true;\n\nfabric.initFilterBackend = function() {\n  if (fabric.enableGLFiltering && fabric.isWebglSupported && fabric.isWebglSupported(fabric.textureSize)) {\n    // console.log('max texture size: ' + fabric.maxTextureSize);\n    return (new fabric.WebglFilterBackend({ tileSize: fabric.textureSize }));\n  }\n  else if (fabric.Canvas2dFilterBackend) {\n    return (new fabric.Canvas2dFilterBackend());\n  }\n};\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  // ensure globality even if entire library were function wrapped (as in Meteor.js packaging system)\n  window.fabric = fabric;\n}\n/*:\n\t----------------------------------------------------\n\tevent.js : 1.1.5 : 2014/02/12 : MIT License\n\t----------------------------------------------------\n\thttps://github.com/mudcube/Event.js\n\t----------------------------------------------------\n\t1  : click, dblclick, dbltap\n\t1+ : tap, longpress, drag, swipe\n\t2+ : pinch, rotate\n\t   : mousewheel, devicemotion, shake\n\t----------------------------------------------------\n\tIdeas for the future\n\t----------------------------------------------------\n\t* GamePad, and other input abstractions.\n\t* Event batching - i.e. for every x fingers down a new gesture is created.\n\t----------------------------------------------------\n\thttp://www.w3.org/TR/2011/WD-touch-events-20110505/\n\t----------------------------------------------------\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\n\n(function(root) { \"use strict\";\n\n// Add custom *EventListener commands to HTMLElements (set false to prevent funkiness).\nroot.modifyEventListener = false;\n\n// Add bulk *EventListener commands on NodeLists from querySelectorAll and others  (set false to prevent funkiness).\nroot.modifySelectors = false;\n\nroot.configure = function(conf) {\n\tif (isFinite(conf.modifyEventListener)) root.modifyEventListener = conf.modifyEventListener;\n\tif (isFinite(conf.modifySelectors)) root.modifySelectors = conf.modifySelectors;\n\t/// Augment event listeners\n\tif (eventListenersAgumented === false && root.modifyEventListener) {\n\t\taugmentEventListeners();\n\t}\n\tif (selectorsAugmented === false && root.modifySelectors) {\n\t\taugmentSelectors();\n\t}\n};\n\n// Event maintenance.\nroot.add = function(target, type, listener, configure) {\n\treturn eventManager(target, type, listener, configure, \"add\");\n};\n\nroot.remove = function(target, type, listener, configure) {\n\treturn eventManager(target, type, listener, configure, \"remove\");\n};\n\nroot.returnFalse = function(event) {\n\treturn false;\n};\n\nroot.stop = function(event) {\n\tif (!event) return;\n\tif (event.stopPropagation) event.stopPropagation();\n\tevent.cancelBubble = true; // <= IE8\n\tevent.cancelBubbleCount = 0;\n};\n\nroot.prevent = function(event) {\n\tif (!event) return;\n\tif (event.preventDefault) {\n\t\tevent.preventDefault();\n\t} else if (event.preventManipulation) {\n\t\tevent.preventManipulation(); // MS\n\t} else {\n\t\tevent.returnValue = false; // <= IE8\n\t}\n};\n\nroot.cancel = function(event) {\n\troot.stop(event);\n\troot.prevent(event);\n};\n\nroot.blur = function() { // Blurs the focused element. Useful when using eventjs.cancel as canceling will prevent focused elements from being blurred.\n\tvar node = document.activeElement;\n\tif (!node) return;\n\tvar nodeName = document.activeElement.nodeName;\n\tif (nodeName === \"INPUT\" || nodeName === \"TEXTAREA\" || node.contentEditable === \"true\") {\n\t\tif (node.blur) node.blur();\n\t}\n};\n\n// Check whether event is natively supported (via @kangax)\nroot.getEventSupport = function (target, type) {\n\tif (typeof(target) === \"string\") {\n\t\ttype = target;\n\t\ttarget = window;\n\t}\n\ttype = \"on\" + type;\n\tif (type in target) return true;\n\tif (!target.setAttribute) target = document.createElement(\"div\");\n\tif (target.setAttribute && target.removeAttribute) {\n\t\ttarget.setAttribute(type, \"\");\n\t\tvar isSupported = typeof target[type] === \"function\";\n\t\tif (typeof target[type] !== \"undefined\") target[type] = null;\n\t\ttarget.removeAttribute(type);\n\t\treturn isSupported;\n\t}\n};\n\nvar clone = function (obj) {\n\tif (!obj || typeof (obj) !== 'object') return obj;\n\tvar temp = new obj.constructor();\n\tfor (var key in obj) {\n\t\tif (!obj[key] || typeof (obj[key]) !== 'object') {\n\t\t\ttemp[key] = obj[key];\n\t\t} else { // clone sub-object\n\t\t\ttemp[key] = clone(obj[key]);\n\t\t}\n\t}\n\treturn temp;\n};\n\n/// Handle custom *EventListener commands.\nvar eventManager = function(target, type, listener, configure, trigger, fromOverwrite) {\n\tconfigure = configure || {};\n\t// Check whether target is a configuration variable;\n\tif (String(target) === \"[object Object]\") {\n\t\tvar data = target;\n\t\ttarget = data.target; delete data.target;\n\t\t///\n\t\tif (data.type && data.listener) {\n\t\t\ttype = data.type; delete data.type;\n\t\t\tlistener = data.listener; delete data.listener;\n\t\t\tfor (var key in data) {\n\t\t\t\tconfigure[key] = data[key];\n\t\t\t}\n\t\t} else { // specialness\n\t\t\tfor (var param in data) {\n\t\t\t\tvar value = data[param];\n\t\t\t\tif (typeof(value) === \"function\") continue;\n\t\t\t\tconfigure[param] = value;\n\t\t\t}\n\t\t\t///\n\t\t\tvar ret = {};\n\t\t\tfor (var key in data) {\n\t\t\t\tvar param = key.split(\",\");\n\t\t\t\tvar o = data[key];\n\t\t\t\tvar conf = {};\n\t\t\t\tfor (var k in configure) { // clone base configuration\n\t\t\t\t\tconf[k] = configure[k];\n\t\t\t\t}\n\t\t\t\t///\n\t\t\t\tif (typeof(o) === \"function\") { // without configuration\n\t\t\t\t\tvar listener = o;\n\t\t\t\t} else if (typeof(o.listener) === \"function\") { // with configuration\n\t\t\t\t\tvar listener = o.listener;\n\t\t\t\t\tfor (var k in o) { // merge configure into base configuration\n\t\t\t\t\t\tif (typeof(o[k]) === \"function\") continue;\n\t\t\t\t\t\tconf[k] = o[k];\n\t\t\t\t\t}\n\t\t\t\t} else { // not a listener\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t///\n\t\t\t\tfor (var n = 0; n < param.length; n ++) {\n\t\t\t\t\tret[key] = eventjs.add(target, param[n], listener, conf, trigger);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\t}\n\t///\n\tif (!target || !type || !listener) return;\n\t// Check for element to load on interval (before onload).\n\tif (typeof(target) === \"string\" && type === \"ready\") {\n\t\tif (window.eventjs_stallOnReady) { /// force stall for scripts to load\n\t\t\ttype = \"load\";\n\t\t\ttarget = window;\n\t\t} else { //\n\t\t\tvar time = (new Date()).getTime();\n\t\t\tvar timeout = configure.timeout;\n\t\t\tvar ms = configure.interval || 1000 / 60;\n\t\t\tvar interval = window.setInterval(function() {\n\t\t\t\tif ((new Date()).getTime() - time > timeout) {\n\t\t\t\t\twindow.clearInterval(interval);\n\t\t\t\t}\n\t\t\t\tif (document.querySelector(target)) {\n\t\t\t\t\twindow.clearInterval(interval);\n\t\t\t\t\tsetTimeout(listener, 1);\n\t\t\t\t}\n\t\t\t}, ms);\n\t\t\treturn;\n\t\t}\n\t}\n\t// Get DOM element from Query Selector.\n\tif (typeof(target) === \"string\") {\n\t\ttarget = document.querySelectorAll(target);\n\t\tif (target.length === 0) return createError(\"Missing target on listener!\", arguments); // No results.\n\t\tif (target.length === 1) { // Single target.\n\t\t\ttarget = target[0];\n\t\t}\n\t}\n\n\t/// Handle multiple targets.\n\tvar event;\n\tvar events = {};\n\tif (target.length > 0 && target !== window) {\n\t\tfor (var n0 = 0, length0 = target.length; n0 < length0; n0 ++) {\n\t\t\tevent = eventManager(target[n0], type, listener, clone(configure), trigger);\n\t\t\tif (event) events[n0] = event;\n\t\t}\n\t\treturn createBatchCommands(events);\n\t}\n\n\t/// Check for multiple events in one string.\n\tif (typeof(type) === \"string\") {\n\t\ttype = type.toLowerCase();\n\t\tif (type.indexOf(\" \") !== -1) {\n\t\t\ttype = type.split(\" \");\n\t\t} else if (type.indexOf(\",\") !== -1) {\n\t\t\ttype = type.split(\",\");\n\t\t}\n\t}\n\n\t/// Attach or remove multiple events associated with a target.\n\tif (typeof(type) !== \"string\") { // Has multiple events.\n\t\tif (typeof(type.length) === \"number\") { // Handle multiple listeners glued together.\n\t\t\tfor (var n1 = 0, length1 = type.length; n1 < length1; n1 ++) { // Array [type]\n\t\t\t\tevent = eventManager(target, type[n1], listener, clone(configure), trigger);\n\t\t\t\tif (event) events[type[n1]] = event;\n\t\t\t}\n\t\t} else { // Handle multiple listeners.\n\t\t\tfor (var key in type) { // Object {type}\n\t\t\t\tif (typeof(type[key]) === \"function\") { // without configuration.\n\t\t\t\t\tevent = eventManager(target, key, type[key], clone(configure), trigger);\n\t\t\t\t} else { // with configuration.\n\t\t\t\t\tevent = eventManager(target, key, type[key].listener, clone(type[key]), trigger);\n\t\t\t\t}\n\t\t\t\tif (event) events[key] = event;\n\t\t\t}\n\t\t}\n\t\treturn createBatchCommands(events);\n\t} else if (type.indexOf(\"on\") === 0) { // to support things like \"onclick\" instead of \"click\"\n\t\ttype = type.substr(2);\n\t}\n\n\t// Ensure listener is a function.\n\tif (typeof(target) !== \"object\") return createError(\"Target is not defined!\", arguments);\n\tif (typeof(listener) !== \"function\") return createError(\"Listener is not a function!\", arguments);\n\n\t// Generate a unique wrapper identifier.\n\tvar useCapture = configure.useCapture || false;\n\tvar id = getID(target) + \".\" + getID(listener) + \".\" + (useCapture ? 1 : 0);\n\t// Handle the event.\n\tif (root.Gesture && root.Gesture._gestureHandlers[type]) { // Fire custom event.\n\t\tid = type + id;\n\t\tif (trigger === \"remove\") { // Remove event listener.\n\t\t\tif (!wrappers[id]) return; // Already removed.\n\t\t\twrappers[id].remove();\n\t\t\tdelete wrappers[id];\n\t\t} else if (trigger === \"add\") { // Attach event listener.\n\t\t\tif (wrappers[id]) {\n\t\t\t\twrappers[id].add();\n\t\t\t\treturn wrappers[id]; // Already attached.\n\t\t\t}\n\t\t\t// Retains \"this\" orientation.\n\t\t\tif (configure.useCall && !root.modifyEventListener) {\n\t\t\t\tvar tmp = listener;\n\t\t\t\tlistener = function(event, self) {\n\t\t\t\t\tfor (var key in self) event[key] = self[key];\n\t\t\t\t\treturn tmp.call(target, event);\n\t\t\t\t};\n\t\t\t}\n\t\t\t// Create listener proxy.\n\t\t\tconfigure.gesture = type;\n\t\t\tconfigure.target = target;\n\t\t\tconfigure.listener = listener;\n\t\t\tconfigure.fromOverwrite = fromOverwrite;\n\t\t\t// Record wrapper.\n\t\t\twrappers[id] = root.proxy[type](configure);\n\t\t}\n\t\treturn wrappers[id];\n\t} else { // Fire native event.\n\t\tvar eventList = getEventList(type);\n\t\tfor (var n = 0, eventId; n < eventList.length; n ++) {\n\t\t\ttype = eventList[n];\n\t\t\teventId = type + \".\" + id;\n\t\t\tif (trigger === \"remove\") { // Remove event listener.\n\t\t\t\tif (!wrappers[eventId]) continue; // Already removed.\n\t\t\t\ttarget[remove](type, listener, useCapture);\n\t\t\t\tdelete wrappers[eventId];\n\t\t\t} else if (trigger === \"add\") { // Attach event listener.\n\t\t\t\tif (wrappers[eventId]) return wrappers[eventId]; // Already attached.\n\t\t\t\ttarget[add](type, listener, useCapture);\n\t\t\t\t// Record wrapper.\n\t\t\t\twrappers[eventId] = {\n\t\t\t\t\tid: eventId,\n\t\t\t\t\ttype: type,\n\t\t\t\t\ttarget: target,\n\t\t\t\t\tlistener: listener,\n\t\t\t\t\tremove: function() {\n\t\t\t\t\t\tfor (var n = 0; n < eventList.length; n ++) {\n\t\t\t\t\t\t\troot.remove(target, eventList[n], listener, configure);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn wrappers[eventId];\n\t}\n};\n\n/// Perform batch actions on multiple events.\nvar createBatchCommands = function(events) {\n\treturn {\n\t\tremove: function() { // Remove multiple events.\n\t\t\tfor (var key in events) {\n\t\t\t\tevents[key].remove();\n\t\t\t}\n\t\t},\n\t\tadd: function() { // Add multiple events.\n\t\t\tfor (var key in events) {\n\t\t\t\tevents[key].add();\n\t\t\t}\n\t\t}\n\t};\n};\n\n/// Display error message in console.\nvar createError = function(message, data) {\n\tif (typeof(console) === \"undefined\") return;\n\tif (typeof(console.error) === \"undefined\") return;\n\tconsole.error(message, data);\n};\n\n/// Handle naming discrepancies between platforms.\nvar pointerDefs = {\n\t\"msPointer\": [ \"MSPointerDown\", \"MSPointerMove\", \"MSPointerUp\" ],\n\t\"touch\": [ \"touchstart\", \"touchmove\", \"touchend\" ],\n\t\"mouse\": [ \"mousedown\", \"mousemove\", \"mouseup\" ]\n};\n\nvar pointerDetect = {\n\t// MSPointer\n\t\"MSPointerDown\": 0,\n\t\"MSPointerMove\": 1,\n\t\"MSPointerUp\": 2,\n\t// Touch\n\t\"touchstart\": 0,\n\t\"touchmove\": 1,\n\t\"touchend\": 2,\n\t// Mouse\n\t\"mousedown\": 0,\n\t\"mousemove\": 1,\n\t\"mouseup\": 2\n};\n\nvar getEventSupport = (function() {\n\troot.supports = {};\n\tif (window.navigator.msPointerEnabled) {\n\t\troot.supports.msPointer = true;\n\t}\n\tif (root.getEventSupport(\"touchstart\")) {\n\t\troot.supports.touch = true;\n\t}\n\tif (root.getEventSupport(\"mousedown\")) {\n\t\troot.supports.mouse = true;\n\t}\n})();\n\nvar getEventList = (function() {\n\treturn function(type) {\n\t\tvar prefix = document.addEventListener ? \"\" : \"on\"; // IE\n\t\tvar idx = pointerDetect[type];\n\t\tif (isFinite(idx)) {\n\t\t\tvar types = [];\n\t\t\tfor (var key in root.supports) {\n\t\t\t\ttypes.push(prefix + pointerDefs[key][idx]);\n\t\t\t}\n\t\t\treturn types;\n\t\t} else {\n\t\t\treturn [ prefix + type ];\n\t\t}\n\t};\n})();\n\n/// Event wrappers to keep track of all events placed in the window.\nvar wrappers = {};\nvar counter = 0;\nvar getID = function(object) {\n\tif (object === window) return \"#window\";\n\tif (object === document) return \"#document\";\n\tif (!object.uniqueID) object.uniqueID = \"e\" + counter ++;\n\treturn object.uniqueID;\n};\n\n/// Detect platforms native *EventListener command.\nvar add = document.addEventListener ? \"addEventListener\" : \"attachEvent\";\nvar remove = document.removeEventListener ? \"removeEventListener\" : \"detachEvent\";\n\n/*\n\tPointer.js\n\t----------------------------------------\n\tModified from; https://github.com/borismus/pointer.js\n*/\n\nroot.createPointerEvent = function (event, self, preventRecord) {\n\tvar eventName = self.gesture;\n\tvar target = self.target;\n\tvar pts = event.changedTouches || root.proxy.getCoords(event);\n\tif (pts.length) {\n\t\tvar pt = pts[0];\n\t\tself.pointers = preventRecord ? [] : pts;\n\t\tself.pageX = pt.pageX;\n\t\tself.pageY = pt.pageY;\n\t\tself.x = self.pageX;\n\t\tself.y = self.pageY;\n\t}\n\t///\n\tvar newEvent = document.createEvent(\"Event\");\n\tnewEvent.initEvent(eventName, true, true);\n\tnewEvent.originalEvent = event;\n\tfor (var k in self) {\n\t\tif (k === \"target\") continue;\n\t\tnewEvent[k] = self[k];\n\t}\n\t///\n\tvar type = newEvent.type;\n\tif (root.Gesture && root.Gesture._gestureHandlers[type]) { // capture custom events.\n//\t\ttarget.dispatchEvent(newEvent);\n\t\tself.oldListener.call(target, newEvent, self, false);\n\t}\n};\n\nvar eventListenersAgumented = false;\nvar augmentEventListeners = function() {\n\t/// Allows *EventListener to use custom event proxies.\n\tif (!window.HTMLElement) return;\n\tvar augmentEventListener = function(proto) {\n\t\tvar recall = function(trigger) { // overwrite native *EventListener's\n\t\t\tvar handle = trigger + \"EventListener\";\n\t\t\tvar handler = proto[handle];\n\t\t\tproto[handle] = function (type, listener, useCapture) {\n\t\t\t\tif (root.Gesture && root.Gesture._gestureHandlers[type]) { // capture custom events.\n\t\t\t\t\tvar configure = useCapture;\n\t\t\t\t\tif (typeof(useCapture) === \"object\") {\n\t\t\t\t\t\tconfigure.useCall = true;\n\t\t\t\t\t} else { // convert to configuration object.\n\t\t\t\t\t\tconfigure = {\n\t\t\t\t\t\t\tuseCall: true,\n\t\t\t\t\t\t\tuseCapture: useCapture\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\teventManager(this, type, listener, configure, trigger, true);\n//\t\t\t\t\thandler.call(this, type, listener, useCapture);\n\t\t\t\t} else { // use native function.\n\t\t\t\t\tvar types = getEventList(type);\n\t\t\t\t\tfor (var n = 0; n < types.length; n ++) {\n\t\t\t\t\t\thandler.call(this, types[n], listener, useCapture);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\trecall(\"add\");\n\t\trecall(\"remove\");\n\t};\n\t// NOTE: overwriting HTMLElement doesn't do anything in Firefox.\n\tif (navigator.userAgent.match(/Firefox/)) {\n\t\t// TODO: fix Firefox for the general case.\n\t\taugmentEventListener(HTMLDivElement.prototype);\n\t\taugmentEventListener(HTMLCanvasElement.prototype);\n\t} else {\n\t\taugmentEventListener(HTMLElement.prototype);\n\t}\n\taugmentEventListener(document);\n\taugmentEventListener(window);\n};\n\nvar selectorsAugmented = false;\nvar augmentSelectors = function() {\n/// Allows querySelectorAll and other NodeLists to perform *EventListener commands in bulk.\n\tvar proto = NodeList.prototype;\n\tproto.removeEventListener = function(type, listener, useCapture) {\n\t\tfor (var n = 0, length = this.length; n < length; n ++) {\n\t\t\tthis[n].removeEventListener(type, listener, useCapture);\n\t\t}\n\t};\n\tproto.addEventListener = function(type, listener, useCapture) {\n\t\tfor (var n = 0, length = this.length; n < length; n ++) {\n\t\t\tthis[n].addEventListener(type, listener, useCapture);\n\t\t}\n\t};\n};\n\nreturn root;\n\n})(eventjs);\n\n/*:\n\t----------------------------------------------------\n\teventjs.proxy : 0.4.2 : 2013/07/17 : MIT License\n\t----------------------------------------------------\n\thttps://github.com/mudcube/eventjs.js\n\t----------------------------------------------------\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\nif (typeof(eventjs.proxy) === \"undefined\") eventjs.proxy = {};\n\neventjs.proxy = (function(root) { \"use strict\";\n\n/*\n\tCreate a new pointer gesture instance.\n*/\n\nroot.pointerSetup = function(conf, self) {\n\t/// Configure.\n\tconf.target = conf.target || window;\n\tconf.doc = conf.target.ownerDocument || conf.target; // Associated document.\n\tconf.minFingers = conf.minFingers || conf.fingers || 1; // Minimum required fingers.\n\tconf.maxFingers = conf.maxFingers || conf.fingers || Infinity; // Maximum allowed fingers.\n\tconf.position = conf.position || \"relative\"; // Determines what coordinate system points are returned.\n\tdelete conf.fingers; //-\n\t/// Convenience data.\n\tself = self || {};\n\tself.enabled = true;\n\tself.gesture = conf.gesture;\n\tself.target = conf.target;\n\tself.env = conf.env;\n\t///\n\tif (eventjs.modifyEventListener && conf.fromOverwrite) {\n\t\tconf.oldListener = conf.listener;\n\t\tconf.listener = eventjs.createPointerEvent;\n\t}\n\t/// Convenience commands.\n\tvar fingers = 0;\n\tvar type = self.gesture.indexOf(\"pointer\") === 0 && eventjs.modifyEventListener ? \"pointer\" : \"mouse\";\n\tif (conf.oldListener) self.oldListener = conf.oldListener;\n\t///\n\tself.listener = conf.listener;\n\tself.proxy = function(listener) {\n\t\tself.defaultListener = conf.listener;\n\t\tconf.listener = listener;\n\t\tlistener(conf.event, self);\n\t};\n\tself.add = function() {\n\t\tif (self.enabled === true) return;\n\t\tif (conf.onPointerDown) eventjs.add(conf.target, type + \"down\", conf.onPointerDown);\n\t\tif (conf.onPointerMove) eventjs.add(conf.doc, type + \"move\", conf.onPointerMove);\n\t\tif (conf.onPointerUp) eventjs.add(conf.doc, type + \"up\", conf.onPointerUp);\n\t\tself.enabled = true;\n\t};\n\tself.remove = function() {\n\t\tif (self.enabled === false) return;\n\t\tif (conf.onPointerDown) eventjs.remove(conf.target, type + \"down\", conf.onPointerDown);\n\t\tif (conf.onPointerMove) eventjs.remove(conf.doc, type + \"move\", conf.onPointerMove);\n\t\tif (conf.onPointerUp) eventjs.remove(conf.doc, type + \"up\", conf.onPointerUp);\n\t\tself.reset();\n\t\tself.enabled = false;\n\t};\n\tself.pause = function(opt) {\n\t\tif (conf.onPointerMove && (!opt || opt.move)) eventjs.remove(conf.doc, type + \"move\", conf.onPointerMove);\n\t\tif (conf.onPointerUp && (!opt || opt.up)) eventjs.remove(conf.doc, type + \"up\", conf.onPointerUp);\n\t\tfingers = conf.fingers;\n\t\tconf.fingers = 0;\n\t};\n\tself.resume = function(opt) {\n\t\tif (conf.onPointerMove && (!opt || opt.move)) eventjs.add(conf.doc, type + \"move\", conf.onPointerMove);\n\t\tif (conf.onPointerUp && (!opt || opt.up)) eventjs.add(conf.doc, type + \"up\", conf.onPointerUp);\n\t\tconf.fingers = fingers;\n\t};\n\tself.reset = function() {\n\t\tconf.tracker = {};\n\t\tconf.fingers = 0;\n\t};\n\t///\n\treturn self;\n};\n\n/*\n\tBegin proxied pointer command.\n*/\n\nvar sp = eventjs.supports; // Default pointerType\n///\neventjs.isMouse = !!sp.mouse;\neventjs.isMSPointer = !!sp.touch;\neventjs.isTouch = !!sp.msPointer;\n///\nroot.pointerStart = function(event, self, conf) {\n\t/// tracks multiple inputs\n\tvar type = (event.type || \"mousedown\").toUpperCase();\n\tif (type.indexOf(\"MOUSE\") === 0) {\n\t\teventjs.isMouse = true;\n\t\teventjs.isTouch = false;\n\t\teventjs.isMSPointer = false;\n\t} else if (type.indexOf(\"TOUCH\") === 0) {\n\t\teventjs.isMouse = false;\n\t\teventjs.isTouch = true;\n\t\teventjs.isMSPointer = false;\n\t} else if (type.indexOf(\"MSPOINTER\") === 0) {\n\t\teventjs.isMouse = false;\n\t\teventjs.isTouch = false;\n\t\teventjs.isMSPointer = true;\n\t}\n\t///\n\tvar addTouchStart = function(touch, sid) {\n\t\tvar bbox = conf.bbox;\n\t\tvar pt = track[sid] = {};\n\t\t///\n\t\tswitch(conf.position) {\n\t\t\tcase \"absolute\": // Absolute from within window.\n\t\t\t\tpt.offsetX = 0;\n\t\t\t\tpt.offsetY = 0;\n\t\t\t\tbreak;\n\t\t\tcase \"differenceFromLast\": // Since last coordinate recorded.\n\t\t\t\tpt.offsetX = touch.pageX;\n\t\t\t\tpt.offsetY = touch.pageY;\n\t\t\t\tbreak;\n\t\t\tcase \"difference\": // Relative from origin.\n\t\t\t\tpt.offsetX = touch.pageX;\n\t\t\t\tpt.offsetY = touch.pageY;\n\t\t\t\tbreak;\n\t\t\tcase \"move\": // Move target element.\n\t\t\t\tpt.offsetX = touch.pageX - bbox.x1;\n\t\t\t\tpt.offsetY = touch.pageY - bbox.y1;\n\t\t\t\tbreak;\n\t\t\tdefault: // Relative from within target.\n\t\t\t\tpt.offsetX = bbox.x1 - bbox.scrollLeft;\n\t\t\t\tpt.offsetY = bbox.y1 - bbox.scrollTop;\n\t\t\t\tbreak;\n\t\t}\n\t\t///\n\t\tvar x = touch.pageX - pt.offsetX;\n\t\tvar y = touch.pageY - pt.offsetY;\n\t\t///\n\t\tpt.rotation = 0;\n\t\tpt.scale = 1;\n\t\tpt.startTime = pt.moveTime = (new Date()).getTime();\n\t\tpt.move = { x: x, y: y };\n\t\tpt.start = { x: x, y: y };\n\t\t///\n\t\tconf.fingers ++;\n\t};\n\t///\n\tconf.event = event;\n\tif (self.defaultListener) {\n\t\tconf.listener = self.defaultListener;\n\t\tdelete self.defaultListener;\n\t}\n\t///\n\tvar isTouchStart = !conf.fingers;\n\tvar track = conf.tracker;\n\tvar touches = event.changedTouches || root.getCoords(event);\n\tvar length = touches.length;\n\t// Adding touch events to tracking.\n\tfor (var i = 0; i < length; i ++) {\n\t\tvar touch = touches[i];\n\t\tvar sid = touch.identifier || Infinity; // Touch ID.\n\t\t// Track the current state of the touches.\n\t\tif (conf.fingers) {\n\t\t\tif (conf.fingers >= conf.maxFingers) {\n\t\t\t\tvar ids = [];\n\t\t\t\tfor (var sid in conf.tracker) ids.push(sid);\n\t\t\t\tself.identifier = ids.join(\",\");\n\t\t\t\treturn isTouchStart;\n\t\t\t}\n\t\t\tvar fingers = 0; // Finger ID.\n\t\t\tfor (var rid in track) {\n\t\t\t\t// Replace removed finger.\n\t\t\t\tif (track[rid].up) {\n\t\t\t\t\tdelete track[rid];\n\t\t\t\t\taddTouchStart(touch, sid);\n\t\t\t\t\tconf.cancel = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tfingers ++;\n\t\t\t}\n\t\t\t// Add additional finger.\n\t\t\tif (track[sid]) continue;\n\t\t\taddTouchStart(touch, sid);\n\t\t} else { // Start tracking fingers.\n\t\t\ttrack = conf.tracker = {};\n\t\t\tself.bbox = conf.bbox = root.getBoundingBox(conf.target);\n\t\t\tconf.fingers = 0;\n\t\t\tconf.cancel = false;\n\t\t\taddTouchStart(touch, sid);\n\t\t}\n\t}\n\t///\n\tvar ids = [];\n\tfor (var sid in conf.tracker) ids.push(sid);\n\tself.identifier = ids.join(\",\");\n\t///\n\treturn isTouchStart;\n};\n\n/*\n\tEnd proxied pointer command.\n*/\n\nroot.pointerEnd = function(event, self, conf, onPointerUp) {\n\t// Record changed touches have ended (iOS changedTouches is not reliable).\n\tvar touches = event.touches || [];\n\tvar length = touches.length;\n\tvar exists = {};\n\tfor (var i = 0; i < length; i ++) {\n\t\tvar touch = touches[i];\n\t\tvar sid = touch.identifier;\n\t\texists[sid || Infinity] = true;\n\t}\n\tfor (var sid in conf.tracker) {\n\t\tvar track = conf.tracker[sid];\n\t\tif (exists[sid] || track.up) continue;\n\t\tif (onPointerUp) { // add changedTouches to mouse.\n\t\t\tonPointerUp({\n\t\t\t\tpageX: track.pageX,\n\t\t\t\tpageY: track.pageY,\n\t\t\t\tchangedTouches: [{\n\t\t\t\t\tpageX: track.pageX,\n\t\t\t\t\tpageY: track.pageY,\n\t\t\t\t\tidentifier: sid === \"Infinity\" ? Infinity : sid\n\t\t\t\t}]\n\t\t\t}, \"up\");\n\t\t}\n\t\ttrack.up = true;\n\t\tconf.fingers --;\n\t}\n/*\t// This should work but fails in Safari on iOS4 so not using it.\n\tvar touches = event.changedTouches || root.getCoords(event);\n\tvar length = touches.length;\n\t// Record changed touches have ended (this should work).\n\tfor (var i = 0; i < length; i ++) {\n\t\tvar touch = touches[i];\n\t\tvar sid = touch.identifier || Infinity;\n\t\tvar track = conf.tracker[sid];\n\t\tif (track && !track.up) {\n\t\t\tif (onPointerUp) { // add changedTouches to mouse.\n\t\t\t\tonPointerUp({\n\t\t\t\t\tchangedTouches: [{\n\t\t\t\t\t\tpageX: track.pageX,\n\t\t\t\t\t\tpageY: track.pageY,\n\t\t\t\t\t\tidentifier: sid === \"Infinity\" ? Infinity : sid\n\t\t\t\t\t}]\n\t\t\t\t}, \"up\");\n\t\t\t}\n\t\t\ttrack.up = true;\n\t\t\tconf.fingers --;\n\t\t}\n\t} */\n\t// Wait for all fingers to be released.\n\tif (conf.fingers !== 0) return false;\n\t// Record total number of fingers gesture used.\n\tvar ids = [];\n\tconf.gestureFingers = 0;\n\tfor (var sid in conf.tracker) {\n\t\tconf.gestureFingers ++;\n\t\tids.push(sid);\n\t}\n\tself.identifier = ids.join(\",\");\n\t// Our pointer gesture has ended.\n\treturn true;\n};\n\n/*\n\tReturns mouse coords in an array to match event.*Touches\n\t------------------------------------------------------------\n\tvar touch = event.changedTouches || root.getCoords(event);\n*/\n\nroot.getCoords = function(event) {\n\tif (typeof(event.pageX) !== \"undefined\") { // Desktop browsers.\n\t\troot.getCoords = function(event) {\n\t\t\treturn Array({\n\t\t\t\ttype: \"mouse\",\n\t\t\t\tx: event.pageX,\n\t\t\t\ty: event.pageY,\n\t\t\t\tpageX: event.pageX,\n\t\t\t\tpageY: event.pageY,\n\t\t\t\tidentifier: event.pointerId || Infinity // pointerId is MS\n\t\t\t});\n\t\t};\n\t} else { // Internet Explorer <= 8.0\n\t\troot.getCoords = function(event) {\n\t\t\tvar doc = document.documentElement;\n\t\t\tevent = event || window.event;\n\t\t\treturn Array({\n\t\t\t\ttype: \"mouse\",\n\t\t\t\tx: event.clientX + doc.scrollLeft,\n\t\t\t\ty: event.clientY + doc.scrollTop,\n\t\t\t\tpageX: event.clientX + doc.scrollLeft,\n\t\t\t\tpageY: event.clientY + doc.scrollTop,\n\t\t\t\tidentifier: Infinity\n\t\t\t});\n\t\t};\n\t}\n\treturn root.getCoords(event);\n};\n\n/*\n\tReturns single coords in an object.\n\t------------------------------------------------------------\n\tvar mouse = root.getCoord(event);\n*/\n\nroot.getCoord = function(event) {\n\tif (\"ontouchstart\" in window) { // Mobile browsers.\n\t\tvar pX = 0;\n\t\tvar pY = 0;\n\t\troot.getCoord = function(event) {\n\t\t\tvar touches = event.changedTouches;\n\t\t\tif (touches && touches.length) { // ontouchstart + ontouchmove\n\t\t\t\treturn {\n\t\t\t\t\tx: pX = touches[0].pageX,\n\t\t\t\t\ty: pY = touches[0].pageY\n\t\t\t\t};\n\t\t\t} else { // ontouchend\n\t\t\t\treturn {\n\t\t\t\t\tx: pX,\n\t\t\t\t\ty: pY\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t} else if(typeof(event.pageX) !== \"undefined\" && typeof(event.pageY) !== \"undefined\") { // Desktop browsers.\n\t\troot.getCoord = function(event) {\n\t\t\treturn {\n\t\t\t\tx: event.pageX,\n\t\t\t\ty: event.pageY\n\t\t\t};\n\t\t};\n\t} else { // Internet Explorer <=8.0\n\t\troot.getCoord = function(event) {\n\t\t\tvar doc = document.documentElement;\n\t\t\tevent = event || window.event;\n\t\t\treturn {\n\t\t\t\tx: event.clientX + doc.scrollLeft,\n\t\t\t\ty: event.clientY + doc.scrollTop\n\t\t\t};\n\t\t};\n\t}\n\treturn root.getCoord(event);\n};\n\n/*\n\tGet target scale and position in space.\n*/\n\nvar getPropertyAsFloat = function(o, type) {\n\tvar n = parseFloat(o.getPropertyValue(type), 10);\n\treturn isFinite(n) ? n : 0;\n};\n\nroot.getBoundingBox = function(o) {\n\tif (o === window || o === document) o = document.body;\n\t///\n\tvar bbox = {};\n\tvar bcr = o.getBoundingClientRect();\n\tbbox.width = bcr.width;\n\tbbox.height = bcr.height;\n\tbbox.x1 = bcr.left;\n\tbbox.y1 = bcr.top;\n\tbbox.scaleX = bcr.width / o.offsetWidth || 1;\n\tbbox.scaleY = bcr.height / o.offsetHeight || 1;\n\tbbox.scrollLeft = 0;\n\tbbox.scrollTop = 0;\n\t///\n\tvar style = window.getComputedStyle(o);\n\tvar borderBox = style.getPropertyValue(\"box-sizing\") === \"border-box\";\n\t///\n\tif (borderBox === false) {\n\t\tvar left = getPropertyAsFloat(style, \"border-left-width\");\n\t\tvar right = getPropertyAsFloat(style, \"border-right-width\");\n\t\tvar bottom = getPropertyAsFloat(style, \"border-bottom-width\");\n\t\tvar top = getPropertyAsFloat(style, \"border-top-width\");\n\t\tbbox.border = [ left, right, top, bottom ];\n\t\tbbox.x1 += left;\n\t\tbbox.y1 += top;\n\t\tbbox.width -= right + left;\n\t\tbbox.height -= bottom + top;\n\t}\n\n/*\tvar left = getPropertyAsFloat(style, \"padding-left\");\n\tvar right = getPropertyAsFloat(style, \"padding-right\");\n\tvar bottom = getPropertyAsFloat(style, \"padding-bottom\");\n\tvar top = getPropertyAsFloat(style, \"padding-top\");\n\tbbox.padding = [ left, right, top, bottom ];*/\n\t///\n\tbbox.x2 = bbox.x1 + bbox.width;\n\tbbox.y2 = bbox.y1 + bbox.height;\n\n\t/// Get the scroll of container element.\n\tvar position = style.getPropertyValue(\"position\");\n\tvar tmp = position === \"fixed\" ? o : o.parentNode;\n\twhile (tmp !== null) {\n\t\tif (tmp === document.body) break;\n\t\tif (tmp.scrollTop === undefined) break;\n\t\tvar style = window.getComputedStyle(tmp);\n\t\tvar position = style.getPropertyValue(\"position\");\n\t\tif (position === \"absolute\") {\n\n\t\t} else if (position === \"fixed\") {\n//\t\t\tbbox.scrollTop += document.body.scrollTop;\n//\t\t\tbbox.scrollLeft += document.body.scrollLeft;\n\t\t\tbbox.scrollTop -= tmp.parentNode.scrollTop;\n\t\t\tbbox.scrollLeft -= tmp.parentNode.scrollLeft;\n\t\t\tbreak;\n\t\t} else {\n\t\t\tbbox.scrollLeft += tmp.scrollLeft;\n\t\t\tbbox.scrollTop += tmp.scrollTop;\n\t\t}\n\t\t///\n\t\ttmp = tmp.parentNode;\n\t};\n\t///\n\tbbox.scrollBodyLeft = (window.pageXOffset !== undefined) ? window.pageXOffset : (document.documentElement || document.body.parentNode || document.body).scrollLeft;\n\tbbox.scrollBodyTop = (window.pageYOffset !== undefined) ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;\n\t///\n\tbbox.scrollLeft -= bbox.scrollBodyLeft;\n\tbbox.scrollTop -= bbox.scrollBodyTop;\n\t///\n\treturn bbox;\n};\n\n/*\n\tKeep track of metaKey, the proper ctrlKey for users platform.\n\t----------------------------------------------------\n\thttp://www.quirksmode.org/js/keys.html\n\t-----------------------------------\n\thttp://unixpapa.com/js/key.html\n*/\n\n(function() {\n\tvar agent = navigator.userAgent.toLowerCase();\n\tvar mac = agent.indexOf(\"macintosh\") !== -1;\n\tvar metaKeys;\n\tif (mac && agent.indexOf(\"khtml\") !== -1) { // chrome, safari.\n\t\tmetaKeys = { 91: true, 93: true };\n\t} else if (mac && agent.indexOf(\"firefox\") !== -1) {  // mac firefox.\n\t\tmetaKeys = { 224: true };\n\t} else { // windows, linux, or mac opera.\n\t\tmetaKeys = { 17: true };\n\t}\n\t(root.metaTrackerReset = function() {\n\t\teventjs.fnKey = root.fnKey = false;\n\t\teventjs.metaKey = root.metaKey = false;\n\t\teventjs.escKey = root.escKey = false;\n\t\teventjs.ctrlKey = root.ctrlKey = false;\n\t\teventjs.shiftKey = root.shiftKey = false;\n\t\teventjs.altKey = root.altKey = false;\n\t})();\n\troot.metaTracker = function(event) {\n\t\tvar isKeyDown = event.type === \"keydown\";\n\t\tif (event.keyCode === 27) eventjs.escKey = root.escKey = isKeyDown;\n\t\tif (metaKeys[event.keyCode]) eventjs.metaKey = root.metaKey = isKeyDown;\n\t\teventjs.ctrlKey = root.ctrlKey = event.ctrlKey;\n\t\teventjs.shiftKey = root.shiftKey = event.shiftKey;\n\t\teventjs.altKey = root.altKey = event.altKey;\n\t};\n})();\n\nreturn root;\n\n})(eventjs.proxy);\n/*:\n\t----------------------------------------------------\n\t\"MutationObserver\" event proxy.\n\t----------------------------------------------------\n\tauthor: Selvakumar Arumugam - MIT LICENSE\n\t   src: http://stackoverflow.com/questions/10868104/can-you-have-a-javascript-hook-trigger-after-a-dom-elements-style-object-change\n\t----------------------------------------------------\n*/\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\n\neventjs.MutationObserver = (function() {\n\tvar MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;\n\tvar DOMAttrModifiedSupported = !MutationObserver && (function() {\n\t\tvar p = document.createElement(\"p\");\n\t\tvar flag = false;\n\t\tvar fn = function() { flag = true };\n\t\tif (p.addEventListener) {\n\t\t\tp.addEventListener(\"DOMAttrModified\", fn, false);\n\t\t} else if (p.attachEvent) {\n\t\t\tp.attachEvent(\"onDOMAttrModified\", fn);\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\t///\n\t\tp.setAttribute(\"id\", \"target\");\n\t\t///\n\t\treturn flag;\n\t})();\n\t///\n\treturn function(container, callback) {\n\t\tif (MutationObserver) {\n\t\t\tvar options = {\n\t\t\t\tsubtree: false,\n\t\t\t\tattributes: true\n\t\t\t};\n\t\t\tvar observer = new MutationObserver(function(mutations) {\n\t\t\t\tmutations.forEach(function(e) {\n\t\t\t\t\tcallback.call(e.target, e.attributeName);\n\t\t\t\t});\n\t\t\t});\n\t\t\tobserver.observe(container, options)\n\t\t} else if (DOMAttrModifiedSupported) {\n\t\t\teventjs.add(container, \"DOMAttrModified\", function(e) {\n\t\t\t\tcallback.call(container, e.attrName);\n\t\t\t});\n\t\t} else if (\"onpropertychange\" in document.body) {\n\t\t\teventjs.add(container, \"propertychange\", function(e) {\n\t\t\t\tcallback.call(container, window.event.propertyName);\n\t\t\t});\n\t\t}\n\t}\n})();\n/*:\n\t\"Click\" event proxy.\n\t----------------------------------------------------\n\teventjs.add(window, \"click\", function(event, self) {});\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\nif (typeof(eventjs.proxy) === \"undefined\") eventjs.proxy = {};\n\neventjs.proxy = (function(root) { \"use strict\";\n\nroot.click = function(conf) {\n\tconf.gesture = conf.gesture || \"click\";\n\tconf.maxFingers = conf.maxFingers || conf.fingers || 1;\n\t/// Tracking the events.\n\tconf.onPointerDown = function (event) {\n\t\tif (root.pointerStart(event, self, conf)) {\n\t\t\teventjs.add(conf.target, \"mouseup\", conf.onPointerUp);\n\t\t}\n\t};\n\tconf.onPointerUp = function(event) {\n\t\tif (root.pointerEnd(event, self, conf)) {\n\t\t\teventjs.remove(conf.target, \"mouseup\", conf.onPointerUp);\n\t\t\tvar pointers = event.changedTouches || root.getCoords(event);\n\t\t\tvar pointer = pointers[0];\n\t\t\tvar bbox = conf.bbox;\n\t\t\tvar newbbox = root.getBoundingBox(conf.target);\n\t\t\tvar y = pointer.pageY - newbbox.scrollBodyTop;\n\t\t\tvar x = pointer.pageX - newbbox.scrollBodyLeft;\n\t\t\t////\n\t\t\tif (x > bbox.x1 && y > bbox.y1 &&\n\t\t\t\tx < bbox.x2 && y < bbox.y2 &&\n\t\t\t\tbbox.scrollTop === newbbox.scrollTop) { // has not been scrolled\n\t\t\t\t///\n\t\t\t\tfor (var key in conf.tracker) break; //- should be modularized? in dblclick too\n\t\t\t\tvar point = conf.tracker[key];\n\t\t\t\tself.x = point.start.x;\n\t\t\t\tself.y = point.start.y;\n\t\t\t\t///\n\t\t\t\tconf.listener(event, self);\n\t\t\t}\n\t\t}\n\t};\n\t// Generate maintenance commands, and other configurations.\n\tvar self = root.pointerSetup(conf);\n\tself.state = \"click\";\n\t// Attach events.\n\teventjs.add(conf.target, \"mousedown\", conf.onPointerDown);\n\t// Return this object.\n\treturn self;\n};\n\neventjs.Gesture = eventjs.Gesture || {};\neventjs.Gesture._gestureHandlers = eventjs.Gesture._gestureHandlers || {};\neventjs.Gesture._gestureHandlers.click = root.click;\n\nreturn root;\n\n})(eventjs.proxy);\n/*:\n\t\"Double-Click\" aka \"Double-Tap\" event proxy.\n\t----------------------------------------------------\n\teventjs.add(window, \"dblclick\", function(event, self) {});\n\t----------------------------------------------------\n\tTouch an target twice for <= 700ms, with less than 25 pixel drift.\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\nif (typeof(eventjs.proxy) === \"undefined\") eventjs.proxy = {};\n\neventjs.proxy = (function(root) { \"use strict\";\n\nroot.dbltap =\nroot.dblclick = function(conf) {\n\tconf.gesture = conf.gesture || \"dbltap\";\n\tconf.maxFingers = conf.maxFingers || conf.fingers || 1;\n\t// Setting up local variables.\n\tvar delay = 700; // in milliseconds\n\tvar time0, time1, timeout;\n\tvar pointer0, pointer1;\n\t// Tracking the events.\n\tconf.onPointerDown = function (event) {\n\t\tvar pointers = event.changedTouches || root.getCoords(event);\n\t\tif (time0 && !time1) { // Click #2\n\t\t\tpointer1 = pointers[0];\n\t\t\ttime1 = (new Date()).getTime() - time0;\n\t\t} else { // Click #1\n\t\t\tpointer0 = pointers[0];\n\t\t\ttime0 = (new Date()).getTime();\n\t\t\ttime1 = 0;\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = setTimeout(function() {\n\t\t\t\ttime0 = 0;\n\t\t\t}, delay);\n\t\t}\n\t\tif (root.pointerStart(event, self, conf)) {\n\t\t\teventjs.add(conf.target, \"mousemove\", conf.onPointerMove).listener(event);\n\t\t\teventjs.add(conf.target, \"mouseup\", conf.onPointerUp);\n\t\t}\n\t};\n\tconf.onPointerMove = function (event) {\n\t\tif (time0 && !time1) {\n\t\t\tvar pointers = event.changedTouches || root.getCoords(event);\n\t\t\tpointer1 = pointers[0];\n\t\t}\n\t\tvar bbox = conf.bbox;\n\t\tvar ax = (pointer1.pageX - bbox.x1);\n\t\tvar ay = (pointer1.pageY - bbox.y1);\n\t\tif (!(ax > 0 && ax < bbox.width && // Within target coordinates..\n\t\t\t  ay > 0 && ay < bbox.height &&\n\t\t\t  Math.abs(pointer1.pageX - pointer0.pageX) <= 25 && // Within drift deviance.\n\t\t\t  Math.abs(pointer1.pageY - pointer0.pageY) <= 25)) {\n\t\t\t// Cancel out this listener.\n\t\t\teventjs.remove(conf.target, \"mousemove\", conf.onPointerMove);\n\t\t\tclearTimeout(timeout);\n\t\t\ttime0 = time1 = 0;\n\t\t}\n\t};\n\tconf.onPointerUp = function(event) {\n\t\tif (root.pointerEnd(event, self, conf)) {\n\t\t\teventjs.remove(conf.target, \"mousemove\", conf.onPointerMove);\n\t\t\teventjs.remove(conf.target, \"mouseup\", conf.onPointerUp);\n\t\t}\n\t\tif (time0 && time1) {\n\t\t\tif (time1 <= delay) { // && !(event.cancelBubble && ++event.cancelBubbleCount > 1)) {\n\t\t\t\tself.state = conf.gesture;\n\t\t\t\tfor (var key in conf.tracker) break;\n\t\t\t\tvar point = conf.tracker[key];\n\t\t\t\tself.x = point.start.x;\n\t\t\t\tself.y = point.start.y;\n\t\t\t\tconf.listener(event, self);\n\t\t\t}\n\t\t\tclearTimeout(timeout);\n\t\t\ttime0 = time1 = 0;\n\t\t}\n\t};\n\t// Generate maintenance commands, and other configurations.\n\tvar self = root.pointerSetup(conf);\n\tself.state = \"dblclick\";\n\t// Attach events.\n\teventjs.add(conf.target, \"mousedown\", conf.onPointerDown);\n\t// Return this object.\n\treturn self;\n};\n\neventjs.Gesture = eventjs.Gesture || {};\neventjs.Gesture._gestureHandlers = eventjs.Gesture._gestureHandlers || {};\neventjs.Gesture._gestureHandlers.dbltap = root.dbltap;\neventjs.Gesture._gestureHandlers.dblclick = root.dblclick;\n\nreturn root;\n\n})(eventjs.proxy);\n/*:\n\t\"Drag\" event proxy (1+ fingers).\n\t----------------------------------------------------\n\tCONFIGURE: maxFingers, position.\n\t----------------------------------------------------\n\teventjs.add(window, \"drag\", function(event, self) {\n\t\tconsole.log(self.gesture, self.state, self.start, self.x, self.y, self.bbox);\n\t});\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\nif (typeof(eventjs.proxy) === \"undefined\") eventjs.proxy = {};\n\neventjs.proxy = (function(root) { \"use strict\";\n\nroot.dragElement = function(that, event) {\n\troot.drag({\n\t\tevent: event,\n\t\ttarget: that,\n\t\tposition: \"move\",\n\t\tlistener: function(event, self) {\n\t\t\tthat.style.left = self.x + \"px\";\n\t\t\tthat.style.top = self.y + \"px\";\n\t\t\teventjs.prevent(event);\n\t\t}\n\t});\n};\n\nroot.drag = function(conf) {\n\tconf.gesture = \"drag\";\n\tconf.onPointerDown = function (event) {\n\t\tif (root.pointerStart(event, self, conf)) {\n\t\t\tif (!conf.monitor) {\n\t\t\t\teventjs.add(conf.doc, \"mousemove\", conf.onPointerMove);\n\t\t\t\teventjs.add(conf.doc, \"mouseup\", conf.onPointerUp);\n\t\t\t}\n\t\t}\n\t\t// Process event listener.\n\t\tconf.onPointerMove(event, \"down\");\n\t};\n\tconf.onPointerMove = function (event, state) {\n\t\tif (!conf.tracker) return conf.onPointerDown(event);\n\t\tvar bbox = conf.bbox;\n\t\tvar touches = event.changedTouches || root.getCoords(event);\n\t\tvar length = touches.length;\n\t\tfor (var i = 0; i < length; i ++) {\n\t\t\tvar touch = touches[i];\n\t\t\tvar identifier = touch.identifier || Infinity;\n\t\t\tvar pt = conf.tracker[identifier];\n\t\t\t// Identifier defined outside of listener.\n\t\t\tif (!pt) continue;\n\t\t\tpt.pageX = touch.pageX;\n\t\t\tpt.pageY = touch.pageY;\n\t\t\t// Record data.\n\t\t\tself.state = state || \"move\";\n\t\t\tself.identifier = identifier;\n\t\t\tself.start = pt.start;\n\t\t\tself.fingers = conf.fingers;\n\t\t\tif (conf.position === \"differenceFromLast\") {\n\t\t\t\tself.x = (pt.pageX - pt.offsetX);\n\t\t\t\tself.y = (pt.pageY - pt.offsetY);\n\t\t\t\tpt.offsetX = pt.pageX;\n\t\t\t\tpt.offsetY = pt.pageY;\n\t\t\t} else {\n\t\t\t\tself.x = (pt.pageX - pt.offsetX);\n\t\t\t\tself.y = (pt.pageY - pt.offsetY);\n\t\t\t}\n\t\t\t///\n\t\t\tconf.listener(event, self);\n\t\t}\n\t};\n\tconf.onPointerUp = function(event) {\n\t\t// Remove tracking for touch.\n\t\tif (root.pointerEnd(event, self, conf, conf.onPointerMove)) {\n\t\t\tif (!conf.monitor) {\n\t\t\t\teventjs.remove(conf.doc, \"mousemove\", conf.onPointerMove);\n\t\t\t\teventjs.remove(conf.doc, \"mouseup\", conf.onPointerUp);\n\t\t\t}\n\t\t}\n\t};\n\t// Generate maintenance commands, and other configurations.\n\tvar self = root.pointerSetup(conf);\n\t// Attach events.\n\tif (conf.event) {\n\t\tconf.onPointerDown(conf.event);\n\t} else { //\n\t\teventjs.add(conf.target, \"mousedown\", conf.onPointerDown);\n\t\tif (conf.monitor) {\n\t\t\teventjs.add(conf.doc, \"mousemove\", conf.onPointerMove);\n\t\t\teventjs.add(conf.doc, \"mouseup\", conf.onPointerUp);\n\t\t}\n\t}\n\t// Return this object.\n\treturn self;\n};\n\neventjs.Gesture = eventjs.Gesture || {};\neventjs.Gesture._gestureHandlers = eventjs.Gesture._gestureHandlers || {};\neventjs.Gesture._gestureHandlers.drag = root.drag;\n\nreturn root;\n\n})(eventjs.proxy);\n/*:\n\t\"Gesture\" event proxy (2+ fingers).\n\t----------------------------------------------------\n\tCONFIGURE: minFingers, maxFingers.\n\t----------------------------------------------------\n\teventjs.add(window, \"gesture\", function(event, self) {\n\t\tconsole.log(\n\t\t\tself.x, // centroid\n\t\t\tself.y,\n\t\t\tself.rotation,\n\t\t\tself.scale,\n\t\t\tself.fingers,\n\t\t\tself.state\n\t\t);\n\t});\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\nif (typeof(eventjs.proxy) === \"undefined\") eventjs.proxy = {};\n\neventjs.proxy = (function(root) { \"use strict\";\n\nvar RAD_DEG = Math.PI / 180;\nvar getCentroid = function(self, points) {\n\tvar centroidx = 0;\n\tvar centroidy = 0;\n\tvar length = 0;\n\tfor (var sid in points) {\n\t\tvar touch = points[sid];\n\t\tif (touch.up) continue;\n\t\tcentroidx += touch.move.x;\n\t\tcentroidy += touch.move.y;\n\t\tlength ++;\n\t}\n\tself.x = centroidx /= length;\n\tself.y = centroidy /= length;\n\treturn self;\n};\n\nroot.gesture = function(conf) {\n\tconf.gesture = conf.gesture || \"gesture\";\n\tconf.minFingers = conf.minFingers || conf.fingers || 2;\n\t// Tracking the events.\n\tconf.onPointerDown = function (event) {\n\t\tvar fingers = conf.fingers;\n\t\tif (root.pointerStart(event, self, conf)) {\n\t\t\teventjs.add(conf.doc, \"mousemove\", conf.onPointerMove);\n\t\t\teventjs.add(conf.doc, \"mouseup\", conf.onPointerUp);\n\t\t}\n\t\t// Record gesture start.\n\t\tif (conf.fingers === conf.minFingers && fingers !== conf.fingers) {\n\t\t\tself.fingers = conf.minFingers;\n\t\t\tself.scale = 1;\n\t\t\tself.rotation = 0;\n\t\t\tself.state = \"start\";\n\t\t\tvar sids = \"\"; //- FIXME(mud): can generate duplicate IDs.\n\t\t\tfor (var key in conf.tracker) sids += key;\n\t\t\tself.identifier = parseInt(sids);\n\t\t\tgetCentroid(self, conf.tracker);\n\t\t\tconf.listener(event, self);\n\t\t}\n\t};\n\t///\n\tconf.onPointerMove = function (event, state) {\n\t\tvar bbox = conf.bbox;\n\t\tvar points = conf.tracker;\n\t\tvar touches = event.changedTouches || root.getCoords(event);\n\t\tvar length = touches.length;\n\t\t// Update tracker coordinates.\n\t\tfor (var i = 0; i < length; i ++) {\n\t\t\tvar touch = touches[i];\n\t\t\tvar sid = touch.identifier || Infinity;\n\t\t\tvar pt = points[sid];\n\t\t\t// Check whether \"pt\" is used by another gesture.\n\t\t\tif (!pt) continue;\n\t\t\t// Find the actual coordinates.\n\t\t\tpt.move.x = (touch.pageX - bbox.x1);\n\t\t\tpt.move.y = (touch.pageY - bbox.y1);\n\t\t}\n\t\t///\n\t\tif (conf.fingers < conf.minFingers) return;\n\t\t///\n\t\tvar touches = [];\n\t\tvar scale = 0;\n\t\tvar rotation = 0;\n\n\t\t/// Calculate centroid of gesture.\n\t\tgetCentroid(self, points);\n\t\t///\n\t\tfor (var sid in points) {\n\t\t\tvar touch = points[sid];\n\t\t\tif (touch.up) continue;\n\t\t\tvar start = touch.start;\n\t\t\tif (!start.distance) {\n\t\t\t\tvar dx = start.x - self.x;\n\t\t\t\tvar dy = start.y - self.y;\n\t\t\t\tstart.distance = Math.sqrt(dx * dx + dy * dy);\n\t\t\t\tstart.angle = Math.atan2(dx, dy) / RAD_DEG;\n\t\t\t}\n\t\t\t// Calculate scale.\n\t\t\tvar dx = touch.move.x - self.x;\n\t\t\tvar dy = touch.move.y - self.y;\n\t\t\tvar distance = Math.sqrt(dx * dx + dy * dy);\n\t\t\tscale += distance / start.distance;\n\t\t\t// Calculate rotation.\n\t\t\tvar angle = Math.atan2(dx, dy) / RAD_DEG;\n\t\t\tvar rotate = (start.angle - angle + 360) % 360 - 180;\n\t\t\ttouch.DEG2 = touch.DEG1; // Previous degree.\n\t\t\ttouch.DEG1 = rotate > 0 ? rotate : -rotate; // Current degree.\n\t\t\tif (typeof(touch.DEG2) !== \"undefined\") {\n\t\t\t\tif (rotate > 0) {\n\t\t\t\t\ttouch.rotation += touch.DEG1 - touch.DEG2;\n\t\t\t\t} else {\n\t\t\t\t\ttouch.rotation -= touch.DEG1 - touch.DEG2;\n\t\t\t\t}\n\t\t\t\trotation += touch.rotation;\n\t\t\t}\n\t\t\t// Attach current points to self.\n\t\t\ttouches.push(touch.move);\n\t\t}\n\t\t///\n\t\tself.touches = touches;\n\t\tself.fingers = conf.fingers;\n\t\tself.scale = scale / conf.fingers;\n\t\tself.rotation = rotation / conf.fingers;\n\t\tself.state = \"change\";\n\t\tconf.listener(event, self);\n\t};\n\tconf.onPointerUp = function(event) {\n\t\t// Remove tracking for touch.\n\t\tvar fingers = conf.fingers;\n\t\tif (root.pointerEnd(event, self, conf)) {\n\t\t\teventjs.remove(conf.doc, \"mousemove\", conf.onPointerMove);\n\t\t\teventjs.remove(conf.doc, \"mouseup\", conf.onPointerUp);\n\t\t}\n\t\t// Check whether fingers has dropped below minFingers.\n\t\tif (fingers === conf.minFingers && conf.fingers < conf.minFingers) {\n\t\t\tself.fingers = conf.fingers;\n\t\t\tself.state = \"end\";\n\t\t\tconf.listener(event, self);\n\t\t}\n\t};\n\t// Generate maintenance commands, and other configurations.\n\tvar self = root.pointerSetup(conf);\n\t// Attach events.\n\teventjs.add(conf.target, \"mousedown\", conf.onPointerDown);\n\t// Return this object.\n\treturn self;\n};\n\neventjs.Gesture = eventjs.Gesture || {};\neventjs.Gesture._gestureHandlers = eventjs.Gesture._gestureHandlers || {};\neventjs.Gesture._gestureHandlers.gesture = root.gesture;\n\nreturn root;\n\n})(eventjs.proxy);\n/*:\n\t\"Pointer\" event proxy (1+ fingers).\n\t----------------------------------------------------\n\tCONFIGURE: minFingers, maxFingers.\n\t----------------------------------------------------\n\teventjs.add(window, \"gesture\", function(event, self) {\n\t\tconsole.log(self.rotation, self.scale, self.fingers, self.state);\n\t});\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\nif (typeof(eventjs.proxy) === \"undefined\") eventjs.proxy = {};\n\neventjs.proxy = (function(root) { \"use strict\";\n\nroot.pointerdown =\nroot.pointermove =\nroot.pointerup = function(conf) {\n\tconf.gesture = conf.gesture || \"pointer\";\n\tif (conf.target.isPointerEmitter) return;\n\t// Tracking the events.\n\tvar isDown = true;\n\tconf.onPointerDown = function (event) {\n\t\tisDown = false;\n\t\tself.gesture = \"pointerdown\";\n\t\tconf.listener(event, self);\n\t};\n\tconf.onPointerMove = function (event) {\n\t\tself.gesture = \"pointermove\";\n\t\tconf.listener(event, self, isDown);\n\t};\n\tconf.onPointerUp = function (event) {\n\t\tisDown = true;\n\t\tself.gesture = \"pointerup\";\n\t\tconf.listener(event, self, true);\n\t};\n\t// Generate maintenance commands, and other configurations.\n\tvar self = root.pointerSetup(conf);\n\t// Attach events.\n\teventjs.add(conf.target, \"mousedown\", conf.onPointerDown);\n\teventjs.add(conf.target, \"mousemove\", conf.onPointerMove);\n\teventjs.add(conf.doc, \"mouseup\", conf.onPointerUp);\n\t// Return this object.\n\tconf.target.isPointerEmitter = true;\n\treturn self;\n};\n\neventjs.Gesture = eventjs.Gesture || {};\neventjs.Gesture._gestureHandlers = eventjs.Gesture._gestureHandlers || {};\neventjs.Gesture._gestureHandlers.pointerdown = root.pointerdown;\neventjs.Gesture._gestureHandlers.pointermove = root.pointermove;\neventjs.Gesture._gestureHandlers.pointerup = root.pointerup;\n\nreturn root;\n\n})(eventjs.proxy);\n/*:\n\t\"Device Motion\" and \"Shake\" event proxy.\n\t----------------------------------------------------\n\thttp://developer.android.com/reference/android/hardware/Sensoreventjs.html#values\n\t----------------------------------------------------\n\teventjs.add(window, \"shake\", function(event, self) {});\n\teventjs.add(window, \"devicemotion\", function(event, self) {\n\t\tconsole.log(self.acceleration, self.accelerationIncludingGravity);\n\t});\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\nif (typeof(eventjs.proxy) === \"undefined\") eventjs.proxy = {};\n\neventjs.proxy = (function(root) { \"use strict\";\n\nroot.shake = function(conf) {\n\t// Externally accessible data.\n\tvar self = {\n\t\tgesture: \"devicemotion\",\n\t\tacceleration: {},\n\t\taccelerationIncludingGravity: {},\n\t\ttarget: conf.target,\n\t\tlistener: conf.listener,\n\t\tremove: function() {\n\t\t\twindow.removeEventListener('devicemotion', onDeviceMotion, false);\n\t\t}\n\t};\n\t// Setting up local variables.\n\tvar threshold = 4; // Gravitational threshold.\n\tvar timeout = 1000; // Timeout between shake events.\n\tvar timeframe = 200; // Time between shakes.\n\tvar shakes = 3; // Minimum shakes to trigger event.\n\tvar lastShake = (new Date()).getTime();\n\tvar gravity = { x: 0, y: 0, z: 0 };\n\tvar delta = {\n\t\tx: { count: 0, value: 0 },\n\t\ty: { count: 0, value: 0 },\n\t\tz: { count: 0, value: 0 }\n\t};\n\t// Tracking the events.\n\tvar onDeviceMotion = function(e) {\n\t\tvar alpha = 0.8; // Low pass filter.\n\t\tvar o = e.accelerationIncludingGravity;\n\t\tgravity.x = alpha * gravity.x + (1 - alpha) * o.x;\n\t\tgravity.y = alpha * gravity.y + (1 - alpha) * o.y;\n\t\tgravity.z = alpha * gravity.z + (1 - alpha) * o.z;\n\t\tself.accelerationIncludingGravity = gravity;\n\t\tself.acceleration.x = o.x - gravity.x;\n\t\tself.acceleration.y = o.y - gravity.y;\n\t\tself.acceleration.z = o.z - gravity.z;\n\t\t///\n\t\tif (conf.gesture === \"devicemotion\") {\n\t\t\tconf.listener(e, self);\n\t\t\treturn;\n\t\t}\n\t\tvar data = \"xyz\";\n\t\tvar now = (new Date()).getTime();\n\t\tfor (var n = 0, length = data.length; n < length; n ++) {\n\t\t\tvar letter = data[n];\n\t\t\tvar ACCELERATION = self.acceleration[letter];\n\t\t\tvar DELTA = delta[letter];\n\t\t\tvar abs = Math.abs(ACCELERATION);\n\t\t\t/// Check whether another shake event was recently registered.\n\t\t\tif (now - lastShake < timeout) continue;\n\t\t\t/// Check whether delta surpasses threshold.\n\t\t\tif (abs > threshold) {\n\t\t\t\tvar idx = now * ACCELERATION / abs;\n\t\t\t\tvar span = Math.abs(idx + DELTA.value);\n\t\t\t\t// Check whether last delta was registered within timeframe.\n\t\t\t\tif (DELTA.value && span < timeframe) {\n\t\t\t\t\tDELTA.value = idx;\n\t\t\t\t\tDELTA.count ++;\n\t\t\t\t\t// Check whether delta count has enough shakes.\n\t\t\t\t\tif (DELTA.count === shakes) {\n\t\t\t\t\t\tconf.listener(e, self);\n\t\t\t\t\t\t// Reset tracking.\n\t\t\t\t\t\tlastShake = now;\n\t\t\t\t\t\tDELTA.value = 0;\n\t\t\t\t\t\tDELTA.count = 0;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Track first shake.\n\t\t\t\t\tDELTA.value = idx;\n\t\t\t\t\tDELTA.count = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\t// Attach events.\n\tif (!window.addEventListener) return;\n\twindow.addEventListener('devicemotion', onDeviceMotion, false);\n\t// Return this object.\n\treturn self;\n};\n\neventjs.Gesture = eventjs.Gesture || {};\neventjs.Gesture._gestureHandlers = eventjs.Gesture._gestureHandlers || {};\neventjs.Gesture._gestureHandlers.shake = root.shake;\n\nreturn root;\n\n})(eventjs.proxy);\n/*:\n\t\"Swipe\" event proxy (1+ fingers).\n\t----------------------------------------------------\n\tCONFIGURE: snap, threshold, maxFingers.\n\t----------------------------------------------------\n\teventjs.add(window, \"swipe\", function(event, self) {\n\t\tconsole.log(self.velocity, self.angle);\n\t});\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\nif (typeof(eventjs.proxy) === \"undefined\") eventjs.proxy = {};\n\neventjs.proxy = (function(root) { \"use strict\";\n\nvar RAD_DEG = Math.PI / 180;\n\nroot.swipe = function(conf) {\n\tconf.snap = conf.snap || 90; // angle snap.\n\tconf.threshold = conf.threshold || 1; // velocity threshold.\n\tconf.gesture = conf.gesture || \"swipe\";\n\t// Tracking the events.\n\tconf.onPointerDown = function (event) {\n\t\tif (root.pointerStart(event, self, conf)) {\n\t\t\teventjs.add(conf.doc, \"mousemove\", conf.onPointerMove).listener(event);\n\t\t\teventjs.add(conf.doc, \"mouseup\", conf.onPointerUp);\n\t\t}\n\t};\n\tconf.onPointerMove = function (event) {\n\t\tvar touches = event.changedTouches || root.getCoords(event);\n\t\tvar length = touches.length;\n\t\tfor (var i = 0; i < length; i ++) {\n\t\t\tvar touch = touches[i];\n\t\t\tvar sid = touch.identifier || Infinity;\n\t\t\tvar o = conf.tracker[sid];\n\t\t\t// Identifier defined outside of listener.\n\t\t\tif (!o) continue;\n\t\t\to.move.x = touch.pageX;\n\t\t\to.move.y = touch.pageY;\n\t\t\to.moveTime = (new Date()).getTime();\n\t\t}\n\t};\n\tconf.onPointerUp = function(event) {\n\t\tif (root.pointerEnd(event, self, conf)) {\n\t\t\teventjs.remove(conf.doc, \"mousemove\", conf.onPointerMove);\n\t\t\teventjs.remove(conf.doc, \"mouseup\", conf.onPointerUp);\n\t\t\t///\n\t\t\tvar velocity1;\n\t\t\tvar velocity2\n\t\t\tvar degree1;\n\t\t\tvar degree2;\n\t\t\t/// Calculate centroid of gesture.\n\t\t\tvar start = { x: 0, y: 0 };\n\t\t\tvar endx = 0;\n\t\t\tvar endy = 0;\n\t\t\tvar length = 0;\n\t\t\t///\n\t\t\tfor (var sid in conf.tracker) {\n\t\t\t\tvar touch = conf.tracker[sid];\n\t\t\t\tvar xdist = touch.move.x - touch.start.x;\n\t\t\t\tvar ydist = touch.move.y - touch.start.y;\n\t\t\t\t///\n\t\t\t\tendx += touch.move.x;\n\t\t\t\tendy += touch.move.y;\n\t\t\t\tstart.x += touch.start.x;\n\t\t\t\tstart.y += touch.start.y;\n\t\t\t\tlength ++;\n\t\t\t\t///\n\t\t\t\tvar distance = Math.sqrt(xdist * xdist + ydist * ydist);\n\t\t\t\tvar ms = touch.moveTime - touch.startTime;\n\t\t\t\tvar degree2 = Math.atan2(xdist, ydist) / RAD_DEG + 180;\n\t\t\t\tvar velocity2 = ms ? distance / ms : 0;\n\t\t\t\tif (typeof(degree1) === \"undefined\") {\n\t\t\t\t\tdegree1 = degree2;\n\t\t\t\t\tvelocity1 = velocity2;\n\t\t\t\t} else if (Math.abs(degree2 - degree1) <= 20) {\n\t\t\t\t\tdegree1 = (degree1 + degree2) / 2;\n\t\t\t\t\tvelocity1 = (velocity1 + velocity2) / 2;\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\t///\n\t\t\tvar fingers = conf.gestureFingers;\n\t\t\tif (conf.minFingers <= fingers && conf.maxFingers >= fingers) {\n\t\t\t\tif (velocity1 > conf.threshold) {\n\t\t\t\t\tstart.x /= length;\n\t\t\t\t\tstart.y /= length;\n\t\t\t\t\tself.start = start;\n\t\t\t\t\tself.x = endx / length;\n\t\t\t\t\tself.y = endy / length;\n\t\t\t\t\tself.angle = -((((degree1 / conf.snap + 0.5) >> 0) * conf.snap || 360) - 360);\n\t\t\t\t\tself.velocity = velocity1;\n\t\t\t\t\tself.fingers = fingers;\n\t\t\t\t\tself.state = \"swipe\";\n\t\t\t\t\tconf.listener(event, self);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\t// Generate maintenance commands, and other configurations.\n\tvar self = root.pointerSetup(conf);\n\t// Attach events.\n\teventjs.add(conf.target, \"mousedown\", conf.onPointerDown);\n\t// Return this object.\n\treturn self;\n};\n\neventjs.Gesture = eventjs.Gesture || {};\neventjs.Gesture._gestureHandlers = eventjs.Gesture._gestureHandlers || {};\neventjs.Gesture._gestureHandlers.swipe = root.swipe;\n\nreturn root;\n\n})(eventjs.proxy);\n/*:\n\t\"Tap\" and \"Longpress\" event proxy.\n\t----------------------------------------------------\n\tCONFIGURE: delay (longpress), timeout (tap).\n\t----------------------------------------------------\n\teventjs.add(window, \"tap\", function(event, self) {\n\t\tconsole.log(self.fingers);\n\t});\n\t----------------------------------------------------\n\tmulti-finger tap // touch an target for <= 250ms.\n\tmulti-finger longpress // touch an target for >= 500ms\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\nif (typeof(eventjs.proxy) === \"undefined\") eventjs.proxy = {};\n\neventjs.proxy = (function(root) { \"use strict\";\n\nroot.longpress = function(conf) {\n\tconf.gesture = \"longpress\";\n\treturn root.tap(conf);\n};\n\nroot.tap = function(conf) {\n\tconf.delay = conf.delay || 500;\n\tconf.timeout = conf.timeout || 250;\n\tconf.driftDeviance = conf.driftDeviance || 10;\n\tconf.gesture = conf.gesture || \"tap\";\n\t// Setting up local variables.\n\tvar timestamp, timeout;\n\t// Tracking the events.\n\tconf.onPointerDown = function (event) {\n\t\tif (root.pointerStart(event, self, conf)) {\n\t\t\ttimestamp = (new Date()).getTime();\n\t\t\t// Initialize event listeners.\n\t\t\teventjs.add(conf.doc, \"mousemove\", conf.onPointerMove).listener(event);\n\t\t\teventjs.add(conf.doc, \"mouseup\", conf.onPointerUp);\n\t\t\t// Make sure this is a \"longpress\" event.\n\t\t\tif (conf.gesture !== \"longpress\") return;\n\t\t\ttimeout = setTimeout(function() {\n\t\t\t\tif (event.cancelBubble && ++event.cancelBubbleCount > 1) return;\n\t\t\t\t// Make sure no fingers have been changed.\n\t\t\t\tvar fingers = 0;\n\t\t\t\tfor (var key in conf.tracker) {\n\t\t\t\t\tvar point = conf.tracker[key];\n\t\t\t\t\tif (point.end === true) return;\n\t\t\t\t\tif (conf.cancel) return;\n\t\t\t\t\tfingers ++;\n\t\t\t\t}\n\t\t\t\t// Send callback.\n\t\t\t\tif (conf.minFingers <= fingers && conf.maxFingers >= fingers) {\n\t\t\t\t\tself.state = \"start\";\n\t\t\t\t\tself.fingers = fingers;\n\t\t\t\t\tself.x = point.start.x;\n\t\t\t\t\tself.y = point.start.y;\n\t\t\t\t\tconf.listener(event, self);\n\t\t\t\t}\n\t\t\t}, conf.delay);\n\t\t}\n\t};\n\tconf.onPointerMove = function (event) {\n\t\tvar bbox = conf.bbox;\n\t\tvar touches = event.changedTouches || root.getCoords(event);\n\t\tvar length = touches.length;\n\t\tfor (var i = 0; i < length; i ++) {\n\t\t\tvar touch = touches[i];\n\t\t\tvar identifier = touch.identifier || Infinity;\n\t\t\tvar pt = conf.tracker[identifier];\n\t\t\tif (!pt) continue;\n\t\t\tvar x = (touch.pageX - bbox.x1);\n\t\t\tvar y = (touch.pageY - bbox.y1);\n\t\t\t///\n\t\t\tvar dx = x - pt.start.x;\n\t\t\tvar dy = y - pt.start.y;\n\t\t\tvar distance = Math.sqrt(dx * dx + dy * dy);\n\t\t\tif (!(x > 0 && x < bbox.width && // Within target coordinates..\n\t\t\t\t  y > 0 && y < bbox.height &&\n\t\t\t\t  distance <= conf.driftDeviance)) { // Within drift deviance.\n\t\t\t\t// Cancel out this listener.\n\t\t\t\teventjs.remove(conf.doc, \"mousemove\", conf.onPointerMove);\n\t\t\t\tconf.cancel = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t};\n\tconf.onPointerUp = function(event) {\n\t\tif (root.pointerEnd(event, self, conf)) {\n\t\t\tclearTimeout(timeout);\n\t\t\teventjs.remove(conf.doc, \"mousemove\", conf.onPointerMove);\n\t\t\teventjs.remove(conf.doc, \"mouseup\", conf.onPointerUp);\n\t\t\tif (event.cancelBubble && ++event.cancelBubbleCount > 1) return;\n\t\t\t// Callback release on longpress.\n\t\t\tif (conf.gesture === \"longpress\") {\n\t\t\t\tif (self.state === \"start\") {\n\t\t\t\t\tself.state = \"end\";\n\t\t\t\t\tconf.listener(event, self);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Cancel event due to movement.\n\t\t\tif (conf.cancel) return;\n\t\t\t// Ensure delay is within margins.\n\t\t\tif ((new Date()).getTime() - timestamp > conf.timeout) return;\n\t\t\t// Send callback.\n\t\t\tvar fingers = conf.gestureFingers;\n\t\t\tif (conf.minFingers <= fingers && conf.maxFingers >= fingers) {\n\t\t\t\tself.state = \"tap\";\n\t\t\t\tself.fingers = conf.gestureFingers;\n\t\t\t\tconf.listener(event, self);\n\t\t\t}\n\t\t}\n\t};\n\t// Generate maintenance commands, and other configurations.\n\tvar self = root.pointerSetup(conf);\n\t// Attach events.\n\teventjs.add(conf.target, \"mousedown\", conf.onPointerDown);\n\t// Return this object.\n\treturn self;\n};\n\neventjs.Gesture = eventjs.Gesture || {};\neventjs.Gesture._gestureHandlers = eventjs.Gesture._gestureHandlers || {};\neventjs.Gesture._gestureHandlers.tap = root.tap;\neventjs.Gesture._gestureHandlers.longpress = root.longpress;\n\nreturn root;\n\n})(eventjs.proxy);\n/*:\n\t\"Mouse Wheel\" event proxy.\n\t----------------------------------------------------\n\teventjs.add(window, \"wheel\", function(event, self) {\n\t\tconsole.log(self.state, self.wheelDelta);\n\t});\n*/\n\nif (typeof(eventjs) === \"undefined\") var eventjs = {};\nif (typeof(eventjs.proxy) === \"undefined\") eventjs.proxy = {};\n\neventjs.proxy = (function(root) { \"use strict\";\n\nroot.wheelPreventElasticBounce = function(el) {\n\tif (!el) return;\n\tif (typeof(el) === \"string\") el = document.querySelector(el);\n\teventjs.add(el, \"wheel\", function(event, self) {\n\t\tself.preventElasticBounce();\n\t\teventjs.stop(event);\n\t});\n};\n\nroot.wheel = function(conf) {\n\t// Configure event listener.\n\tvar interval;\n\tvar timeout = conf.timeout || 150;\n\tvar count = 0;\n\t// Externally accessible data.\n\tvar self = {\n\t\tgesture: \"wheel\",\n\t\tstate: \"start\",\n\t\twheelDelta: 0,\n\t\ttarget: conf.target,\n\t\tlistener: conf.listener,\n\t\tpreventElasticBounce: function(event) {\n\t\t\tvar target = this.target;\n\t\t\tvar scrollTop = target.scrollTop;\n\t\t\tvar top = scrollTop + target.offsetHeight;\n\t\t\tvar height = target.scrollHeight;\n\t\t\tif (top === height && this.wheelDelta <= 0) eventjs.cancel(event);\n\t\t\telse if (scrollTop === 0 && this.wheelDelta >= 0) eventjs.cancel(event);\n\t\t\teventjs.stop(event);\n\t\t},\n\t\tadd: function() {\n\t\t\tconf.target[add](type, onMouseWheel, false);\n\t\t},\n\t\tremove: function() {\n\t\t\tconf.target[remove](type, onMouseWheel, false);\n\t\t}\n\t};\n\t// Tracking the events.\n\tvar onMouseWheel = function(event) {\n\t\tevent = event || window.event;\n\t\tself.state = count++ ? \"change\" : \"start\";\n\t\tself.wheelDelta = event.detail ? event.detail * -20 : event.wheelDelta;\n\t\tconf.listener(event, self);\n\t\tclearTimeout(interval);\n\t\tinterval = setTimeout(function() {\n\t\t\tcount = 0;\n\t\t\tself.state = \"end\";\n\t\t\tself.wheelDelta = 0;\n\t\t\tconf.listener(event, self);\n\t\t}, timeout);\n\t};\n\t// Attach events.\n\tvar add = document.addEventListener ? \"addEventListener\" : \"attachEvent\";\n\tvar remove = document.removeEventListener ? \"removeEventListener\" : \"detachEvent\";\n\tvar type = eventjs.getEventSupport(\"mousewheel\") ? \"mousewheel\" : \"DOMMouseScroll\";\n\tconf.target[add](type, onMouseWheel, false);\n\t// Return this object.\n\treturn self;\n};\n\neventjs.Gesture = eventjs.Gesture || {};\neventjs.Gesture._gestureHandlers = eventjs.Gesture._gestureHandlers || {};\neventjs.Gesture._gestureHandlers.wheel = root.wheel;\n\nreturn root;\n\n})(eventjs.proxy);\n/*\n\t\"Orientation Change\"\n\t----------------------------------------------------\n\thttps://developer.apple.com/library/safari/documentation/SafariDOMAdditions/Reference/DeviceOrientationEventClassRef/DeviceOrientationEvent/DeviceOrientationEvent.html#//apple_ref/doc/uid/TP40010526\n\t----------------------------------------------------\n\tEvent.add(window, \"deviceorientation\", function(event, self) {});\n*/\n\nif (typeof(Event) === \"undefined\") var Event = {};\nif (typeof(Event.proxy) === \"undefined\") Event.proxy = {};\n\nEvent.proxy = (function(root) { \"use strict\";\n\nroot.orientation = function(conf) {\n\t// Externally accessible data.\n\tvar self = {\n\t\tgesture: \"orientationchange\",\n\t\tprevious: null, /* Report the previous orientation */\n\t\tcurrent: window.orientation,\n\t\ttarget: conf.target,\n\t\tlistener: conf.listener,\n\t\tremove: function() {\n\t\t\twindow.removeEventListener('orientationchange', onOrientationChange, false);\n\t\t}\n\t};\n\n\t// Tracking the events.\n\tvar onOrientationChange = function(e) {\n\n\t\tself.previous = self.current;\n\t\tself.current = window.orientation;\n\t    if(self.previous !== null && self.previous != self.current) {\n\t\t\tconf.listener(e, self);\n\t\t\treturn;\n\t    }\n\n\n\t};\n\t// Attach events.\n\tif (window.DeviceOrientationEvent) {\n    \twindow.addEventListener(\"orientationchange\", onOrientationChange, false);\n  \t}\n\t// Return this object.\n\treturn self;\n};\n\nEvent.Gesture = Event.Gesture || {};\nEvent.Gesture._gestureHandlers = Event.Gesture._gestureHandlers || {};\nEvent.Gesture._gestureHandlers.orientation = root.orientation;\n\nreturn root;\n\n})(Event.proxy);\n(function() {\n\n  /**\n   * @private\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  function _removeEventListener(eventName, handler) {\n    if (!this.__eventListeners[eventName]) {\n      return;\n    }\n    var eventListener = this.__eventListeners[eventName];\n    if (handler) {\n      eventListener[eventListener.indexOf(handler)] = false;\n    }\n    else {\n      fabric.util.array.fill(eventListener, false);\n    }\n  }\n\n  /**\n   * Observes specified event\n   * @deprecated `observe` deprecated since 0.8.34 (use `on` instead)\n   * @memberOf fabric.Observable\n   * @alias on\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function that receives a notification when an event of the specified type occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function observe(eventName, handler) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = { };\n    }\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        this.on(prop, eventName[prop]);\n      }\n    }\n    else {\n      if (!this.__eventListeners[eventName]) {\n        this.__eventListeners[eventName] = [];\n      }\n      this.__eventListeners[eventName].push(handler);\n    }\n    return this;\n  }\n\n  /**\n   * Stops event observing for a particular event handler. Calling this method\n   * without arguments removes all handlers for all events\n   * @deprecated `stopObserving` deprecated since 0.8.34 (use `off` instead)\n   * @memberOf fabric.Observable\n   * @alias off\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function to be deleted from EventListeners\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function stopObserving(eventName, handler) {\n    if (!this.__eventListeners) {\n      return;\n    }\n\n    // remove all key/value pairs (event name -> event handler)\n    if (arguments.length === 0) {\n      for (eventName in this.__eventListeners) {\n        _removeEventListener.call(this, eventName);\n      }\n    }\n    // one object with key/value pairs was passed\n    else if (arguments.length === 1 && typeof arguments[0] === 'object') {\n      for (var prop in eventName) {\n        _removeEventListener.call(this, prop, eventName[prop]);\n      }\n    }\n    else {\n      _removeEventListener.call(this, eventName, handler);\n    }\n    return this;\n  }\n\n  /**\n   * Fires event with an optional options object\n   * @deprecated `fire` deprecated since 1.0.7 (use `trigger` instead)\n   * @memberOf fabric.Observable\n   * @alias trigger\n   * @param {String} eventName Event name to fire\n   * @param {Object} [options] Options object\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function fire(eventName, options) {\n    if (!this.__eventListeners) {\n      return;\n    }\n\n    var listenersForEvent = this.__eventListeners[eventName];\n    if (!listenersForEvent) {\n      return;\n    }\n\n    for (var i = 0, len = listenersForEvent.length; i < len; i++) {\n      listenersForEvent[i] && listenersForEvent[i].call(this, options || { });\n    }\n    this.__eventListeners[eventName] = listenersForEvent.filter(function(value) {\n      return value !== false;\n    });\n    return this;\n  }\n\n  /**\n   * @namespace fabric.Observable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#events}\n   * @see {@link http://fabricjs.com/events|Events demo}\n   */\n  fabric.Observable = {\n    observe: observe,\n    stopObserving: stopObserving,\n    fire: fire,\n\n    on: observe,\n    off: stopObserving,\n    trigger: fire\n  };\n})();\n/**\n * @namespace fabric.Collection\n */\nfabric.Collection = {\n\n  _objects: [],\n\n  /**\n   * Adds objects to collection, Canvas or Group, then renders canvas\n   * (if `renderOnAddRemove` is not `false`).\n   * in case of Group no changes to bounding box are made.\n   * Objects should be instances of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the add method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  add: function () {\n    this._objects.push.apply(this._objects, arguments);\n    if (this._onObjectAdded) {\n      for (var i = 0, length = arguments.length; i < length; i++) {\n        this._onObjectAdded(arguments[i]);\n      }\n    }\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * An object should be an instance of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the insertAt method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {Object} object Object to insert\n   * @param {Number} index Index to insert object at\n   * @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  insertAt: function (object, index, nonSplicing) {\n    var objects = this._objects;\n    if (nonSplicing) {\n      objects[index] = object;\n    }\n    else {\n      objects.splice(index, 0, object);\n    }\n    this._onObjectAdded && this._onObjectAdded(object);\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Removes objects from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  remove: function() {\n    var objects = this._objects,\n        index, somethingRemoved = false;\n\n    for (var i = 0, length = arguments.length; i < length; i++) {\n      index = objects.indexOf(arguments[i]);\n\n      // only call onObjectRemoved if an object was actually removed\n      if (index !== -1) {\n        somethingRemoved = true;\n        objects.splice(index, 1);\n        this._onObjectRemoved && this._onObjectRemoved(arguments[i]);\n      }\n    }\n\n    this.renderOnAddRemove && somethingRemoved && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Executes given function for each object in this group\n   * @param {Function} callback\n   *                   Callback invoked with current object as first argument,\n   *                   index - as second and an array of all objects - as third.\n   *                   Callback is invoked in a context of Global Object (e.g. `window`)\n   *                   when no `context` argument is given\n   *\n   * @param {Object} context Context (aka thisObject)\n   * @return {Self} thisArg\n   * @chainable\n   */\n  forEachObject: function(callback, context) {\n    var objects = this.getObjects();\n    for (var i = 0, len = objects.length; i < len; i++) {\n      callback.call(context, objects[i], i, objects);\n    }\n    return this;\n  },\n\n  /**\n   * Returns an array of children objects of this instance\n   * Type parameter introduced in 1.3.10\n   * since 2.3.5 this method return always a COPY of the array;\n   * @param {String} [type] When specified, only objects of this type are returned\n   * @return {Array}\n   */\n  getObjects: function(type) {\n    if (typeof type === 'undefined') {\n      return this._objects.concat();\n    }\n    return this._objects.filter(function(o) {\n      return o.type === type;\n    });\n  },\n\n  /**\n   * Returns object at specified index\n   * @param {Number} index\n   * @return {Self} thisArg\n   */\n  item: function (index) {\n    return this._objects[index];\n  },\n\n  /**\n   * Returns true if collection contains no objects\n   * @return {Boolean} true if collection is empty\n   */\n  isEmpty: function () {\n    return this._objects.length === 0;\n  },\n\n  /**\n   * Returns a size of a collection (i.e: length of an array containing its objects)\n   * @return {Number} Collection size\n   */\n  size: function() {\n    return this._objects.length;\n  },\n\n  /**\n   * Returns true if collection contains an object\n   * @param {Object} object Object to check against\n   * @return {Boolean} `true` if collection contains an object\n   */\n  contains: function(object) {\n    return this._objects.indexOf(object) > -1;\n  },\n\n  /**\n   * Returns number representation of a collection complexity\n   * @return {Number} complexity\n   */\n  complexity: function () {\n    return this._objects.reduce(function (memo, current) {\n      memo += current.complexity ? current.complexity() : 0;\n      return memo;\n    }, 0);\n  }\n};\n/**\n * @namespace fabric.CommonMethods\n */\nfabric.CommonMethods = {\n\n  /**\n   * Sets object's properties from options\n   * @param {Object} [options] Options object\n   */\n  _setOptions: function(options) {\n    for (var prop in options) {\n      this.set(prop, options[prop]);\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Gradient to\n   */\n  _initGradient: function(filler, property) {\n    if (filler && filler.colorStops && !(filler instanceof fabric.Gradient)) {\n      this.set(property, new fabric.Gradient(filler));\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Pattern to\n   * @param {Function} [callback] callback to invoke after pattern load\n   */\n  _initPattern: function(filler, property, callback) {\n    if (filler && filler.source && !(filler instanceof fabric.Pattern)) {\n      this.set(property, new fabric.Pattern(filler, callback));\n    }\n    else {\n      callback && callback();\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [options] Options object\n   */\n  _initClipping: function(options) {\n    if (!options.clipTo || typeof options.clipTo !== 'string') {\n      return;\n    }\n\n    var functionBody = fabric.util.getFunctionBody(options.clipTo);\n    if (typeof functionBody !== 'undefined') {\n      this.clipTo = new Function('ctx', functionBody);\n    }\n  },\n\n  /**\n   * @private\n   */\n  _setObject: function(obj) {\n    for (var prop in obj) {\n      this._set(prop, obj[prop]);\n    }\n  },\n\n  /**\n   * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n   * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n   * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  set: function(key, value) {\n    if (typeof key === 'object') {\n      this._setObject(key);\n    }\n    else {\n      if (typeof value === 'function' && key !== 'clipTo') {\n        this._set(key, value(this.get(key)));\n      }\n      else {\n        this._set(key, value);\n      }\n    }\n    return this;\n  },\n\n  _set: function(key, value) {\n    this[key] = value;\n  },\n\n  /**\n   * Toggles specified property from `true` to `false` or from `false` to `true`\n   * @param {String} property Property to toggle\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  toggle: function(property) {\n    var value = this.get(property);\n    if (typeof value === 'boolean') {\n      this.set(property, !value);\n    }\n    return this;\n  },\n\n  /**\n   * Basic getter\n   * @param {String} property Property name\n   * @return {*} value of a property\n   */\n  get: function(property) {\n    return this[property];\n  }\n};\n(function(global) {\n\n  var sqrt = Math.sqrt,\n      atan2 = Math.atan2,\n      pow = Math.pow,\n      abs = Math.abs,\n      PiBy180 = Math.PI / 180,\n      PiBy2 = Math.PI / 2;\n\n  /**\n   * @namespace fabric.util\n   */\n  fabric.util = {\n\n    /**\n     * Calculate the cos of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    cos: function(angle) {\n      if (angle === 0) { return 1; }\n      if (angle < 0) {\n        // cos(a) = cos(-a)\n        angle = -angle;\n      }\n      var angleSlice = angle / PiBy2;\n      switch (angleSlice) {\n        case 1: case 3: return 0;\n        case 2: return -1;\n      }\n      return Math.cos(angle);\n    },\n\n    /**\n     * Calculate the sin of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    sin: function(angle) {\n      if (angle === 0) { return 0; }\n      var angleSlice = angle / PiBy2, sign = 1;\n      if (angle < 0) {\n        // sin(-a) = -sin(a)\n        sign = -1;\n      }\n      switch (angleSlice) {\n        case 1: return sign;\n        case 2: return 0;\n        case 3: return -sign;\n      }\n      return Math.sin(angle);\n    },\n\n    /**\n     * Removes value from an array.\n     * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} array\n     * @param {*} value\n     * @return {Array} original array\n     */\n    removeFromArray: function(array, value) {\n      var idx = array.indexOf(value);\n      if (idx !== -1) {\n        array.splice(idx, 1);\n      }\n      return array;\n    },\n\n    /**\n     * Returns random number between 2 specified ones.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} min lower limit\n     * @param {Number} max upper limit\n     * @return {Number} random value (between min and max)\n     */\n    getRandomInt: function(min, max) {\n      return Math.floor(Math.random() * (max - min + 1)) + min;\n    },\n\n    /**\n     * Transforms degrees to radians.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} degrees value in degrees\n     * @return {Number} value in radians\n     */\n    degreesToRadians: function(degrees) {\n      return degrees * PiBy180;\n    },\n\n    /**\n     * Transforms radians to degrees.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} radians value in radians\n     * @return {Number} value in degrees\n     */\n    radiansToDegrees: function(radians) {\n      return radians / PiBy180;\n    },\n\n    /**\n     * Rotates `point` around `origin` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Point} point The point to rotate\n     * @param {fabric.Point} origin The origin of the rotation\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {fabric.Point} The new rotated point\n     */\n    rotatePoint: function(point, origin, radians) {\n      point.subtractEquals(origin);\n      var v = fabric.util.rotateVector(point, radians);\n      return new fabric.Point(v.x, v.y).addEquals(origin);\n    },\n\n    /**\n     * Rotates `vector` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} vector The vector to rotate (x and y)\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {Object} The new rotated point\n     */\n    rotateVector: function(vector, radians) {\n      var sin = fabric.util.sin(radians),\n          cos = fabric.util.cos(radians),\n          rx = vector.x * cos - vector.y * sin,\n          ry = vector.x * sin + vector.y * cos;\n      return {\n        x: rx,\n        y: ry\n      };\n    },\n\n    /**\n     * Apply transform t to point p\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Point} p The point to transform\n     * @param  {Array} t The transform\n     * @param  {Boolean} [ignoreOffset] Indicates that the offset should not be applied\n     * @return {fabric.Point} The transformed point\n     */\n    transformPoint: function(p, t, ignoreOffset) {\n      if (ignoreOffset) {\n        return new fabric.Point(\n          t[0] * p.x + t[2] * p.y,\n          t[1] * p.x + t[3] * p.y\n        );\n      }\n      return new fabric.Point(\n        t[0] * p.x + t[2] * p.y + t[4],\n        t[1] * p.x + t[3] * p.y + t[5]\n      );\n    },\n\n    /**\n     * Returns coordinates of points's bounding rectangle (left, top, width, height)\n     * @param {Array} points 4 points array\n     * @return {Object} Object with left, top, width, height properties\n     */\n    makeBoundingBoxFromPoints: function(points) {\n      var xPoints = [points[0].x, points[1].x, points[2].x, points[3].x],\n          minX = fabric.util.array.min(xPoints),\n          maxX = fabric.util.array.max(xPoints),\n          width = maxX - minX,\n          yPoints = [points[0].y, points[1].y, points[2].y, points[3].y],\n          minY = fabric.util.array.min(yPoints),\n          maxY = fabric.util.array.max(yPoints),\n          height = maxY - minY;\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height\n      };\n    },\n\n    /**\n     * Invert transformation t\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} t The transform\n     * @return {Array} The inverted transform\n     */\n    invertTransform: function(t) {\n      var a = 1 / (t[0] * t[3] - t[1] * t[2]),\n          r = [a * t[3], -a * t[1], -a * t[2], a * t[0]],\n          o = fabric.util.transformPoint({ x: t[4], y: t[5] }, r, true);\n      r[4] = -o.x;\n      r[5] = -o.y;\n      return r;\n    },\n\n    /**\n     * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number|String} number number to operate on\n     * @param {Number} fractionDigits number of fraction digits to \"leave\"\n     * @return {Number}\n     */\n    toFixed: function(number, fractionDigits) {\n      return parseFloat(Number(number).toFixed(fractionDigits));\n    },\n\n    /**\n     * Converts from attribute value to pixel value if applicable.\n     * Returns converted pixels or original value not converted.\n     * @param {Number|String} value number to operate on\n     * @param {Number} fontSize\n     * @return {Number|String}\n     */\n    parseUnit: function(value, fontSize) {\n      var unit = /\\D{0,2}$/.exec(value),\n          number = parseFloat(value);\n      if (!fontSize) {\n        fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      }\n      switch (unit[0]) {\n        case 'mm':\n          return number * fabric.DPI / 25.4;\n\n        case 'cm':\n          return number * fabric.DPI / 2.54;\n\n        case 'in':\n          return number * fabric.DPI;\n\n        case 'pt':\n          return number * fabric.DPI / 72; // or * 4 / 3\n\n        case 'pc':\n          return number * fabric.DPI / 72 * 12; // or * 16\n\n        case 'em':\n          return number * fontSize;\n\n        default:\n          return number;\n      }\n    },\n\n    /**\n     * Function which always returns `false`.\n     * @static\n     * @memberOf fabric.util\n     * @return {Boolean}\n     */\n    falseFunction: function() {\n      return false;\n    },\n\n    /**\n     * Returns klass \"Class\" object of given namespace\n     * @memberOf fabric.util\n     * @param {String} type Type of object (eg. 'circle')\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @return {Object} klass \"Class\"\n     */\n    getKlass: function(type, namespace) {\n      // capitalize first letter only\n      type = fabric.util.string.camelize(type.charAt(0).toUpperCase() + type.slice(1));\n      return fabric.util.resolveNamespace(namespace)[type];\n    },\n\n    /**\n     * Returns array of attributes for given svg that fabric parses\n     * @memberOf fabric.util\n     * @param {String} type Type of svg element (eg. 'circle')\n     * @return {Array} string names of supported attributes\n     */\n    getSvgAttributes: function(type) {\n      var attributes = [\n        'instantiated_by_use',\n        'style',\n        'id',\n        'class'\n      ];\n      switch (type) {\n        case 'linearGradient':\n          attributes = attributes.concat(['x1', 'y1', 'x2', 'y2', 'gradientUnits', 'gradientTransform']);\n          break;\n        case 'radialGradient':\n          attributes = attributes.concat(['gradientUnits', 'gradientTransform', 'cx', 'cy', 'r', 'fx', 'fy', 'fr']);\n          break;\n        case 'stop':\n          attributes = attributes.concat(['offset', 'stop-color', 'stop-opacity']);\n          break;\n      }\n      return attributes;\n    },\n\n    /**\n     * Returns object of given namespace\n     * @memberOf fabric.util\n     * @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'\n     * @return {Object} Object for given namespace (default fabric)\n     */\n    resolveNamespace: function(namespace) {\n      if (!namespace) {\n        return fabric;\n      }\n\n      var parts = namespace.split('.'),\n          len = parts.length, i,\n          obj = global || fabric.window;\n\n      for (i = 0; i < len; ++i) {\n        obj = obj[parts[i]];\n      }\n\n      return obj;\n    },\n\n    /**\n     * Loads image element from given url and passes it to a callback\n     * @memberOf fabric.util\n     * @param {String} url URL representing an image\n     * @param {Function} callback Callback; invoked with loaded image\n     * @param {*} [context] Context to invoke callback in\n     * @param {Object} [crossOrigin] crossOrigin value to set image element to\n     */\n    loadImage: function(url, callback, context, crossOrigin) {\n      if (!url) {\n        callback && callback.call(context, url);\n        return;\n      }\n\n      var img = fabric.util.createImage();\n\n      /** @ignore */\n      var onLoadCallback = function () {\n        callback && callback.call(context, img);\n        img = img.onload = img.onerror = null;\n      };\n\n      img.onload = onLoadCallback;\n      /** @ignore */\n      img.onerror = function() {\n        fabric.log('Error loading ' + img.src);\n        callback && callback.call(context, null, true);\n        img = img.onload = img.onerror = null;\n      };\n\n      // data-urls appear to be buggy with crossOrigin\n      // https://github.com/kangax/fabric.js/commit/d0abb90f1cd5c5ef9d2a94d3fb21a22330da3e0a#commitcomment-4513767\n      // see https://code.google.com/p/chromium/issues/detail?id=315152\n      //     https://bugzilla.mozilla.org/show_bug.cgi?id=935069\n      if (url.indexOf('data') !== 0 && crossOrigin) {\n        img.crossOrigin = crossOrigin;\n      }\n\n      // IE10 / IE11-Fix: SVG contents from data: URI\n      // will only be available if the IMG is present\n      // in the DOM (and visible)\n      if (url.substring(0,14) === 'data:image/svg') {\n        img.onload = null;\n        fabric.util.loadImageInDom(img, onLoadCallback);\n      }\n\n      img.src = url;\n    },\n\n    /**\n     * Attaches SVG image with data: URL to the dom\n     * @memberOf fabric.util\n     * @param {Object} img Image object with data:image/svg src\n     * @param {Function} callback Callback; invoked with loaded image\n     * @return {Object} DOM element (div containing the SVG image)\n     */\n    loadImageInDom: function(img, onLoadCallback) {\n      var div = fabric.document.createElement('div');\n      div.style.width = div.style.height = '1px';\n      div.style.left = div.style.top = '-100%';\n      div.style.position = 'absolute';\n      div.appendChild(img);\n      fabric.document.querySelector('body').appendChild(div);\n      /**\n       * Wrap in function to:\n       *   1. Call existing callback\n       *   2. Cleanup DOM\n       */\n      img.onload = function () {\n        onLoadCallback();\n        div.parentNode.removeChild(div);\n        div = null;\n      };\n    },\n\n    /**\n     * Creates corresponding fabric instances from their object representations\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */\n    enlivenObjects: function(objects, callback, namespace, reviver) {\n      objects = objects || [];\n\n      function onLoaded() {\n        if (++numLoadedObjects === numTotalObjects) {\n          callback && callback(enlivenedObjects);\n        }\n      }\n\n      var enlivenedObjects = [],\n          numLoadedObjects = 0,\n          numTotalObjects = objects.length;\n\n      if (!numTotalObjects) {\n        callback && callback(enlivenedObjects);\n        return;\n      }\n\n      objects.forEach(function (o, index) {\n        // if sparse array\n        if (!o || !o.type) {\n          onLoaded();\n          return;\n        }\n        var klass = fabric.util.getKlass(o.type, namespace);\n        klass.fromObject(o, function (obj, error) {\n          error || (enlivenedObjects[index] = obj);\n          reviver && reviver(o, obj, error);\n          onLoaded();\n        });\n      });\n    },\n\n    /**\n     * Create and wait for loading of patterns\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} patterns Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * called after each fabric object created.\n     */\n    enlivenPatterns: function(patterns, callback) {\n      patterns = patterns || [];\n\n      function onLoaded() {\n        if (++numLoadedPatterns === numPatterns) {\n          callback && callback(enlivenedPatterns);\n        }\n      }\n\n      var enlivenedPatterns = [],\n          numLoadedPatterns = 0,\n          numPatterns = patterns.length;\n\n      if (!numPatterns) {\n        callback && callback(enlivenedPatterns);\n        return;\n      }\n\n      patterns.forEach(function (p, index) {\n        if (p && p.source) {\n          new fabric.Pattern(p, function(pattern) {\n            enlivenedPatterns[index] = pattern;\n            onLoaded();\n          });\n        }\n        else {\n          enlivenedPatterns[index] = p;\n          onLoaded();\n        }\n      });\n    },\n\n    /**\n     * Groups SVG elements (usually those retrieved from SVG document)\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} elements SVG elements to group\n     * @param {Object} [options] Options object\n     * @param {String} path Value to set sourcePath to\n     * @return {fabric.Object|fabric.Group}\n     */\n    groupSVGElements: function(elements, options, path) {\n      var object;\n      if (elements && elements.length === 1) {\n        return elements[0];\n      }\n      if (options) {\n        if (options.width && options.height) {\n          options.centerPoint = {\n            x: options.width / 2,\n            y: options.height / 2\n          };\n        }\n        else {\n          delete options.width;\n          delete options.height;\n        }\n      }\n      object = new fabric.Group(elements, options);\n      if (typeof path !== 'undefined') {\n        object.sourcePath = path;\n      }\n      return object;\n    },\n\n    /**\n     * Populates an object with properties of another object\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} source Source object\n     * @param {Object} destination Destination object\n     * @return {Array} properties Properties names to include\n     */\n    populateWithProperties: function(source, destination, properties) {\n      if (properties && Object.prototype.toString.call(properties) === '[object Array]') {\n        for (var i = 0, len = properties.length; i < len; i++) {\n          if (properties[i] in source) {\n            destination[properties[i]] = source[properties[i]];\n          }\n        }\n      }\n    },\n\n    /**\n     * Draws a dashed line between two points\n     *\n     * This method is used to draw dashed line around selection area.\n     * See <a href=\"http://stackoverflow.com/questions/4576724/dotted-stroke-in-canvas\">dotted stroke in canvas</a>\n     *\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x  start x coordinate\n     * @param {Number} y start y coordinate\n     * @param {Number} x2 end x coordinate\n     * @param {Number} y2 end y coordinate\n     * @param {Array} da dash array pattern\n     */\n    drawDashedLine: function(ctx, x, y, x2, y2, da) {\n      var dx = x2 - x,\n          dy = y2 - y,\n          len = sqrt(dx * dx + dy * dy),\n          rot = atan2(dy, dx),\n          dc = da.length,\n          di = 0,\n          draw = true;\n\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.moveTo(0, 0);\n      ctx.rotate(rot);\n\n      x = 0;\n      while (len > x) {\n        x += da[di++ % dc];\n        if (x > len) {\n          x = len;\n        }\n        ctx[draw ? 'lineTo' : 'moveTo'](x, 0);\n        draw = !draw;\n      }\n\n      ctx.restore();\n    },\n\n    /**\n     * Creates canvas element\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    createCanvasElement: function() {\n      return fabric.document.createElement('canvas');\n    },\n\n    /**\n     * Creates a canvas element that is a copy of another and is also painted\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    copyCanvasElement: function(canvas) {\n      var newCanvas = fabric.util.createCanvasElement();\n      newCanvas.width = canvas.width;\n      newCanvas.height = canvas.height;\n      newCanvas.getContext('2d').drawImage(canvas, 0, 0);\n      return newCanvas;\n    },\n\n    /**\n     * Creates image element (works on client and node)\n     * @static\n     * @memberOf fabric.util\n     * @return {HTMLImageElement} HTML image element\n     */\n    createImage: function() {\n      return fabric.document.createElement('img');\n    },\n\n    /**\n     * @static\n     * @memberOf fabric.util\n     * @deprecated since 2.0.0\n     * @param {fabric.Object} receiver Object implementing `clipTo` method\n     * @param {CanvasRenderingContext2D} ctx Context to clip\n     */\n    clipContext: function(receiver, ctx) {\n      ctx.save();\n      ctx.beginPath();\n      receiver.clipTo(ctx);\n      ctx.clip();\n    },\n\n    /**\n     * Multiply matrix A by matrix B to nest transformations\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a First transformMatrix\n     * @param  {Array} b Second transformMatrix\n     * @param  {Boolean} is2x2 flag to multiply matrices as 2x2 matrices\n     * @return {Array} The product of the two transform matrices\n     */\n    multiplyTransformMatrices: function(a, b, is2x2) {\n      // Matrix multiply a * b\n      return [\n        a[0] * b[0] + a[2] * b[1],\n        a[1] * b[0] + a[3] * b[1],\n        a[0] * b[2] + a[2] * b[3],\n        a[1] * b[2] + a[3] * b[3],\n        is2x2 ? 0 : a[0] * b[4] + a[2] * b[5] + a[4],\n        is2x2 ? 0 : a[1] * b[4] + a[3] * b[5] + a[5]\n      ];\n    },\n\n    /**\n     * Decomposes standard 2x2 matrix into transform componentes\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a transformMatrix\n     * @return {Object} Components of transform\n     */\n    qrDecompose: function(a) {\n      var angle = atan2(a[1], a[0]),\n          denom = pow(a[0], 2) + pow(a[1], 2),\n          scaleX = sqrt(denom),\n          scaleY = (a[0] * a[3] - a[2] * a [1]) / scaleX,\n          skewX = atan2(a[0] * a[2] + a[1] * a [3], denom);\n      return {\n        angle: angle  / PiBy180,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        skewX: skewX / PiBy180,\n        skewY: 0,\n        translateX: a[4],\n        translateY: a[5]\n      };\n    },\n\n    customTransformMatrix: function(scaleX, scaleY, skewX) {\n      var skewMatrixX = [1, 0, abs(Math.tan(skewX * PiBy180)), 1],\n          scaleMatrix = [abs(scaleX), 0, 0, abs(scaleY)];\n      return fabric.util.multiplyTransformMatrices(scaleMatrix, skewMatrixX, true);\n    },\n\n    /**\n     * reset an object transform state to neutral. Top and left are not accounted for\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to transform\n     */\n    resetObjectTransform: function (target) {\n      target.scaleX = 1;\n      target.scaleY = 1;\n      target.skewX = 0;\n      target.skewY = 0;\n      target.flipX = false;\n      target.flipY = false;\n      target.rotate(0);\n    },\n\n    /**\n     * Extract Object transform values\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to read from\n     * @return {Object} Components of transform\n     */\n    saveObjectTransform: function (target) {\n      return {\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        angle: target.angle,\n        left: target.left,\n        flipX: target.flipX,\n        flipY: target.flipY,\n        top: target.top\n      };\n    },\n\n    /**\n     * Returns string representation of function body\n     * @param {Function} fn Function to get body of\n     * @return {String} Function body\n     */\n    getFunctionBody: function(fn) {\n      return (String(fn).match(/function[^{]*\\{([\\s\\S]*)\\}/) || {})[1];\n    },\n\n    /**\n     * Returns true if context has transparent pixel\n     * at specified location (taking tolerance into account)\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x x coordinate\n     * @param {Number} y y coordinate\n     * @param {Number} tolerance Tolerance\n     */\n    isTransparent: function(ctx, x, y, tolerance) {\n\n      // If tolerance is > 0 adjust start coords to take into account.\n      // If moves off Canvas fix to 0\n      if (tolerance > 0) {\n        if (x > tolerance) {\n          x -= tolerance;\n        }\n        else {\n          x = 0;\n        }\n        if (y > tolerance) {\n          y -= tolerance;\n        }\n        else {\n          y = 0;\n        }\n      }\n\n      var _isTransparent = true, i, temp,\n          imageData ,\n          l = imageData.data.length;\n      imageData.crossOrigin = 'anonymous';//add by zhoujun --20190623\n      imageData.onload = function(){\n        ctx.getImageData(x, y, (tolerance * 2) || 1, (tolerance * 2) || 1)\n      }\n      imageData = ctx.getImageData(x, y, (tolerance * 2) || 1, (tolerance * 2) || 1)\n      // Split image data - for tolerance > 1, pixelDataSize = 4;\n      for (i = 3; i < l; i += 4) {\n        temp = imageData.data[i];\n        _isTransparent = temp <= 0;\n        if (_isTransparent === false) {\n          break; // Stop if color found\n        }\n      }\n\n      imageData = null;\n\n      return _isTransparent;\n    },\n\n    /**\n     * Parse preserveAspectRatio attribute from element\n     * @param {string} attribute to be parsed\n     * @return {Object} an object containing align and meetOrSlice attribute\n     */\n    parsePreserveAspectRatioAttribute: function(attribute) {\n      var meetOrSlice = 'meet', alignX = 'Mid', alignY = 'Mid',\n          aspectRatioAttrs = attribute.split(' '), align;\n\n      if (aspectRatioAttrs && aspectRatioAttrs.length) {\n        meetOrSlice = aspectRatioAttrs.pop();\n        if (meetOrSlice !== 'meet' && meetOrSlice !== 'slice') {\n          align = meetOrSlice;\n          meetOrSlice = 'meet';\n        }\n        else if (aspectRatioAttrs.length) {\n          align = aspectRatioAttrs.pop();\n        }\n      }\n      //divide align in alignX and alignY\n      alignX = align !== 'none' ? align.slice(1, 4) : 'none';\n      alignY = align !== 'none' ? align.slice(5, 8) : 'none';\n      return {\n        meetOrSlice: meetOrSlice,\n        alignX: alignX,\n        alignY: alignY\n      };\n    },\n\n    /**\n     * Clear char widths cache for the given font family or all the cache if no\n     * fontFamily is specified.\n     * Use it if you know you are loading fonts in a lazy way and you are not waiting\n     * for custom fonts to load properly when adding text objects to the canvas.\n     * If a text object is added when its own font is not loaded yet, you will get wrong\n     * measurement and so wrong bounding boxes.\n     * After the font cache is cleared, either change the textObject text content or call\n     * initDimensions() to trigger a recalculation\n     * @memberOf fabric.util\n     * @param {String} [fontFamily] font family to clear\n     */\n    clearFabricFontCache: function(fontFamily) {\n      fontFamily = (fontFamily || '').toLowerCase();\n      if (!fontFamily) {\n        fabric.charWidthsCache = { };\n      }\n      else if (fabric.charWidthsCache[fontFamily]) {\n        delete fabric.charWidthsCache[fontFamily];\n      }\n    },\n\n    /**\n     * Given current aspect ratio, determines the max width and height that can\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Number} ar aspect ratio\n     * @param {Number} maximumArea Maximum area you want to achieve\n     * @return {Object.x} Limited dimensions by X\n     * @return {Object.y} Limited dimensions by Y\n     */\n    limitDimsByArea: function(ar, maximumArea) {\n      var roughWidth = Math.sqrt(maximumArea * ar),\n          perfLimitSizeY = Math.floor(maximumArea / roughWidth);\n      return { x: Math.floor(roughWidth), y: perfLimitSizeY };\n    },\n\n    capValue: function(min, value, max) {\n      return Math.max(min, Math.min(value, max));\n    },\n\n    findScaleToFit: function(source, destination) {\n      return Math.min(destination.width / source.width, destination.height / source.height);\n    },\n\n    findScaleToCover: function(source, destination) {\n      return Math.max(destination.width / source.width, destination.height / source.height);\n    }\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n(function() {\n\n  var _join = Array.prototype.join;\n\n  /* Adapted from http://dxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGPathDataParser.cpp\n   * by Andrea Bogazzi code is under MPL. if you don't have a copy of the license you can take it here\n   * http://mozilla.org/MPL/2.0/\n   */\n  function arcToSegments(toX, toY, rx, ry, large, sweep, rotateX) {\n    var argsString = _join.call(arguments);\n    if (fabric.arcToSegmentsCache[argsString]) {\n      return fabric.arcToSegmentsCache[argsString];\n    }\n\n    var PI = Math.PI, th = rotateX * PI / 180,\n        sinTh = fabric.util.sin(th),\n        cosTh = fabric.util.cos(th),\n        fromX = 0, fromY = 0;\n\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n\n    var px = -cosTh * toX * 0.5 - sinTh * toY * 0.5,\n        py = -cosTh * toY * 0.5 + sinTh * toX * 0.5,\n        rx2 = rx * rx, ry2 = ry * ry, py2 = py * py, px2 = px * px,\n        pl = rx2 * ry2 - rx2 * py2 - ry2 * px2,\n        root = 0;\n\n    if (pl < 0) {\n      var s = Math.sqrt(1 - pl / (rx2 * ry2));\n      rx *= s;\n      ry *= s;\n    }\n    else {\n      root = (large === sweep ? -1.0 : 1.0) *\n              Math.sqrt( pl / (rx2 * py2 + ry2 * px2));\n    }\n\n    var cx = root * rx * py / ry,\n        cy = -root * ry * px / rx,\n        cx1 = cosTh * cx - sinTh * cy + toX * 0.5,\n        cy1 = sinTh * cx + cosTh * cy + toY * 0.5,\n        mTheta = calcVectorAngle(1, 0, (px - cx) / rx, (py - cy) / ry),\n        dtheta = calcVectorAngle((px - cx) / rx, (py - cy) / ry, (-px - cx) / rx, (-py - cy) / ry);\n\n    if (sweep === 0 && dtheta > 0) {\n      dtheta -= 2 * PI;\n    }\n    else if (sweep === 1 && dtheta < 0) {\n      dtheta += 2 * PI;\n    }\n\n    // Convert into cubic bezier segments <= 90deg\n    var segments = Math.ceil(Math.abs(dtheta / PI * 2)),\n        result = [], mDelta = dtheta / segments,\n        mT = 8 / 3 * Math.sin(mDelta / 4) * Math.sin(mDelta / 4) / Math.sin(mDelta / 2),\n        th3 = mTheta + mDelta;\n\n    for (var i = 0; i < segments; i++) {\n      result[i] = segmentToBezier(mTheta, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY);\n      fromX = result[i][4];\n      fromY = result[i][5];\n      mTheta = th3;\n      th3 += mDelta;\n    }\n    fabric.arcToSegmentsCache[argsString] = result;\n    return result;\n  }\n\n  function segmentToBezier(th2, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY) {\n    var costh2 = fabric.util.cos(th2),\n        sinth2 = fabric.util.sin(th2),\n        costh3 = fabric.util.cos(th3),\n        sinth3 = fabric.util.sin(th3),\n        toX = cosTh * rx * costh3 - sinTh * ry * sinth3 + cx1,\n        toY = sinTh * rx * costh3 + cosTh * ry * sinth3 + cy1,\n        cp1X = fromX + mT * ( -cosTh * rx * sinth2 - sinTh * ry * costh2),\n        cp1Y = fromY + mT * ( -sinTh * rx * sinth2 + cosTh * ry * costh2),\n        cp2X = toX + mT * ( cosTh * rx * sinth3 + sinTh * ry * costh3),\n        cp2Y = toY + mT * ( sinTh * rx * sinth3 - cosTh * ry * costh3);\n\n    return [\n      cp1X, cp1Y,\n      cp2X, cp2Y,\n      toX, toY\n    ];\n  }\n\n  /*\n   * Private\n   */\n  function calcVectorAngle(ux, uy, vx, vy) {\n    var ta = Math.atan2(uy, ux),\n        tb = Math.atan2(vy, vx);\n    if (tb >= ta) {\n      return tb - ta;\n    }\n    else {\n      return 2 * Math.PI - (ta - tb);\n    }\n  }\n\n  /**\n   * Draws arc\n   * @param {CanvasRenderingContext2D} ctx\n   * @param {Number} fx\n   * @param {Number} fy\n   * @param {Array} coords\n   */\n  fabric.util.drawArc = function(ctx, fx, fy, coords) {\n    var rx = coords[0],\n        ry = coords[1],\n        rot = coords[2],\n        large = coords[3],\n        sweep = coords[4],\n        tx = coords[5],\n        ty = coords[6],\n        segs = [[], [], [], []],\n        segsNorm = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segsNorm.length; i < len; i++) {\n      segs[i][0] = segsNorm[i][0] + fx;\n      segs[i][1] = segsNorm[i][1] + fy;\n      segs[i][2] = segsNorm[i][2] + fx;\n      segs[i][3] = segsNorm[i][3] + fy;\n      segs[i][4] = segsNorm[i][4] + fx;\n      segs[i][5] = segsNorm[i][5] + fy;\n      ctx.bezierCurveTo.apply(ctx, segs[i]);\n    }\n  };\n\n  /**\n   * Calculate bounding box of a elliptic-arc\n   * @param {Number} fx start point of arc\n   * @param {Number} fy\n   * @param {Number} rx horizontal radius\n   * @param {Number} ry vertical radius\n   * @param {Number} rot angle of horizontal axe\n   * @param {Number} large 1 or 0, whatever the arc is the big or the small on the 2 points\n   * @param {Number} sweep 1 or 0, 1 clockwise or counterclockwise direction\n   * @param {Number} tx end point of arc\n   * @param {Number} ty\n   */\n  fabric.util.getBoundsOfArc = function(fx, fy, rx, ry, rot, large, sweep, tx, ty) {\n\n    var fromX = 0, fromY = 0, bound, bounds = [],\n        segs = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segs.length; i < len; i++) {\n      bound = getBoundsOfCurve(fromX, fromY, segs[i][0], segs[i][1], segs[i][2], segs[i][3], segs[i][4], segs[i][5]);\n      bounds.push({ x: bound[0].x + fx, y: bound[0].y + fy });\n      bounds.push({ x: bound[1].x + fx, y: bound[1].y + fy });\n      fromX = segs[i][4];\n      fromY = segs[i][5];\n    }\n    return bounds;\n  };\n\n  /**\n   * Calculate bounding box of a beziercurve\n   * @param {Number} x0 starting point\n   * @param {Number} y0\n   * @param {Number} x1 first control point\n   * @param {Number} y1\n   * @param {Number} x2 secondo control point\n   * @param {Number} y2\n   * @param {Number} x3 end of beizer\n   * @param {Number} y3\n   */\n  // taken from http://jsbin.com/ivomiq/56/edit  no credits available for that.\n  function getBoundsOfCurve(x0, y0, x1, y1, x2, y2, x3, y3) {\n    var argsString;\n    if (fabric.cachesBoundsOfCurve) {\n      argsString = _join.call(arguments);\n      if (fabric.boundsOfCurveCache[argsString]) {\n        return fabric.boundsOfCurveCache[argsString];\n      }\n    }\n\n    var sqrt = Math.sqrt,\n        min = Math.min, max = Math.max,\n        abs = Math.abs, tvalues = [],\n        bounds = [[], []],\n        a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n\n    b = 6 * x0 - 12 * x1 + 6 * x2;\n    a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n    c = 3 * x1 - 3 * x0;\n\n    for (var i = 0; i < 2; ++i) {\n      if (i > 0) {\n        b = 6 * y0 - 12 * y1 + 6 * y2;\n        a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n        c = 3 * y1 - 3 * y0;\n      }\n\n      if (abs(a) < 1e-12) {\n        if (abs(b) < 1e-12) {\n          continue;\n        }\n        t = -c / b;\n        if (0 < t && t < 1) {\n          tvalues.push(t);\n        }\n        continue;\n      }\n      b2ac = b * b - 4 * c * a;\n      if (b2ac < 0) {\n        continue;\n      }\n      sqrtb2ac = sqrt(b2ac);\n      t1 = (-b + sqrtb2ac) / (2 * a);\n      if (0 < t1 && t1 < 1) {\n        tvalues.push(t1);\n      }\n      t2 = (-b - sqrtb2ac) / (2 * a);\n      if (0 < t2 && t2 < 1) {\n        tvalues.push(t2);\n      }\n    }\n\n    var x, y, j = tvalues.length, jlen = j, mt;\n    while (j--) {\n      t = tvalues[j];\n      mt = 1 - t;\n      x = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n      bounds[0][j] = x;\n\n      y = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n      bounds[1][j] = y;\n    }\n\n    bounds[0][jlen] = x0;\n    bounds[1][jlen] = y0;\n    bounds[0][jlen + 1] = x3;\n    bounds[1][jlen + 1] = y3;\n    var result = [\n      {\n        x: min.apply(null, bounds[0]),\n        y: min.apply(null, bounds[1])\n      },\n      {\n        x: max.apply(null, bounds[0]),\n        y: max.apply(null, bounds[1])\n      }\n    ];\n    if (fabric.cachesBoundsOfCurve) {\n      fabric.boundsOfCurveCache[argsString] = result;\n    }\n    return result;\n  }\n\n  fabric.util.getBoundsOfCurve = getBoundsOfCurve;\n\n})();\n(function() {\n\n  var slice = Array.prototype.slice;\n\n  /**\n   * Invokes method on all items in a given array\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} method Name of a method to invoke\n   * @return {Array}\n   */\n  function invoke(array, method) {\n    var args = slice.call(arguments, 2), result = [];\n    for (var i = 0, len = array.length; i < len; i++) {\n      result[i] = args.length ? array[i][method].apply(array[i], args) : array[i][method].call(array[i]);\n    }\n    return result;\n  }\n\n  /**\n   * Finds maximum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function max(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 >= value2;\n    });\n  }\n\n  /**\n   * Finds minimum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function min(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 < value2;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function fill(array, value) {\n    var k = array.length;\n    while (k--) {\n      array[k] = value;\n    }\n    return array;\n  }\n\n  /**\n   * @private\n   */\n  function find(array, byProperty, condition) {\n    if (!array || array.length === 0) {\n      return;\n    }\n\n    var i = array.length - 1,\n        result = byProperty ? array[i][byProperty] : array[i];\n    if (byProperty) {\n      while (i--) {\n        if (condition(array[i][byProperty], result)) {\n          result = array[i][byProperty];\n        }\n      }\n    }\n    else {\n      while (i--) {\n        if (condition(array[i], result)) {\n          result = array[i];\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @namespace fabric.util.array\n   */\n  fabric.util.array = {\n    fill: fill,\n    invoke: invoke,\n    min: min,\n    max: max\n  };\n\n})();\n(function() {\n  /**\n   * Copies all enumerable properties of one js object to another\n   * this does not and cannot compete with generic utils.\n   * Does not clone or extend fabric.Object subclasses.\n   * This is mostly for internal use and has extra handling for fabricJS objects\n   * it skips the canvas property in deep cloning.\n   * @memberOf fabric.util.object\n   * @param {Object} destination Where to copy to\n   * @param {Object} source Where to copy from\n   * @return {Object}\n   */\n\n  function extend(destination, source, deep) {\n    // JScript DontEnum bug is not taken care of\n    // the deep clone is for internal use, is not meant to avoid\n    // javascript traps or cloning html element or self referenced objects.\n    if (deep) {\n      if (!fabric.isLikelyNode && source instanceof Element) {\n        // avoid cloning deep images, canvases,\n        destination = source;\n      }\n      else if (source instanceof Array) {\n        destination = [];\n        for (var i = 0, len = source.length; i < len; i++) {\n          destination[i] = extend({ }, source[i], deep);\n        }\n      }\n      else if (source && typeof source === 'object') {\n        for (var property in source) {\n          if (property === 'canvas') {\n            destination[property] = extend({ }, source[property]);\n          }\n          else if (source.hasOwnProperty(property)) {\n            destination[property] = extend({ }, source[property], deep);\n          }\n        }\n      }\n      else {\n        // this sounds odd for an extend but is ok for recursive use\n        destination = source;\n      }\n    }\n    else {\n      for (var property in source) {\n        destination[property] = source[property];\n      }\n    }\n    return destination;\n  }\n\n  /**\n   * Creates an empty object and copies all enumerable properties of another object to it\n   * @memberOf fabric.util.object\n   * TODO: this function return an empty object if you try to clone null\n   * @param {Object} object Object to clone\n   * @return {Object}\n   */\n  function clone(object, deep) {\n    return extend({ }, object, deep);\n  }\n\n  /** @namespace fabric.util.object */\n  fabric.util.object = {\n    extend: extend,\n    clone: clone\n  };\n  fabric.util.object.extend(fabric.util, fabric.Observable);\n})();\n(function() {\n\n  /**\n   * Camelizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to camelize\n   * @return {String} Camelized version of a string\n   */\n  function camelize(string) {\n    return string.replace(/-+(.)?/g, function(match, character) {\n      return character ? character.toUpperCase() : '';\n    });\n  }\n\n  /**\n   * Capitalizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to capitalize\n   * @param {Boolean} [firstLetterOnly] If true only first letter is capitalized\n   * and other letters stay untouched, if false first letter is capitalized\n   * and other letters are converted to lowercase.\n   * @return {String} Capitalized version of a string\n   */\n  function capitalize(string, firstLetterOnly) {\n    return string.charAt(0).toUpperCase() +\n      (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());\n  }\n\n  /**\n   * Escapes XML in a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to escape\n   * @return {String} Escaped version of a string\n   */\n  function escapeXml(string) {\n    return string.replace(/&/g, '&amp;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&apos;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;');\n  }\n\n  /**\n   * Divide a string in the user perceived single units\n   * @memberOf fabric.util.string\n   * @param {String} textstring String to escape\n   * @return {Array} array containing the graphemes\n   */\n  function graphemeSplit(textstring) {\n    var i = 0, chr, graphemes = [];\n    for (i = 0, chr; i < textstring.length; i++) {\n      if ((chr = getWholeChar(textstring, i)) === false) {\n        continue;\n      }\n      graphemes.push(chr);\n    }\n    return graphemes;\n  }\n\n  // taken from mdn in the charAt doc page.\n  function getWholeChar(str, i) {\n    var code = str.charCodeAt(i);\n\n    if (isNaN(code)) {\n      return ''; // Position not found\n    }\n    if (code < 0xD800 || code > 0xDFFF) {\n      return str.charAt(i);\n    }\n\n    // High surrogate (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xD800 <= code && code <= 0xDBFF) {\n      if (str.length <= (i + 1)) {\n        throw 'High surrogate without following low surrogate';\n      }\n      var next = str.charCodeAt(i + 1);\n      if (0xDC00 > next || next > 0xDFFF) {\n        throw 'High surrogate without following low surrogate';\n      }\n      return str.charAt(i) + str.charAt(i + 1);\n    }\n    // Low surrogate (0xDC00 <= code && code <= 0xDFFF)\n    if (i === 0) {\n      throw 'Low surrogate without preceding high surrogate';\n    }\n    var prev = str.charCodeAt(i - 1);\n\n    // (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xD800 > prev || prev > 0xDBFF) {\n      throw 'Low surrogate without preceding high surrogate';\n    }\n    // We can pass over low surrogates now as the second component\n    // in a pair which we have already processed\n    return false;\n  }\n\n\n  /**\n   * String utilities\n   * @namespace fabric.util.string\n   */\n  fabric.util.string = {\n    camelize: camelize,\n    capitalize: capitalize,\n    escapeXml: escapeXml,\n    graphemeSplit: graphemeSplit\n  };\n})();\n(function() {\n\n  var slice = Array.prototype.slice, emptyFunction = function() { },\n\n      IS_DONTENUM_BUGGY = (function() {\n        for (var p in { toString: 1 }) {\n          if (p === 'toString') {\n            return false;\n          }\n        }\n        return true;\n      })(),\n\n      /** @ignore */\n      addMethods = function(klass, source, parent) {\n        for (var property in source) {\n\n          if (property in klass.prototype &&\n              typeof klass.prototype[property] === 'function' &&\n              (source[property] + '').indexOf('callSuper') > -1) {\n\n            klass.prototype[property] = (function(property) {\n              return function() {\n\n                var superclass = this.constructor.superclass;\n                this.constructor.superclass = parent;\n                var returnValue = source[property].apply(this, arguments);\n                this.constructor.superclass = superclass;\n\n                if (property !== 'initialize') {\n                  return returnValue;\n                }\n              };\n            })(property);\n          }\n          else {\n            klass.prototype[property] = source[property];\n          }\n\n          if (IS_DONTENUM_BUGGY) {\n            if (source.toString !== Object.prototype.toString) {\n              klass.prototype.toString = source.toString;\n            }\n            if (source.valueOf !== Object.prototype.valueOf) {\n              klass.prototype.valueOf = source.valueOf;\n            }\n          }\n        }\n      };\n\n  function Subclass() { }\n\n  function callSuper(methodName) {\n    var parentMethod = null,\n        _this = this;\n\n    // climb prototype chain to find method not equal to callee's method\n    while (_this.constructor.superclass) {\n      var superClassMethod = _this.constructor.superclass.prototype[methodName];\n      if (_this[methodName] !== superClassMethod) {\n        parentMethod = superClassMethod;\n        break;\n      }\n      // eslint-disable-next-line\n      _this = _this.constructor.superclass.prototype;\n    }\n\n    if (!parentMethod) {\n      return console.log('tried to callSuper ' + methodName + ', method not found in prototype chain', this);\n    }\n\n    return (arguments.length > 1)\n      ? parentMethod.apply(this, slice.call(arguments, 1))\n      : parentMethod.call(this);\n  }\n\n  /**\n   * Helper for creation of \"classes\".\n   * @memberOf fabric.util\n   * @param {Function} [parent] optional \"Class\" to inherit from\n   * @param {Object} [properties] Properties shared by all instances of this class\n   *                  (be careful modifying objects defined here as this would affect all instances)\n   */\n  function createClass() {\n    var parent = null,\n        properties = slice.call(arguments, 0);\n\n    if (typeof properties[0] === 'function') {\n      parent = properties.shift();\n    }\n    function klass() {\n      this.initialize.apply(this, arguments);\n    }\n\n    klass.superclass = parent;\n    klass.subclasses = [];\n\n    if (parent) {\n      Subclass.prototype = parent.prototype;\n      klass.prototype = new Subclass();\n      parent.subclasses.push(klass);\n    }\n    for (var i = 0, length = properties.length; i < length; i++) {\n      addMethods(klass, properties[i], parent);\n    }\n    if (!klass.prototype.initialize) {\n      klass.prototype.initialize = emptyFunction;\n    }\n    klass.prototype.constructor = klass;\n    klass.prototype.callSuper = callSuper;\n    return klass;\n  }\n\n  fabric.util.createClass = createClass;\n})();\n(function () {\n\n  var unknown = 'unknown';\n\n  /* EVENT HANDLING */\n\n  function areHostMethods(object) {\n    var methodNames = Array.prototype.slice.call(arguments, 1),\n        t, i, len = methodNames.length;\n    for (i = 0; i < len; i++) {\n      t = typeof object[methodNames[i]];\n      if (!(/^(?:function|object|unknown)$/).test(t)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /** @ignore */\n  var getElement,\n      setElement,\n      getUniqueId = (function () {\n        var uid = 0;\n        return function (element) {\n          return element.__uniqueID || (element.__uniqueID = 'uniqueID__' + uid++);\n        };\n      })();\n\n  (function () {\n    var elements = { };\n    /** @ignore */\n    getElement = function (uid) {\n      return elements[uid];\n    };\n    /** @ignore */\n    setElement = function (uid, element) {\n      elements[uid] = element;\n    };\n  })();\n\n  function createListener(uid, handler) {\n    return {\n      handler: handler,\n      wrappedHandler: createWrappedHandler(uid, handler)\n    };\n  }\n\n  function createWrappedHandler(uid, handler) {\n    return function (e) {\n      handler.call(getElement(uid), e || fabric.window.event);\n    };\n  }\n\n  function createDispatcher(uid, eventName) {\n    return function (e) {\n      if (handlers[uid] && handlers[uid][eventName]) {\n        var handlersForEvent = handlers[uid][eventName];\n        for (var i = 0, len = handlersForEvent.length; i < len; i++) {\n          handlersForEvent[i].call(this, e || fabric.window.event);\n        }\n      }\n    };\n  }\n\n  var shouldUseAddListenerRemoveListener = (\n        areHostMethods(fabric.document.documentElement, 'addEventListener', 'removeEventListener') &&\n        areHostMethods(fabric.window, 'addEventListener', 'removeEventListener')),\n\n      shouldUseAttachEventDetachEvent = (\n        areHostMethods(fabric.document.documentElement, 'attachEvent', 'detachEvent') &&\n        areHostMethods(fabric.window, 'attachEvent', 'detachEvent')),\n\n      // IE branch\n      listeners = { },\n\n      // DOM L0 branch\n      handlers = { },\n\n      addListener, removeListener;\n\n  if (shouldUseAddListenerRemoveListener) {\n    /** @ignore */\n    addListener = function (element, eventName, handler, options) {\n      // since ie10 or ie9 can use addEventListener but they do not support options, i need to check\n      element && element.addEventListener(eventName, handler, shouldUseAttachEventDetachEvent ? false : options);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler, options) {\n      element && element.removeEventListener(eventName, handler, shouldUseAttachEventDetachEvent ? false : options);\n    };\n  }\n\n  else if (shouldUseAttachEventDetachEvent) {\n    /** @ignore */\n    addListener = function (element, eventName, handler) {\n      if (!element) {\n        return;\n      }\n      var uid = getUniqueId(element);\n      setElement(uid, element);\n      if (!listeners[uid]) {\n        listeners[uid] = { };\n      }\n      if (!listeners[uid][eventName]) {\n        listeners[uid][eventName] = [];\n\n      }\n      var listener = createListener(uid, handler);\n      listeners[uid][eventName].push(listener);\n      element.attachEvent('on' + eventName, listener.wrappedHandler);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler) {\n      if (!element) {\n        return;\n      }\n      var uid = getUniqueId(element), listener;\n      if (listeners[uid] && listeners[uid][eventName]) {\n        for (var i = 0, len = listeners[uid][eventName].length; i < len; i++) {\n          listener = listeners[uid][eventName][i];\n          if (listener && listener.handler === handler) {\n            element.detachEvent('on' + eventName, listener.wrappedHandler);\n            listeners[uid][eventName][i] = null;\n          }\n        }\n      }\n    };\n  }\n  else {\n    /** @ignore */\n    addListener = function (element, eventName, handler) {\n      if (!element) {\n        return;\n      }\n      var uid = getUniqueId(element);\n      if (!handlers[uid]) {\n        handlers[uid] = { };\n      }\n      if (!handlers[uid][eventName]) {\n        handlers[uid][eventName] = [];\n        var existingHandler = element['on' + eventName];\n        if (existingHandler) {\n          handlers[uid][eventName].push(existingHandler);\n        }\n        element['on' + eventName] = createDispatcher(uid, eventName);\n      }\n      handlers[uid][eventName].push(handler);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler) {\n      if (!element) {\n        return;\n      }\n      var uid = getUniqueId(element);\n      if (handlers[uid] && handlers[uid][eventName]) {\n        var handlersForEvent = handlers[uid][eventName];\n        for (var i = 0, len = handlersForEvent.length; i < len; i++) {\n          if (handlersForEvent[i] === handler) {\n            handlersForEvent.splice(i, 1);\n          }\n        }\n      }\n    };\n  }\n\n  /**\n   * Adds an event listener to an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.addListener = addListener;\n\n  /**\n   * Removes an event listener from an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.removeListener = removeListener;\n\n  /**\n   * Cross-browser wrapper for getting event's coordinates\n   * @memberOf fabric.util\n   * @param {Event} event Event object\n   */\n  function getPointer(event) {\n    event || (event = fabric.window.event);\n\n    var element = event.target ||\n                  (typeof event.srcElement !== unknown ? event.srcElement : null),\n\n        scroll = fabric.util.getScrollLeftTop(element);\n    return {\n      x: pointerX(event) + scroll.left,\n      y: pointerY(event) + scroll.top\n    };\n  }\n\n  var pointerX = function(event) {\n        return event.clientX;\n      },\n\n      pointerY = function(event) {\n        return event.clientY;\n      };\n\n  function _getPointer(event, pageProp, clientProp) {\n    var touchProp = event.type === 'touchend' ? 'changedTouches' : 'touches';\n    var pointer, eventTouchProp = event[touchProp];\n\n    if (eventTouchProp && eventTouchProp[0]) {\n      pointer = eventTouchProp[0][clientProp];\n    }\n\n    if (typeof pointer === 'undefined') {\n      pointer = event[clientProp];\n    }\n\n    return pointer;\n  }\n\n  if (fabric.isTouchSupported) {\n    pointerX = function(event) {\n      return _getPointer(event, 'pageX', 'clientX');\n    };\n    pointerY = function(event) {\n      return _getPointer(event, 'pageY', 'clientY');\n    };\n  }\n\n  fabric.util.getPointer = getPointer;\n\n})();\n(function () {\n\n  /**\n   * Cross-browser wrapper for setting element's style\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {HTMLElement} Element that was passed as a first argument\n   */\n  function setStyle(element, styles) {\n    var elementStyle = element.style;\n    if (!elementStyle) {\n      return element;\n    }\n    if (typeof styles === 'string') {\n      element.style.cssText += ';' + styles;\n      return styles.indexOf('opacity') > -1\n        ? setOpacity(element, styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1])\n        : element;\n    }\n    for (var property in styles) {\n      if (property === 'opacity') {\n        setOpacity(element, styles[property]);\n      }\n      else {\n        var normalizedProperty = (property === 'float' || property === 'cssFloat')\n          ? (typeof elementStyle.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat')\n          : property;\n        elementStyle[normalizedProperty] = styles[property];\n      }\n    }\n    return element;\n  }\n\n  var parseEl = fabric.document.createElement('div'),\n      supportsOpacity = typeof parseEl.style.opacity === 'string',\n      supportsFilters = typeof parseEl.style.filter === 'string',\n      reOpacity = /alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,\n\n      /** @ignore */\n      setOpacity = function (element) { return element; };\n\n  if (supportsOpacity) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      element.style.opacity = value;\n      return element;\n    };\n  }\n  else if (supportsFilters) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      var es = element.style;\n      if (element.currentStyle && !element.currentStyle.hasLayout) {\n        es.zoom = 1;\n      }\n      if (reOpacity.test(es.filter)) {\n        value = value >= 0.9999 ? '' : ('alpha(opacity=' + (value * 100) + ')');\n        es.filter = es.filter.replace(reOpacity, value);\n      }\n      else {\n        es.filter += ' alpha(opacity=' + (value * 100) + ')';\n      }\n      return element;\n    };\n  }\n\n  fabric.util.setStyle = setStyle;\n\n})();\n(function() {\n\n  var _slice = Array.prototype.slice;\n\n  /**\n   * Takes id and returns an element with that id (if one exists in a document)\n   * @memberOf fabric.util\n   * @param {String|HTMLElement} id\n   * @return {HTMLElement|null}\n   */\n  function getById(id) {\n    return typeof id === 'string' ? fabric.document.getElementById(id) : id;\n  }\n\n  var sliceCanConvertNodelists,\n      /**\n       * Converts an array-like object (e.g. arguments or NodeList) to an array\n       * @memberOf fabric.util\n       * @param {Object} arrayLike\n       * @return {Array}\n       */\n      toArray = function(arrayLike) {\n        return _slice.call(arrayLike, 0);\n      };\n\n  try {\n    sliceCanConvertNodelists = toArray(fabric.document.childNodes) instanceof Array;\n  }\n  catch (err) { }\n\n  if (!sliceCanConvertNodelists) {\n    toArray = function(arrayLike) {\n      var arr = new Array(arrayLike.length), i = arrayLike.length;\n      while (i--) {\n        arr[i] = arrayLike[i];\n      }\n      return arr;\n    };\n  }\n\n  /**\n   * Creates specified element with specified attributes\n   * @memberOf fabric.util\n   * @param {String} tagName Type of an element to create\n   * @param {Object} [attributes] Attributes to set on an element\n   * @return {HTMLElement} Newly created element\n   */\n  function makeElement(tagName, attributes) {\n    var el = fabric.document.createElement(tagName);\n    for (var prop in attributes) {\n      if (prop === 'class') {\n        el.className = attributes[prop];\n      }\n      else if (prop === 'for') {\n        el.htmlFor = attributes[prop];\n      }\n      else {\n        el.setAttribute(prop, attributes[prop]);\n      }\n    }\n    return el;\n  }\n\n  /**\n   * Adds class to an element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to add class to\n   * @param {String} className Class to add to an element\n   */\n  function addClass(element, className) {\n    if (element && (' ' + element.className + ' ').indexOf(' ' + className + ' ') === -1) {\n      element.className += (element.className ? ' ' : '') + className;\n    }\n  }\n\n  /**\n   * Wraps element with another element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to wrap\n   * @param {HTMLElement|String} wrapper Element to wrap with\n   * @param {Object} [attributes] Attributes to set on a wrapper\n   * @return {HTMLElement} wrapper\n   */\n  function wrapElement(element, wrapper, attributes) {\n    if (typeof wrapper === 'string') {\n      wrapper = makeElement(wrapper, attributes);\n    }\n    if (element.parentNode) {\n      element.parentNode.replaceChild(wrapper, element);\n    }\n    wrapper.appendChild(element);\n    return wrapper;\n  }\n\n  /**\n   * Returns element scroll offsets\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to operate on\n   * @return {Object} Object with left/top values\n   */\n  function getScrollLeftTop(element) {\n\n    var left = 0,\n        top = 0,\n        docElement = fabric.document.documentElement,\n        body = fabric.document.body || {\n          scrollLeft: 0, scrollTop: 0\n        };\n\n    // While loop checks (and then sets element to) .parentNode OR .host\n    //  to account for ShadowDOM. We still want to traverse up out of ShadowDOM,\n    //  but the .parentNode of a root ShadowDOM node will always be null, instead\n    //  it should be accessed through .host. See http://stackoverflow.com/a/24765528/4383938\n    while (element && (element.parentNode || element.host)) {\n\n      // Set element to element parent, or 'host' in case of ShadowDOM\n      element = element.parentNode || element.host;\n\n      if (element === fabric.document) {\n        left = body.scrollLeft || docElement.scrollLeft || 0;\n        top = body.scrollTop ||  docElement.scrollTop || 0;\n      }\n      else {\n        left += element.scrollLeft || 0;\n        top += element.scrollTop || 0;\n      }\n\n      if (element.nodeType === 1 && element.style.position === 'fixed') {\n        break;\n      }\n    }\n\n    return { left: left, top: top };\n  }\n\n  /**\n   * Returns offset for a given element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get offset for\n   * @return {Object} Object with \"left\" and \"top\" properties\n   */\n  function getElementOffset(element) {\n    var docElem,\n        doc = element && element.ownerDocument,\n        box = { left: 0, top: 0 },\n        offset = { left: 0, top: 0 },\n        scrollLeftTop,\n        offsetAttributes = {\n          borderLeftWidth: 'left',\n          borderTopWidth:  'top',\n          paddingLeft:     'left',\n          paddingTop:      'top'\n        };\n\n    if (!doc) {\n      return offset;\n    }\n\n    for (var attr in offsetAttributes) {\n      offset[offsetAttributes[attr]] += parseInt(getElementStyle(element, attr), 10) || 0;\n    }\n\n    docElem = doc.documentElement;\n    if ( typeof element.getBoundingClientRect !== 'undefined' ) {\n      box = element.getBoundingClientRect();\n    }\n\n    scrollLeftTop = getScrollLeftTop(element);\n\n    return {\n      left: box.left + scrollLeftTop.left - (docElem.clientLeft || 0) + offset.left,\n      top: box.top + scrollLeftTop.top - (docElem.clientTop || 0)  + offset.top\n    };\n  }\n\n  /**\n   * Returns style attribute value of a given element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get style attribute for\n   * @param {String} attr Style attribute to get for element\n   * @return {String} Style attribute value of the given element.\n   */\n  var getElementStyle;\n  if (fabric.document.defaultView && fabric.document.defaultView.getComputedStyle) {\n    getElementStyle = function(element, attr) {\n      var style = fabric.document.defaultView.getComputedStyle(element, null);\n      return style ? style[attr] : undefined;\n    };\n  }\n  else {\n    getElementStyle = function(element, attr) {\n      var value = element.style[attr];\n      if (!value && element.currentStyle) {\n        value = element.currentStyle[attr];\n      }\n      return value;\n    };\n  }\n\n  (function () {\n    var style = fabric.document.documentElement.style,\n        selectProp = 'userSelect' in style\n          ? 'userSelect'\n          : 'MozUserSelect' in style\n            ? 'MozUserSelect'\n            : 'WebkitUserSelect' in style\n              ? 'WebkitUserSelect'\n              : 'KhtmlUserSelect' in style\n                ? 'KhtmlUserSelect'\n                : '';\n\n    /**\n     * Makes element unselectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make unselectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementUnselectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = fabric.util.falseFunction;\n      }\n      if (selectProp) {\n        element.style[selectProp] = 'none';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = 'on';\n      }\n      return element;\n    }\n\n    /**\n     * Makes element selectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make selectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementSelectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = null;\n      }\n      if (selectProp) {\n        element.style[selectProp] = '';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = '';\n      }\n      return element;\n    }\n\n    fabric.util.makeElementUnselectable = makeElementUnselectable;\n    fabric.util.makeElementSelectable = makeElementSelectable;\n  })();\n\n  (function() {\n\n    /**\n     * Inserts a script element with a given url into a document; invokes callback, when that script is finished loading\n     * @memberOf fabric.util\n     * @param {String} url URL of a script to load\n     * @param {Function} callback Callback to execute when script is finished loading\n     */\n    function getScript(url, callback) {\n      var headEl = fabric.document.getElementsByTagName('head')[0],\n          scriptEl = fabric.document.createElement('script'),\n          loading = true;\n\n      /** @ignore */\n      scriptEl.onload = /** @ignore */ scriptEl.onreadystatechange = function(e) {\n        if (loading) {\n          if (typeof this.readyState === 'string' &&\n              this.readyState !== 'loaded' &&\n              this.readyState !== 'complete') {\n            return;\n          }\n          loading = false;\n          callback(e || fabric.window.event);\n          scriptEl = scriptEl.onload = scriptEl.onreadystatechange = null;\n        }\n      };\n      scriptEl.src = url;\n      headEl.appendChild(scriptEl);\n      // causes issue in Opera\n      // headEl.removeChild(scriptEl);\n    }\n\n    fabric.util.getScript = getScript;\n  })();\n\n  function getNodeCanvas(element) {\n    var impl = fabric.jsdomImplForWrapper(element);\n    return impl._canvas || impl._image;\n  };\n\n  function cleanUpJsdomNode(element) {\n    if (!fabric.isLikelyNode) {\n      return;\n    }\n    var impl = fabric.jsdomImplForWrapper(element);\n    if (impl) {\n      impl._image = null;\n      impl._canvas = null;\n      // unsure if necessary\n      impl._currentSrc = null;\n      impl._attributes = null;\n      impl._classList = null;\n    }\n  }\n\n  fabric.util.getById = getById;\n  fabric.util.toArray = toArray;\n  fabric.util.makeElement = makeElement;\n  fabric.util.addClass = addClass;\n  fabric.util.wrapElement = wrapElement;\n  fabric.util.getScrollLeftTop = getScrollLeftTop;\n  fabric.util.getElementOffset = getElementOffset;\n  fabric.util.getElementStyle = getElementStyle;\n  fabric.util.getNodeCanvas = getNodeCanvas;\n  fabric.util.cleanUpJsdomNode = cleanUpJsdomNode;\n\n})();\n(function() {\n\n  function addParamToUrl(url, param) {\n    return url + (/\\?/.test(url) ? '&' : '?') + param;\n  }\n\n  function emptyFn() { }\n\n  /**\n   * Cross-browser abstraction for sending XMLHttpRequest\n   * @memberOf fabric.util\n   * @param {String} url URL to send XMLHttpRequest to\n   * @param {Object} [options] Options object\n   * @param {String} [options.method=\"GET\"]\n   * @param {String} [options.parameters] parameters to append to url in GET or in body\n   * @param {String} [options.body] body to send with POST or PUT request\n   * @param {Function} options.onComplete Callback to invoke when request is completed\n   * @return {XMLHttpRequest} request\n   */\n  function request(url, options) {\n    options || (options = { });\n\n    var method = options.method ? options.method.toUpperCase() : 'GET',\n        onComplete = options.onComplete || function() { },\n        xhr = new fabric.window.XMLHttpRequest(),\n        body = options.body || options.parameters;\n\n    /** @ignore */\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === 4) {\n        onComplete(xhr);\n        xhr.onreadystatechange = emptyFn;\n      }\n    };\n\n    if (method === 'GET') {\n      body = null;\n      if (typeof options.parameters === 'string') {\n        url = addParamToUrl(url, options.parameters);\n      }\n    }\n\n    xhr.open(method, url, true);\n\n    if (method === 'POST' || method === 'PUT') {\n      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n\n    xhr.send(body);\n    return xhr;\n  }\n\n  fabric.util.request = request;\n})();\n/**\n * Wrapper around `console.log` (when available)\n * @param {*} [values] Values to log\n */\nfabric.log = function() { };\n\n/**\n * Wrapper around `console.warn` (when available)\n * @param {*} [values] Values to log as a warning\n */\nfabric.warn = function() { };\n\n/* eslint-disable */\nif (typeof console !== 'undefined') {\n\n  ['log', 'warn'].forEach(function(methodName) {\n\n    if (typeof console[methodName] !== 'undefined' &&\n        typeof console[methodName].apply === 'function') {\n\n      fabric[methodName] = function() {\n        return console[methodName].apply(console, arguments);\n      };\n    }\n  });\n}\n/* eslint-enable */\n(function() {\n\n  function noop() {\n    return false;\n  }\n\n  /**\n   * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Number} [options.startValue=0] Starting value\n   * @param {Number} [options.endValue=100] Ending value\n   * @param {Number} [options.byValue=100] Value to modify the property by\n   * @param {Function} [options.easing] Easing function\n   * @param {Number} [options.duration=500] Duration of change (in ms)\n   */\n  function animate(options) {\n\n    requestAnimFrame(function(timestamp) {\n      options || (options = { });\n\n      var start = timestamp || +new Date(),\n          duration = options.duration || 500,\n          finish = start + duration, time,\n          onChange = options.onChange || noop,\n          abort = options.abort || noop,\n          onComplete = options.onComplete || noop,\n          easing = options.easing || function(t, b, c, d) {return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;},\n          startValue = 'startValue' in options ? options.startValue : 0,\n          endValue = 'endValue' in options ? options.endValue : 100,\n          byValue = options.byValue || endValue - startValue;\n\n      options.onStart && options.onStart();\n\n      (function tick(ticktime) {\n        if (abort()) {\n          onComplete(endValue, 1, 1);\n          return;\n        }\n        time = ticktime || +new Date();\n        var currentTime = time > finish ? duration : (time - start),\n            timePerc = currentTime / duration,\n            current = easing(currentTime, startValue, byValue, duration),\n            valuePerc = Math.abs((current - startValue) / byValue);\n        onChange(current, valuePerc, timePerc);\n        if (time > finish) {\n          options.onComplete && options.onComplete();\n          return;\n        }\n        requestAnimFrame(tick);\n      })(start);\n    });\n\n  }\n\n  var _requestAnimFrame = fabric.window.requestAnimationFrame       ||\n                          fabric.window.webkitRequestAnimationFrame ||\n                          fabric.window.mozRequestAnimationFrame    ||\n                          fabric.window.oRequestAnimationFrame      ||\n                          fabric.window.msRequestAnimationFrame     ||\n                          function(callback) {\n                            return fabric.window.setTimeout(callback, 1000 / 60);\n                          };\n\n  var _cancelAnimFrame = fabric.window.cancelAnimationFrame || fabric.window.clearTimeout;\n\n  /**\n   * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   * In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method\n   * @memberOf fabric.util\n   * @param {Function} callback Callback to invoke\n   * @param {DOMElement} element optional Element to associate with animation\n   */\n  function requestAnimFrame() {\n    return _requestAnimFrame.apply(fabric.window, arguments);\n  }\n\n  function cancelAnimFrame() {\n    return _cancelAnimFrame.apply(fabric.window, arguments);\n  }\n\n  fabric.util.animate = animate;\n  fabric.util.requestAnimFrame = requestAnimFrame;\n  fabric.util.cancelAnimFrame = cancelAnimFrame;\n})();\n(function() {\n  // Calculate an in-between color. Returns a \"rgba()\" string.\n  // Credit: Edwin Martin <edwin@bitstorm.org>\n  //         http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js\n  function calculateColor(begin, end, pos) {\n    var color = 'rgba('\n        + parseInt((begin[0] + pos * (end[0] - begin[0])), 10) + ','\n        + parseInt((begin[1] + pos * (end[1] - begin[1])), 10) + ','\n        + parseInt((begin[2] + pos * (end[2] - begin[2])), 10);\n\n    color += ',' + (begin && end ? parseFloat(begin[3] + pos * (end[3] - begin[3])) : 1);\n    color += ')';\n    return color;\n  }\n\n  /**\n   * Changes the color from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {String} fromColor The starting color in hex or rgb(a) format.\n   * @param {String} toColor The starting color in hex or rgb(a) format.\n   * @param {Number} [duration] Duration of change (in ms).\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Function} [options.colorEasing] Easing function. Note that this function only take two arguments (currentTime, duration). Thus the regular animation easing functions cannot be used.\n   */\n  function animateColor(fromColor, toColor, duration, options) {\n    var startColor = new fabric.Color(fromColor).getSource(),\n        endColor = new fabric.Color(toColor).getSource();\n\n    options = options || {};\n\n    fabric.util.animate(fabric.util.object.extend(options, {\n      duration: duration || 500,\n      startValue: startColor,\n      endValue: endColor,\n      byValue: endColor,\n      easing: function (currentTime, startValue, byValue, duration) {\n        var posValue = options.colorEasing\n          ? options.colorEasing(currentTime, duration)\n          : 1 - Math.cos(currentTime / duration * (Math.PI / 2));\n        return calculateColor(startValue, byValue, posValue);\n      }\n    }));\n  }\n\n  fabric.util.animateColor = animateColor;\n\n})();\n(function() {\n\n  function normalize(a, c, p, s) {\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    }\n    else {\n      //handle the 0/0 case:\n      if (c === 0 && a === 0) {\n        s = p / (2 * Math.PI) * Math.asin(1);\n      }\n      else {\n        s = p / (2 * Math.PI) * Math.asin(c / a);\n      }\n    }\n    return { a: a, c: c, p: p, s: s };\n  }\n\n  function elastic(opts, t, d) {\n    return opts.a *\n      Math.pow(2, 10 * (t -= 1)) *\n      Math.sin( (t * d - opts.s) * (2 * Math.PI) / opts.p );\n  }\n\n  /**\n   * Cubic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCubic(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t + 1) + b;\n  }\n\n  /**\n   * Cubic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCubic(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t + 2) + b;\n  }\n\n  /**\n   * Quartic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuart(t, b, c, d) {\n    return c * (t /= d) * t * t * t + b;\n  }\n\n  /**\n   * Quartic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuart(t, b, c, d) {\n    return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n  }\n\n  /**\n   * Quartic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuart(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t + b;\n    }\n    return -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n  }\n\n  /**\n   * Quintic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuint(t, b, c, d) {\n    return c * (t /= d) * t * t * t * t + b;\n  }\n\n  /**\n   * Quintic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuint(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n  }\n\n  /**\n   * Quintic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuint(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n  }\n\n  /**\n   * Sinusoidal easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInSine(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Sinusoidal easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutSine(t, b, c, d) {\n    return c * Math.sin(t / d * (Math.PI / 2)) + b;\n  }\n\n  /**\n   * Sinusoidal easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutSine(t, b, c, d) {\n    return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n  }\n\n  /**\n   * Exponential easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInExpo(t, b, c, d) {\n    return (t === 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n  }\n\n  /**\n   * Exponential easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutExpo(t, b, c, d) {\n    return (t === d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n  }\n\n  /**\n   * Exponential easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutExpo(t, b, c, d) {\n    if (t === 0) {\n      return b;\n    }\n    if (t === d) {\n      return b + c;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n    }\n    return c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n  }\n\n  /**\n   * Circular easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInCirc(t, b, c, d) {\n    return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n  }\n\n  /**\n   * Circular easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCirc(t, b, c, d) {\n    return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n  }\n\n  /**\n   * Circular easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCirc(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n    }\n    return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n  }\n\n  /**\n   * Elastic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return -elastic(opts, t, d) + b;\n  }\n\n  /**\n   * Elastic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return opts.a * Math.pow(2, -10 * t) * Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) + opts.c + b;\n  }\n\n  /**\n   * Elastic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d / 2;\n    if (t === 2) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * (0.3 * 1.5);\n    }\n    var opts = normalize(a, c, p, s);\n    if (t < 1) {\n      return -0.5 * elastic(opts, t, d) + b;\n    }\n    return opts.a * Math.pow(2, -10 * (t -= 1)) *\n      Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) * 0.5 + opts.c + b;\n  }\n\n  /**\n   * Backwards easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\n  }\n\n  /**\n   * Backwards easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n  }\n\n  /**\n   * Backwards easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\n    }\n    return c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\n  }\n\n  /**\n   * Bouncing easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBounce(t, b, c, d) {\n    return c - easeOutBounce (d - t, 0, c, d) + b;\n  }\n\n  /**\n   * Bouncing easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBounce(t, b, c, d) {\n    if ((t /= d) < (1 / 2.75)) {\n      return c * (7.5625 * t * t) + b;\n    }\n    else if (t < (2 / 2.75)) {\n      return c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\n    }\n    else if (t < (2.5 / 2.75)) {\n      return c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\n    }\n    else {\n      return c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\n    }\n  }\n\n  /**\n   * Bouncing easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBounce(t, b, c, d) {\n    if (t < d / 2) {\n      return easeInBounce (t * 2, 0, c, d) * 0.5 + b;\n    }\n    return easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n  }\n\n  /**\n   * Easing functions\n   * See <a href=\"http://gizma.com/easing/\">Easing Equations by Robert Penner</a>\n   * @namespace fabric.util.ease\n   */\n  fabric.util.ease = {\n\n    /**\n     * Quadratic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInQuad: function(t, b, c, d) {\n      return c * (t /= d) * t + b;\n    },\n\n    /**\n     * Quadratic easing out\n     * @memberOf fabric.util.ease\n     */\n    easeOutQuad: function(t, b, c, d) {\n      return -c * (t /= d) * (t - 2) + b;\n    },\n\n    /**\n     * Quadratic easing in and out\n     * @memberOf fabric.util.ease\n     */\n    easeInOutQuad: function(t, b, c, d) {\n      t /= (d / 2);\n      if (t < 1) {\n        return c / 2 * t * t + b;\n      }\n      return -c / 2 * ((--t) * (t - 2) - 1) + b;\n    },\n\n    /**\n     * Cubic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInCubic: function(t, b, c, d) {\n      return c * (t /= d) * t * t + b;\n    },\n\n    easeOutCubic: easeOutCubic,\n    easeInOutCubic: easeInOutCubic,\n    easeInQuart: easeInQuart,\n    easeOutQuart: easeOutQuart,\n    easeInOutQuart: easeInOutQuart,\n    easeInQuint: easeInQuint,\n    easeOutQuint: easeOutQuint,\n    easeInOutQuint: easeInOutQuint,\n    easeInSine: easeInSine,\n    easeOutSine: easeOutSine,\n    easeInOutSine: easeInOutSine,\n    easeInExpo: easeInExpo,\n    easeOutExpo: easeOutExpo,\n    easeInOutExpo: easeInOutExpo,\n    easeInCirc: easeInCirc,\n    easeOutCirc: easeOutCirc,\n    easeInOutCirc: easeInOutCirc,\n    easeInElastic: easeInElastic,\n    easeOutElastic: easeOutElastic,\n    easeInOutElastic: easeInOutElastic,\n    easeInBack: easeInBack,\n    easeOutBack: easeOutBack,\n    easeInOutBack: easeInOutBack,\n    easeInBounce: easeInBounce,\n    easeOutBounce: easeOutBounce,\n    easeInOutBounce: easeInOutBounce\n  };\n\n})();\n(function(global) {\n\n  'use strict';\n\n  /**\n   * @name fabric\n   * @namespace\n   */\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      parseUnit = fabric.util.parseUnit,\n      multiplyTransformMatrices = fabric.util.multiplyTransformMatrices,\n\n      svgValidTagNames = ['path', 'circle', 'polygon', 'polyline', 'ellipse', 'rect', 'line',\n        'image', 'text'],\n      svgViewBoxElements = ['symbol', 'image', 'marker', 'pattern', 'view', 'svg'],\n      svgInvalidAncestors = ['pattern', 'defs', 'symbol', 'metadata', 'clipPath', 'mask', 'desc'],\n      svgValidParents = ['symbol', 'g', 'a', 'svg', 'clipPath', 'defs'],\n\n      attributesMap = {\n        cx:                   'left',\n        x:                    'left',\n        r:                    'radius',\n        cy:                   'top',\n        y:                    'top',\n        display:              'visible',\n        visibility:           'visible',\n        transform:            'transformMatrix',\n        'fill-opacity':       'fillOpacity',\n        'fill-rule':          'fillRule',\n        'font-family':        'fontFamily',\n        'font-size':          'fontSize',\n        'font-style':         'fontStyle',\n        'font-weight':        'fontWeight',\n        'letter-spacing':     'charSpacing',\n        'paint-order':        'paintFirst',\n        'stroke-dasharray':   'strokeDashArray',\n        'stroke-dashoffset':  'strokeDashOffset',\n        'stroke-linecap':     'strokeLineCap',\n        'stroke-linejoin':    'strokeLineJoin',\n        'stroke-miterlimit':  'strokeMiterLimit',\n        'stroke-opacity':     'strokeOpacity',\n        'stroke-width':       'strokeWidth',\n        'text-decoration':    'textDecoration',\n        'text-anchor':        'textAnchor',\n        opacity:              'opacity',\n        'clip-path':          'clipPath',\n        'clip-rule':          'clipRule',\n      },\n\n      colorAttributes = {\n        stroke: 'strokeOpacity',\n        fill:   'fillOpacity'\n      };\n\n  fabric.svgValidTagNamesRegEx = getSvgRegex(svgValidTagNames);\n  fabric.svgViewBoxElementsRegEx = getSvgRegex(svgViewBoxElements);\n  fabric.svgInvalidAncestorsRegEx = getSvgRegex(svgInvalidAncestors);\n  fabric.svgValidParentsRegEx = getSvgRegex(svgValidParents);\n\n  fabric.cssRules = { };\n  fabric.gradientDefs = { };\n  fabric.clipPaths = { };\n\n  function normalizeAttr(attr) {\n    // transform attribute names\n    if (attr in attributesMap) {\n      return attributesMap[attr];\n    }\n    return attr;\n  }\n\n  function normalizeValue(attr, value, parentAttributes, fontSize) {\n    var isArray = Object.prototype.toString.call(value) === '[object Array]',\n        parsed;\n\n    if ((attr === 'fill' || attr === 'stroke') && value === 'none') {\n      value = '';\n    }\n    else if (attr === 'strokeDashArray') {\n      if (value === 'none') {\n        value = null;\n      }\n      else {\n        value = value.replace(/,/g, ' ').split(/\\s+/).map(parseFloat);\n      }\n    }\n    else if (attr === 'transformMatrix') {\n      if (parentAttributes && parentAttributes.transformMatrix) {\n        value = multiplyTransformMatrices(\n          parentAttributes.transformMatrix, fabric.parseTransformAttribute(value));\n      }\n      else {\n        value = fabric.parseTransformAttribute(value);\n      }\n    }\n    else if (attr === 'visible') {\n      value = value !== 'none' && value !== 'hidden';\n      // display=none on parent element always takes precedence over child element\n      if (parentAttributes && parentAttributes.visible === false) {\n        value = false;\n      }\n    }\n    else if (attr === 'opacity') {\n      value = parseFloat(value);\n      if (parentAttributes && typeof parentAttributes.opacity !== 'undefined') {\n        value *= parentAttributes.opacity;\n      }\n    }\n    else if (attr === 'textAnchor' /* text-anchor */) {\n      value = value === 'start' ? 'left' : value === 'end' ? 'right' : 'center';\n    }\n    else if (attr === 'charSpacing') {\n      // parseUnit returns px and we convert it to em\n      parsed = parseUnit(value, fontSize) / fontSize * 1000;\n    }\n    else if (attr === 'paintFirst') {\n      var fillIndex = value.indexOf('fill');\n      var strokeIndex = value.indexOf('stroke');\n      var value = 'fill';\n      if (fillIndex > -1 && strokeIndex > -1 && strokeIndex < fillIndex) {\n        value = 'stroke';\n      }\n      else if (fillIndex === -1 && strokeIndex > -1) {\n        value = 'stroke';\n      }\n    }\n    else if (attr === 'href' || attr === 'xlink:href') {\n      return value;\n    }\n    else {\n      parsed = isArray ? value.map(parseUnit) : parseUnit(value, fontSize);\n    }\n\n    return (!isArray && isNaN(parsed) ? value : parsed);\n  }\n\n  /**\n    * @private\n    */\n  function getSvgRegex(arr) {\n    return new RegExp('^(' + arr.join('|') + ')\\\\b', 'i');\n  }\n\n  /**\n   * @private\n   * @param {Object} attributes Array of attributes to parse\n   */\n  function _setStrokeFillOpacity(attributes) {\n    for (var attr in colorAttributes) {\n\n      if (typeof attributes[colorAttributes[attr]] === 'undefined' || attributes[attr] === '') {\n        continue;\n      }\n\n      if (typeof attributes[attr] === 'undefined') {\n        if (!fabric.Object.prototype[attr]) {\n          continue;\n        }\n        attributes[attr] = fabric.Object.prototype[attr];\n      }\n\n      if (attributes[attr].indexOf('url(') === 0) {\n        continue;\n      }\n\n      var color = new fabric.Color(attributes[attr]);\n      attributes[attr] = color.setAlpha(toFixed(color.getAlpha() * attributes[colorAttributes[attr]], 2)).toRgba();\n    }\n    return attributes;\n  }\n\n  /**\n   * @private\n   */\n  function _getMultipleNodes(doc, nodeNames) {\n    var nodeName, nodeArray = [], nodeList, i, len;\n    for (i = 0, len = nodeNames.length; i < len; i++) {\n      nodeName = nodeNames[i];\n      nodeList = doc.getElementsByTagName(nodeName);\n      nodeArray = nodeArray.concat(Array.prototype.slice.call(nodeList));\n    }\n    return nodeArray;\n  }\n\n  /**\n   * Parses \"transform\" attribute, returning an array of values\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {String} attributeValue String containing attribute value\n   * @return {Array} Array of 6 elements representing transformation matrix\n   */\n  fabric.parseTransformAttribute = (function() {\n    function rotateMatrix(matrix, args) {\n      var cos = fabric.util.cos(args[0]), sin = fabric.util.sin(args[0]),\n          x = 0, y = 0;\n      if (args.length === 3) {\n        x = args[1];\n        y = args[2];\n      }\n\n      matrix[0] = cos;\n      matrix[1] = sin;\n      matrix[2] = -sin;\n      matrix[3] = cos;\n      matrix[4] = x - (cos * x - sin * y);\n      matrix[5] = y - (sin * x + cos * y);\n    }\n\n    function scaleMatrix(matrix, args) {\n      var multiplierX = args[0],\n          multiplierY = (args.length === 2) ? args[1] : args[0];\n\n      matrix[0] = multiplierX;\n      matrix[3] = multiplierY;\n    }\n\n    function skewMatrix(matrix, args, pos) {\n      matrix[pos] = Math.tan(fabric.util.degreesToRadians(args[0]));\n    }\n\n    function translateMatrix(matrix, args) {\n      matrix[4] = args[0];\n      if (args.length === 2) {\n        matrix[5] = args[1];\n      }\n    }\n\n    // identity matrix\n    var iMatrix = fabric.iMatrix,\n\n        // == begin transform regexp\n        number = fabric.reNum,\n\n        commaWsp = '(?:\\\\s+,?\\\\s*|,\\\\s*)',\n\n        skewX = '(?:(skewX)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        skewY = '(?:(skewY)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        rotate = '(?:(rotate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + ')' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        scale = '(?:(scale)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        translate = '(?:(translate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        matrix = '(?:(matrix)\\\\s*\\\\(\\\\s*' +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' +\n                  '\\\\s*\\\\))',\n\n        transform = '(?:' +\n                    matrix + '|' +\n                    translate + '|' +\n                    scale + '|' +\n                    rotate + '|' +\n                    skewX + '|' +\n                    skewY +\n                    ')',\n\n        transforms = '(?:' + transform + '(?:' + commaWsp + '*' + transform + ')*' + ')',\n\n        transformList = '^\\\\s*(?:' + transforms + '?)\\\\s*$',\n\n        // http://www.w3.org/TR/SVG/coords.html#TransformAttribute\n        reTransformList = new RegExp(transformList),\n        // == end transform regexp\n\n        reTransform = new RegExp(transform, 'g');\n\n    return function(attributeValue) {\n\n      // start with identity matrix\n      var matrix = iMatrix.concat(),\n          matrices = [];\n\n      // return if no argument was given or\n      // an argument does not match transform attribute regexp\n      if (!attributeValue || (attributeValue && !reTransformList.test(attributeValue))) {\n        return matrix;\n      }\n\n      attributeValue.replace(reTransform, function(match) {\n\n        var m = new RegExp(transform).exec(match).filter(function (match) {\n              // match !== '' && match != null\n              return (!!match);\n            }),\n            operation = m[1],\n            args = m.slice(2).map(parseFloat);\n\n        switch (operation) {\n          case 'translate':\n            translateMatrix(matrix, args);\n            break;\n          case 'rotate':\n            args[0] = fabric.util.degreesToRadians(args[0]);\n            rotateMatrix(matrix, args);\n            break;\n          case 'scale':\n            scaleMatrix(matrix, args);\n            break;\n          case 'skewX':\n            skewMatrix(matrix, args, 2);\n            break;\n          case 'skewY':\n            skewMatrix(matrix, args, 1);\n            break;\n          case 'matrix':\n            matrix = args;\n            break;\n        }\n\n        // snapshot current matrix into matrices array\n        matrices.push(matrix.concat());\n        // reset\n        matrix = iMatrix.concat();\n      });\n\n      var combinedMatrix = matrices[0];\n      while (matrices.length > 1) {\n        matrices.shift();\n        combinedMatrix = fabric.util.multiplyTransformMatrices(combinedMatrix, matrices[0]);\n      }\n      return combinedMatrix;\n    };\n  })();\n\n  /**\n   * @private\n   */\n  function parseStyleString(style, oStyle) {\n    var attr, value;\n    style.replace(/;\\s*$/, '').split(';').forEach(function (chunk) {\n      var pair = chunk.split(':');\n\n      attr = pair[0].trim().toLowerCase();\n      value =  pair[1].trim();\n\n      oStyle[attr] = value;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function parseStyleObject(style, oStyle) {\n    var attr, value;\n    for (var prop in style) {\n      if (typeof style[prop] === 'undefined') {\n        continue;\n      }\n\n      attr = prop.toLowerCase();\n      value = style[prop];\n\n      oStyle[attr] = value;\n    }\n  }\n\n  /**\n   * @private\n   */\n  function getGlobalStylesForElement(element, svgUid) {\n    var styles = { };\n    for (var rule in fabric.cssRules[svgUid]) {\n      if (elementMatchesRule(element, rule.split(' '))) {\n        for (var property in fabric.cssRules[svgUid][rule]) {\n          styles[property] = fabric.cssRules[svgUid][rule][property];\n        }\n      }\n    }\n    return styles;\n  }\n\n  /**\n   * @private\n   */\n  function elementMatchesRule(element, selectors) {\n    var firstMatching, parentMatching = true;\n    //start from rightmost selector.\n    firstMatching = selectorMatches(element, selectors.pop());\n    if (firstMatching && selectors.length) {\n      parentMatching = doesSomeParentMatch(element, selectors);\n    }\n    return firstMatching && parentMatching && (selectors.length === 0);\n  }\n\n  function doesSomeParentMatch(element, selectors) {\n    var selector, parentMatching = true;\n    while (element.parentNode && element.parentNode.nodeType === 1 && selectors.length) {\n      if (parentMatching) {\n        selector = selectors.pop();\n      }\n      element = element.parentNode;\n      parentMatching = selectorMatches(element, selector);\n    }\n    return selectors.length === 0;\n  }\n\n  /**\n   * @private\n   */\n  function selectorMatches(element, selector) {\n    var nodeName = element.nodeName,\n        classNames = element.getAttribute('class'),\n        id = element.getAttribute('id'), matcher, i;\n    // i check if a selector matches slicing away part from it.\n    // if i get empty string i should match\n    matcher = new RegExp('^' + nodeName, 'i');\n    selector = selector.replace(matcher, '');\n    if (id && selector.length) {\n      matcher = new RegExp('#' + id + '(?![a-zA-Z\\\\-]+)', 'i');\n      selector = selector.replace(matcher, '');\n    }\n    if (classNames && selector.length) {\n      classNames = classNames.split(' ');\n      for (i = classNames.length; i--;) {\n        matcher = new RegExp('\\\\.' + classNames[i] + '(?![a-zA-Z\\\\-]+)', 'i');\n        selector = selector.replace(matcher, '');\n      }\n    }\n    return selector.length === 0;\n  }\n\n  /**\n   * @private\n   * to support IE8 missing getElementById on SVGdocument and on node xmlDOM\n   */\n  function elementById(doc, id) {\n    var el;\n    doc.getElementById && (el = doc.getElementById(id));\n    if (el) {\n      return el;\n    }\n    var node, i, len, nodelist = doc.getElementsByTagName('*');\n    for (i = 0, len = nodelist.length; i < len; i++) {\n      node = nodelist[i];\n      if (id === node.getAttribute('id')) {\n        return node;\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  function parseUseDirectives(doc) {\n    var nodelist = _getMultipleNodes(doc, ['use', 'svg:use']), i = 0;\n    while (nodelist.length && i < nodelist.length) {\n      var el = nodelist[i],\n          xlink = (el.getAttribute('xlink:href') || el.getAttribute('href')).substr(1),\n          x = el.getAttribute('x') || 0,\n          y = el.getAttribute('y') || 0,\n          el2 = elementById(doc, xlink).cloneNode(true),\n          currentTrans = (el2.getAttribute('transform') || '') + ' translate(' + x + ', ' + y + ')',\n          parentNode, oldLength = nodelist.length, attr, j, attrs, len;\n\n      applyViewboxTransform(el2);\n      if (/^svg$/i.test(el2.nodeName)) {\n        var el3 = el2.ownerDocument.createElement('g');\n        for (j = 0, attrs = el2.attributes, len = attrs.length; j < len; j++) {\n          attr = attrs.item(j);\n          el3.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n        // el2.firstChild != null\n        while (el2.firstChild) {\n          el3.appendChild(el2.firstChild);\n        }\n        el2 = el3;\n      }\n\n      for (j = 0, attrs = el.attributes, len = attrs.length; j < len; j++) {\n        attr = attrs.item(j);\n        if (attr.nodeName === 'x' || attr.nodeName === 'y' ||\n          attr.nodeName === 'xlink:href' || attr.nodeName === 'href') {\n          continue;\n        }\n\n        if (attr.nodeName === 'transform') {\n          currentTrans = attr.nodeValue + ' ' + currentTrans;\n        }\n        else {\n          el2.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n      }\n\n      el2.setAttribute('transform', currentTrans);\n      el2.setAttribute('instantiated_by_use', '1');\n      el2.removeAttribute('id');\n      parentNode = el.parentNode;\n      parentNode.replaceChild(el2, el);\n      // some browsers do not shorten nodelist after replaceChild (IE8)\n      if (nodelist.length === oldLength) {\n        i++;\n      }\n    }\n  }\n\n  // http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\n  // matches, e.g.: +14.56e-12, etc.\n  var reViewBoxAttrValue = new RegExp(\n    '^' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*' +\n    '$'\n  );\n\n  /**\n   * Add a <g> element that envelop all child elements and makes the viewbox transformMatrix descend on all elements\n   */\n  function applyViewboxTransform(element) {\n\n    var viewBoxAttr = element.getAttribute('viewBox'),\n        scaleX = 1,\n        scaleY = 1,\n        minX = 0,\n        minY = 0,\n        viewBoxWidth, viewBoxHeight, matrix, el,\n        widthAttr = element.getAttribute('width'),\n        heightAttr = element.getAttribute('height'),\n        x = element.getAttribute('x') || 0,\n        y = element.getAttribute('y') || 0,\n        preserveAspectRatio = element.getAttribute('preserveAspectRatio') || '',\n        missingViewBox = (!viewBoxAttr || !fabric.svgViewBoxElementsRegEx.test(element.nodeName)\n                           || !(viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue))),\n        missingDimAttr = (!widthAttr || !heightAttr || widthAttr === '100%' || heightAttr === '100%'),\n        toBeParsed = missingViewBox && missingDimAttr,\n        parsedDim = { }, translateMatrix = '', widthDiff = 0, heightDiff = 0;\n\n    parsedDim.width = 0;\n    parsedDim.height = 0;\n    parsedDim.toBeParsed = toBeParsed;\n\n    if (toBeParsed) {\n      return parsedDim;\n    }\n\n    if (missingViewBox) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      return parsedDim;\n    }\n\n    minX = -parseFloat(viewBoxAttr[1]);\n    minY = -parseFloat(viewBoxAttr[2]);\n    viewBoxWidth = parseFloat(viewBoxAttr[3]);\n    viewBoxHeight = parseFloat(viewBoxAttr[4]);\n\n    if (!missingDimAttr) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      scaleX = parsedDim.width / viewBoxWidth;\n      scaleY = parsedDim.height / viewBoxHeight;\n    }\n    else {\n      parsedDim.width = viewBoxWidth;\n      parsedDim.height = viewBoxHeight;\n    }\n\n    // default is to preserve aspect ratio\n    preserveAspectRatio = fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);\n    if (preserveAspectRatio.alignX !== 'none') {\n      //translate all container for the effect of Mid, Min, Max\n      if (preserveAspectRatio.meetOrSlice === 'meet') {\n        scaleY = scaleX = (scaleX > scaleY ? scaleY : scaleX);\n        // calculate additional translation to move the viewbox\n      }\n      if (preserveAspectRatio.meetOrSlice === 'slice') {\n        scaleY = scaleX = (scaleX > scaleY ? scaleX : scaleY);\n        // calculate additional translation to move the viewbox\n      }\n      widthDiff = parsedDim.width - viewBoxWidth * scaleX;\n      heightDiff = parsedDim.height - viewBoxHeight * scaleX;\n      if (preserveAspectRatio.alignX === 'Mid') {\n        widthDiff /= 2;\n      }\n      if (preserveAspectRatio.alignY === 'Mid') {\n        heightDiff /= 2;\n      }\n      if (preserveAspectRatio.alignX === 'Min') {\n        widthDiff = 0;\n      }\n      if (preserveAspectRatio.alignY === 'Min') {\n        heightDiff = 0;\n      }\n    }\n\n    if (scaleX === 1 && scaleY === 1 && minX === 0 && minY === 0 && x === 0 && y === 0) {\n      return parsedDim;\n    }\n\n    if (x || y) {\n      translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n    }\n\n    matrix = translateMatrix + ' matrix(' + scaleX +\n                  ' 0' +\n                  ' 0 ' +\n                  scaleY + ' ' +\n                  (minX * scaleX + widthDiff) + ' ' +\n                  (minY * scaleY + heightDiff) + ') ';\n    parsedDim.viewboxTransform = fabric.parseTransformAttribute(matrix);\n    if (element.nodeName === 'svg') {\n      el = element.ownerDocument.createElement('g');\n      // element.firstChild != null\n      while (element.firstChild) {\n        el.appendChild(element.firstChild);\n      }\n      element.appendChild(el);\n    }\n    else {\n      el = element;\n      matrix = el.getAttribute('transform') + matrix;\n    }\n    el.setAttribute('transform', matrix);\n    return parsedDim;\n  }\n\n  function hasAncestorWithNodeName(element, nodeName) {\n    while (element && (element = element.parentNode)) {\n      if (element.nodeName && nodeName.test(element.nodeName.replace('svg:', ''))\n        && !element.getAttribute('instantiated_by_use')) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {SVGDocument} doc SVG document to parse\n   * @param {Function} callback Callback to call when parsing is finished;\n   * It's being passed an array of elements (parsed from a document).\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   * @param {Object} [parsingOptions] options for parsing document\n   * @param {String} [parsingOptions.crossOrigin] crossOrigin settings\n   */\n  fabric.parseSVGDocument = function(doc, callback, reviver, parsingOptions) {\n    if (!doc) {\n      return;\n    }\n\n    parseUseDirectives(doc);\n\n    var svgUid =  fabric.Object.__uid++, i, len,\n        options = applyViewboxTransform(doc),\n        descendants = fabric.util.toArray(doc.getElementsByTagName('*'));\n    options.crossOrigin = parsingOptions && parsingOptions.crossOrigin;\n    options.svgUid = svgUid;\n\n    if (descendants.length === 0 && fabric.isLikelyNode) {\n      // we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\n      // https://github.com/ajaxorg/node-o3-xml/issues/21\n      descendants = doc.selectNodes('//*[name(.)!=\"svg\"]');\n      var arr = [];\n      for (i = 0, len = descendants.length; i < len; i++) {\n        arr[i] = descendants[i];\n      }\n      descendants = arr;\n    }\n\n    var elements = descendants.filter(function(el) {\n      applyViewboxTransform(el);\n      return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', '')) &&\n            !hasAncestorWithNodeName(el, fabric.svgInvalidAncestorsRegEx); // http://www.w3.org/TR/SVG/struct.html#DefsElement\n    });\n\n    if (!elements || (elements && !elements.length)) {\n      callback && callback([], {});\n      return;\n    }\n    var clipPaths = { };\n    descendants.filter(function(el) {\n      return el.nodeName.replace('svg:', '') === 'clipPath';\n    }).forEach(function(el) {\n      var id = el.getAttribute('id');\n      clipPaths[id] = fabric.util.toArray(el.getElementsByTagName('*')).filter(function(el) {\n        return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', ''));\n      });\n    });\n    fabric.gradientDefs[svgUid] = fabric.getGradientDefs(doc);\n    fabric.cssRules[svgUid] = fabric.getCSSRules(doc);\n    fabric.clipPaths[svgUid] = clipPaths;\n    // Precedence of rules:   style > class > attribute\n    fabric.parseElements(elements, function(instances, elements) {\n      if (callback) {\n        callback(instances, options, elements, descendants);\n        delete fabric.gradientDefs[svgUid];\n        delete fabric.cssRules[svgUid];\n        delete fabric.clipPaths[svgUid];\n      }\n    }, clone(options), reviver, parsingOptions);\n  };\n\n  function recursivelyParseGradientsXlink(doc, gradient) {\n    var gradientsAttrs = ['gradientTransform', 'x1', 'x2', 'y1', 'y2', 'gradientUnits', 'cx', 'cy', 'r', 'fx', 'fy'],\n        xlinkAttr = 'xlink:href',\n        xLink = gradient.getAttribute(xlinkAttr).substr(1),\n        referencedGradient = elementById(doc, xLink);\n    if (referencedGradient && referencedGradient.getAttribute(xlinkAttr)) {\n      recursivelyParseGradientsXlink(doc, referencedGradient);\n    }\n    gradientsAttrs.forEach(function(attr) {\n      if (!gradient.hasAttribute(attr)) {\n        gradient.setAttribute(attr, referencedGradient.getAttribute(attr));\n      }\n    });\n    if (!gradient.children.length) {\n      var referenceClone = referencedGradient.cloneNode(true);\n      while (referenceClone.firstChild) {\n        gradient.appendChild(referenceClone.firstChild);\n      }\n    }\n    gradient.removeAttribute(xlinkAttr);\n  }\n\n  var reFontDeclaration = new RegExp(\n    '(normal|italic)?\\\\s*(normal|small-caps)?\\\\s*' +\n    '(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\\\s*(' +\n      fabric.reNum +\n    '(?:px|cm|mm|em|pt|pc|in)*)(?:\\\\/(normal|' + fabric.reNum + '))?\\\\s+(.*)');\n\n  extend(fabric, {\n    /**\n     * Parses a short font declaration, building adding its properties to a style object\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {String} value font declaration\n     * @param {Object} oStyle definition\n     */\n    parseFontDeclaration: function(value, oStyle) {\n      var match = value.match(reFontDeclaration);\n\n      if (!match) {\n        return;\n      }\n      var fontStyle = match[1],\n          // font variant is not used\n          // fontVariant = match[2],\n          fontWeight = match[3],\n          fontSize = match[4],\n          lineHeight = match[5],\n          fontFamily = match[6];\n\n      if (fontStyle) {\n        oStyle.fontStyle = fontStyle;\n      }\n      if (fontWeight) {\n        oStyle.fontWeight = isNaN(parseFloat(fontWeight)) ? fontWeight : parseFloat(fontWeight);\n      }\n      if (fontSize) {\n        oStyle.fontSize = parseUnit(fontSize);\n      }\n      if (fontFamily) {\n        oStyle.fontFamily = fontFamily;\n      }\n      if (lineHeight) {\n        oStyle.lineHeight = lineHeight === 'normal' ? 1 : lineHeight;\n      }\n    },\n\n    /**\n     * Parses an SVG document, returning all of the gradient declarations found in it\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\n     */\n    getGradientDefs: function(doc) {\n      var tagArray = [\n            'linearGradient',\n            'radialGradient',\n            'svg:linearGradient',\n            'svg:radialGradient'],\n          elList = _getMultipleNodes(doc, tagArray),\n          el, j = 0, gradientDefs = { };\n      j = elList.length;\n      while (j--) {\n        el = elList[j];\n        if (el.getAttribute('xlink:href')) {\n          recursivelyParseGradientsXlink(doc, el);\n        }\n        gradientDefs[el.getAttribute('id')] = el;\n      }\n      return gradientDefs;\n    },\n\n    /**\n     * Returns an object of attributes' name/value, given element and an array of attribute names;\n     * Parses parent \"g\" nodes recursively upwards.\n     * @static\n     * @memberOf fabric\n     * @param {DOMElement} element Element to parse\n     * @param {Array} attributes Array of attributes to parse\n     * @return {Object} object containing parsed attributes' names/values\n     */\n    parseAttributes: function(element, attributes, svgUid) {\n\n      if (!element) {\n        return;\n      }\n\n      var value,\n          parentAttributes = { },\n          fontSize, parentFontSize;\n\n      if (typeof svgUid === 'undefined') {\n        svgUid = element.getAttribute('svgUid');\n      }\n      // if there's a parent container (`g` or `a` or `symbol` node), parse its attributes recursively upwards\n      if (element.parentNode && fabric.svgValidParentsRegEx.test(element.parentNode.nodeName)) {\n        parentAttributes = fabric.parseAttributes(element.parentNode, attributes, svgUid);\n      }\n\n      var ownAttributes = attributes.reduce(function(memo, attr) {\n        value = element.getAttribute(attr);\n        if (value) { // eslint-disable-line\n          memo[attr] = value;\n        }\n        return memo;\n      }, { });\n      // add values parsed from style, which take precedence over attributes\n      // (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\n      ownAttributes = extend(ownAttributes,\n        extend(getGlobalStylesForElement(element, svgUid), fabric.parseStyleAttribute(element)));\n\n      fontSize = parentFontSize = parentAttributes.fontSize || fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      if (ownAttributes['font-size']) {\n        // looks like the minimum should be 9px when dealing with ems. this is what looks like in browsers.\n        ownAttributes['font-size'] = fontSize = parseUnit(ownAttributes['font-size'], parentFontSize);\n      }\n\n      var normalizedAttr, normalizedValue, normalizedStyle = {};\n      for (var attr in ownAttributes) {\n        normalizedAttr = normalizeAttr(attr);\n        normalizedValue = normalizeValue(normalizedAttr, ownAttributes[attr], parentAttributes, fontSize);\n        normalizedStyle[normalizedAttr] = normalizedValue;\n      }\n      if (normalizedStyle && normalizedStyle.font) {\n        fabric.parseFontDeclaration(normalizedStyle.font, normalizedStyle);\n      }\n      var mergedAttrs = extend(parentAttributes, normalizedStyle);\n      return fabric.svgValidParentsRegEx.test(element.nodeName) ? mergedAttrs : _setStrokeFillOpacity(mergedAttrs);\n    },\n\n    /**\n     * Transforms an array of svg elements to corresponding fabric.* instances\n     * @static\n     * @memberOf fabric\n     * @param {Array} elements Array of elements to parse\n     * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\n     * @param {Object} [options] Options object\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     */\n    parseElements: function(elements, callback, options, reviver, parsingOptions) {\n      new fabric.ElementsParser(elements, callback, options, reviver, parsingOptions).parse();\n    },\n\n    /**\n     * Parses \"style\" attribute, retuning an object with values\n     * @static\n     * @memberOf fabric\n     * @param {SVGElement} element Element to parse\n     * @return {Object} Objects with values parsed from style attribute of an element\n     */\n    parseStyleAttribute: function(element) {\n      var oStyle = { },\n          style = element.getAttribute('style');\n\n      if (!style) {\n        return oStyle;\n      }\n\n      if (typeof style === 'string') {\n        parseStyleString(style, oStyle);\n      }\n      else {\n        parseStyleObject(style, oStyle);\n      }\n\n      return oStyle;\n    },\n\n    /**\n     * Parses \"points\" attribute, returning an array of values\n     * @static\n     * @memberOf fabric\n     * @param {String} points points attribute string\n     * @return {Array} array of points\n     */\n    parsePointsAttribute: function(points) {\n\n      // points attribute is required and must not be empty\n      if (!points) {\n        return null;\n      }\n\n      // replace commas with whitespace and remove bookending whitespace\n      points = points.replace(/,/g, ' ').trim();\n\n      points = points.split(/\\s+/);\n      var parsedPoints = [], i, len;\n\n      for (i = 0, len = points.length; i < len; i += 2) {\n        parsedPoints.push({\n          x: parseFloat(points[i]),\n          y: parseFloat(points[i + 1])\n        });\n      }\n\n      // odd number of points is an error\n      // if (parsedPoints.length % 2 !== 0) {\n      //   return null;\n      // }\n\n      return parsedPoints;\n    },\n\n    /**\n     * Returns CSS rules for a given SVG document\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} CSS rules of this document\n     */\n    getCSSRules: function(doc) {\n      var styles = doc.getElementsByTagName('style'), i, len,\n          allRules = { }, rules;\n\n      // very crude parsing of style contents\n      for (i = 0, len = styles.length; i < len; i++) {\n        // IE9 doesn't support textContent, but provides text instead.\n        var styleContents = styles[i].textContent || styles[i].text;\n\n        // remove comments\n        styleContents = styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\n        if (styleContents.trim() === '') {\n          continue;\n        }\n        rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\n        rules = rules.map(function(rule) { return rule.trim(); });\n        // eslint-disable-next-line no-loop-func\n        rules.forEach(function(rule) {\n\n          var match = rule.match(/([\\s\\S]*?)\\s*\\{([^}]*)\\}/),\n              ruleObj = { }, declaration = match[2].trim(),\n              propertyValuePairs = declaration.replace(/;$/, '').split(/\\s*;\\s*/);\n\n          for (i = 0, len = propertyValuePairs.length; i < len; i++) {\n            var pair = propertyValuePairs[i].split(/\\s*:\\s*/),\n                property = pair[0],\n                value = pair[1];\n            ruleObj[property] = value;\n          }\n          rule = match[1];\n          rule.split(',').forEach(function(_rule) {\n            _rule = _rule.replace(/^svg/i, '').trim();\n            if (_rule === '') {\n              return;\n            }\n            if (allRules[_rule]) {\n              fabric.util.object.extend(allRules[_rule], ruleObj);\n            }\n            else {\n              allRules[_rule] = fabric.util.object.clone(ruleObj);\n            }\n          });\n        });\n      }\n      return allRules;\n    },\n\n    /**\n     * Takes url corresponding to an SVG document, and parses it into a set of fabric objects.\n     * Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)\n     * @memberOf fabric\n     * @param {String} url\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromURL: function(url, callback, reviver, options) {\n\n      url = url.replace(/^\\n\\s*/, '').trim();\n      new fabric.util.request(url, {\n        method: 'get',\n        onComplete: onComplete\n      });\n\n      function onComplete(r) {\n\n        var xml = r.responseXML;\n        if (xml && !xml.documentElement && fabric.window.ActiveXObject && r.responseText) {\n          xml = new ActiveXObject('Microsoft.XMLDOM');\n          xml.async = 'false';\n          //IE chokes on DOCTYPE\n          xml.loadXML(r.responseText.replace(/<!DOCTYPE[\\s\\S]*?(\\[[\\s\\S]*\\])*?>/i, ''));\n        }\n        if (!xml || !xml.documentElement) {\n          callback && callback(null);\n          return false;\n        }\n\n        fabric.parseSVGDocument(xml.documentElement, function (results, _options, elements, allElements) {\n          callback && callback(results, _options, elements, allElements);\n        }, reviver, options);\n      }\n    },\n\n    /**\n     * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\n     * @memberOf fabric\n     * @param {String} string\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromString: function(string, callback, reviver, options) {\n      string = string.trim();\n      var doc;\n      if (typeof DOMParser !== 'undefined') {\n        var parser = new DOMParser();\n        if (parser && parser.parseFromString) {\n          doc = parser.parseFromString(string, 'text/xml');\n        }\n      }\n      else if (fabric.window.ActiveXObject) {\n        doc = new ActiveXObject('Microsoft.XMLDOM');\n        doc.async = 'false';\n        // IE chokes on DOCTYPE\n        doc.loadXML(string.replace(/<!DOCTYPE[\\s\\S]*?(\\[[\\s\\S]*\\])*?>/i, ''));\n      }\n\n      fabric.parseSVGDocument(doc.documentElement, function (results, _options, elements, allElements) {\n        callback(results, _options, elements, allElements);\n      }, reviver, options);\n    }\n  });\n\n})(typeof exports !== 'undefined' ? exports : this);\nfabric.ElementsParser = function(elements, callback, options, reviver, parsingOptions) {\n  this.elements = elements;\n  this.callback = callback;\n  this.options = options;\n  this.reviver = reviver;\n  this.svgUid = (options && options.svgUid) || 0;\n  this.parsingOptions = parsingOptions;\n  this.regexUrl = /^url\\(['\"]?#([^'\"]+)['\"]?\\)/g;\n};\n\n(function(proto) {\n  proto.parse = function() {\n    this.instances = new Array(this.elements.length);\n    this.numElements = this.elements.length;\n    this.createObjects();\n  };\n\n  proto.createObjects = function() {\n    var _this = this;\n    this.elements.forEach(function(element, i) {\n      element.setAttribute('svgUid', _this.svgUid);\n      _this.createObject(element, i);\n    });\n  };\n\n  proto.findTag = function(el) {\n    return fabric[fabric.util.string.capitalize(el.tagName.replace('svg:', ''))];\n  };\n\n  proto.createObject = function(el, index) {\n    var klass = this.findTag(el);\n    if (klass && klass.fromElement) {\n      try {\n        klass.fromElement(el, this.createCallback(index, el), this.options);\n      }\n      catch (err) {\n        fabric.log(err);\n      }\n    }\n    else {\n      this.checkIfDone();\n    }\n  };\n\n  proto.createCallback = function(index, el) {\n    var _this = this;\n    return function(obj) {\n      var _options;\n      _this.resolveGradient(obj, 'fill');\n      _this.resolveGradient(obj, 'stroke');\n      if (obj instanceof fabric.Image && obj._originalElement) {\n        _options = obj.parsePreserveAspectRatioAttribute(el);\n      }\n      obj._removeTransformMatrix(_options);\n      _this.resolveClipPath(obj);\n      _this.reviver && _this.reviver(el, obj);\n      _this.instances[index] = obj;\n      _this.checkIfDone();\n    };\n  };\n\n  proto.extractPropertyDefinition = function(obj, property, storage) {\n    var value = obj[property];\n    if (!(/^url\\(/).test(value)) {\n      return;\n    }\n    var id = this.regexUrl.exec(value)[1];\n    this.regexUrl.lastIndex = 0;\n    return fabric[storage][this.svgUid][id];\n  };\n\n  proto.resolveGradient = function(obj, property) {\n    var gradientDef = this.extractPropertyDefinition(obj, property, 'gradientDefs');\n    if (gradientDef) {\n      obj.set(property, fabric.Gradient.fromElement(gradientDef, obj));\n    }\n  };\n\n  proto.createClipPathCallback = function(obj, container) {\n    return function(_newObj) {\n      _newObj._removeTransformMatrix();\n      _newObj.fillRule = _newObj.clipRule;\n      container.push(_newObj);\n    };\n  };\n\n  proto.resolveClipPath = function(obj) {\n    var clipPath = this.extractPropertyDefinition(obj, 'clipPath', 'clipPaths'),\n        element, klass, objTransformInv, container, gTransform, options;\n    if (clipPath) {\n      container = [];\n      objTransformInv = fabric.util.invertTransform(obj.calcTransformMatrix());\n      for (var i = 0; i < clipPath.length; i++) {\n        element = clipPath[i];\n        klass = this.findTag(element);\n        klass.fromElement(\n          element,\n          this.createClipPathCallback(obj, container),\n          this.options\n        );\n      }\n      if (container.length === 1) {\n        clipPath = container[0];\n      }\n      else {\n        clipPath = new fabric.Group(container);\n      }\n      gTransform = fabric.util.multiplyTransformMatrices(\n        objTransformInv,\n        clipPath.calcTransformMatrix()\n      );\n      var options = fabric.util.qrDecompose(gTransform);\n      clipPath.flipX = false;\n      clipPath.flipY = false;\n      clipPath.set('scaleX', options.scaleX);\n      clipPath.set('scaleY', options.scaleY);\n      clipPath.angle = options.angle;\n      clipPath.skewX = options.skewX;\n      clipPath.skewY = 0;\n      clipPath.setPositionByOrigin({ x: options.translateX, y: options.translateY }, 'center', 'center');\n      obj.clipPath = clipPath;\n    }\n  };\n\n  proto.checkIfDone = function() {\n    if (--this.numElements === 0) {\n      this.instances = this.instances.filter(function(el) {\n        // eslint-disable-next-line no-eq-null, eqeqeq\n        return el != null;\n      });\n      this.callback(this.instances, this.elements);\n    }\n  };\n})(fabric.ElementsParser.prototype);\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Point) {\n    fabric.warn('fabric.Point is already defined');\n    return;\n  }\n\n  fabric.Point = Point;\n\n  /**\n   * Point class\n   * @class fabric.Point\n   * @memberOf fabric\n   * @constructor\n   * @param {Number} x\n   * @param {Number} y\n   * @return {fabric.Point} thisArg\n   */\n  function Point(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  Point.prototype = /** @lends fabric.Point.prototype */ {\n\n    type: 'point',\n\n    constructor: Point,\n\n    /**\n     * Adds another point to this one and returns another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point instance with added values\n     */\n    add: function (that) {\n      return new Point(this.x + that.x, this.y + that.y);\n    },\n\n    /**\n     * Adds another point to this one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    addEquals: function (that) {\n      this.x += that.x;\n      this.y += that.y;\n      return this;\n    },\n\n    /**\n     * Adds value to this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point} new Point with added value\n     */\n    scalarAdd: function (scalar) {\n      return new Point(this.x + scalar, this.y + scalar);\n    },\n\n    /**\n     * Adds value to this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarAddEquals: function (scalar) {\n      this.x += scalar;\n      this.y += scalar;\n      return this;\n    },\n\n    /**\n     * Subtracts another point from this point and returns a new one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point object with subtracted values\n     */\n    subtract: function (that) {\n      return new Point(this.x - that.x, this.y - that.y);\n    },\n\n    /**\n     * Subtracts another point from this point\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    subtractEquals: function (that) {\n      this.x -= that.x;\n      this.y -= that.y;\n      return this;\n    },\n\n    /**\n     * Subtracts value from this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    scalarSubtract: function (scalar) {\n      return new Point(this.x - scalar, this.y - scalar);\n    },\n\n    /**\n     * Subtracts value from this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarSubtractEquals: function (scalar) {\n      this.x -= scalar;\n      this.y -= scalar;\n      return this;\n    },\n\n    /**\n     * Multiplies this point by a value and returns a new one\n     * TODO: rename in scalarMultiply in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    multiply: function (scalar) {\n      return new Point(this.x * scalar, this.y * scalar);\n    },\n\n    /**\n     * Multiplies this point by a value\n     * TODO: rename in scalarMultiplyEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    multiplyEquals: function (scalar) {\n      this.x *= scalar;\n      this.y *= scalar;\n      return this;\n    },\n\n    /**\n     * Divides this point by a value and returns a new one\n     * TODO: rename in scalarDivide in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    divide: function (scalar) {\n      return new Point(this.x / scalar, this.y / scalar);\n    },\n\n    /**\n     * Divides this point by a value\n     * TODO: rename in scalarDivideEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    divideEquals: function (scalar) {\n      this.x /= scalar;\n      this.y /= scalar;\n      return this;\n    },\n\n    /**\n     * Returns true if this point is equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    eq: function (that) {\n      return (this.x === that.x && this.y === that.y);\n    },\n\n    /**\n     * Returns true if this point is less than another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lt: function (that) {\n      return (this.x < that.x && this.y < that.y);\n    },\n\n    /**\n     * Returns true if this point is less than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lte: function (that) {\n      return (this.x <= that.x && this.y <= that.y);\n    },\n\n    /**\n\n     * Returns true if this point is greater another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gt: function (that) {\n      return (this.x > that.x && this.y > that.y);\n    },\n\n    /**\n     * Returns true if this point is greater than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gte: function (that) {\n      return (this.x >= that.x && this.y >= that.y);\n    },\n\n    /**\n     * Returns new point which is the result of linear interpolation with this one and another one\n     * @param {fabric.Point} that\n     * @param {Number} t , position of interpolation, between 0 and 1 default 0.5\n     * @return {fabric.Point}\n     */\n    lerp: function (that, t) {\n      if (typeof t === 'undefined') {\n        t = 0.5;\n      }\n      t = Math.max(Math.min(1, t), 0);\n      return new Point(this.x + (that.x - this.x) * t, this.y + (that.y - this.y) * t);\n    },\n\n    /**\n     * Returns distance from this point and another one\n     * @param {fabric.Point} that\n     * @return {Number}\n     */\n    distanceFrom: function (that) {\n      var dx = this.x - that.x,\n          dy = this.y - that.y;\n      return Math.sqrt(dx * dx + dy * dy);\n    },\n\n    /**\n     * Returns the point between this point and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    midPointFrom: function (that) {\n      return this.lerp(that);\n    },\n\n    /**\n     * Returns a new point which is the min of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    min: function (that) {\n      return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));\n    },\n\n    /**\n     * Returns a new point which is the max of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    max: function (that) {\n      return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));\n    },\n\n    /**\n     * Returns string representation of this point\n     * @return {String}\n     */\n    toString: function () {\n      return this.x + ',' + this.y;\n    },\n\n    /**\n     * Sets x/y of this point\n     * @param {Number} x\n     * @param {Number} y\n     * @chainable\n     */\n    setXY: function (x, y) {\n      this.x = x;\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x of this point\n     * @param {Number} x\n     * @chainable\n     */\n    setX: function (x) {\n      this.x = x;\n      return this;\n    },\n\n    /**\n     * Sets y of this point\n     * @param {Number} y\n     * @chainable\n     */\n    setY: function (y) {\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x/y of this point from another point\n     * @param {fabric.Point} that\n     * @chainable\n     */\n    setFromPoint: function (that) {\n      this.x = that.x;\n      this.y = that.y;\n      return this;\n    },\n\n    /**\n     * Swaps x/y of this point and another point\n     * @param {fabric.Point} that\n     */\n    swap: function (that) {\n      var x = this.x,\n          y = this.y;\n      this.x = that.x;\n      this.y = that.y;\n      that.x = x;\n      that.y = y;\n    },\n\n    /**\n     * return a cloned instance of the point\n     * @return {fabric.Point}\n     */\n    clone: function () {\n      return new Point(this.x, this.y);\n    }\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Intersection) {\n    fabric.warn('fabric.Intersection is already defined');\n    return;\n  }\n\n  /**\n   * Intersection class\n   * @class fabric.Intersection\n   * @memberOf fabric\n   * @constructor\n   */\n  function Intersection(status) {\n    this.status = status;\n    this.points = [];\n  }\n\n  fabric.Intersection = Intersection;\n\n  fabric.Intersection.prototype = /** @lends fabric.Intersection.prototype */ {\n\n    constructor: Intersection,\n\n    /**\n     * Appends a point to intersection\n     * @param {fabric.Point} point\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoint: function (point) {\n      this.points.push(point);\n      return this;\n    },\n\n    /**\n     * Appends points to intersection\n     * @param {Array} points\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoints: function (points) {\n      this.points = this.points.concat(points);\n      return this;\n    }\n  };\n\n  /**\n   * Checks if one line intersects another\n   * TODO: rename in intersectSegmentSegment\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {fabric.Point} b1\n   * @param {fabric.Point} b2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {\n    var result,\n        uaT = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),\n        ubT = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),\n        uB = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);\n    if (uB !== 0) {\n      var ua = uaT / uB,\n          ub = ubT / uB;\n      if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\n        result = new Intersection('Intersection');\n        result.appendPoint(new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y)));\n      }\n      else {\n        result = new Intersection();\n      }\n    }\n    else {\n      if (uaT === 0 || ubT === 0) {\n        result = new Intersection('Coincident');\n      }\n      else {\n        result = new Intersection('Parallel');\n      }\n    }\n    return result;\n  };\n\n  /**\n   * Checks if line intersects polygon\n   * TODO: rename in intersectSegmentPolygon\n   * fix detection of coincident\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {Array} points\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLinePolygon = function(a1, a2, points) {\n    var result = new Intersection(),\n        length = points.length,\n        b1, b2, inter, i;\n\n    for (i = 0; i < length; i++) {\n      b1 = points[i];\n      b2 = points[(i + 1) % length];\n      inter = Intersection.intersectLineLine(a1, a2, b1, b2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects another polygon\n   * @static\n   * @param {Array} points1\n   * @param {Array} points2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {\n    var result = new Intersection(),\n        length = points1.length, i;\n\n    for (i = 0; i < length; i++) {\n      var a1 = points1[i],\n          a2 = points1[(i + 1) % length],\n          inter = Intersection.intersectLinePolygon(a1, a2, points2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects rectangle\n   * @static\n   * @param {Array} points\n   * @param {fabric.Point} r1\n   * @param {fabric.Point} r2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {\n    var min = r1.min(r2),\n        max = r1.max(r2),\n        topRight = new fabric.Point(max.x, min.y),\n        bottomLeft = new fabric.Point(min.x, max.y),\n        inter1 = Intersection.intersectLinePolygon(min, topRight, points),\n        inter2 = Intersection.intersectLinePolygon(topRight, max, points),\n        inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),\n        inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),\n        result = new Intersection();\n\n    result.appendPoints(inter1.points);\n    result.appendPoints(inter2.points);\n    result.appendPoints(inter3.points);\n    result.appendPoints(inter4.points);\n\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Color) {\n    fabric.warn('fabric.Color is already defined.');\n    return;\n  }\n\n  /**\n   * Color class\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\n   *\n   * @class fabric.Color\n   * @param {String} color optional in hex or rgb(a) or hsl format or from known color list\n   * @return {fabric.Color} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}\n   */\n  function Color(color) {\n    if (!color) {\n      this.setSource([0, 0, 0, 1]);\n    }\n    else {\n      this._tryParsingColor(color);\n    }\n  }\n\n  fabric.Color = Color;\n\n  fabric.Color.prototype = /** @lends fabric.Color.prototype */ {\n\n    /**\n     * @private\n     * @param {String|Array} color Color value to parse\n     */\n    _tryParsingColor: function(color) {\n      var source;\n\n      if (color in Color.colorNameMap) {\n        color = Color.colorNameMap[color];\n      }\n\n      if (color === 'transparent') {\n        source = [255, 255, 255, 0];\n      }\n\n      if (!source) {\n        source = Color.sourceFromHex(color);\n      }\n      if (!source) {\n        source = Color.sourceFromRgb(color);\n      }\n      if (!source) {\n        source = Color.sourceFromHsl(color);\n      }\n      if (!source) {\n        //if color is not recognize let's make black as canvas does\n        source = [0, 0, 0, 1];\n      }\n      if (source) {\n        this.setSource(source);\n      }\n    },\n\n    /**\n     * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n     * @private\n     * @param {Number} r Red color value\n     * @param {Number} g Green color value\n     * @param {Number} b Blue color value\n     * @return {Array} Hsl color\n     */\n    _rgbToHsl: function(r, g, b) {\n      r /= 255; g /= 255; b /= 255;\n\n      var h, s, l,\n          max = fabric.util.array.max([r, g, b]),\n          min = fabric.util.array.min([r, g, b]);\n\n      l = (max + min) / 2;\n\n      if (max === min) {\n        h = s = 0; // achromatic\n      }\n      else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n          case r:\n            h = (g - b) / d + (g < b ? 6 : 0);\n            break;\n          case g:\n            h = (b - r) / d + 2;\n            break;\n          case b:\n            h = (r - g) / d + 4;\n            break;\n        }\n        h /= 6;\n      }\n\n      return [\n        Math.round(h * 360),\n        Math.round(s * 100),\n        Math.round(l * 100)\n      ];\n    },\n\n    /**\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @return {Array}\n     */\n    getSource: function() {\n      return this._source;\n    },\n\n    /**\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @param {Array} source\n     */\n    setSource: function(source) {\n      this._source = source;\n    },\n\n    /**\n     * Returns color representation in RGB format\n     * @return {String} ex: rgb(0-255,0-255,0-255)\n     */\n    toRgb: function() {\n      var source = this.getSource();\n      return 'rgb(' + source[0] + ',' + source[1] + ',' + source[2] + ')';\n    },\n\n    /**\n     * Returns color representation in RGBA format\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n     */\n    toRgba: function() {\n      var source = this.getSource();\n      return 'rgba(' + source[0] + ',' + source[1] + ',' + source[2] + ',' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HSL format\n     * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\n     */\n    toHsl: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsl(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%)';\n    },\n\n    /**\n     * Returns color representation in HSLA format\n     * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\n     */\n    toHsla: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsla(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%,' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HEX format\n     * @return {String} ex: FF5555\n     */\n    toHex: function() {\n      var source = this.getSource(), r, g, b;\n\n      r = source[0].toString(16);\n      r = (r.length === 1) ? ('0' + r) : r;\n\n      g = source[1].toString(16);\n      g = (g.length === 1) ? ('0' + g) : g;\n\n      b = source[2].toString(16);\n      b = (b.length === 1) ? ('0' + b) : b;\n\n      return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();\n    },\n\n    /**\n     * Returns color representation in HEXA format\n     * @return {String} ex: FF5555CC\n     */\n    toHexa: function() {\n      var source = this.getSource(), a;\n\n      a = Math.round(source[3] * 255);\n      a = a.toString(16);\n      a = (a.length === 1) ? ('0' + a) : a;\n\n      return this.toHex() + a.toUpperCase();\n    },\n\n    /**\n     * Gets value of alpha channel for this color\n     * @return {Number} 0-1\n     */\n    getAlpha: function() {\n      return this.getSource()[3];\n    },\n\n    /**\n     * Sets value of alpha channel for this color\n     * @param {Number} alpha Alpha value 0-1\n     * @return {fabric.Color} thisArg\n     */\n    setAlpha: function(alpha) {\n      var source = this.getSource();\n      source[3] = alpha;\n      this.setSource(source);\n      return this;\n    },\n\n    /**\n     * Transforms color to its grayscale representation\n     * @return {fabric.Color} thisArg\n     */\n    toGrayscale: function() {\n      var source = this.getSource(),\n          average = parseInt((source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0), 10),\n          currentAlpha = source[3];\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Transforms color to its black and white representation\n     * @param {Number} threshold\n     * @return {fabric.Color} thisArg\n     */\n    toBlackWhite: function(threshold) {\n      var source = this.getSource(),\n          average = (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),\n          currentAlpha = source[3];\n\n      threshold = threshold || 127;\n\n      average = (Number(average) < Number(threshold)) ? 0 : 255;\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Overlays color with another color\n     * @param {String|fabric.Color} otherColor\n     * @return {fabric.Color} thisArg\n     */\n    overlayWith: function(otherColor) {\n      if (!(otherColor instanceof Color)) {\n        otherColor = new Color(otherColor);\n      }\n\n      var result = [],\n          alpha = this.getAlpha(),\n          otherAlpha = 0.5,\n          source = this.getSource(),\n          otherSource = otherColor.getSource(), i;\n\n      for (i = 0; i < 3; i++) {\n        result.push(Math.round((source[i] * (1 - otherAlpha)) + (otherSource[i] * otherAlpha)));\n      }\n\n      result[3] = alpha;\n      this.setSource(result);\n      return this;\n    }\n  };\n\n  /**\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  // eslint-disable-next-line max-len\n  fabric.Color.reRGBa = /^rgba?\\(\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*(?:\\s*,\\s*((?:\\d*\\.?\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHSLa = /^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}\\%)\\s*,\\s*(\\d{1,3}\\%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HEX format (ex: #FF5544CC, #FF5555, 010155, aff)\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHex = /^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;\n\n  /**\n   * Map of the 148 color names with HEX code\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   * @see: https://www.w3.org/TR/css3-color/#svg-color\n   */\n  fabric.Color.colorNameMap = {\n    aliceblue:            '#F0F8FF',\n    antiquewhite:         '#FAEBD7',\n    aqua:                 '#00FFFF',\n    aquamarine:           '#7FFFD4',\n    azure:                '#F0FFFF',\n    beige:                '#F5F5DC',\n    bisque:               '#FFE4C4',\n    black:                '#000000',\n    blanchedalmond:       '#FFEBCD',\n    blue:                 '#0000FF',\n    blueviolet:           '#8A2BE2',\n    brown:                '#A52A2A',\n    burlywood:            '#DEB887',\n    cadetblue:            '#5F9EA0',\n    chartreuse:           '#7FFF00',\n    chocolate:            '#D2691E',\n    coral:                '#FF7F50',\n    cornflowerblue:       '#6495ED',\n    cornsilk:             '#FFF8DC',\n    crimson:              '#DC143C',\n    cyan:                 '#00FFFF',\n    darkblue:             '#00008B',\n    darkcyan:             '#008B8B',\n    darkgoldenrod:        '#B8860B',\n    darkgray:             '#A9A9A9',\n    darkgrey:             '#A9A9A9',\n    darkgreen:            '#006400',\n    darkkhaki:            '#BDB76B',\n    darkmagenta:          '#8B008B',\n    darkolivegreen:       '#556B2F',\n    darkorange:           '#FF8C00',\n    darkorchid:           '#9932CC',\n    darkred:              '#8B0000',\n    darksalmon:           '#E9967A',\n    darkseagreen:         '#8FBC8F',\n    darkslateblue:        '#483D8B',\n    darkslategray:        '#2F4F4F',\n    darkslategrey:        '#2F4F4F',\n    darkturquoise:        '#00CED1',\n    darkviolet:           '#9400D3',\n    deeppink:             '#FF1493',\n    deepskyblue:          '#00BFFF',\n    dimgray:              '#696969',\n    dimgrey:              '#696969',\n    dodgerblue:           '#1E90FF',\n    firebrick:            '#B22222',\n    floralwhite:          '#FFFAF0',\n    forestgreen:          '#228B22',\n    fuchsia:              '#FF00FF',\n    gainsboro:            '#DCDCDC',\n    ghostwhite:           '#F8F8FF',\n    gold:                 '#FFD700',\n    goldenrod:            '#DAA520',\n    gray:                 '#808080',\n    grey:                 '#808080',\n    green:                '#008000',\n    greenyellow:          '#ADFF2F',\n    honeydew:             '#F0FFF0',\n    hotpink:              '#FF69B4',\n    indianred:            '#CD5C5C',\n    indigo:               '#4B0082',\n    ivory:                '#FFFFF0',\n    khaki:                '#F0E68C',\n    lavender:             '#E6E6FA',\n    lavenderblush:        '#FFF0F5',\n    lawngreen:            '#7CFC00',\n    lemonchiffon:         '#FFFACD',\n    lightblue:            '#ADD8E6',\n    lightcoral:           '#F08080',\n    lightcyan:            '#E0FFFF',\n    lightgoldenrodyellow: '#FAFAD2',\n    lightgray:            '#D3D3D3',\n    lightgrey:            '#D3D3D3',\n    lightgreen:           '#90EE90',\n    lightpink:            '#FFB6C1',\n    lightsalmon:          '#FFA07A',\n    lightseagreen:        '#20B2AA',\n    lightskyblue:         '#87CEFA',\n    lightslategray:       '#778899',\n    lightslategrey:       '#778899',\n    lightsteelblue:       '#B0C4DE',\n    lightyellow:          '#FFFFE0',\n    lime:                 '#00FF00',\n    limegreen:            '#32CD32',\n    linen:                '#FAF0E6',\n    magenta:              '#FF00FF',\n    maroon:               '#800000',\n    mediumaquamarine:     '#66CDAA',\n    mediumblue:           '#0000CD',\n    mediumorchid:         '#BA55D3',\n    mediumpurple:         '#9370DB',\n    mediumseagreen:       '#3CB371',\n    mediumslateblue:      '#7B68EE',\n    mediumspringgreen:    '#00FA9A',\n    mediumturquoise:      '#48D1CC',\n    mediumvioletred:      '#C71585',\n    midnightblue:         '#191970',\n    mintcream:            '#F5FFFA',\n    mistyrose:            '#FFE4E1',\n    moccasin:             '#FFE4B5',\n    navajowhite:          '#FFDEAD',\n    navy:                 '#000080',\n    oldlace:              '#FDF5E6',\n    olive:                '#808000',\n    olivedrab:            '#6B8E23',\n    orange:               '#FFA500',\n    orangered:            '#FF4500',\n    orchid:               '#DA70D6',\n    palegoldenrod:        '#EEE8AA',\n    palegreen:            '#98FB98',\n    paleturquoise:        '#AFEEEE',\n    palevioletred:        '#DB7093',\n    papayawhip:           '#FFEFD5',\n    peachpuff:            '#FFDAB9',\n    peru:                 '#CD853F',\n    pink:                 '#FFC0CB',\n    plum:                 '#DDA0DD',\n    powderblue:           '#B0E0E6',\n    purple:               '#800080',\n    rebeccapurple:        '#663399',\n    red:                  '#FF0000',\n    rosybrown:            '#BC8F8F',\n    royalblue:            '#4169E1',\n    saddlebrown:          '#8B4513',\n    salmon:               '#FA8072',\n    sandybrown:           '#F4A460',\n    seagreen:             '#2E8B57',\n    seashell:             '#FFF5EE',\n    sienna:               '#A0522D',\n    silver:               '#C0C0C0',\n    skyblue:              '#87CEEB',\n    slateblue:            '#6A5ACD',\n    slategray:            '#708090',\n    slategrey:            '#708090',\n    snow:                 '#FFFAFA',\n    springgreen:          '#00FF7F',\n    steelblue:            '#4682B4',\n    tan:                  '#D2B48C',\n    teal:                 '#008080',\n    thistle:              '#D8BFD8',\n    tomato:               '#FF6347',\n    turquoise:            '#40E0D0',\n    violet:               '#EE82EE',\n    wheat:                '#F5DEB3',\n    white:                '#FFFFFF',\n    whitesmoke:           '#F5F5F5',\n    yellow:               '#FFFF00',\n    yellowgreen:          '#9ACD32'\n  };\n\n  /**\n   * @private\n   * @param {Number} p\n   * @param {Number} q\n   * @param {Number} t\n   * @return {Number}\n   */\n  function hue2rgb(p, q, t) {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  /**\n   * Returns new color object, when given a color in RGB format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgb = function(color) {\n    return Color.fromSource(Color.sourceFromRgb(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromRgb = function(color) {\n    var match = color.match(Color.reRGBa);\n    if (match) {\n      var r = parseInt(match[1], 10) / (/%$/.test(match[1]) ? 100 : 1) * (/%$/.test(match[1]) ? 255 : 1),\n          g = parseInt(match[2], 10) / (/%$/.test(match[2]) ? 100 : 1) * (/%$/.test(match[2]) ? 255 : 1),\n          b = parseInt(match[3], 10) / (/%$/.test(match[3]) ? 100 : 1) * (/%$/.test(match[3]) ? 255 : 1);\n\n      return [\n        parseInt(r, 10),\n        parseInt(g, 10),\n        parseInt(b, 10),\n        match[4] ? parseFloat(match[4]) : 1\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given a color in RGBA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgba = Color.fromRgb;\n\n  /**\n   * Returns new color object, when given a color in HSL format\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\n   * @memberOf fabric.Color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsl = function(color) {\n    return Color.fromSource(Color.sourceFromHsl(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\n   * @return {Array} source\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\n   */\n  fabric.Color.sourceFromHsl = function(color) {\n    var match = color.match(Color.reHSLa);\n    if (!match) {\n      return;\n    }\n\n    var h = (((parseFloat(match[1]) % 360) + 360) % 360) / 360,\n        s = parseFloat(match[2]) / (/%$/.test(match[2]) ? 100 : 1),\n        l = parseFloat(match[3]) / (/%$/.test(match[3]) ? 100 : 1),\n        r, g, b;\n\n    if (s === 0) {\n      r = g = b = l;\n    }\n    else {\n      var q = l <= 0.5 ? l * (s + 1) : l + s - l * s,\n          p = l * 2 - q;\n\n      r = hue2rgb(p, q, h + 1 / 3);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [\n      Math.round(r * 255),\n      Math.round(g * 255),\n      Math.round(b * 255),\n      match[4] ? parseFloat(match[4]) : 1\n    ];\n  };\n\n  /**\n   * Returns new color object, when given a color in HSLA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsla = Color.fromHsl;\n\n  /**\n   * Returns new color object, when given a color in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: FF5555\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHex = function(color) {\n    return Color.fromSource(Color.sourceFromHex(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromHex = function(color) {\n    if (color.match(Color.reHex)) {\n      var value = color.slice(color.indexOf('#') + 1),\n          isShortNotation = (value.length === 3 || value.length === 4),\n          isRGBa = (value.length === 8 || value.length === 4),\n          r = isShortNotation ? (value.charAt(0) + value.charAt(0)) : value.substring(0, 2),\n          g = isShortNotation ? (value.charAt(1) + value.charAt(1)) : value.substring(2, 4),\n          b = isShortNotation ? (value.charAt(2) + value.charAt(2)) : value.substring(4, 6),\n          a = isRGBa ? (isShortNotation ? (value.charAt(3) + value.charAt(3)) : value.substring(6, 8)) : 'FF';\n\n      return [\n        parseInt(r, 16),\n        parseInt(g, 16),\n        parseInt(b, 16),\n        parseFloat((parseInt(a, 16) / 255).toFixed(2))\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\n   * @static\n   * @memberOf fabric.Color\n   * @param {Array} source\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromSource = function(source) {\n    var oColor = new Color();\n    oColor.setSource(source);\n    return oColor;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function() {\n\n  /* _FROM_SVG_START_ */\n  function getColorStop(el) {\n    var style = el.getAttribute('style'),\n        offset = el.getAttribute('offset') || 0,\n        color, colorAlpha, opacity, i;\n\n    // convert percents to absolute values\n    offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);\n    offset = offset < 0 ? 0 : offset > 1 ? 1 : offset;\n    if (style) {\n      var keyValuePairs = style.split(/\\s*;\\s*/);\n\n      if (keyValuePairs[keyValuePairs.length - 1] === '') {\n        keyValuePairs.pop();\n      }\n\n      for (i = keyValuePairs.length; i--; ) {\n\n        var split = keyValuePairs[i].split(/\\s*:\\s*/),\n            key = split[0].trim(),\n            value = split[1].trim();\n\n        if (key === 'stop-color') {\n          color = value;\n        }\n        else if (key === 'stop-opacity') {\n          opacity = value;\n        }\n      }\n    }\n\n    if (!color) {\n      color = el.getAttribute('stop-color') || 'rgb(0,0,0)';\n    }\n    if (!opacity) {\n      opacity = el.getAttribute('stop-opacity');\n    }\n\n    color = new fabric.Color(color);\n    colorAlpha = color.getAlpha();\n    opacity = isNaN(parseFloat(opacity)) ? 1 : parseFloat(opacity);\n    opacity *= colorAlpha;\n\n    return {\n      offset: offset,\n      color: color.toRgb(),\n      opacity: opacity\n    };\n  }\n\n  function getLinearCoords(el) {\n    return {\n      x1: el.getAttribute('x1') || 0,\n      y1: el.getAttribute('y1') || 0,\n      x2: el.getAttribute('x2') || '100%',\n      y2: el.getAttribute('y2') || 0\n    };\n  }\n\n  function getRadialCoords(el) {\n    return {\n      x1: el.getAttribute('fx') || el.getAttribute('cx') || '50%',\n      y1: el.getAttribute('fy') || el.getAttribute('cy') || '50%',\n      r1: 0,\n      x2: el.getAttribute('cx') || '50%',\n      y2: el.getAttribute('cy') || '50%',\n      r2: el.getAttribute('r') || '50%'\n    };\n  }\n  /* _FROM_SVG_END_ */\n\n  var clone = fabric.util.object.clone;\n\n  /**\n   * Gradient class\n   * @class fabric.Gradient\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#gradients}\n   * @see {@link fabric.Gradient#initialize} for constructor definition\n   */\n  fabric.Gradient = fabric.util.createClass(/** @lends fabric.Gradient.prototype */ {\n\n    /**\n     * Horizontal offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object with type, coords, gradientUnits and colorStops\n     * @return {fabric.Gradient} thisArg\n     */\n    initialize: function(options) {\n      options || (options = { });\n\n      var coords = { };\n\n      this.id = fabric.Object.__uid++;\n      this.type = options.type || 'linear';\n\n      coords = {\n        x1: options.coords.x1 || 0,\n        y1: options.coords.y1 || 0,\n        x2: options.coords.x2 || 0,\n        y2: options.coords.y2 || 0\n      };\n\n      if (this.type === 'radial') {\n        coords.r1 = options.coords.r1 || 0;\n        coords.r2 = options.coords.r2 || 0;\n      }\n      this.coords = coords;\n      this.colorStops = options.colorStops.slice();\n      if (options.gradientTransform) {\n        this.gradientTransform = options.gradientTransform;\n      }\n      this.offsetX = options.offsetX || this.offsetX;\n      this.offsetY = options.offsetY || this.offsetY;\n    },\n\n    /**\n     * Adds another colorStop\n     * @param {Object} colorStop Object with offset and color\n     * @return {fabric.Gradient} thisArg\n     */\n    addColorStop: function(colorStops) {\n      for (var position in colorStops) {\n        var color = new fabric.Color(colorStops[position]);\n        this.colorStops.push({\n          offset: parseFloat(position),\n          color: color.toRgb(),\n          opacity: color.getAlpha()\n        });\n      }\n      return this;\n    },\n\n    /**\n     * Returns object representation of a gradient\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object}\n     */\n    toObject: function(propertiesToInclude) {\n      var object = {\n        type: this.type,\n        coords: this.coords,\n        colorStops: this.colorStops,\n        offsetX: this.offsetX,\n        offsetY: this.offsetY,\n        gradientTransform: this.gradientTransform ? this.gradientTransform.concat() : this.gradientTransform\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an gradient\n     * @param {Object} object Object to create a gradient for\n     * @return {String} SVG representation of an gradient (linear/radial)\n     */\n    toSVG: function(object) {\n      var coords = clone(this.coords, true), i, len,\n          markup, commonAttributes, colorStops = clone(this.colorStops, true),\n          needsSwap = coords.r1 > coords.r2,\n          offsetX = object.width / 2, offsetY = object.height / 2;\n      // colorStops must be sorted ascending\n      colorStops.sort(function(a, b) {\n        return a.offset - b.offset;\n      });\n      if (object.type === 'path') {\n        offsetX -= object.pathOffset.x;\n        offsetY -= object.pathOffset.y;\n      }\n      for (var prop in coords) {\n        if (prop === 'x1' || prop === 'x2') {\n          coords[prop] += this.offsetX - offsetX;\n        }\n        else if (prop === 'y1' || prop === 'y2') {\n          coords[prop] += this.offsetY - offsetY;\n        }\n      }\n\n      commonAttributes = 'id=\"SVGID_' + this.id +\n                     '\" gradientUnits=\"userSpaceOnUse\"';\n      if (this.gradientTransform) {\n        commonAttributes += ' gradientTransform=\"matrix(' + this.gradientTransform.join(' ') + ')\" ';\n      }\n      if (this.type === 'linear') {\n        markup = [\n          '<linearGradient ',\n          commonAttributes,\n          ' x1=\"', coords.x1,\n          '\" y1=\"', coords.y1,\n          '\" x2=\"', coords.x2,\n          '\" y2=\"', coords.y2,\n          '\">\\n'\n        ];\n      }\n      else if (this.type === 'radial') {\n        // svg radial gradient has just 1 radius. the biggest.\n        markup = [\n          '<radialGradient ',\n          commonAttributes,\n          ' cx=\"', needsSwap ? coords.x1 : coords.x2,\n          '\" cy=\"', needsSwap ? coords.y1 : coords.y2,\n          '\" r=\"', needsSwap ? coords.r1 : coords.r2,\n          '\" fx=\"', needsSwap ? coords.x2 : coords.x1,\n          '\" fy=\"', needsSwap ? coords.y2 : coords.y1,\n          '\">\\n'\n        ];\n      }\n\n      if (this.type === 'radial') {\n        if (needsSwap) {\n          // svg goes from internal to external radius. if radius are inverted, swap color stops.\n          colorStops = colorStops.concat();\n          colorStops.reverse();\n          for (i = 0, len = colorStops.length; i < len; i++) {\n            colorStops[i].offset = 1 - colorStops[i].offset;\n          }\n        }\n        var minRadius = Math.min(coords.r1, coords.r2);\n        if (minRadius > 0) {\n          // i have to shift all colorStops and add new one in 0.\n          var maxRadius = Math.max(coords.r1, coords.r2),\n              percentageShift = minRadius / maxRadius;\n          for (i = 0, len = colorStops.length; i < len; i++) {\n            colorStops[i].offset += percentageShift * (1 - colorStops[i].offset);\n          }\n        }\n      }\n\n      for (i = 0, len = colorStops.length; i < len; i++) {\n        var colorStop = colorStops[i];\n        markup.push(\n          '<stop ',\n          'offset=\"', (colorStop.offset * 100) + '%',\n          '\" style=\"stop-color:', colorStop.color,\n          (typeof colorStop.opacity !== 'undefined' ? ';stop-opacity: ' + colorStop.opacity : ';'),\n          '\"/>\\n'\n        );\n      }\n\n      markup.push((this.type === 'linear' ? '</linearGradient>\\n' : '</radialGradient>\\n'));\n\n      return markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns an instance of CanvasGradient\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {CanvasGradient}\n     */\n    toLive: function(ctx) {\n      var gradient, coords = fabric.util.object.clone(this.coords), i, len;\n\n      if (!this.type) {\n        return;\n      }\n\n      if (this.type === 'linear') {\n        gradient = ctx.createLinearGradient(\n          coords.x1, coords.y1, coords.x2, coords.y2);\n      }\n      else if (this.type === 'radial') {\n        gradient = ctx.createRadialGradient(\n          coords.x1, coords.y1, coords.r1, coords.x2, coords.y2, coords.r2);\n      }\n\n      for (i = 0, len = this.colorStops.length; i < len; i++) {\n        var color = this.colorStops[i].color,\n            opacity = this.colorStops[i].opacity,\n            offset = this.colorStops[i].offset;\n\n        if (typeof opacity !== 'undefined') {\n          color = new fabric.Color(color).setAlpha(opacity).toRgba();\n        }\n        gradient.addColorStop(offset, color);\n      }\n\n      return gradient;\n    }\n  });\n\n  fabric.util.object.extend(fabric.Gradient, {\n\n    /* _FROM_SVG_START_ */\n    /**\n     * Returns {@link fabric.Gradient} instance from an SVG element\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {SVGGradientElement} el SVG gradient element\n     * @param {fabric.Object} instance\n     * @return {fabric.Gradient} Gradient instance\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\n     * @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement\n     */\n    fromElement: function(el, instance) {\n      /**\n       *  @example:\n       *\n       *  <linearGradient id=\"linearGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <linearGradient id=\"linearGrad2\">\n       *    <stop offset=\"0\" style=\"stop-color:rgb(255,255,255)\"/>\n       *    <stop offset=\"1\" style=\"stop-color:rgb(0,0,0)\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *    <stop offset=\"50%\" stop-color=\"black\" stop-opacity=\"0.5\" />\n       *    <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *  </radialGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad2\">\n       *    <stop offset=\"0\" stop-color=\"rgb(255,255,255)\" />\n       *    <stop offset=\"0.5\" stop-color=\"rgb(0,0,0)\" />\n       *    <stop offset=\"1\" stop-color=\"rgb(255,255,255)\" />\n       *  </radialGradient>\n       *\n       */\n\n      var colorStopEls = el.getElementsByTagName('stop'),\n          type,\n          gradientUnits = el.getAttribute('gradientUnits') || 'objectBoundingBox',\n          gradientTransform = el.getAttribute('gradientTransform'),\n          colorStops = [],\n          coords, ellipseMatrix, i;\n\n      if (el.nodeName === 'linearGradient' || el.nodeName === 'LINEARGRADIENT') {\n        type = 'linear';\n      }\n      else {\n        type = 'radial';\n      }\n\n      if (type === 'linear') {\n        coords = getLinearCoords(el);\n      }\n      else if (type === 'radial') {\n        coords = getRadialCoords(el);\n      }\n\n      for (i = colorStopEls.length; i--; ) {\n        colorStops.push(getColorStop(colorStopEls[i]));\n      }\n\n      ellipseMatrix = _convertPercentUnitsToValues(instance, coords, gradientUnits);\n\n      var gradient = new fabric.Gradient({\n        type: type,\n        coords: coords,\n        colorStops: colorStops,\n        offsetX: -instance.left,\n        offsetY: -instance.top\n      });\n\n      if (gradientTransform || ellipseMatrix !== '') {\n        gradient.gradientTransform = fabric.parseTransformAttribute((gradientTransform || '') + ellipseMatrix);\n      }\n\n      return gradient;\n    },\n    /* _FROM_SVG_END_ */\n\n    /**\n     * Returns {@link fabric.Gradient} instance from its object representation\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {Object} obj\n     * @param {Object} [options] Options object\n     */\n    forObject: function(obj, options) {\n      options || (options = { });\n      _convertPercentUnitsToValues(obj, options.coords, 'userSpaceOnUse');\n      return new fabric.Gradient(options);\n    }\n  });\n\n  /**\n   * @private\n   */\n  function _convertPercentUnitsToValues(object, options, gradientUnits) {\n    var propValue, addFactor = 0, multFactor = 1, ellipseMatrix = '';\n    for (var prop in options) {\n      if (options[prop] === 'Infinity') {\n        options[prop] = 1;\n      }\n      else if (options[prop] === '-Infinity') {\n        options[prop] = 0;\n      }\n      propValue = parseFloat(options[prop], 10);\n      if (typeof options[prop] === 'string' && /^(\\d+\\.\\d+)%|(\\d+)%$/.test(options[prop])) {\n        multFactor = 0.01;\n      }\n      else {\n        multFactor = 1;\n      }\n      if (prop === 'x1' || prop === 'x2' || prop === 'r2') {\n        multFactor *= gradientUnits === 'objectBoundingBox' ? object.width : 1;\n        addFactor = gradientUnits === 'objectBoundingBox' ? object.left || 0 : 0;\n      }\n      else if (prop === 'y1' || prop === 'y2') {\n        multFactor *= gradientUnits === 'objectBoundingBox' ? object.height : 1;\n        addFactor = gradientUnits === 'objectBoundingBox' ? object.top || 0 : 0;\n      }\n      options[prop] = propValue * multFactor + addFactor;\n    }\n    if (object.type === 'ellipse' &&\n        options.r2 !== null &&\n        gradientUnits === 'objectBoundingBox' &&\n        object.rx !== object.ry) {\n\n      var scaleFactor = object.ry / object.rx;\n      ellipseMatrix = ' scale(1, ' + scaleFactor + ')';\n      if (options.y1) {\n        options.y1 /= scaleFactor;\n      }\n      if (options.y2) {\n        options.y2 /= scaleFactor;\n      }\n    }\n    return ellipseMatrix;\n  }\n})();\n(function() {\n\n  'use strict';\n\n  var toFixed = fabric.util.toFixed;\n\n  /**\n   * Pattern class\n   * @class fabric.Pattern\n   * @see {@link http://fabricjs.com/patterns|Pattern demo}\n   * @see {@link http://fabricjs.com/dynamic-patterns|DynamicPattern demo}\n   * @see {@link fabric.Pattern#initialize} for constructor definition\n   */\n\n\n  fabric.Pattern = fabric.util.createClass(/** @lends fabric.Pattern.prototype */ {\n\n    /**\n     * Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n     * @type String\n     * @default\n     */\n    repeat: 'repeat',\n\n    /**\n     * Pattern horizontal offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Pattern vertical offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @type String\n     * @default\n     */\n    crossOrigin: '',\n\n    /**\n     * transform matrix to change the pattern, imported from svgs.\n     * @type Array\n     * @default\n     */\n    patternTransform: null,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @param {Function} [callback] function to invoke after callback init.\n     * @return {fabric.Pattern} thisArg\n     */\n    initialize: function(options, callback) {\n      options || (options = { });\n\n      this.id = fabric.Object.__uid++;\n      this.setOptions(options);\n      if (!options.source || (options.source && typeof options.source !== 'string')) {\n        callback && callback(this);\n        return;\n      }\n      // function string\n      if (typeof fabric.util.getFunctionBody(options.source) !== 'undefined') {\n        this.source = new Function(fabric.util.getFunctionBody(options.source));\n        callback && callback(this);\n      }\n      else {\n        // img src string\n        var _this = this;\n        this.source = fabric.util.createImage();\n        fabric.util.loadImage(options.source, function(img) {\n          _this.source = img;\n          callback && callback(_this);\n        }, null, this.crossOrigin);\n      }\n    },\n\n    /**\n     * Returns object representation of a pattern\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of a pattern instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          source, object;\n\n      // callback\n      if (typeof this.source === 'function') {\n        source = String(this.source);\n      }\n      // <img> element\n      else if (typeof this.source.src === 'string') {\n        source = this.source.src;\n      }\n      // <canvas> element\n      else if (typeof this.source === 'object' && this.source.toDataURL) {\n        source = this.source.toDataURL();\n      }\n\n      object = {\n        type: 'pattern',\n        source: source,\n        repeat: this.repeat,\n        crossOrigin: this.crossOrigin,\n        offsetX: toFixed(this.offsetX, NUM_FRACTION_DIGITS),\n        offsetY: toFixed(this.offsetY, NUM_FRACTION_DIGITS),\n        patternTransform: this.patternTransform ? this.patternTransform.concat() : null\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a pattern\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a pattern\n     */\n    toSVG: function(object) {\n      var patternSource = typeof this.source === 'function' ? this.source() : this.source,\n          patternWidth = patternSource.width / object.width,\n          patternHeight = patternSource.height / object.height,\n          patternOffsetX = this.offsetX / object.width,\n          patternOffsetY = this.offsetY / object.height,\n          patternImgSrc = '';\n      if (this.repeat === 'repeat-x' || this.repeat === 'no-repeat') {\n        patternHeight = 1;\n        if (patternOffsetY) {\n          patternHeight += Math.abs(patternOffsetY);\n        }\n      }\n      if (this.repeat === 'repeat-y' || this.repeat === 'no-repeat') {\n        patternWidth = 1;\n        if (patternOffsetX) {\n          patternWidth += Math.abs(patternOffsetX);\n        }\n\n      }\n      if (patternSource.src) {\n        patternImgSrc = patternSource.src;\n      }\n      else if (patternSource.toDataURL) {\n        patternImgSrc = patternSource.toDataURL();\n      }\n\n      return '<pattern id=\"SVGID_' + this.id +\n                    '\" x=\"' + patternOffsetX +\n                    '\" y=\"' + patternOffsetY +\n                    '\" width=\"' + patternWidth +\n                    '\" height=\"' + patternHeight + '\">\\n' +\n               '<image x=\"0\" y=\"0\"' +\n                      ' width=\"' + patternSource.width +\n                      '\" height=\"' + patternSource.height +\n                      '\" xlink:href=\"' + patternImgSrc +\n               '\"></image>\\n' +\n             '</pattern>\\n';\n    },\n    /* _TO_SVG_END_ */\n\n    setOptions: function(options) {\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n    },\n\n    /**\n     * Returns an instance of CanvasPattern\n     * @param {CanvasRenderingContext2D} ctx Context to create pattern\n     * @return {CanvasPattern}\n     */\n    toLive: function(ctx) {\n      var source = typeof this.source === 'function' ? this.source() : this.source;\n\n      // if the image failed to load, return, and allow rest to continue loading\n      if (!source) {\n        return '';\n      }\n\n      // if an image\n      if (typeof source.src !== 'undefined') {\n        if (!source.complete) {\n          return '';\n        }\n        if (source.naturalWidth === 0 || source.naturalHeight === 0) {\n          return '';\n        }\n      }\n      return ctx.createPattern(source, this.repeat);\n    }\n  });\n})();\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Shadow) {\n    fabric.warn('fabric.Shadow is already defined.');\n    return;\n  }\n\n  /**\n   * Shadow class\n   * @class fabric.Shadow\n   * @see {@link http://fabricjs.com/shadows|Shadow demo}\n   * @see {@link fabric.Shadow#initialize} for constructor definition\n   */\n  fabric.Shadow = fabric.util.createClass(/** @lends fabric.Shadow.prototype */ {\n\n    /**\n     * Shadow color\n     * @type String\n     * @default\n     */\n    color: 'rgb(0,0,0)',\n\n    /**\n     * Shadow blur\n     * @type Number\n     */\n    blur: 0,\n\n    /**\n     * Shadow horizontal offset\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Shadow vertical offset\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * Whether the shadow should affect stroke operations\n     * @type Boolean\n     * @default\n     */\n    affectStroke: false,\n\n    /**\n     * Indicates whether toObject should include default values\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Constructor\n     * @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetY properties or string (e.g. \"rgba(0,0,0,0.2) 2px 2px 10px\")\n     * @return {fabric.Shadow} thisArg\n     */\n    initialize: function(options) {\n\n      if (typeof options === 'string') {\n        options = this._parseShadow(options);\n      }\n\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n\n      this.id = fabric.Object.__uid++;\n    },\n\n    /**\n     * @private\n     * @param {String} shadow Shadow value to parse\n     * @return {Object} Shadow object with color, offsetX, offsetY and blur\n     */\n    _parseShadow: function(shadow) {\n      var shadowStr = shadow.trim(),\n          offsetsAndBlur = fabric.Shadow.reOffsetsAndBlur.exec(shadowStr) || [],\n          color = shadowStr.replace(fabric.Shadow.reOffsetsAndBlur, '') || 'rgb(0,0,0)';\n\n      return {\n        color: color.trim(),\n        offsetX: parseInt(offsetsAndBlur[1], 10) || 0,\n        offsetY: parseInt(offsetsAndBlur[2], 10) || 0,\n        blur: parseInt(offsetsAndBlur[3], 10) || 0\n      };\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @see http://www.w3.org/TR/css-text-decor-3/#text-shadow\n     * @return {String} Returns CSS3 text-shadow declaration\n     */\n    toString: function() {\n      return [this.offsetX, this.offsetY, this.blur, this.color].join('px ');\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a shadow\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a shadow\n     */\n    toSVG: function(object) {\n      var fBoxX = 40, fBoxY = 40, NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          offset = fabric.util.rotateVector(\n            { x: this.offsetX, y: this.offsetY },\n            fabric.util.degreesToRadians(-object.angle)),\n          BLUR_BOX = 20, color = new fabric.Color(this.color);\n\n      if (object.width && object.height) {\n        //http://www.w3.org/TR/SVG/filters.html#FilterEffectsRegion\n        // we add some extra space to filter box to contain the blur ( 20 )\n        fBoxX = toFixed((Math.abs(offset.x) + this.blur) / object.width, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n        fBoxY = toFixed((Math.abs(offset.y) + this.blur) / object.height, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n      }\n      if (object.flipX) {\n        offset.x *= -1;\n      }\n      if (object.flipY) {\n        offset.y *= -1;\n      }\n\n      return (\n        '<filter id=\"SVGID_' + this.id + '\" y=\"-' + fBoxY + '%\" height=\"' + (100 + 2 * fBoxY) + '%\" ' +\n          'x=\"-' + fBoxX + '%\" width=\"' + (100 + 2 * fBoxX) + '%\" ' + '>\\n' +\n          '\\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"' +\n            toFixed(this.blur ? this.blur / 2 : 0, NUM_FRACTION_DIGITS) + '\"></feGaussianBlur>\\n' +\n          '\\t<feOffset dx=\"' + toFixed(offset.x, NUM_FRACTION_DIGITS) +\n          '\" dy=\"' + toFixed(offset.y, NUM_FRACTION_DIGITS) + '\" result=\"oBlur\" ></feOffset>\\n' +\n          '\\t<feFlood flood-color=\"' + color.toRgb() + '\" flood-opacity=\"' + color.getAlpha() + '\"/>\\n' +\n          '\\t<feComposite in2=\"oBlur\" operator=\"in\" />\\n' +\n          '\\t<feMerge>\\n' +\n            '\\t\\t<feMergeNode></feMergeNode>\\n' +\n            '\\t\\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\\n' +\n          '\\t</feMerge>\\n' +\n        '</filter>\\n');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns object representation of a shadow\n     * @return {Object} Object representation of a shadow instance\n     */\n    toObject: function() {\n      if (this.includeDefaultValues) {\n        return {\n          color: this.color,\n          blur: this.blur,\n          offsetX: this.offsetX,\n          offsetY: this.offsetY,\n          affectStroke: this.affectStroke\n        };\n      }\n      var obj = { }, proto = fabric.Shadow.prototype;\n\n      ['color', 'blur', 'offsetX', 'offsetY', 'affectStroke'].forEach(function(prop) {\n        if (this[prop] !== proto[prop]) {\n          obj[prop] = this[prop];\n        }\n      }, this);\n\n      return obj;\n    }\n  });\n\n  /**\n   * Regex matching shadow offsetX, offsetY and blur (ex: \"2px 2px 10px rgba(0,0,0,0.2)\", \"rgb(0,255,0) 2px 2px\")\n   * @static\n   * @field\n   * @memberOf fabric.Shadow\n   */\n  // eslint-disable-next-line max-len\n  fabric.Shadow.reOffsetsAndBlur = /(?:\\s|^)(-?\\d+(?:px)?(?:\\s?|$))?(-?\\d+(?:px)?(?:\\s?|$))?(\\d+(?:px)?)?(?:\\s?|$)(?:$|\\s)/;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function () {\n\n  'use strict';\n\n  if (fabric.StaticCanvas) {\n    fabric.warn('fabric.StaticCanvas is already defined.');\n    return;\n  }\n\n  // aliases for faster resolution\n  var extend = fabric.util.object.extend,\n      getElementOffset = fabric.util.getElementOffset,\n      removeFromArray = fabric.util.removeFromArray,\n      toFixed = fabric.util.toFixed,\n      transformPoint = fabric.util.transformPoint,\n      invertTransform = fabric.util.invertTransform,\n      getNodeCanvas = fabric.util.getNodeCanvas,\n      createCanvasElement = fabric.util.createCanvasElement,\n\n      CANVAS_INIT_ERROR = new Error('Could not initialize `canvas` element');\n\n  /**\n   * Static canvas class\n   * @class fabric.StaticCanvas\n   * @mixes fabric.Collection\n   * @mixes fabric.Observable\n   * @see {@link http://fabricjs.com/static_canvas|StaticCanvas demo}\n   * @see {@link fabric.StaticCanvas#initialize} for constructor definition\n   * @fires before:render\n   * @fires after:render\n   * @fires canvas:cleared\n   * @fires object:added\n   * @fires object:removed\n   */\n  fabric.StaticCanvas = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n      this.renderAndResetBound = this.renderAndReset.bind(this);\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\n      this._initStatic(el, options);\n    },\n\n    /**\n     * Background color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    backgroundColor: '',\n\n    /**\n     * Background image of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundImage}.\n     * <b>Backwards incompatibility note:</b> The \"backgroundImageOpacity\"\n     * and \"backgroundImageStretch\" properties are deprecated since 1.3.9.\n     * Use {@link fabric.Image#opacity}, {@link fabric.Image#width} and {@link fabric.Image#height}.\n     * since 2.4.0 image caching is active, please when putting an image as background, add to the\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n     * vale. As an alternative you can disable image objectCaching\n     * @type fabric.Image\n     * @default\n     */\n    backgroundImage: null,\n\n    /**\n     * Overlay color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setOverlayColor}\n     * @since 1.3.9\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    overlayColor: '',\n\n    /**\n     * Overlay image of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setOverlayImage}.\n     * <b>Backwards incompatibility note:</b> The \"overlayImageLeft\"\n     * and \"overlayImageTop\" properties are deprecated since 1.3.9.\n     * Use {@link fabric.Image#left} and {@link fabric.Image#top}.\n     * since 2.4.0 image caching is active, please when putting an image as overlay, add to the\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n     * vale. As an alternative you can disable image objectCaching\n     * @type fabric.Image\n     * @default\n     */\n    overlayImage: null,\n\n    /**\n     * Indicates whether toObject/toDatalessObject should include default values\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Indicates whether objects' state should be saved\n     * @type Boolean\n     * @default\n     */\n    stateful: false,\n\n    /**\n     * Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove},\n     * {@link fabric.StaticCanvas.moveTo}, {@link fabric.StaticCanvas.clear} and many more, should also re-render canvas.\n     * Disabling this option will not give a performance boost when adding/removing a lot of objects to/from canvas at once\n     * since the renders are quequed and executed one per frame.\n     * Disabling is suggested anyway and managing the renders of the app manually is not a big effort ( canvas.requestRenderAll() )\n     * Left default to true to do not break documentation and old app, fiddles.\n     * @type Boolean\n     * @default\n     */\n    renderOnAddRemove: true,\n\n    /**\n     * Function that determines clipping of entire canvas area\n     * Being passed context as first argument.\n     * If you are using code minification, ctx argument can be minified/manglied you should use\n     * as a workaround `var ctx = arguments[0];` in the function;\n     * See clipping canvas area in {@link https://github.com/kangax/fabric.js/wiki/FAQ}\n     * @deprecated since 2.0.0\n     * @type Function\n     * @default\n     */\n    clipTo: null,\n\n    /**\n     * Indicates whether object controls (borders/controls) are rendered above overlay image\n     * @type Boolean\n     * @default\n     */\n    controlsAboveOverlay: false,\n\n    /**\n     * Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas\n     * @type Boolean\n     * @default\n     */\n    allowTouchScrolling: false,\n\n    /**\n     * Indicates whether this canvas will use image smoothing, this is on by default in browsers\n     * @type Boolean\n     * @default\n     */\n    imageSmoothingEnabled: true,\n\n    /**\n     * The transformation (in the format of Canvas transform) which focuses the viewport\n     * @type Array\n     * @default\n     */\n    viewportTransform: fabric.iMatrix.concat(),\n\n    /**\n     * if set to false background image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    backgroundVpt: true,\n\n    /**\n     * if set to false overlya image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    overlayVpt: true,\n\n    /**\n     * Callback; invoked right before object is about to be scaled/rotated\n     * @deprecated since 2.3.0\n     * Use before:transform event\n     */\n    onBeforeScaleRotate: function () {\n      /* NOOP */\n    },\n\n    /**\n     * When true, canvas is scaled by devicePixelRatio for better rendering on retina screens\n     * @type Boolean\n     * @default\n     */\n    enableRetinaScaling: true,\n\n    /**\n     * Describe canvas element extension over design\n     * properties are tl,tr,bl,br.\n     * if canvas is not zoomed/panned those points are the four corner of canvas\n     * if canvas is viewportTransformed you those points indicate the extension\n     * of canvas element in plain untrasformed coordinates\n     * The coordinates get updated with @method calcViewportBoundaries.\n     * @memberOf fabric.StaticCanvas.prototype\n     */\n    vptCoords: { },\n\n    /**\n     * Based on vptCoords and object.aCoords, skip rendering of objects that\n     * are not included in current viewport.\n     * May greatly help in applications with crowded canvas and use of zoom/pan\n     * If One of the corner of the bounding box of the object is on the canvas\n     * the objects get rendered.\n     * @memberOf fabric.StaticCanvas.prototype\n     * @type Boolean\n     * @default\n     */\n    skipOffscreen: true,\n\n    /**\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n     * the clipPath object gets used when the canvas has rendered, and the context is placed in the\n     * top left corner of the canvas.\n     * clipPath will clip away controls, if you do not want this to happen use controlsAboveOverlay = true\n     * @type fabric.Object\n     */\n    clipPath: undefined,\n\n    /**\n     * @private\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     */\n    _initStatic: function(el, options) {\n      var cb = this.requestRenderAllBound;\n      this._objects = [];\n      this._createLowerCanvas(el);\n      this._initOptions(options);\n      this._setImageSmoothing();\n      // only initialize retina scaling once\n      if (!this.interactive) {\n        this._initRetinaScaling();\n      }\n\n      if (options.overlayImage) {\n        this.setOverlayImage(options.overlayImage, cb);\n      }\n      if (options.backgroundImage) {\n        this.setBackgroundImage(options.backgroundImage, cb);\n      }\n      if (options.backgroundColor) {\n        this.setBackgroundColor(options.backgroundColor, cb);\n      }\n      if (options.overlayColor) {\n        this.setOverlayColor(options.overlayColor, cb);\n      }\n      this.calcOffset();\n    },\n\n    /**\n     * @private\n     */\n    _isRetinaScaling: function() {\n      return (fabric.devicePixelRatio !== 1 && this.enableRetinaScaling);\n    },\n\n    /**\n     * @private\n     * @return {Number} retinaScaling if applied, otherwise 1;\n     */\n    getRetinaScaling: function() {\n      return this._isRetinaScaling() ? fabric.devicePixelRatio : 1;\n    },\n\n    /**\n     * @private\n     */\n    _initRetinaScaling: function() {\n      if (!this._isRetinaScaling()) {\n        return;\n      }\n      this.lowerCanvasEl.setAttribute('width', this.width * fabric.devicePixelRatio);\n      this.lowerCanvasEl.setAttribute('height', this.height * fabric.devicePixelRatio);\n\n      this.contextContainer.scale(fabric.devicePixelRatio, fabric.devicePixelRatio);\n    },\n\n    /**\n     * Calculates canvas element offset relative to the document\n     * This method is also attached as \"resize\" event handler of window\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    calcOffset: function () {\n      this._offset = getElementOffset(this.lowerCanvasEl);\n      return this;\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to\n     * @param {Function} callback callback to invoke when image is loaded and set as an overlay\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}\n     * @example <caption>Normal overlayImage with left/top = 0</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage with different properties</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage loaded from cross-origin</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    setOverlayImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('overlayImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/djnr8o7a/28/|jsFiddle demo}\n     * @example <caption>Normal backgroundImage with left/top = 0</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage with different properties</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage loaded from cross-origin</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    // TODO: fix stretched examples\n    setBackgroundImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('backgroundImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayColor|foreground color} for this canvas\n     * @param {(String|fabric.Pattern)} overlayColor Color or pattern to set foreground color to\n     * @param {Function} callback Callback to invoke when foreground color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}\n     * @example <caption>Normal overlayColor - color value</caption>\n     * canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setOverlayColor: function(overlayColor, callback) {\n      return this.__setBgOverlayColor('overlayColor', overlayColor, callback);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas\n     * @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to\n     * @param {Function} callback Callback to invoke when background color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}\n     * @example <caption>Normal backgroundColor - color value</caption>\n     * canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setBackgroundColor: function(backgroundColor, callback) {\n      return this.__setBgOverlayColor('backgroundColor', backgroundColor, callback);\n    },\n\n    /**\n     * @private\n     * @see {@link http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-imagesmoothingenabled|WhatWG Canvas Standard}\n     */\n    _setImageSmoothing: function() {\n      var ctx = this.getContext();\n\n      ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled || ctx.webkitImageSmoothingEnabled\n        || ctx.mozImageSmoothingEnabled || ctx.msImageSmoothingEnabled || ctx.oImageSmoothingEnabled;\n      ctx.imageSmoothingEnabled = this.imageSmoothingEnabled;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}\n     * or {@link fabric.StaticCanvas#overlayImage|overlayImage})\n     * @param {(fabric.Image|String|null)} image fabric.Image instance, URL of an image or null to set background or overlay to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background or overlay\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.\n     */\n    __setBgOverlayImage: function(property, image, callback, options) {\n      if (typeof image === 'string') {\n        fabric.util.loadImage(image, function(img) {\n          if (img) {\n            var instance = new fabric.Image(img, options);\n            this[property] = instance;\n            instance.canvas = this;\n          }\n          callback && callback(img);\n        }, this, options && options.crossOrigin);\n      }\n      else {\n        options && image.setOptions(options);\n        this[property] = image;\n        image && (image.canvas = this);\n        callback && callback(image);\n      }\n\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}\n     * or {@link fabric.StaticCanvas#overlayColor|overlayColor})\n     * @param {(Object|String|null)} color Object with pattern information, color value or null\n     * @param {Function} [callback] Callback is invoked when color is set\n     */\n    __setBgOverlayColor: function(property, color, callback) {\n      this[property] = color;\n      this._initGradient(color, property);\n      this._initPattern(color, property, callback);\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _createCanvasElement: function() {\n      var element = createCanvasElement();\n      if (!element) {\n        throw CANVAS_INIT_ERROR;\n      }\n      if (!element.style) {\n        element.style = { };\n      }\n      if (typeof element.getContext === 'undefined') {\n        throw CANVAS_INIT_ERROR;\n      }\n      return element;\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initOptions: function (options) {\n      var lowerCanvasEl = this.lowerCanvasEl;\n      this._setOptions(options);\n\n      this.width = this.width || parseInt(lowerCanvasEl.width, 10) || 0;\n      this.height = this.height || parseInt(lowerCanvasEl.height, 10) || 0;\n\n      if (!this.lowerCanvasEl.style) {\n        return;\n      }\n\n      lowerCanvasEl.width = this.width;\n      lowerCanvasEl.height = this.height;\n\n      lowerCanvasEl.style.width = this.width + 'px';\n      lowerCanvasEl.style.height = this.height + 'px';\n\n      this.viewportTransform = this.viewportTransform.slice();\n    },\n\n    /**\n     * Creates a bottom canvas\n     * @private\n     * @param {HTMLElement} [canvasEl]\n     */\n    _createLowerCanvas: function (canvasEl) {\n      // canvasEl === 'HTMLCanvasElement' does not work on jsdom/node\n      if (canvasEl && canvasEl.getContext) {\n        this.lowerCanvasEl = canvasEl;\n      }\n      else {\n        this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();\n      }\n\n      fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');\n\n      if (this.interactive) {\n        this._applyCanvasStyle(this.lowerCanvasEl);\n      }\n\n      this.contextContainer = this.lowerCanvasEl.getContext('2d');\n    },\n\n    /**\n     * Returns canvas width (in px)\n     * @return {Number}\n     */\n    getWidth: function () {\n      return this.width;\n    },\n\n    /**\n     * Returns canvas height (in px)\n     * @return {Number}\n     */\n    getHeight: function () {\n      return this.height;\n    },\n\n    /**\n     * Sets width of this canvas instance\n     * @param {Number|String} value                         Value to set width to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setWidth: function (value, options) {\n      return this.setDimensions({ width: value }, options);\n    },\n\n    /**\n     * Sets height of this canvas instance\n     * @param {Number|String} value                         Value to set height to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setHeight: function (value, options) {\n      return this.setDimensions({ height: value }, options);\n    },\n\n    /**\n     * Sets dimensions (width, height) of this canvas instance. when options.cssOnly flag active you should also supply the unit of measure (px/%/em)\n     * @param {Object}        dimensions                    Object with width/height properties\n     * @param {Number|String} [dimensions.width]            Width of canvas element\n     * @param {Number|String} [dimensions.height]           Height of canvas element\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setDimensions: function (dimensions, options) {\n      var cssValue;\n\n      options = options || {};\n\n      for (var prop in dimensions) {\n        cssValue = dimensions[prop];\n\n        if (!options.cssOnly) {\n          this._setBackstoreDimension(prop, dimensions[prop]);\n          cssValue += 'px';\n          this.hasLostContext = true;\n        }\n\n        if (!options.backstoreOnly) {\n          this._setCssDimension(prop, cssValue);\n        }\n      }\n      if (this._isCurrentlyDrawing) {\n        this.freeDrawingBrush && this.freeDrawingBrush._setBrushStyles();\n      }\n      this._initRetinaScaling();\n      this._setImageSmoothing();\n      this.calcOffset();\n\n      if (!options.cssOnly) {\n        this.requestRenderAll();\n      }\n\n      return this;\n    },\n\n    /**\n     * Helper for setting width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {Number} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setBackstoreDimension: function (prop, value) {\n      this.lowerCanvasEl[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl[prop] = value;\n      }\n\n      if (this.cacheCanvasEl) {\n        this.cacheCanvasEl[prop] = value;\n      }\n\n      this[prop] = value;\n\n      return this;\n    },\n\n    /**\n     * Helper for setting css width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {String} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setCssDimension: function (prop, value) {\n      this.lowerCanvasEl.style[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl.style[prop] = value;\n      }\n\n      if (this.wrapperEl) {\n        this.wrapperEl.style[prop] = value;\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns canvas zoom level\n     * @return {Number}\n     */\n    getZoom: function () {\n      return this.viewportTransform[0];\n    },\n\n    /**\n     * Sets viewport transform of this canvas instance\n     * @param {Array} vpt the transform in the form of context.transform\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setViewportTransform: function (vpt) {\n      var activeObject = this._activeObject, object, ignoreVpt = false, skipAbsolute = true, i, len;\n      this.viewportTransform = vpt;\n      for (i = 0, len = this._objects.length; i < len; i++) {\n        object = this._objects[i];\n        object.group || object.setCoords(ignoreVpt, skipAbsolute);\n      }\n      if (activeObject && activeObject.type === 'activeSelection') {\n        activeObject.setCoords(ignoreVpt, skipAbsolute);\n      }\n      this.calcViewportBoundaries();\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Sets zoom level of this canvas instance, zoom centered around point\n     * @param {fabric.Point} point to zoom with respect to\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    zoomToPoint: function (point, value) {\n      // TODO: just change the scale, preserve other transformations\n      var before = point, vpt = this.viewportTransform.slice(0);\n      point = transformPoint(point, invertTransform(this.viewportTransform));\n      vpt[0] = value;\n      vpt[3] = value;\n      var after = transformPoint(point, vpt);\n      vpt[4] += before.x - after.x;\n      vpt[5] += before.y - after.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Sets zoom level of this canvas instance\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setZoom: function (value) {\n      this.zoomToPoint(new fabric.Point(0, 0), value);\n      return this;\n    },\n\n    /**\n     * Pan viewport so as to place point at top left corner of canvas\n     * @param {fabric.Point} point to move to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    absolutePan: function (point) {\n      var vpt = this.viewportTransform.slice(0);\n      vpt[4] = -point.x;\n      vpt[5] = -point.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Pans viewpoint relatively\n     * @param {fabric.Point} point (position vector) to move by\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    relativePan: function (point) {\n      return this.absolutePan(new fabric.Point(\n        -point.x - this.viewportTransform[4],\n        -point.y - this.viewportTransform[5]\n      ));\n    },\n\n    /**\n     * Returns &lt;canvas> element corresponding to this instance\n     * @return {HTMLCanvasElement}\n     */\n    getElement: function () {\n      return this.lowerCanvasEl;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was added\n     */\n    _onObjectAdded: function(obj) {\n      this.stateful && obj.setupState();\n      obj._set('canvas', this);\n      obj.setCoords();\n      this.fire('object:added', { target: obj });\n      obj.fire('added');\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      this.fire('object:removed', { target: obj });\n      obj.fire('removed');\n      delete obj.canvas;\n    },\n\n    /**\n     * Clears specified context of canvas element\n     * @param {CanvasRenderingContext2D} ctx Context to clear\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clearContext: function(ctx) {\n      ctx.clearRect(0, 0, this.width, this.height);\n      return this;\n    },\n\n    /**\n     * Returns context of canvas where objects are drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getContext: function () {\n      return this.contextContainer;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      this._objects.length = 0;\n      this.backgroundImage = null;\n      this.overlayImage = null;\n      this.backgroundColor = '';\n      this.overlayColor = '';\n      if (this._hasITextHandlers) {\n        this.off('mouse:up', this._mouseUpITextHandler);\n        this._iTextInstances = null;\n        this._hasITextHandlers = false;\n      }\n      this.clearContext(this.contextContainer);\n      this.fire('canvas:cleared');\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Renders the canvas\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._objects);\n      return this;\n    },\n\n    /**\n     * Function created to be instance bound at initialization\n     * used in requestAnimationFrame rendering\n     * Let the fabricJS call it. If you call it manually you could have more\n     * animationFrame stacking on to of each other\n     * for an imperative rendering, use canvas.renderAll\n     * @private\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAndReset: function() {\n      this.isRendering = 0;\n      this.renderAll();\n    },\n\n    /**\n     * Append a renderAll request to next animation frame.\n     * unless one is already in progress, in that case nothing is done\n     * a boolean flag will avoid appending more.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    requestRenderAll: function () {\n      if (!this.isRendering) {\n        this.isRendering = fabric.util.requestAnimFrame(this.renderAndResetBound);\n      }\n      return this;\n    },\n\n    /**\n     * Calculate the position of the 4 corner of canvas with current viewportTransform.\n     * helps to determinate when an object is in the current rendering viewport using\n     * object absolute coordinates ( aCoords )\n     * @return {Object} points.tl\n     * @chainable\n     */\n    calcViewportBoundaries: function() {\n      var points = { }, width = this.width, height = this.height,\n          iVpt = invertTransform(this.viewportTransform);\n      points.tl = transformPoint({ x: 0, y: 0 }, iVpt);\n      points.br = transformPoint({ x: width, y: height }, iVpt);\n      points.tr = new fabric.Point(points.br.x, points.tl.y);\n      points.bl = new fabric.Point(points.tl.x, points.br.y);\n      this.vptCoords = points;\n      return points;\n    },\n\n    cancelRequestedRender: function() {\n      if (this.isRendering) {\n        fabric.util.cancelAnimFrame(this.isRendering);\n        this.isRendering = 0;\n      }\n    },\n\n    /**\n     * Renders background, objects, overlay and controls.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {Array} objects to render\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderCanvas: function(ctx, objects) {\n      var v = this.viewportTransform, path = this.clipPath;\n      this.cancelRequestedRender();\n      this.calcViewportBoundaries();\n      this.clearContext(ctx);\n      this.fire('before:render', { ctx: ctx, });\n      if (this.clipTo) {\n        fabric.util.clipContext(this, ctx);\n      }\n      this._renderBackground(ctx);\n\n      ctx.save();\n      //apply viewport transform once for all rendering process\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      this._renderObjects(ctx, objects);\n      ctx.restore();\n      if (!this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      if (this.clipTo) {\n        ctx.restore();\n      }\n      if (path) {\n        path.canvas = this;\n        // needed to setup a couple of variables\n        path.shouldCache();\n        path._transformDone = true;\n        path.renderCache({ forClipping: true });\n        this.drawClipPathOnCanvas(ctx);\n      }\n      this._renderOverlay(ctx);\n      if (this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      this.fire('after:render', { ctx: ctx, });\n    },\n\n    /**\n     * Paint the cached clipPath on the lowerCanvasEl\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawClipPathOnCanvas: function(ctx) {\n      var v = this.viewportTransform, path = this.clipPath;\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      // DEBUG: uncomment this line, comment the following\n      // ctx.globalAlpha = 0.4;\n      ctx.globalCompositeOperation = 'destination-in';\n      path.transform(ctx);\n      ctx.scale(1 / path.zoomX, 1 / path.zoomY);\n      ctx.drawImage(path._cacheCanvas, -path.cacheTranslationX, -path.cacheTranslationY);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} objects to render\n     */\n    _renderObjects: function(ctx, objects) {\n      var i, len;\n      for (i = 0, len = objects.length; i < len; ++i) {\n        objects[i] && objects[i].render(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {string} property 'background' or 'overlay'\n     */\n    _renderBackgroundOrOverlay: function(ctx, property) {\n      var object = this[property + 'Color'], v;\n      if (object) {\n        ctx.fillStyle = object.toLive\n          ? object.toLive(ctx, this)\n          : object;\n\n        ctx.fillRect(\n          object.offsetX || 0,\n          object.offsetY || 0,\n          this.width,\n          this.height);\n      }\n      object = this[property + 'Image'];\n      if (object) {\n        if (this[property + 'Vpt']) {\n          v = this.viewportTransform;\n          ctx.save();\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        }\n        object.render(ctx);\n        this[property + 'Vpt'] && ctx.restore();\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'background');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderOverlay: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'overlay');\n    },\n\n    /**\n     * Returns coordinates of a center of canvas.\n     * Returned value is an object with top and left properties\n     * @return {Object} object with \"top\" and \"left\" number values\n     */\n    getCenter: function () {\n      return {\n        top: this.height / 2,\n        left: this.width / 2\n      };\n    },\n\n    /**\n     * Centers object horizontally in the canvas\n     * @param {fabric.Object} object Object to center horizontally\n     * @return {fabric.Canvas} thisArg\n     */\n    centerObjectH: function (object) {\n      return this._centerObject(object, new fabric.Point(this.getCenter().left, object.getCenterPoint().y));\n    },\n\n    /**\n     * Centers object vertically in the canvas\n     * @param {fabric.Object} object Object to center vertically\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObjectV: function (object) {\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, this.getCenter().top));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the canvas\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObject: function(object) {\n      var center = this.getCenter();\n\n      return this._centerObject(object, new fabric.Point(center.left, center.top));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the viewport\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObject: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, vpCenter);\n    },\n\n    /**\n     * Centers object horizontally in the viewport, object.top is unchanged\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectH: function(object) {\n      var vpCenter = this.getVpCenter();\n      this._centerObject(object, new fabric.Point(vpCenter.x, object.getCenterPoint().y));\n      return this;\n    },\n\n    /**\n     * Centers object Vertically in the viewport, object.top is unchanged\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectV: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, vpCenter.y));\n    },\n\n    /**\n     * Calculate the point in canvas that correspond to the center of actual viewport.\n     * @return {fabric.Point} vpCenter, viewport center\n     * @chainable\n     */\n    getVpCenter: function() {\n      var center = this.getCenter(),\n          iVpt = invertTransform(this.viewportTransform);\n      return transformPoint({ x: center.left, y: center.top }, iVpt);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} object Object to center\n     * @param {fabric.Point} center Center point\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    _centerObject: function(object, center) {\n      object.setPositionByOrigin(center, 'center', 'center');\n      object.setCoords();\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Returs dataless JSON representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {String} json string\n     */\n    toDatalessJSON: function (propertiesToInclude) {\n      return this.toDatalessObject(propertiesToInclude);\n    },\n\n    /**\n     * Returns object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toObject', propertiesToInclude);\n    },\n\n    /**\n     * Returns dataless object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toDatalessObject', propertiesToInclude);\n    },\n\n    /**\n     * @private\n     */\n    _toObjectMethod: function (methodName, propertiesToInclude) {\n\n      var clipPath = this.clipPath, data = {\n        version: fabric.version,\n        objects: this._toObjects(methodName, propertiesToInclude),\n      };\n      if (clipPath) {\n        clipPath = clipPath.toObject(propertiesToInclude);\n      }\n      extend(data, this.__serializeBgOverlay(methodName, propertiesToInclude));\n\n      fabric.util.populateWithProperties(this, data, propertiesToInclude);\n\n      return data;\n    },\n\n    /**\n     * @private\n     */\n    _toObjects: function(methodName, propertiesToInclude) {\n      return this._objects.filter(function(object) {\n        return !object.excludeFromExport;\n      }).map(function(instance) {\n        return this._toObject(instance, methodName, propertiesToInclude);\n      }, this);\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      var originalValue;\n\n      if (!this.includeDefaultValues) {\n        originalValue = instance.includeDefaultValues;\n        instance.includeDefaultValues = false;\n      }\n\n      var object = instance[methodName](propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        instance.includeDefaultValues = originalValue;\n      }\n      return object;\n    },\n\n    /**\n     * @private\n     */\n    __serializeBgOverlay: function(methodName, propertiesToInclude) {\n      var data = { }, bgImage = this.backgroundImage, overlay = this.overlayImage;\n\n      if (this.backgroundColor) {\n        data.background = this.backgroundColor.toObject\n          ? this.backgroundColor.toObject(propertiesToInclude)\n          : this.backgroundColor;\n      }\n\n      if (this.overlayColor) {\n        data.overlay = this.overlayColor.toObject\n          ? this.overlayColor.toObject(propertiesToInclude)\n          : this.overlayColor;\n      }\n      if (bgImage && !bgImage.excludeFromExport) {\n        data.backgroundImage = this._toObject(bgImage, methodName, propertiesToInclude);\n      }\n      if (overlay && !overlay.excludeFromExport) {\n        data.overlayImage = this._toObject(overlay, methodName, propertiesToInclude);\n      }\n\n      return data;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * When true, getSvgTransform() will apply the StaticCanvas.viewportTransform to the SVG transformation. When true,\n     * a zoomed canvas will then produce zoomed SVG output.\n     * @type Boolean\n     * @default\n     */\n    svgViewportTransformation: true,\n\n    /**\n     * Returns SVG representation of canvas\n     * @function\n     * @param {Object} [options] Options object for SVG output\n     * @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included\n     * @param {Object} [options.viewBox] SVG viewbox object\n     * @param {Number} [options.viewBox.x] x-cooridnate of viewbox\n     * @param {Number} [options.viewBox.y] y-coordinate of viewbox\n     * @param {Number} [options.viewBox.width] Width of viewbox\n     * @param {Number} [options.viewBox.height] Height of viewbox\n     * @param {String} [options.encoding=UTF-8] Encoding of SVG output\n     * @param {String} [options.width] desired width of svg with or without units\n     * @param {String} [options.height] desired height of svg with or without units\n     * @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.\n     * @return {String} SVG string\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n     * @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}\n     * @example <caption>Normal SVG output</caption>\n     * var svg = canvas.toSVG();\n     * @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>\n     * var svg = canvas.toSVG({suppressPreamble: true});\n     * @example <caption>SVG output with viewBox attribute</caption>\n     * var svg = canvas.toSVG({\n     *   viewBox: {\n     *     x: 100,\n     *     y: 100,\n     *     width: 200,\n     *     height: 300\n     *   }\n     * });\n     * @example <caption>SVG output with different encoding (default: UTF-8)</caption>\n     * var svg = canvas.toSVG({encoding: 'ISO-8859-1'});\n     * @example <caption>Modify SVG output with reviver function</caption>\n     * var svg = canvas.toSVG(null, function(svg) {\n     *   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');\n     * });\n     */\n    toSVG: function(options, reviver) {\n      options || (options = { });\n      options.reviver = reviver;\n      var markup = [];\n\n      this._setSVGPreamble(markup, options);\n      this._setSVGHeader(markup, options);\n      if (this.clipPath) {\n        markup.push('<g clip-path=\"url(#' + this.clipPath.clipPathId + ')\" >\\n');\n      }\n      this._setSVGBgOverlayColor(markup, 'backgroundColor');\n      this._setSVGBgOverlayImage(markup, 'backgroundImage', reviver);\n      this._setSVGObjects(markup, reviver);\n      if (this.clipPath) {\n        markup.push('</g>\\n');\n      }\n      this._setSVGBgOverlayColor(markup, 'overlayColor');\n      this._setSVGBgOverlayImage(markup, 'overlayImage', reviver);\n\n      markup.push('</svg>');\n\n      return markup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _setSVGPreamble: function(markup, options) {\n      if (options.suppressPreamble) {\n        return;\n      }\n      markup.push(\n        '<?xml version=\"1.0\" encoding=\"', (options.encoding || 'UTF-8'), '\" standalone=\"no\" ?>\\n',\n        '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ',\n        '\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n'\n      );\n    },\n\n    /**\n     * @private\n     */\n    _setSVGHeader: function(markup, options) {\n      var width = options.width || this.width,\n          height = options.height || this.height,\n          vpt, viewBox = 'viewBox=\"0 0 ' + this.width + ' ' + this.height + '\" ',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      if (options.viewBox) {\n        viewBox = 'viewBox=\"' +\n                options.viewBox.x + ' ' +\n                options.viewBox.y + ' ' +\n                options.viewBox.width + ' ' +\n                options.viewBox.height + '\" ';\n      }\n      else {\n        if (this.svgViewportTransformation) {\n          vpt = this.viewportTransform;\n          viewBox = 'viewBox=\"' +\n                  toFixed(-vpt[4] / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(-vpt[5] / vpt[3], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.width / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.height / vpt[3], NUM_FRACTION_DIGITS) + '\" ';\n        }\n      }\n\n      markup.push(\n        '<svg ',\n        'xmlns=\"http://www.w3.org/2000/svg\" ',\n        'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ',\n        'version=\"1.1\" ',\n        'width=\"', width, '\" ',\n        'height=\"', height, '\" ',\n        viewBox,\n        'xml:space=\"preserve\">\\n',\n        '<desc>Created with Fabric.js ', fabric.version, '</desc>\\n',\n        '<defs>\\n',\n        this.createSVGFontFacesMarkup(),\n        this.createSVGRefElementsMarkup(),\n        this.createSVGClipPathMarkup(options),\n        '</defs>\\n'\n      );\n    },\n\n    createSVGClipPathMarkup: function(options) {\n      var clipPath = this.clipPath;\n      if (clipPath) {\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\n        return  '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\n          this.clipPath.toClipPathSVG(options.reviver) +\n          '</clipPath>\\n';\n      }\n      return '';\n    },\n\n    /**\n     * Creates markup containing SVG referenced elements like patterns, gradients etc.\n     * @return {String}\n     */\n    createSVGRefElementsMarkup: function() {\n      var _this = this,\n          markup = ['backgroundColor', 'overlayColor'].map(function(prop) {\n            var fill = _this[prop];\n            if (fill && fill.toLive) {\n              return fill.toSVG(_this, false);\n            }\n          });\n      return markup.join('');\n    },\n\n    /**\n     * Creates markup containing SVG font faces,\n     * font URLs for font faces must be collected by developers\n     * and are not extracted from the DOM by fabricjs\n     * @param {Array} objects Array of fabric objects\n     * @return {String}\n     */\n    createSVGFontFacesMarkup: function() {\n      var markup = '', fontList = { }, obj, fontFamily,\n          style, row, rowIndex, _char, charIndex, i, len,\n          fontPaths = fabric.fontPaths, objects = this._objects;\n\n      for (i = 0, len = objects.length; i < len; i++) {\n        obj = objects[i];\n        fontFamily = obj.fontFamily;\n        if (obj.type.indexOf('text') === -1 || fontList[fontFamily] || !fontPaths[fontFamily]) {\n          continue;\n        }\n        fontList[fontFamily] = true;\n        if (!obj.styles) {\n          continue;\n        }\n        style = obj.styles;\n        for (rowIndex in style) {\n          row = style[rowIndex];\n          for (charIndex in row) {\n            _char = row[charIndex];\n            fontFamily = _char.fontFamily;\n            if (!fontList[fontFamily] && fontPaths[fontFamily]) {\n              fontList[fontFamily] = true;\n            }\n          }\n        }\n      }\n\n      for (var j in fontList) {\n        markup += [\n          '\\t\\t@font-face {\\n',\n          '\\t\\t\\tfont-family: \\'', j, '\\';\\n',\n          '\\t\\t\\tsrc: url(\\'', fontPaths[j], '\\');\\n',\n          '\\t\\t}\\n'\n        ].join('');\n      }\n\n      if (markup) {\n        markup = [\n          '\\t<style type=\"text/css\">',\n          '<![CDATA[\\n',\n          markup,\n          ']]>',\n          '</style>\\n'\n        ].join('');\n      }\n\n      return markup;\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObjects: function(markup, reviver) {\n      var instance, i, len, objects = this._objects;\n      for (i = 0, len = objects.length; i < len; i++) {\n        instance = objects[i];\n        if (instance.excludeFromExport) {\n          continue;\n        }\n        this._setSVGObject(markup, instance, reviver);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      markup.push(instance.toSVG(reviver));\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayImage: function(markup, property, reviver) {\n      if (this[property] && !this[property].excludeFromExport && this[property].toSVG) {\n        markup.push(this[property].toSVG(reviver));\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayColor: function(markup, property) {\n      var filler = this[property], vpt = this.viewportTransform, finalWidth = this.width / vpt[0],\n          finalHeight = this.height / vpt[3];\n      if (!filler) {\n        return;\n      }\n      if (filler.toLive) {\n        var repeat = filler.repeat;\n        markup.push(\n          '<rect transform=\"translate(', finalWidth / 2, ',', finalHeight / 2, ')\"',\n          ' x=\"', filler.offsetX - finalWidth / 2, '\" y=\"', filler.offsetY - finalHeight / 2, '\" ',\n          'width=\"',\n          (repeat === 'repeat-y' || repeat === 'no-repeat'\n            ? filler.source.width\n            : finalWidth ),\n          '\" height=\"',\n          (repeat === 'repeat-x' || repeat === 'no-repeat'\n            ? filler.source.height\n            : finalHeight),\n          '\" fill=\"url(#SVGID_' + filler.id + ')\"',\n          '></rect>\\n'\n        );\n      }\n      else {\n        markup.push(\n          '<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" ',\n          'fill=\"', this[property], '\"',\n          '></rect>\\n'\n        );\n      }\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the bottom of the stack of drawn objects\n     * @param {fabric.Object} object Object to send to back\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendToBack: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, objs;\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.unshift(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.unshift(object);\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the top of the stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringToFront: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, objs;\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.push(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.push(object);\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Moves an object or a selection down in stack of drawn objects\n     * An optional paramter, intersecting allowes to move the object in behind\n     * the first intersecting object. Where intersection is calculated with\n     * bounding box. If no intersection is found, there will not be change in the\n     * stack.\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendBackwards: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx > 0 + objsMoved) {\n            newIdx = idx - 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== 0) {\n          // if object is not on the bottom of stack\n          newIdx = this._findNewLowerIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewLowerIndex: function(object, idx, intersecting) {\n      var newIdx, i;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse down the stack looking for the nearest intersecting object\n        for (i = idx - 1; i >= 0; --i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx - 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object or a selection up in stack of drawn objects\n     * An optional paramter, intersecting allowes to move the object in front\n     * of the first intersecting object. Where intersection is calculated with\n     * bounding box. If no intersection is found, there will not be change in the\n     * stack.\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringForward: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx < this._objects.length - 1 - objsMoved) {\n            newIdx = idx + 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== this._objects.length - 1) {\n          // if object is not on top of stack (last item in an array)\n          newIdx = this._findNewUpperIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewUpperIndex: function(object, idx, intersecting) {\n      var newIdx, i, len;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse up the stack looking for the nearest intersecting object\n        for (i = idx + 1, len = this._objects.length; i < len; ++i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx + 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object to specified level in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Number} index Position to move to\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    moveTo: function (object, index) {\n      removeFromArray(this._objects, object);\n      this._objects.splice(index, 0, object);\n      return this.renderOnAddRemove && this.requestRenderAll();\n    },\n\n    /**\n     * Clears a canvas element and dispose objects\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      // cancel eventually ongoing renders\n      if (this.isRendering) {\n        fabric.util.cancelAnimFrame(this.isRendering);\n        this.isRendering = 0;\n      }\n      this.forEachObject(function(object) {\n        object.dispose && object.dispose();\n      });\n      this._objects = [];\n      if (this.backgroundImage && this.backgroundImage.dispose) {\n        this.backgroundImage.dispose();\n      }\n      this.backgroundImage = null;\n      if (this.overlayImage && this.overlayImage.dispose) {\n        this.overlayImage.dispose();\n      }\n      this.overlayImage = null;\n      this._iTextInstances = null;\n      this.contextContainer = null;\n      fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);\n      this.lowerCanvasEl = undefined;\n      return this;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function () {\n      return '#<fabric.Canvas (' + this.complexity() + '): ' +\n               '{ objects: ' + this._objects.length + ' }>';\n    }\n  });\n\n  extend(fabric.StaticCanvas.prototype, fabric.Observable);\n  extend(fabric.StaticCanvas.prototype, fabric.Collection);\n  extend(fabric.StaticCanvas.prototype, fabric.DataURLExporter);\n\n  extend(fabric.StaticCanvas, /** @lends fabric.StaticCanvas */ {\n\n    /**\n     * @static\n     * @type String\n     * @default\n     */\n    EMPTY_JSON: '{\"objects\": [], \"background\": \"white\"}',\n\n    /**\n     * Provides a way to check support of some of the canvas methods\n     * (either those of HTMLCanvasElement itself, or rendering context)\n     *\n     * @param {String} methodName Method to check support for;\n     *                            Could be one of \"getImageData\", \"toDataURL\", \"toDataURLWithQuality\" or \"setLineDash\"\n     * @return {Boolean | null} `true` if method is supported (or at least exists),\n     *                          `null` if canvas element or context can not be initialized\n     */\n    supports: function (methodName) {\n      var el = createCanvasElement();\n\n      if (!el || !el.getContext) {\n        return null;\n      }\n\n      var ctx = el.getContext('2d');\n      if (!ctx) {\n        return null;\n      }\n\n      switch (methodName) {\n\n        case 'getImageData':\n          return typeof ctx.getImageData !== 'undefined';\n\n        case 'setLineDash':\n          return typeof ctx.setLineDash !== 'undefined';\n\n        case 'toDataURL':\n          return typeof el.toDataURL !== 'undefined';\n\n        case 'toDataURLWithQuality':\n          try {\n            el.toDataURL('image/jpeg', 0);\n            return true;\n          }\n          catch (e) { }\n          return false;\n\n        default:\n          return null;\n      }\n    }\n  });\n\n  /**\n   * Returns JSON representation of canvas\n   * @function\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {String} JSON string\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n   * @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}\n   * @example <caption>JSON without additional properties</caption>\n   * var json = canvas.toJSON();\n   * @example <caption>JSON with additional properties included</caption>\n   * var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY', 'lockUniScaling']);\n   * @example <caption>JSON without default values</caption>\n   * canvas.includeDefaultValues = false;\n   * var json = canvas.toJSON();\n   */\n  fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;\n\n  if (fabric.isLikelyNode) {\n    fabric.StaticCanvas.prototype.createPNGStream = function() {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createPNGStream();\n    };\n    fabric.StaticCanvas.prototype.createJPEGStream = function(opts) {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createJPEGStream(opts);\n    };\n  }\n})();\n/**\n * BaseBrush class\n * @class fabric.BaseBrush\n * @see {@link http://fabricjs.com/freedrawing|Freedrawing demo}\n */\nfabric.BaseBrush = fabric.util.createClass(/** @lends fabric.BaseBrush.prototype */ {\n\n  /**\n   * Color of a brush\n   * @type String\n   * @default\n   */\n  color: 'rgb(0, 0, 0)',\n\n  /**\n   * Width of a brush, has to be a Number, no string literals\n   * @type Number\n   * @default\n   */\n  width: 1,\n\n  /**\n   * Shadow object representing shadow of this shape.\n   * <b>Backwards incompatibility note:</b> This property replaces \"shadowColor\" (String), \"shadowOffsetX\" (Number),\n   * \"shadowOffsetY\" (Number) and \"shadowBlur\" (Number) since v1.2.12\n   * @type fabric.Shadow\n   * @default\n   */\n  shadow: null,\n\n  /**\n   * Line endings style of a brush (one of \"butt\", \"round\", \"square\")\n   * @type String\n   * @default\n   */\n  strokeLineCap: 'round',\n\n  /**\n   * Corner style of a brush (one of \"bevel\", \"round\", \"miter\")\n   * @type String\n   * @default\n   */\n  strokeLineJoin: 'round',\n\n  /**\n   * Maximum miter length (used for strokeLineJoin = \"miter\") of a brush's\n   * @type Number\n   * @default\n   */\n  strokeMiterLimit:         10,\n\n  /**\n   * Stroke Dash Array.\n   * @type Array\n   * @default\n   */\n  strokeDashArray: null,\n\n  /**\n   * Sets shadow of an object\n   * @param {Object|String} [options] Options object or string (e.g. \"2px 2px 10px rgba(0,0,0,0.2)\")\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  setShadow: function(options) {\n    this.shadow = new fabric.Shadow(options);\n    return this;\n  },\n\n  /**\n   * Sets brush styles\n   * @private\n   */\n  _setBrushStyles: function() {\n    var ctx = this.canvas.contextTop;\n    ctx.strokeStyle = this.color;\n    ctx.lineWidth = this.width;\n    ctx.lineCap = this.strokeLineCap;\n    ctx.miterLimit = this.strokeMiterLimit;\n    ctx.lineJoin = this.strokeLineJoin;\n    if (fabric.StaticCanvas.supports('setLineDash')) {\n      ctx.setLineDash(this.strokeDashArray || []);\n    }\n  },\n\n  /**\n   * Sets the transformation on given context\n   * @param {RenderingContext2d} ctx context to render on\n   * @private\n   */\n  _saveAndTransform: function(ctx) {\n    var v = this.canvas.viewportTransform;\n    ctx.save();\n    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n  },\n\n  /**\n   * Sets brush shadow styles\n   * @private\n   */\n  _setShadow: function() {\n    if (!this.shadow) {\n      return;\n    }\n\n    var ctx = this.canvas.contextTop,\n        zoom = this.canvas.getZoom();\n\n    ctx.shadowColor = this.shadow.color;\n    ctx.shadowBlur = this.shadow.blur * zoom;\n    ctx.shadowOffsetX = this.shadow.offsetX * zoom;\n    ctx.shadowOffsetY = this.shadow.offsetY * zoom;\n  },\n\n  /**\n   * Removes brush shadow styles\n   * @private\n   */\n  _resetShadow: function() {\n    var ctx = this.canvas.contextTop;\n\n    ctx.shadowColor = '';\n    ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n  }\n});\n(function() {\n\n  /**\n   * PencilBrush class\n   * @class fabric.PencilBrush\n   * @extends fabric.BaseBrush\n   */\n  fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {\n\n    /**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.PencilBrush} Instance of a pencil brush\n     */\n    initialize: function(canvas) {\n      this.canvas = canvas;\n      this._points = [];\n    },\n\n    /**\n     * Invoked inside on mouse down and mouse move\n     * @param {Object} pointer\n     */\n    _drawSegment: function (ctx, p1, p2) {\n      var midPoint = p1.midPointFrom(p2);\n      ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);\n      return midPoint;\n    },\n\n    /**\n     * Inovoked on mouse down\n     * @param {Object} pointer\n     */\n    onMouseDown: function(pointer) {\n      this._prepareForDrawing(pointer);\n      // capture coordinates immediately\n      // this allows to draw dots (when movement never occurs)\n      this._captureDrawingPath(pointer);\n      this._render();\n    },\n\n    /**\n     * Inovoked on mouse move\n     * @param {Object} pointer\n     */\n    onMouseMove: function(pointer) {\n      if (this._captureDrawingPath(pointer) && this._points.length > 1) {\n        if (this.needsFullRender) {\n          // redraw curve\n          // clear top canvas\n          this.canvas.clearContext(this.canvas.contextTop);\n          this._render();\n        }\n        else {\n          var points = this._points, length = points.length, ctx = this.canvas.contextTop;\n          // draw the curve update\n          this._saveAndTransform(ctx);\n          if (this.oldEnd) {\n            ctx.beginPath();\n            ctx.moveTo(this.oldEnd.x, this.oldEnd.y);\n          }\n          this.oldEnd = this._drawSegment(ctx, points[length - 2], points[length - 1], true);\n          ctx.stroke();\n          ctx.restore();\n        }\n      }\n    },\n\n    /**\n     * Invoked on mouse up\n     */\n    onMouseUp: function() {\n      this.oldEnd = undefined;\n      this._finalizeAndAddPath();\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _prepareForDrawing: function(pointer) {\n\n      var p = new fabric.Point(pointer.x, pointer.y);\n\n      this._reset();\n      this._addPoint(p);\n      this.canvas.contextTop.moveTo(p.x, p.y);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Point} point Point to be added to points array\n     */\n    _addPoint: function(point) {\n      if (this._points.length > 1 && point.eq(this._points[this._points.length - 1])) {\n        return false;\n      }\n      this._points.push(point);\n      return true;\n    },\n\n    /**\n     * Clear points array and set contextTop canvas style.\n     * @private\n     */\n    _reset: function() {\n      this._points.length = 0;\n      this._setBrushStyles();\n      var color = new fabric.Color(this.color);\n      this.needsFullRender = (color.getAlpha() < 1);\n      this._setShadow();\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _captureDrawingPath: function(pointer) {\n      var pointerPoint = new fabric.Point(pointer.x, pointer.y);\n      return this._addPoint(pointerPoint);\n    },\n\n    /**\n     * Draw a smooth path on the topCanvas using quadraticCurveTo\n     * @private\n     */\n    _render: function() {\n      var ctx  = this.canvas.contextTop, i, len,\n          p1 = this._points[0],\n          p2 = this._points[1];\n\n      this._saveAndTransform(ctx);\n      ctx.beginPath();\n      //if we only have 2 points in the path and they are the same\n      //it means that the user only clicked the canvas without moving the mouse\n      //then we should be drawing a dot. A path isn't drawn between two identical dots\n      //that's why we set them apart a bit\n      if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {\n        var width = this.width / 1000;\n        p1 = new fabric.Point(p1.x, p1.y);\n        p2 = new fabric.Point(p2.x, p2.y);\n        p1.x -= width;\n        p2.x += width;\n      }\n      ctx.moveTo(p1.x, p1.y);\n\n      for (i = 1, len = this._points.length; i < len; i++) {\n        // we pick the point between pi + 1 & pi + 2 as the\n        // end point and p1 as our control point.\n        this._drawSegment(ctx, p1, p2);\n        p1 = this._points[i];\n        p2 = this._points[i + 1];\n      }\n      // Draw last line as a straight line while\n      // we wait for the next point to be able to calculate\n      // the bezier control point\n      ctx.lineTo(p1.x, p1.y);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * Converts points to SVG path\n     * @param {Array} points Array of points\n     * @return {String} SVG path\n     */\n    convertPointsToSVGPath: function(points) {\n      var path = [], i, width = this.width / 1000,\n          p1 = new fabric.Point(points[0].x, points[0].y),\n          p2 = new fabric.Point(points[1].x, points[1].y),\n          len = points.length, multSignX = 1, multSignY = 1, manyPoints = len > 2;\n\n      if (manyPoints) {\n        multSignX = points[2].x < p2.x ? -1 : points[2].x === p2.x ? 0 : 1;\n        multSignY = points[2].y < p2.y ? -1 : points[2].y === p2.y ? 0 : 1;\n      }\n      path.push('M ', p1.x - multSignX * width, ' ', p1.y - multSignY * width, ' ');\n      for (i = 1; i < len; i++) {\n        if (!p1.eq(p2)) {\n          var midPoint = p1.midPointFrom(p2);\n          // p1 is our bezier control point\n          // midpoint is our endpoint\n          // start point is p(i-1) value.\n          path.push('Q ', p1.x, ' ', p1.y, ' ', midPoint.x, ' ', midPoint.y, ' ');\n        }\n        p1 = points[i];\n        if ((i + 1) < points.length) {\n          p2 = points[i + 1];\n        }\n      }\n      if (manyPoints) {\n        multSignX = p1.x > points[i - 2].x ? 1 : p1.x === points[i - 2].x ? 0 : -1;\n        multSignY = p1.y > points[i - 2].y ? 1 : p1.y === points[i - 2].y ? 0 : -1;\n      }\n      path.push('L ', p1.x + multSignX * width, ' ', p1.y + multSignY * width);\n      return path;\n    },\n\n    /**\n     * Creates fabric.Path object to add on canvas\n     * @param {String} pathData Path data\n     * @return {fabric.Path} Path to add on canvas\n     */\n    createPath: function(pathData) {\n      var path = new fabric.Path(pathData, {\n        fill: null,\n        stroke: this.color,\n        strokeWidth: this.width,\n        strokeLineCap: this.strokeLineCap,\n        strokeMiterLimit: this.strokeMiterLimit,\n        strokeLineJoin: this.strokeLineJoin,\n        strokeDashArray: this.strokeDashArray,\n      });\n      var position = new fabric.Point(path.left + path.width / 2, path.top + path.height / 2);\n      position = path.translateToGivenOrigin(position, 'center', 'center', path.originX, path.originY);\n      path.top = position.y;\n      path.left = position.x;\n      if (this.shadow) {\n        this.shadow.affectStroke = true;\n        path.setShadow(this.shadow);\n      }\n\n      return path;\n    },\n\n    /**\n     * On mouseup after drawing the path on contextTop canvas\n     * we use the points captured to create an new fabric path object\n     * and add it to the fabric canvas.\n     */\n    _finalizeAndAddPath: function() {\n      var ctx = this.canvas.contextTop;\n      ctx.closePath();\n\n      var pathData = this.convertPointsToSVGPath(this._points).join('');\n      if (pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {\n        // do not create 0 width/height paths, as they are\n        // rendered inconsistently across browsers\n        // Firefox 4, for example, renders a dot,\n        // whereas Chrome 10 renders nothing\n        this.canvas.requestRenderAll();\n        return;\n      }\n\n      var path = this.createPath(pathData);\n      this.canvas.clearContext(this.canvas.contextTop);\n      this.canvas.add(path);\n      this.canvas.renderAll();\n      path.setCoords();\n      this._resetShadow();\n\n\n      // fire event 'path' created\n      this.canvas.fire('path:created', { path: path });\n    }\n  });\n})();\n/**\n * CircleBrush class\n * @class fabric.CircleBrush\n */\nfabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.CircleBrush.prototype */ {\n\n  /**\n   * Width of a brush\n   * @type Number\n   * @default\n   */\n  width: 10,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.CircleBrush} Instance of a circle brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.points = [];\n  },\n\n  /**\n   * Invoked inside on mouse down and mouse move\n   * @param {Object} pointer\n   */\n  drawDot: function(pointer) {\n    var point = this.addPoint(pointer),\n        ctx = this.canvas.contextTop;\n    this._saveAndTransform(ctx);\n    ctx.fillStyle = point.fill;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.restore();\n  },\n\n  /**\n   * Invoked on mouse down\n   */\n  onMouseDown: function(pointer) {\n    this.points.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n    this.drawDot(pointer);\n  },\n\n  /**\n   * Render the full state of the brush\n   * @private\n   */\n  _render: function() {\n    var ctx  = this.canvas.contextTop, i, len,\n        points = this.points, point;\n    this._saveAndTransform(ctx);\n    for (i = 0, len = points.length; i < len; i++) {\n      point = points[i];\n      ctx.fillStyle = point.fill;\n      ctx.beginPath();\n      ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);\n      ctx.closePath();\n      ctx.fill();\n    }\n    ctx.restore();\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    this.drawDot(pointer);\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove, i, len;\n    this.canvas.renderOnAddRemove = false;\n\n    var circles = [];\n\n    for (i = 0, len = this.points.length; i < len; i++) {\n      var point = this.points[i],\n          circle = new fabric.Circle({\n            radius: point.radius,\n            left: point.x,\n            top: point.y,\n            originX: 'center',\n            originY: 'center',\n            fill: point.fill\n          });\n\n      this.shadow && circle.setShadow(this.shadow);\n\n      circles.push(circle);\n    }\n    var group = new fabric.Group(circles);\n    group.canvas = this.canvas;\n\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.requestRenderAll();\n  },\n\n  /**\n   * @param {Object} pointer\n   * @return {fabric.Point} Just added pointer point\n   */\n  addPoint: function(pointer) {\n    var pointerPoint = new fabric.Point(pointer.x, pointer.y),\n\n        circleRadius = fabric.util.getRandomInt(\n          Math.max(0, this.width - 20), this.width + 20) / 2,\n\n        circleColor = new fabric.Color(this.color)\n          .setAlpha(fabric.util.getRandomInt(0, 100) / 100)\n          .toRgba();\n\n    pointerPoint.radius = circleRadius;\n    pointerPoint.fill = circleColor;\n\n    this.points.push(pointerPoint);\n\n    return pointerPoint;\n  }\n});\n/**\n * SprayBrush class\n * @class fabric.SprayBrush\n */\nfabric.SprayBrush = fabric.util.createClass( fabric.BaseBrush, /** @lends fabric.SprayBrush.prototype */ {\n\n  /**\n   * Width of a spray\n   * @type Number\n   * @default\n   */\n  width:              10,\n\n  /**\n   * Density of a spray (number of dots per chunk)\n   * @type Number\n   * @default\n   */\n  density:            20,\n\n  /**\n   * Width of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidth:           1,\n\n  /**\n   * Width variance of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidthVariance:   1,\n\n  /**\n   * Whether opacity of a dot should be random\n   * @type Boolean\n   * @default\n   */\n  randomOpacity:        false,\n\n  /**\n   * Whether overlapping dots (rectangles) should be removed (for performance reasons)\n   * @type Boolean\n   * @default\n   */\n  optimizeOverlapping:  true,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.SprayBrush} Instance of a spray brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.sprayChunks = [];\n  },\n\n  /**\n   * Invoked on mouse down\n   * @param {Object} pointer\n   */\n  onMouseDown: function(pointer) {\n    this.sprayChunks.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n\n    this.addSprayChunk(pointer);\n    this.render(this.sprayChunkPoints);\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    this.addSprayChunk(pointer);\n    this.render(this.sprayChunkPoints);\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\n    this.canvas.renderOnAddRemove = false;\n\n    var rects = [];\n\n    for (var i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      var sprayChunk = this.sprayChunks[i];\n\n      for (var j = 0, jlen = sprayChunk.length; j < jlen; j++) {\n\n        var rect = new fabric.Rect({\n          width: sprayChunk[j].width,\n          height: sprayChunk[j].width,\n          left: sprayChunk[j].x + 1,\n          top: sprayChunk[j].y + 1,\n          originX: 'center',\n          originY: 'center',\n          fill: this.color\n        });\n        rects.push(rect);\n      }\n    }\n\n    if (this.optimizeOverlapping) {\n      rects = this._getOptimizedRects(rects);\n    }\n\n    var group = new fabric.Group(rects);\n    this.shadow && group.setShadow(this.shadow);\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.requestRenderAll();\n  },\n\n  /**\n   * @private\n   * @param {Array} rects\n   */\n  _getOptimizedRects: function(rects) {\n\n    // avoid creating duplicate rects at the same coordinates\n    var uniqueRects = { }, key, i, len;\n\n    for (i = 0, len = rects.length; i < len; i++) {\n      key = rects[i].left + '' + rects[i].top;\n      if (!uniqueRects[key]) {\n        uniqueRects[key] = rects[i];\n      }\n    }\n    var uniqueRectsArray = [];\n    for (key in uniqueRects) {\n      uniqueRectsArray.push(uniqueRects[key]);\n    }\n\n    return uniqueRectsArray;\n  },\n\n  /**\n   * Render new chunk of spray brush\n   */\n  render: function(sprayChunk) {\n    var ctx = this.canvas.contextTop, i, len;\n    ctx.fillStyle = this.color;\n\n    this._saveAndTransform(ctx);\n\n    for (i = 0, len = sprayChunk.length; i < len; i++) {\n      var point = sprayChunk[i];\n      if (typeof point.opacity !== 'undefined') {\n        ctx.globalAlpha = point.opacity;\n      }\n      ctx.fillRect(point.x, point.y, point.width, point.width);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * Render all spray chunks\n   */\n  _render: function() {\n    var ctx = this.canvas.contextTop, i, ilen;\n    ctx.fillStyle = this.color;\n\n    this._saveAndTransform(ctx);\n\n    for (i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      this.render(this.sprayChunks[i]);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * @param {Object} pointer\n   */\n  addSprayChunk: function(pointer) {\n    this.sprayChunkPoints = [];\n\n    var x, y, width, radius = this.width / 2, i;\n\n    for (i = 0; i < this.density; i++) {\n\n      x = fabric.util.getRandomInt(pointer.x - radius, pointer.x + radius);\n      y = fabric.util.getRandomInt(pointer.y - radius, pointer.y + radius);\n\n      if (this.dotWidthVariance) {\n        width = fabric.util.getRandomInt(\n          // bottom clamp width to 1\n          Math.max(1, this.dotWidth - this.dotWidthVariance),\n          this.dotWidth + this.dotWidthVariance);\n      }\n      else {\n        width = this.dotWidth;\n      }\n\n      var point = new fabric.Point(x, y);\n      point.width = width;\n\n      if (this.randomOpacity) {\n        point.opacity = fabric.util.getRandomInt(0, 100) / 100;\n      }\n\n      this.sprayChunkPoints.push(point);\n    }\n\n    this.sprayChunks.push(this.sprayChunkPoints);\n  }\n});\n/**\n * PatternBrush class\n * @class fabric.PatternBrush\n * @extends fabric.BaseBrush\n */\nfabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, /** @lends fabric.PatternBrush.prototype */ {\n\n  getPatternSrc: function() {\n\n    var dotWidth = 20,\n        dotDistance = 5,\n        patternCanvas = fabric.util.createCanvasElement(),\n        patternCtx = patternCanvas.getContext('2d');\n\n    patternCanvas.width = patternCanvas.height = dotWidth + dotDistance;\n\n    patternCtx.fillStyle = this.color;\n    patternCtx.beginPath();\n    patternCtx.arc(dotWidth / 2, dotWidth / 2, dotWidth / 2, 0, Math.PI * 2, false);\n    patternCtx.closePath();\n    patternCtx.fill();\n\n    return patternCanvas;\n  },\n\n  getPatternSrcFunction: function() {\n    return String(this.getPatternSrc).replace('this.color', '\"' + this.color + '\"');\n  },\n\n  /**\n   * Creates \"pattern\" instance property\n   */\n  getPattern: function() {\n    return this.canvas.contextTop.createPattern(this.source || this.getPatternSrc(), 'repeat');\n  },\n\n  /**\n   * Sets brush styles\n   */\n  _setBrushStyles: function() {\n    this.callSuper('_setBrushStyles');\n    this.canvas.contextTop.strokeStyle = this.getPattern();\n  },\n\n  /**\n   * Creates path\n   */\n  createPath: function(pathData) {\n    var path = this.callSuper('createPath', pathData),\n        topLeft = path._getLeftTopCoords().scalarAdd(path.strokeWidth / 2);\n\n    path.stroke = new fabric.Pattern({\n      source: this.source || this.getPatternSrcFunction(),\n      offsetX: -topLeft.x,\n      offsetY: -topLeft.y\n    });\n    return path;\n  }\n});\n(function() {\n\n  var getPointer = fabric.util.getPointer,\n      degreesToRadians = fabric.util.degreesToRadians,\n      radiansToDegrees = fabric.util.radiansToDegrees,\n      atan2 = Math.atan2,\n      abs = Math.abs,\n      supportLineDash = fabric.StaticCanvas.supports('setLineDash'),\n\n      STROKE_OFFSET = 0.5;\n\n  /**\n   * Canvas class\n   * @class fabric.Canvas\n   * @extends fabric.StaticCanvas\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#canvas}\n   * @see {@link fabric.Canvas#initialize} for constructor definition\n   *\n   * @fires object:modified\n   * @fires object:rotated\n   * @fires object:scaled\n   * @fires object:moved\n   * @fires object:skewed\n   * @fires object:rotating\n   * @fires object:scaling\n   * @fires object:moving\n   * @fires object:skewing\n   * @fires object:selected this event is deprecated. use selection:created\n   *\n   * @fires before:transform\n   * @fires before:selection:cleared\n   * @fires selection:cleared\n   * @fires selection:updated\n   * @fires selection:created\n   *\n   * @fires path:created\n   * @fires mouse:down\n   * @fires mouse:move\n   * @fires mouse:up\n   * @fires mouse:down:before\n   * @fires mouse:move:before\n   * @fires mouse:up:before\n   * @fires mouse:over\n   * @fires mouse:out\n   * @fires mouse:dblclick\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   *\n   */\n  fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n      this.renderAndResetBound = this.renderAndReset.bind(this);\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\n      this._initStatic(el, options);\n      this._initInteractive();\n      this._createCacheCanvas();\n    },\n\n    /**\n     * When true, objects can be transformed by one side (unproportionally)\n     * @type Boolean\n     * @default\n     */\n    uniScaleTransform:      false,\n\n    /**\n     * Indicates which key enable unproportional scaling\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    uniScaleKey:           'shiftKey',\n\n    /**\n     * When true, objects use center point as the origin of scale transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:        false,\n\n    /**\n     * When true, objects use center point as the origin of rotate transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:       false,\n\n    /**\n     * Indicates which key enable centered Transform\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    centeredKey:           'altKey',\n\n    /**\n     * Indicates which key enable alternate action on corner\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    altActionKey:           'shiftKey',\n\n    /**\n     * Indicates that canvas is interactive. This property should not be changed.\n     * @type Boolean\n     * @default\n     */\n    interactive:            true,\n\n    /**\n     * Indicates whether group selection should be enabled\n     * @type Boolean\n     * @default\n     */\n    selection:              true,\n\n    /**\n     * Indicates which key or keys enable multiple click selection\n     * Pass value as a string or array of strings\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or empty or containing any other string that is not a modifier key\n     * feature is disabled.\n     * @since 1.6.2\n     * @type String|Array\n     * @default\n     */\n    selectionKey:           'shiftKey',\n\n    /**\n     * Indicates which key enable alternative selection\n     * in case of target overlapping with active object\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * For a series of reason that come from the general expectations on how\n     * things should work, this feature works only for preserveObjectStacking true.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled.\n     * @since 1.6.5\n     * @type null|String\n     * @default\n     */\n    altSelectionKey:           null,\n\n    /**\n     * Color of selection\n     * @type String\n     * @default\n     */\n    selectionColor:         'rgba(100, 100, 255, 0.3)', // blue\n\n    /**\n     * Default dash array pattern\n     * If not empty the selection border is dashed\n     * @type Array\n     */\n    selectionDashArray:     [],\n\n    /**\n     * Color of the border of selection (usually slightly darker than color of selection itself)\n     * @type String\n     * @default\n     */\n    selectionBorderColor:   'rgba(255, 255, 255, 0.3)',\n\n    /**\n     * Width of a line used in object/group selection\n     * @type Number\n     * @default\n     */\n    selectionLineWidth:     1,\n\n    /**\n     * Select only shapes that are fully contained in the dragged selection rectangle.\n     * @type Boolean\n     * @default\n     */\n    selectionFullyContained: false,\n\n    /**\n     * Default cursor value used when hovering over an object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:            'move',\n\n    /**\n     * Default cursor value used when moving an object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:             'move',\n\n    /**\n     * Default cursor value used for the entire canvas\n     * @type String\n     * @default\n     */\n    defaultCursor:          'default',\n\n    /**\n     * Cursor value used during free drawing\n     * @type String\n     * @default\n     */\n    freeDrawingCursor:      'crosshair',\n\n    /**\n     * Cursor value used for rotation point\n     * @type String\n     * @default\n     */\n    rotationCursor:         'crosshair',\n\n    /**\n     * Cursor value used for disabled elements ( corners with disabled action )\n     * @type String\n     * @since 2.0.0\n     * @default\n     */\n    notAllowedCursor:         'not-allowed',\n\n    /**\n     * Default element class that's given to wrapper (div) element of canvas\n     * @type String\n     * @default\n     */\n    containerClass:         'canvas-container',\n\n    /**\n     * When true, object detection happens on per-pixel basis rather than on per-bounding-box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:     false,\n\n    /**\n     * Number of pixels around target pixel to tolerate (consider active) during object detection\n     * @type Number\n     * @default\n     */\n    targetFindTolerance:    0,\n\n    /**\n     * When true, target detection is skipped when hovering over canvas. This can be used to improve performance.\n     * @type Boolean\n     * @default\n     */\n    skipTargetFind:         false,\n\n    /**\n     * When true, mouse events on canvas (mousedown/mousemove/mouseup) result in free drawing.\n     * After mousedown, mousemove creates a shape,\n     * and then mouseup finalizes it and adds an instance of `fabric.Path` onto canvas.\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-4#free_drawing}\n     * @type Boolean\n     * @default\n     */\n    isDrawingMode:          false,\n\n    /**\n     * Indicates whether objects should remain in current stack position when selected.\n     * When false objects are brought to top and rendered as part of the selection group\n     * @type Boolean\n     * @default\n     */\n    preserveObjectStacking: false,\n\n    /**\n     * Indicates the angle that an object will lock to while rotating.\n     * @type Number\n     * @since 1.6.7\n     * @default\n     */\n    snapAngle: 0,\n\n    /**\n     * Indicates the distance from the snapAngle the rotation will lock to the snapAngle.\n     * When `null`, the snapThreshold will default to the snapAngle.\n     * @type null|Number\n     * @since 1.6.7\n     * @default\n     */\n    snapThreshold: null,\n\n    /**\n     * Indicates if the right click on canvas can output the context menu or not\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    stopContextMenu: false,\n\n    /**\n     * Indicates if the canvas can fire right click events\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    fireRightClick: false,\n\n    /**\n     * Indicates if the canvas can fire middle click events\n     * @type Boolean\n     * @since 1.7.8\n     * @default\n     */\n    fireMiddleClick: false,\n\n    /**\n     * @private\n     */\n    _initInteractive: function() {\n      this._currentTransform = null;\n      this._groupSelector = null;\n      this._initWrapperElement();\n      this._createUpperCanvas();\n      this._initEventListeners();\n\n      this._initRetinaScaling();\n\n      this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);\n\n      this.calcOffset();\n    },\n\n    /**\n     * Divides objects in two groups, one to render immediately\n     * and one to render as activeGroup.\n     * @return {Array} objects to render immediately and pushes the other in the activeGroup.\n     */\n    _chooseObjectsToRender: function() {\n      var activeObjects = this.getActiveObjects(),\n          object, objsToRender, activeGroupObjects;\n\n      if (activeObjects.length > 0 && !this.preserveObjectStacking) {\n        objsToRender = [];\n        activeGroupObjects = [];\n        for (var i = 0, length = this._objects.length; i < length; i++) {\n          object = this._objects[i];\n          if (activeObjects.indexOf(object) === -1 ) {\n            objsToRender.push(object);\n          }\n          else {\n            activeGroupObjects.push(object);\n          }\n        }\n        if (activeObjects.length > 1) {\n          this._activeObject._objects = activeGroupObjects;\n        }\n        objsToRender.push.apply(objsToRender, activeGroupObjects);\n      }\n      else {\n        objsToRender = this._objects;\n      }\n      return objsToRender;\n    },\n\n    /**\n     * Renders both the top canvas and the secondary container canvas.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      if (this.contextTopDirty && !this._groupSelector && !this.isDrawingMode) {\n        this.clearContext(this.contextTop);\n        this.contextTopDirty = false;\n      }\n      if (this.hasLostContext) {\n        this.renderTopLayer(this.contextTop);\n      }\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._chooseObjectsToRender());\n      return this;\n    },\n\n    renderTopLayer: function(ctx) {\n      ctx.save();\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this.freeDrawingBrush && this.freeDrawingBrush._render();\n        this.contextTopDirty = true;\n      }\n      // we render the top context - last object\n      if (this.selection && this._groupSelector) {\n        this._drawSelection(ctx);\n        this.contextTopDirty = true;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Method to render only the top canvas.\n     * Also used to render the group selection box.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    renderTop: function () {\n      var ctx = this.contextTop;\n      this.clearContext(ctx);\n      this.renderTopLayer(ctx);\n      this.fire('after:render');\n      return this;\n    },\n\n    /**\n     * Resets the current transform to its original values and chooses the type of resizing based on the event\n     * @private\n     */\n    _resetCurrentTransform: function() {\n      var t = this._currentTransform;\n\n      t.target.set({\n        scaleX: t.original.scaleX,\n        scaleY: t.original.scaleY,\n        skewX: t.original.skewX,\n        skewY: t.original.skewY,\n        left: t.original.left,\n        top: t.original.top\n      });\n\n      if (this._shouldCenterTransform(t.target)) {\n        if (t.originX !== 'center') {\n          if (t.originX === 'right') {\n            t.mouseXSign = -1;\n          }\n          else {\n            t.mouseXSign = 1;\n          }\n        }\n        if (t.originY !== 'center') {\n          if (t.originY === 'bottom') {\n            t.mouseYSign = -1;\n          }\n          else {\n            t.mouseYSign = 1;\n          }\n        }\n\n        t.originX = 'center';\n        t.originY = 'center';\n      }\n      else {\n        t.originX = t.original.originX;\n        t.originY = t.original.originY;\n      }\n    },\n\n    /**\n     * Checks if point is contained within an area of given object\n     * @param {Event} e Event object\n     * @param {fabric.Object} target Object to test against\n     * @param {Object} [point] x,y object of point coordinates we want to check.\n     * @return {Boolean} true if point is contained within an area of given object\n     */\n    containsPoint: function (e, target, point) {\n      var ignoreZoom = true,\n          pointer = point || this.getPointer(e, ignoreZoom),\n          xy;\n\n      if (target.group && target.group === this._activeObject && target.group.type === 'activeSelection') {\n        xy = this._normalizePointer(target.group, pointer);\n      }\n      else {\n        xy = { x: pointer.x, y: pointer.y };\n      }\n      // http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\n      // http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\n      return (target.containsPoint(xy) || target._findTargetCorner(pointer));\n    },\n\n    /**\n     * @private\n     */\n    _normalizePointer: function (object, pointer) {\n      var m = object.calcTransformMatrix(),\n          invertedM = fabric.util.invertTransform(m),\n          vptPointer = this.restorePointerVpt(pointer);\n      return fabric.util.transformPoint(vptPointer, invertedM);\n    },\n\n    /**\n     * Returns true if object is transparent at a certain location\n     * @param {fabric.Object} target Object to check\n     * @param {Number} x Left coordinate\n     * @param {Number} y Top coordinate\n     * @return {Boolean}\n     */\n    isTargetTransparent: function (target, x, y) {\n      if (target.shouldCache() && target._cacheCanvas) {\n        var normalizedPointer = this._normalizePointer(target, {x: x, y: y}),\n            targetRelativeX = target.cacheTranslationX + (normalizedPointer.x * target.zoomX),\n            targetRelativeY = target.cacheTranslationY + (normalizedPointer.y * target.zoomY);\n\n        var isTransparent = fabric.util.isTransparent(\n          target._cacheContext, targetRelativeX, targetRelativeY, this.targetFindTolerance);\n\n        return isTransparent;\n      }\n\n      var ctx = this.contextCache,\n          originalColor = target.selectionBackgroundColor, v = this.viewportTransform;\n\n      target.selectionBackgroundColor = '';\n\n      this.clearContext(ctx);\n\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      target.render(ctx);\n      ctx.restore();\n\n      target === this._activeObject && target._renderControls(ctx, {\n        hasBorders: false,\n        transparentCorners: false\n      }, {\n        hasBorders: false,\n      });\n\n      target.selectionBackgroundColor = originalColor;\n\n      var isTransparent = fabric.util.isTransparent(\n        ctx, x, y, this.targetFindTolerance);\n\n      return isTransparent;\n    },\n\n    /**\n     * takes an event and determins if selection key has been pressed\n     * @private\n     * @param {Event} e Event object\n     */\n    _isSelectionKeyPressed: function(e) {\n      var selectionKeyPressed = false;\n\n      if (Object.prototype.toString.call(this.selectionKey) === '[object Array]') {\n        selectionKeyPressed = !!this.selectionKey.find(function(key) { return e[key] === true; });\n      }\n      else {\n        selectionKeyPressed = e[this.selectionKey];\n      }\n\n      return selectionKeyPressed;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _shouldClearSelection: function (e, target) {\n      var activeObjects = this.getActiveObjects(),\n          activeObject = this._activeObject;\n\n      return (\n        !target\n        ||\n        (target &&\n          activeObject &&\n          activeObjects.length > 1 &&\n          activeObjects.indexOf(target) === -1 &&\n          activeObject !== target &&\n          !this._isSelectionKeyPressed(e))\n        ||\n        (target && !target.evented)\n        ||\n        (target &&\n          !target.selectable &&\n          activeObject &&\n          activeObject !== target)\n      );\n    },\n\n    /**\n     * centeredScaling from object can't override centeredScaling from canvas.\n     * this should be fixed, since object setting should take precedence over canvas.\n     * @private\n     * @param {fabric.Object} target\n     */\n    _shouldCenterTransform: function (target) {\n      if (!target) {\n        return;\n      }\n\n      var t = this._currentTransform,\n          centerTransform;\n\n      if (t.action === 'scale' || t.action === 'scaleX' || t.action === 'scaleY') {\n        centerTransform = this.centeredScaling || target.centeredScaling;\n      }\n      else if (t.action === 'rotate') {\n        centerTransform = this.centeredRotation || target.centeredRotation;\n      }\n\n      return centerTransform ? !t.altKey : t.altKey;\n    },\n\n    /**\n     * @private\n     */\n    _getOriginFromCorner: function(target, corner) {\n      var origin = {\n        x: target.originX,\n        y: target.originY\n      };\n\n      if (corner === 'ml' || corner === 'tl' || corner === 'bl') {\n        origin.x = 'right';\n      }\n      else if (corner === 'mr' || corner === 'tr' || corner === 'br') {\n        origin.x = 'left';\n      }\n\n      if (corner === 'tl' || corner === 'mt' || corner === 'tr') {\n        origin.y = 'bottom';\n      }\n      else if (corner === 'bl' || corner === 'mb' || corner === 'br') {\n        origin.y = 'top';\n      }\n\n      return origin;\n    },\n\n    /**\n     * @private\n     */\n    _getActionFromCorner: function(alreadySelected, corner, e) {\n      if (!corner || !alreadySelected) {\n        return 'drag';\n      }\n\n      switch (corner) {\n        case 'mtr':\n          return 'rotate';\n        case 'ml':\n        case 'mr':\n          return e[this.altActionKey] ? 'skewY' : 'scaleX';\n        case 'mt':\n        case 'mb':\n          return e[this.altActionKey] ? 'skewX' : 'scaleY';\n        default:\n          return 'scale';\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _setupCurrentTransform: function (e, target, alreadySelected) {\n      if (!target) {\n        return;\n      }\n\n      var pointer = this.getPointer(e),\n          corner = target._findTargetCorner(this.getPointer(e, true)),\n          action = this._getActionFromCorner(alreadySelected, corner, e),\n          origin = this._getOriginFromCorner(target, corner);\n\n      this._currentTransform = {\n        target: target,\n        action: action,\n        corner: corner,\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        // used by transation\n        offsetX: pointer.x - target.left,\n        offsetY: pointer.y - target.top,\n        originX: origin.x,\n        originY: origin.y,\n        ex: pointer.x,\n        ey: pointer.y,\n        lastX: pointer.x,\n        lastY: pointer.y,\n        // unsure they are usefull anymore.\n        // left: target.left,\n        // top: target.top,\n        theta: degreesToRadians(target.angle),\n        // end of unsure\n        width: target.width * target.scaleX,\n        mouseXSign: 1,\n        mouseYSign: 1,\n        shiftKey: e.shiftKey,\n        altKey: e[this.centeredKey],\n        original: fabric.util.saveObjectTransform(target),\n      };\n\n      this._currentTransform.original.originX = origin.x;\n      this._currentTransform.original.originY = origin.y;\n\n      this._resetCurrentTransform();\n      this._beforeTransform(e);\n    },\n\n    /**\n     * Translates object by \"setting\" its left/top\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @return {Boolean} true if the translation occurred\n     */\n    _translateObject: function (x, y) {\n      var transform = this._currentTransform,\n          target = transform.target,\n          newLeft = x - transform.offsetX,\n          newTop = y - transform.offsetY,\n          moveX = !target.get('lockMovementX') && target.left !== newLeft,\n          moveY = !target.get('lockMovementY') && target.top !== newTop;\n\n      moveX && target.set('left', newLeft);\n      moveY && target.set('top', newTop);\n      return moveX || moveY;\n    },\n\n    /**\n     * Check if we are increasing a positive skew or lower it,\n     * checking mouse direction and pressed corner.\n     * @private\n     */\n    _changeSkewTransformOrigin: function(mouseMove, t, by) {\n      var property = 'originX', origins = { 0: 'center' },\n          skew = t.target.skewX, originA = 'left', originB = 'right',\n          corner = t.corner === 'mt' || t.corner === 'ml' ? 1 : -1,\n          flipSign = 1;\n\n      mouseMove = mouseMove > 0 ? 1 : -1;\n      if (by === 'y') {\n        skew = t.target.skewY;\n        originA = 'top';\n        originB = 'bottom';\n        property = 'originY';\n      }\n      origins[-1] = originA;\n      origins[1] = originB;\n\n      t.target.flipX && (flipSign *= -1);\n      t.target.flipY && (flipSign *= -1);\n\n      if (skew === 0) {\n        t.skewSign = -corner * mouseMove * flipSign;\n        t[property] = origins[-mouseMove];\n      }\n      else {\n        skew = skew > 0 ? 1 : -1;\n        t.skewSign = skew;\n        t[property] = origins[skew * corner * flipSign];\n      }\n    },\n\n    /**\n     * Skew object by mouse events\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @param {String} by Either 'x' or 'y'\n     * @return {Boolean} true if the skewing occurred\n     */\n    _skewObject: function (x, y, by) {\n      var t = this._currentTransform,\n          target = t.target, skewed = false,\n          lockSkewingX = target.get('lockSkewingX'),\n          lockSkewingY = target.get('lockSkewingY');\n\n      if ((lockSkewingX && by === 'x') || (lockSkewingY && by === 'y')) {\n        return false;\n      }\n\n      // Get the constraint point\n      var center = target.getCenterPoint(),\n          actualMouseByCenter = target.toLocalPoint(new fabric.Point(x, y), 'center', 'center')[by],\n          lastMouseByCenter = target.toLocalPoint(new fabric.Point(t.lastX, t.lastY), 'center', 'center')[by],\n          actualMouseByOrigin, constraintPosition, dim = target._getTransformedDimensions();\n\n      this._changeSkewTransformOrigin(actualMouseByCenter - lastMouseByCenter, t, by);\n      actualMouseByOrigin = target.toLocalPoint(new fabric.Point(x, y), t.originX, t.originY)[by];\n      constraintPosition = target.translateToOriginPoint(center, t.originX, t.originY);\n      // Actually skew the object\n      skewed = this._setObjectSkew(actualMouseByOrigin, t, by, dim);\n      t.lastX = x;\n      t.lastY = y;\n      // Make sure the constraints apply\n      target.setPositionByOrigin(constraintPosition, t.originX, t.originY);\n      return skewed;\n    },\n\n    /**\n     * Set object skew\n     * @private\n     * @return {Boolean} true if the skewing occurred\n     */\n    _setObjectSkew: function(localMouse, transform, by, _dim) {\n      var target = transform.target, newValue, skewed = false,\n          skewSign = transform.skewSign, newDim, dimNoSkew,\n          otherBy, _otherBy, _by, newDimMouse, skewX, skewY;\n\n      if (by === 'x') {\n        otherBy = 'y';\n        _otherBy = 'Y';\n        _by = 'X';\n        skewX = 0;\n        skewY = target.skewY;\n      }\n      else {\n        otherBy = 'x';\n        _otherBy = 'X';\n        _by = 'Y';\n        skewX = target.skewX;\n        skewY = 0;\n      }\n\n      dimNoSkew = target._getTransformedDimensions(skewX, skewY);\n      newDimMouse = 2 * Math.abs(localMouse) - dimNoSkew[by];\n      if (newDimMouse <= 2) {\n        newValue = 0;\n      }\n      else {\n        newValue = skewSign * Math.atan((newDimMouse / target['scale' + _by]) /\n                                        (dimNoSkew[otherBy] / target['scale' + _otherBy]));\n        newValue = fabric.util.radiansToDegrees(newValue);\n      }\n      skewed = target['skew' + _by] !== newValue;\n      target.set('skew' + _by, newValue);\n      if (target['skew' + _otherBy] !== 0) {\n        newDim = target._getTransformedDimensions();\n        newValue = (_dim[otherBy] / newDim[otherBy]) * target['scale' + _otherBy];\n        target.set('scale' + _otherBy, newValue);\n      }\n      return skewed;\n    },\n\n    /**\n     * Scales object by invoking its scaleX/scaleY methods\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @param {String} by Either 'x' or 'y' - specifies dimension constraint by which to scale an object.\n     *                    When not provided, an object is scaled by both dimensions equally\n     * @return {Boolean} true if the scaling occurred\n     */\n    _scaleObject: function (x, y, by) {\n      var t = this._currentTransform,\n          target = t.target,\n          lockScalingX = target.lockScalingX,\n          lockScalingY = target.lockScalingY,\n          lockScalingFlip = target.lockScalingFlip;\n\n      if (lockScalingX && lockScalingY) {\n        return false;\n      }\n\n      // Get the constraint point\n      var constraintPosition = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY),\n          localMouse = target.toLocalPoint(new fabric.Point(x, y), t.originX, t.originY),\n          dim = target._getTransformedDimensions(), scaled = false;\n\n      this._setLocalMouse(localMouse, t);\n\n      // Actually scale the object\n      scaled = this._setObjectScale(localMouse, t, lockScalingX, lockScalingY, by, lockScalingFlip, dim);\n\n      // Make sure the constraints apply\n      target.setPositionByOrigin(constraintPosition, t.originX, t.originY);\n      return scaled;\n    },\n\n    /**\n     * @private\n     * @return {Boolean} true if the scaling occurred\n     */\n    _setObjectScale: function(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {\n      var target = transform.target, forbidScalingX = false, forbidScalingY = false, scaled = false,\n          changeX, changeY, scaleX, scaleY;\n\n      scaleX = localMouse.x * target.scaleX / _dim.x;\n      scaleY = localMouse.y * target.scaleY / _dim.y;\n      changeX = target.scaleX !== scaleX;\n      changeY = target.scaleY !== scaleY;\n\n      if (lockScalingFlip && scaleX <= 0 && scaleX < target.scaleX) {\n        forbidScalingX = true;\n        localMouse.x = 0;\n      }\n\n      if (lockScalingFlip && scaleY <= 0 && scaleY < target.scaleY) {\n        forbidScalingY = true;\n        localMouse.y = 0;\n      }\n\n      if (by === 'equally' && !lockScalingX && !lockScalingY) {\n        scaled = this._scaleObjectEqually(localMouse, target, transform, _dim);\n      }\n      else if (!by) {\n        forbidScalingX || lockScalingX || (target.set('scaleX', scaleX) && (scaled = scaled || changeX));\n        forbidScalingY || lockScalingY || (target.set('scaleY', scaleY) && (scaled = scaled || changeY));\n      }\n      else if (by === 'x' && !target.get('lockUniScaling')) {\n        forbidScalingX || lockScalingX || (target.set('scaleX', scaleX) && (scaled = scaled || changeX));\n      }\n      else if (by === 'y' && !target.get('lockUniScaling')) {\n        forbidScalingY || lockScalingY || (target.set('scaleY', scaleY) && (scaled = scaled || changeY));\n      }\n      transform.newScaleX = scaleX;\n      transform.newScaleY = scaleY;\n      forbidScalingX || forbidScalingY || this._flipObject(transform, by);\n      return scaled;\n    },\n\n    /**\n     * @private\n     * @return {Boolean} true if the scaling occurred\n     */\n    _scaleObjectEqually: function(localMouse, target, transform, _dim) {\n\n      var dist = localMouse.y + localMouse.x,\n          lastDist = _dim.y * transform.original.scaleY / target.scaleY +\n                     _dim.x * transform.original.scaleX / target.scaleX,\n          scaled, signX = localMouse.x < 0 ? -1 : 1,\n          signY = localMouse.y < 0 ? -1 : 1;\n\n      // We use transform.scaleX/Y instead of target.scaleX/Y\n      // because the object may have a min scale and we'll loose the proportions\n      transform.newScaleX = signX * Math.abs(transform.original.scaleX * dist / lastDist);\n      transform.newScaleY = signY * Math.abs(transform.original.scaleY * dist / lastDist);\n      scaled = transform.newScaleX !== target.scaleX || transform.newScaleY !== target.scaleY;\n      target.set('scaleX', transform.newScaleX);\n      target.set('scaleY', transform.newScaleY);\n      return scaled;\n    },\n\n    /**\n     * @private\n     */\n    _flipObject: function(transform, by) {\n      if (transform.newScaleX < 0 && by !== 'y') {\n        if (transform.originX === 'left') {\n          transform.originX = 'right';\n        }\n        else if (transform.originX === 'right') {\n          transform.originX = 'left';\n        }\n      }\n\n      if (transform.newScaleY < 0 && by !== 'x') {\n        if (transform.originY === 'top') {\n          transform.originY = 'bottom';\n        }\n        else if (transform.originY === 'bottom') {\n          transform.originY = 'top';\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setLocalMouse: function(localMouse, t) {\n      var target = t.target, zoom = this.getZoom(),\n          padding = target.padding / zoom;\n\n      if (t.originX === 'right') {\n        localMouse.x *= -1;\n      }\n      else if (t.originX === 'center') {\n        localMouse.x *= t.mouseXSign * 2;\n        if (localMouse.x < 0) {\n          t.mouseXSign = -t.mouseXSign;\n        }\n      }\n\n      if (t.originY === 'bottom') {\n        localMouse.y *= -1;\n      }\n      else if (t.originY === 'center') {\n        localMouse.y *= t.mouseYSign * 2;\n        if (localMouse.y < 0) {\n          t.mouseYSign = -t.mouseYSign;\n        }\n      }\n\n      // adjust the mouse coordinates when dealing with padding\n      if (abs(localMouse.x) > padding) {\n        if (localMouse.x < 0) {\n          localMouse.x += padding;\n        }\n        else {\n          localMouse.x -= padding;\n        }\n      }\n      else { // mouse is within the padding, set to 0\n        localMouse.x = 0;\n      }\n\n      if (abs(localMouse.y) > padding) {\n        if (localMouse.y < 0) {\n          localMouse.y += padding;\n        }\n        else {\n          localMouse.y -= padding;\n        }\n      }\n      else {\n        localMouse.y = 0;\n      }\n    },\n\n    /**\n     * Rotates object by invoking its rotate method\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @return {Boolean} true if the rotation occurred\n     */\n    _rotateObject: function (x, y) {\n\n      var t = this._currentTransform,\n          target = t.target, constraintPosition,\n          constraintPosition = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY);\n\n      if (target.lockRotation) {\n        return false;\n      }\n\n      var lastAngle = atan2(t.ey - constraintPosition.y, t.ex - constraintPosition.x),\n          curAngle = atan2(y - constraintPosition.y, x - constraintPosition.x),\n          angle = radiansToDegrees(curAngle - lastAngle + t.theta),\n          hasRotated = true;\n\n      if (target.snapAngle > 0) {\n        var snapAngle  = target.snapAngle,\n            snapThreshold  = target.snapThreshold || snapAngle,\n            rightAngleLocked = Math.ceil(angle / snapAngle) * snapAngle,\n            leftAngleLocked = Math.floor(angle / snapAngle) * snapAngle;\n\n        if (Math.abs(angle - leftAngleLocked) < snapThreshold) {\n          angle = leftAngleLocked;\n        }\n        else if (Math.abs(angle - rightAngleLocked) < snapThreshold) {\n          angle = rightAngleLocked;\n        }\n      }\n\n      // normalize angle to positive value\n      if (angle < 0) {\n        angle = 360 + angle;\n      }\n      angle %= 360;\n\n      if (target.angle === angle) {\n        hasRotated = false;\n      }\n      else {\n        // rotation only happen here\n        target.angle = angle;\n        // Make sure the constraints apply\n        target.setPositionByOrigin(constraintPosition, t.originX, t.originY);\n      }\n\n      return hasRotated;\n    },\n\n    /**\n     * Set the cursor type of the canvas element\n     * @param {String} value Cursor type of the canvas element.\n     * @see http://www.w3.org/TR/css3-ui/#cursor\n     */\n    setCursor: function (value) {\n      this.upperCanvasEl.style.cursor = value;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx to draw the selection on\n     */\n    _drawSelection: function (ctx) {\n      var groupSelector = this._groupSelector,\n          left = groupSelector.left,\n          top = groupSelector.top,\n          aleft = abs(left),\n          atop = abs(top);\n\n      if (this.selectionColor) {\n        ctx.fillStyle = this.selectionColor;\n\n        ctx.fillRect(\n          groupSelector.ex - ((left > 0) ? 0 : -left),\n          groupSelector.ey - ((top > 0) ? 0 : -top),\n          aleft,\n          atop\n        );\n      }\n\n      if (!this.selectionLineWidth || !this.selectionBorderColor) {\n        return;\n      }\n      ctx.lineWidth = this.selectionLineWidth;\n      ctx.strokeStyle = this.selectionBorderColor;\n\n      // selection border\n      if (this.selectionDashArray.length > 1 && !supportLineDash) {\n\n        var px = groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n            py = groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop);\n\n        ctx.beginPath();\n\n        fabric.util.drawDashedLine(ctx, px, py, px + aleft, py, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px, py + atop - 1, px + aleft, py + atop - 1, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px, py, px, py + atop, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px + aleft - 1, py, px + aleft - 1, py + atop, this.selectionDashArray);\n\n        ctx.closePath();\n        ctx.stroke();\n      }\n      else {\n        fabric.Object.prototype._setLineDash.call(this, ctx, this.selectionDashArray);\n        ctx.strokeRect(\n          groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n          groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop),\n          aleft,\n          atop\n        );\n      }\n    },\n\n    /**\n     * Method that determines what object we are clicking on\n     * the skipGroup parameter is for internal use, is needed for shift+click action\n     * 11/09/2018 TODO: would be cool if findTarget could discern between being a full target\n     * or the outside part of the corner.\n     * @param {Event} e mouse event\n     * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through\n     * @return {fabric.Object} the target found\n     */\n    findTarget: function (e, skipGroup) {\n      if (this.skipTargetFind) {\n        return;\n      }\n\n      var ignoreZoom = true,\n          pointer = this.getPointer(e, ignoreZoom),\n          activeObject = this._activeObject,\n          aObjects = this.getActiveObjects(),\n          activeTarget, activeTargetSubs;\n\n      // first check current group (if one exists)\n      // active group does not check sub targets like normal groups.\n      // if active group just exits.\n      this.targets = [];\n\n      if (aObjects.length > 1 && !skipGroup && activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        return activeObject;\n      }\n      // if we hit the corner of an activeObject, let's return that.\n      if (aObjects.length === 1 && activeObject._findTargetCorner(pointer)) {\n        return activeObject;\n      }\n      if (aObjects.length === 1 &&\n        activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        if (!this.preserveObjectStacking) {\n          return activeObject;\n        }\n        else {\n          activeTarget = activeObject;\n          activeTargetSubs = this.targets;\n          this.targets = [];\n        }\n      }\n      var target = this._searchPossibleTargets(this._objects, pointer);\n      if (e[this.altSelectionKey] && target && activeTarget && target !== activeTarget) {\n        target = activeTarget;\n        this.targets = activeTargetSubs;\n      }\n      return target;\n    },\n\n    /**\n     * Checks point is inside the object.\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\n     * @param {fabric.Object} obj Object to test against\n     * @param {Object} [globalPointer] x,y object of point coordinates relative to canvas used to search per pixel target.\n     * @return {Boolean} true if point is contained within an area of given object\n     * @private\n     */\n    _checkTarget: function(pointer, obj, globalPointer) {\n      if (obj &&\n          obj.visible &&\n          obj.evented &&\n          this.containsPoint(null, obj, pointer)){\n        if ((this.perPixelTargetFind || obj.perPixelTargetFind) && !obj.isEditing) {\n          var isTransparent = this.isTargetTransparent(obj, globalPointer.x, globalPointer.y);\n          if (!isTransparent) {\n            return true;\n          }\n        }\n        else {\n          return true;\n        }\n      }\n    },\n\n    /**\n     * Function used to search inside objects an object that contains pointer in bounding box or that contains pointerOnCanvas when painted\n     * @param {Array} [objects] objects array to look into\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\n     * @return {fabric.Object} object that contains pointer\n     * @private\n     */\n    _searchPossibleTargets: function(objects, pointer) {\n      // Cache all targets where their bounding box contains point.\n      var target, i = objects.length, subTarget;\n      // Do not check for currently grouped objects, since we check the parent group itself.\n      // until we call this function specifically to search inside the activeGroup\n      while (i--) {\n        var objToCheck = objects[i];\n        var pointerToUse = objToCheck.group && objToCheck.group.type !== 'activeSelection' ?\n          this._normalizePointer(objToCheck.group, pointer) : pointer;\n        if (this._checkTarget(pointerToUse, objToCheck, pointer)) {\n          target = objects[i];\n          if (target.subTargetCheck && target instanceof fabric.Group) {\n            subTarget = this._searchPossibleTargets(target._objects, pointer);\n            subTarget && this.targets.push(subTarget);\n          }\n          break;\n        }\n      }\n      return target;\n    },\n\n    /**\n     * Returns pointer coordinates without the effect of the viewport\n     * @param {Object} pointer with \"x\" and \"y\" number values\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    restorePointerVpt: function(pointer) {\n      return fabric.util.transformPoint(\n        pointer,\n        fabric.util.invertTransform(this.viewportTransform)\n      );\n    },\n\n    /**\n     * Returns pointer coordinates relative to canvas.\n     * Can return coordinates with or without viewportTransform.\n     * ignoreZoom false gives back coordinates that represent\n     * the point clicked on canvas element.\n     * ignoreZoom true gives back coordinates after being processed\n     * by the viewportTransform ( sort of coordinates of what is displayed\n     * on the canvas where you are clicking.\n     * ignoreZoom true = HTMLElement coordinates relative to top,left\n     * ignoreZoom false, default = fabric space coordinates, the same used for shape position\n     * To interact with your shapes top and left you want to use ignoreZoom true\n     * most of the time, while ignoreZoom false will give you coordinates\n     * compatible with the object.oCoords system.\n     * of the time.\n     * @param {Event} e\n     * @param {Boolean} ignoreZoom\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    getPointer: function (e, ignoreZoom) {\n      // return cached values if we are in the event processing chain\n      if (this._absolutePointer && !ignoreZoom) {\n        return this._absolutePointer;\n      }\n      if (this._pointer && ignoreZoom) {\n        return this._pointer;\n      }\n\n      var pointer = getPointer(e),\n          upperCanvasEl = this.upperCanvasEl,\n          bounds = upperCanvasEl.getBoundingClientRect(),\n          boundsWidth = bounds.width || 0,\n          boundsHeight = bounds.height || 0,\n          cssScale;\n\n      if (!boundsWidth || !boundsHeight ) {\n        if ('top' in bounds && 'bottom' in bounds) {\n          boundsHeight = Math.abs( bounds.top - bounds.bottom );\n        }\n        if ('right' in bounds && 'left' in bounds) {\n          boundsWidth = Math.abs( bounds.right - bounds.left );\n        }\n      }\n\n      this.calcOffset();\n      pointer.x = pointer.x - this._offset.left;\n      pointer.y = pointer.y - this._offset.top;\n      if (!ignoreZoom) {\n        pointer = this.restorePointerVpt(pointer);\n      }\n\n      if (boundsWidth === 0 || boundsHeight === 0) {\n        // If bounds are not available (i.e. not visible), do not apply scale.\n        cssScale = { width: 1, height: 1 };\n      }\n      else {\n        cssScale = {\n          width: upperCanvasEl.width / boundsWidth,\n          height: upperCanvasEl.height / boundsHeight\n        };\n      }\n\n      return {\n        x: pointer.x * cssScale.width,\n        y: pointer.y * cssScale.height\n      };\n    },\n\n    /**\n     * @private\n     * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\n     */\n    _createUpperCanvas: function () {\n      var lowerCanvasClass = this.lowerCanvasEl.className.replace(/\\s*lower-canvas\\s*/, '');\n\n      // there is no need to create a new upperCanvas element if we have already one.\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl.className = '';\n      }\n      else {\n        this.upperCanvasEl = this._createCanvasElement();\n      }\n      fabric.util.addClass(this.upperCanvasEl, 'upper-canvas ' + lowerCanvasClass);\n\n      this.wrapperEl.appendChild(this.upperCanvasEl);\n\n      this._copyCanvasStyle(this.lowerCanvasEl, this.upperCanvasEl);\n      this._applyCanvasStyle(this.upperCanvasEl);\n      this.contextTop = this.upperCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _createCacheCanvas: function () {\n      this.cacheCanvasEl = this._createCanvasElement();\n      this.cacheCanvasEl.setAttribute('width', this.width);\n      this.cacheCanvasEl.setAttribute('height', this.height);\n      this.contextCache = this.cacheCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _initWrapperElement: function () {\n      this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, 'div', {\n        'class': this.containerClass\n      });\n      fabric.util.setStyle(this.wrapperEl, {\n        width: this.width + 'px',\n        height: this.height + 'px',\n        position: 'relative'\n      });\n      fabric.util.makeElementUnselectable(this.wrapperEl);\n    },\n\n    /**\n     * @private\n     * @param {HTMLElement} element canvas element to apply styles on\n     */\n    _applyCanvasStyle: function (element) {\n      var width = this.width || element.width,\n          height = this.height || element.height;\n\n      fabric.util.setStyle(element, {\n        position: 'absolute',\n        width: width + 'px',\n        height: height + 'px',\n        left: 0,\n        top: 0,\n        'touch-action': this.allowTouchScrolling ? 'manipulation' : 'none'\n      });\n      element.width = width;\n      element.height = height;\n      fabric.util.makeElementUnselectable(element);\n    },\n\n    /**\n     * Copy the entire inline style from one element (fromEl) to another (toEl)\n     * @private\n     * @param {Element} fromEl Element style is copied from\n     * @param {Element} toEl Element copied style is applied to\n     */\n    _copyCanvasStyle: function (fromEl, toEl) {\n      toEl.style.cssText = fromEl.style.cssText;\n    },\n\n    /**\n     * Returns context of canvas where object selection is drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getSelectionContext: function() {\n      return this.contextTop;\n    },\n\n    /**\n     * Returns &lt;canvas> element on which object selection is drawn\n     * @return {HTMLCanvasElement}\n     */\n    getSelectionElement: function () {\n      return this.upperCanvasEl;\n    },\n\n    /**\n     * Returns currently active object\n     * @return {fabric.Object} active object\n     */\n    getActiveObject: function () {\n      return this._activeObject;\n    },\n\n    /**\n     * Returns an array with the current selected objects\n     * @return {fabric.Object} active object\n     */\n    getActiveObjects: function () {\n      var active = this._activeObject;\n      if (active) {\n        if (active.type === 'activeSelection' && active._objects) {\n          return active._objects.slice(0);\n        }\n        else {\n          return [active];\n        }\n      }\n      return [];\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      // removing active object should fire \"selection:cleared\" events\n      if (obj === this._activeObject) {\n        this.fire('before:selection:cleared', { target: obj });\n        this._discardActiveObject();\n        this.fire('selection:cleared', { target: obj });\n        obj.fire('deselected');\n      }\n      if (this._hoveredTarget === obj) {\n        this._hoveredTarget = null;\n      }\n      this.callSuper('_onObjectRemoved', obj);\n    },\n\n    /**\n     * @private\n     * Compares the old activeObject with the current one and fires correct events\n     * @param {fabric.Object} obj old activeObject\n     */\n    _fireSelectionEvents: function(oldObjects, e) {\n      var somethingChanged = false, objects = this.getActiveObjects(),\n          added = [], removed = [], opt = { e: e };\n      oldObjects.forEach(function(oldObject) {\n        if (objects.indexOf(oldObject) === -1) {\n          somethingChanged = true;\n          oldObject.fire('deselected', opt);\n          removed.push(oldObject);\n        }\n      });\n      objects.forEach(function(object) {\n        if (oldObjects.indexOf(object) === -1) {\n          somethingChanged = true;\n          object.fire('selected', opt);\n          added.push(object);\n        }\n      });\n      if (oldObjects.length > 0 && objects.length > 0) {\n        opt.selected = added;\n        opt.deselected = removed;\n        // added for backward compatibility\n        opt.updated = added[0] || removed[0];\n        opt.target = this._activeObject;\n        somethingChanged && this.fire('selection:updated', opt);\n      }\n      else if (objects.length > 0) {\n        // deprecated event\n        if (objects.length === 1) {\n          opt.target = added[0];\n          this.fire('object:selected', opt);\n        }\n        opt.selected = added;\n        // added for backward compatibility\n        opt.target = this._activeObject;\n        this.fire('selection:created', opt);\n      }\n      else if (oldObjects.length > 0) {\n        opt.deselected = removed;\n        this.fire('selection:cleared', opt);\n      }\n    },\n\n    /**\n     * Sets given object as the only active object on canvas\n     * @param {fabric.Object} object Object to set as an active one\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveObject: function (object, e) {\n      var currentActives = this.getActiveObjects();\n      this._setActiveObject(object, e);\n      this._fireSelectionEvents(currentActives, e);\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {Object} object to set as active\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {Boolean} true if the selection happened\n     */\n    _setActiveObject: function(object, e) {\n      if (this._activeObject === object) {\n        return false;\n      }\n      if (!this._discardActiveObject(e, object)) {\n        return false;\n      }\n      if (object.onSelect({ e: e })) {\n        return false;\n      }\n      this._activeObject = object;\n      return true;\n    },\n\n    /**\n     * @private\n     */\n    _discardActiveObject: function(e, object) {\n      var obj = this._activeObject;\n      if (obj) {\n        // onDeselect return TRUE to cancel selection;\n        if (obj.onDeselect({ e: e, object: object })) {\n          return false;\n        }\n        this._activeObject = null;\n      }\n      return true;\n    },\n\n    /**\n     * Discards currently active object and fire events. If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parameter and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @param {event} e\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    discardActiveObject: function (e) {\n      var currentActives = this.getActiveObjects();\n      if (currentActives.length) {\n        this.fire('before:selection:cleared', { target: currentActives[0], e: e });\n      }\n      this._discardActiveObject(e);\n      this._fireSelectionEvents(currentActives, e);\n      return this;\n    },\n\n    /**\n     * Clears a canvas element and removes all event listeners\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      var wrapper = this.wrapperEl;\n      this.removeListeners();\n      wrapper.removeChild(this.upperCanvasEl);\n      wrapper.removeChild(this.lowerCanvasEl);\n      this.contextCache = null;\n      this.contextTop = null;\n      ['upperCanvasEl', 'cacheCanvasEl'].forEach((function(element) {\n        fabric.util.cleanUpJsdomNode(this[element]);\n        this[element] = undefined;\n      }).bind(this));\n      if (wrapper.parentNode) {\n        wrapper.parentNode.replaceChild(this.lowerCanvasEl, this.wrapperEl);\n      }\n      delete this.wrapperEl;\n      fabric.StaticCanvas.prototype.dispose.call(this);\n      return this;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      // this.discardActiveGroup();\n      this.discardActiveObject();\n      this.clearContext(this.contextTop);\n      return this.callSuper('clear');\n    },\n\n    /**\n     * Draws objects' controls (borders/controls)\n     * @param {CanvasRenderingContext2D} ctx Context to render controls on\n     */\n    drawControls: function(ctx) {\n      var activeObject = this._activeObject;\n\n      if (activeObject) {\n        activeObject._renderControls(ctx);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      //If the object is part of the current selection group, it should\n      //be transformed appropriately\n      //i.e. it should be serialised as it would appear if the selection group\n      //were to be destroyed.\n      var originalProperties = this._realizeGroupTransformOnObject(instance),\n          object = this.callSuper('_toObject', instance, methodName, propertiesToInclude);\n      //Undo the damage we did by changing all of its properties\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n      return object;\n    },\n\n    /**\n     * Realises an object's group transformation on it\n     * @private\n     * @param {fabric.Object} [instance] the object to transform (gets mutated)\n     * @returns the original values of instance which were changed\n     */\n    _realizeGroupTransformOnObject: function(instance) {\n      if (instance.group && instance.group.type === 'activeSelection' && this._activeObject === instance.group) {\n        var layoutProps = ['angle', 'flipX', 'flipY', 'left', 'scaleX', 'scaleY', 'skewX', 'skewY', 'top'];\n        //Copy all the positionally relevant properties across now\n        var originalValues = {};\n        layoutProps.forEach(function(prop) {\n          originalValues[prop] = instance[prop];\n        });\n        this._activeObject.realizeTransform(instance);\n        return originalValues;\n      }\n      else {\n        return null;\n      }\n    },\n\n    /**\n     * Restores the changed properties of instance\n     * @private\n     * @param {fabric.Object} [instance] the object to un-transform (gets mutated)\n     * @param {Object} [originalValues] the original values of instance, as returned by _realizeGroupTransformOnObject\n     */\n    _unwindGroupTransformOnObject: function(instance, originalValues) {\n      if (originalValues) {\n        instance.set(originalValues);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      //If the object is in a selection group, simulate what would happen to that\n      //object when the group is deselected\n      var originalProperties = this._realizeGroupTransformOnObject(instance);\n      this.callSuper('_setSVGObject', markup, instance, reviver);\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n    },\n\n    setViewportTransform: function (vpt) {\n      if (this.renderOnAddRemove && this._activeObject && this._activeObject.isEditing) {\n        this._activeObject.clearContextTop();\n      }\n      fabric.StaticCanvas.prototype.setViewportTransform.call(this, vpt);\n    }\n  });\n\n  // copying static properties manually to work around Opera's bug,\n  // where \"prototype\" property is enumerable and overrides existing prototype\n  for (var prop in fabric.StaticCanvas) {\n    if (prop !== 'prototype') {\n      fabric.Canvas[prop] = fabric.StaticCanvas[prop];\n    }\n  }\n\n  if (fabric.isTouchSupported) {\n    /** @ignore */\n    fabric.Canvas.prototype._setCursorFromEvent = function() { };\n  }\n})();\n(function() {\n\n  var cursorOffset = {\n        mt: 0, // n\n        tr: 1, // ne\n        mr: 2, // e\n        br: 3, // se\n        mb: 4, // s\n        bl: 5, // sw\n        ml: 6, // w\n        tl: 7 // nw\n      },\n      addListener = fabric.util.addListener,\n      removeListener = fabric.util.removeListener,\n      RIGHT_CLICK = 3, MIDDLE_CLICK = 2, LEFT_CLICK = 1,\n      addEventOptions = { passive: false };\n\n  function checkClick(e, value) {\n    return 'which' in e ? e.which === value : e.button === value - 1;\n  }\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Map of cursor style values for each of the object controls\n     * @private\n     */\n    cursorMap: [\n      'n-resize',\n      'ne-resize',\n      'e-resize',\n      'se-resize',\n      's-resize',\n      'sw-resize',\n      'w-resize',\n      'nw-resize'\n    ],\n\n    /**\n     * Adds mouse listeners to canvas\n     * @private\n     */\n    _initEventListeners: function () {\n      // in case we initialized the class twice. This should not happen normally\n      // but in some kind of applications where the canvas element may be changed\n      // this is a workaround to having double listeners.\n      this.removeListeners();\n      this._bindEvents();\n      this.addOrRemove(addListener, 'add');\n    },\n\n    addOrRemove: function(functor, eventjsFunctor) {\n      functor(fabric.window, 'resize', this._onResize);\n      functor(this.upperCanvasEl, 'mousedown', this._onMouseDown);\n      functor(this.upperCanvasEl, 'mousemove', this._onMouseMove, addEventOptions);\n      functor(this.upperCanvasEl, 'mouseout', this._onMouseOut);\n      functor(this.upperCanvasEl, 'mouseenter', this._onMouseEnter);\n      functor(this.upperCanvasEl, 'wheel', this._onMouseWheel);\n      functor(this.upperCanvasEl, 'contextmenu', this._onContextMenu);\n      functor(this.upperCanvasEl, 'dblclick', this._onDoubleClick);\n      functor(this.upperCanvasEl, 'touchstart', this._onMouseDown, addEventOptions);\n      functor(this.upperCanvasEl, 'touchmove', this._onMouseMove, addEventOptions);\n      functor(this.upperCanvasEl, 'dragover', this._onDragOver);\n      functor(this.upperCanvasEl, 'dragenter', this._onDragEnter);\n      functor(this.upperCanvasEl, 'dragleave', this._onDragLeave);\n      functor(this.upperCanvasEl, 'drop', this._onDrop);\n      if (typeof eventjs !== 'undefined' && eventjsFunctor in eventjs) {\n        eventjs[eventjsFunctor](this.upperCanvasEl, 'gesture', this._onGesture);\n        eventjs[eventjsFunctor](this.upperCanvasEl, 'drag', this._onDrag);\n        eventjs[eventjsFunctor](this.upperCanvasEl, 'orientation', this._onOrientationChange);\n        eventjs[eventjsFunctor](this.upperCanvasEl, 'shake', this._onShake);\n        eventjs[eventjsFunctor](this.upperCanvasEl, 'longpress', this._onLongPress);\n      }\n    },\n\n    /**\n     * Removes all event listeners\n     */\n    removeListeners: function() {\n      this.addOrRemove(removeListener, 'remove');\n      // if you dispose on a mouseDown, before mouse up, you need to clean document to...\n      removeListener(fabric.document, 'mouseup', this._onMouseUp);\n      removeListener(fabric.document, 'touchend', this._onMouseUp, addEventOptions);\n      removeListener(fabric.document, 'mousemove', this._onMouseMove, addEventOptions);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n    },\n\n    /**\n     * @private\n     */\n    _bindEvents: function() {\n      if (this.eventsBound) {\n        // for any reason we pass here twice we do not want to bind events twice.\n        return;\n      }\n      this._onMouseDown = this._onMouseDown.bind(this);\n      this._onMouseMove = this._onMouseMove.bind(this);\n      this._onMouseUp = this._onMouseUp.bind(this);\n      this._onResize = this._onResize.bind(this);\n      this._onGesture = this._onGesture.bind(this);\n      this._onDrag = this._onDrag.bind(this);\n      this._onShake = this._onShake.bind(this);\n      this._onLongPress = this._onLongPress.bind(this);\n      this._onOrientationChange = this._onOrientationChange.bind(this);\n      this._onMouseWheel = this._onMouseWheel.bind(this);\n      this._onMouseOut = this._onMouseOut.bind(this);\n      this._onMouseEnter = this._onMouseEnter.bind(this);\n      this._onContextMenu = this._onContextMenu.bind(this);\n      this._onDoubleClick = this._onDoubleClick.bind(this);\n      this._onDragOver = this._onDragOver.bind(this);\n      this._onDragEnter = this._simpleEventHandler.bind(this, 'dragenter');\n      this._onDragLeave = this._simpleEventHandler.bind(this, 'dragleave');\n      this._onDrop = this._simpleEventHandler.bind(this, 'drop');\n      this.eventsBound = true;\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js gesture\n     * @param {Event} [self] Inner Event object\n     */\n    _onGesture: function(e, self) {\n      this.__onTransformGesture && this.__onTransformGesture(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js drag\n     * @param {Event} [self] Inner Event object\n     */\n    _onDrag: function(e, self) {\n      this.__onDrag && this.__onDrag(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on wheel event\n     */\n    _onMouseWheel: function(e) {\n      this.__onMouseWheel(e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseOut: function(e) {\n      var target = this._hoveredTarget;\n      this.fire('mouse:out', { target: target, e: e });\n      this._hoveredTarget = null;\n      target && target.fire('mouseout', { e: e });\n      if (this._iTextInstances) {\n        this._iTextInstances.forEach(function(obj) {\n          if (obj.isEditing) {\n            obj.hiddenTextarea.focus();\n          }\n        });\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseenter\n     */\n    _onMouseEnter: function(e) {\n      if (!this.findTarget(e)) {\n        this.fire('mouse:over', { target: null, e: e });\n        this._hoveredTarget = null;\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js orientation change\n     * @param {Event} [self] Inner Event object\n     */\n    _onOrientationChange: function(e, self) {\n      this.__onOrientationChange && this.__onOrientationChange(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onShake: function(e, self) {\n      this.__onShake && this.__onShake(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onLongPress: function(e, self) {\n      this.__onLongPress && this.__onLongPress(e, self);\n    },\n\n    /**\n     * prevent default to allow drop event to be fired\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     */\n    _onDragOver: function(e) {\n      e.preventDefault();\n      var target = this._simpleEventHandler('dragover', e);\n      this._fireEnterLeaveEvents(target, e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onContextMenu: function (e) {\n      if (this.stopContextMenu) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onDoubleClick: function (e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'dblclick');\n      this._resetTransformEventData(e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDown: function (e) {\n      this.__onMouseDown(e);\n      this._resetTransformEventData();\n      addListener(fabric.document, 'touchend', this._onMouseUp, addEventOptions);\n      addListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n\n      removeListener(this.upperCanvasEl, 'mousemove', this._onMouseMove, addEventOptions);\n      removeListener(this.upperCanvasEl, 'touchmove', this._onMouseMove, addEventOptions);\n\n      if (e.type === 'touchstart') {\n        // Unbind mousedown to prevent double triggers from touch devices\n        removeListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);\n      }\n      else {\n        addListener(fabric.document, 'mouseup', this._onMouseUp);\n        addListener(fabric.document, 'mousemove', this._onMouseMove, addEventOptions);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUp: function (e) {\n      this.__onMouseUp(e);\n      this._resetTransformEventData();\n      removeListener(fabric.document, 'mouseup', this._onMouseUp);\n      removeListener(fabric.document, 'touchend', this._onMouseUp, addEventOptions);\n\n      removeListener(fabric.document, 'mousemove', this._onMouseMove, addEventOptions);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n\n      addListener(this.upperCanvasEl, 'mousemove', this._onMouseMove, addEventOptions);\n      addListener(this.upperCanvasEl, 'touchmove', this._onMouseMove, addEventOptions);\n\n      if (e.type === 'touchend') {\n        // Wait 400ms before rebinding mousedown to prevent double triggers\n        // from touch devices\n        var _this = this;\n        setTimeout(function() {\n          addListener(_this.upperCanvasEl, 'mousedown', _this._onMouseDown);\n        }, 400);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMove: function (e) {\n      !this.allowTouchScrolling && e.preventDefault && e.preventDefault();\n      this.__onMouseMove(e);\n    },\n\n    /**\n     * @private\n     */\n    _onResize: function () {\n      this.calcOffset();\n    },\n\n    /**\n     * Decides whether the canvas should be redrawn in mouseup and mousedown events.\n     * @private\n     * @param {Object} target\n     */\n    _shouldRender: function(target) {\n      var activeObject = this._activeObject;\n\n      if (\n        !!activeObject !== !!target ||\n        (activeObject && target && (activeObject !== target))\n      ) {\n        // this covers: switch of target, from target to no target, selection of target\n        // multiSelection with key and mouse\n        return true;\n      }\n      else if (activeObject && activeObject.isEditing) {\n        // if we mouse up/down over a editing textbox a cursor change,\n        // there is no need to re render\n        return false;\n      }\n      return false;\n    },\n\n    /**\n     * Method that defines the actions when mouse is released on canvas.\n     * The method resets the currentTransform parameters, store the image corner\n     * position in the image object and render the canvas on top.\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseUp: function (e) {\n      var target, transform = this._currentTransform,\n          groupSelector = this._groupSelector, shouldRender = false,\n          isClick = (!groupSelector || (groupSelector.left === 0 && groupSelector.top === 0));\n      this._cacheTransformEventData(e);\n      target = this._target;\n      this._handleEvent(e, 'up:before');\n      // if right/middle click just fire events and return\n      // target undefined will make the _handleEvent search the target\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'up', RIGHT_CLICK, isClick);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'up', MIDDLE_CLICK, isClick);\n        }\n        this._resetTransformEventData();\n        return;\n      }\n\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this._onMouseUpInDrawingMode(e);\n        return;\n      }\n\n      if (transform) {\n        this._finalizeCurrentTransform(e);\n        shouldRender = transform.actionPerformed;\n      }\n\n      if (!isClick) {\n        this._maybeGroupObjects(e);\n        shouldRender || (shouldRender = this._shouldRender(target));\n      }\n      if (target) {\n        target.isMoving = false;\n      }\n      this._setCursorFromEvent(e, target);\n      this._handleEvent(e, 'up', LEFT_CLICK, isClick);\n      this._groupSelector = null;\n      this._currentTransform = null;\n      // reset the target information about which corner is selected\n      target && (target.__corner = 0);\n      if (shouldRender) {\n        this.requestRenderAll();\n      }\n      else if (!isClick) {\n        this.renderTop();\n      }\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @return {Fabric.Object} target return the the target found, for internal reasons.\n     */\n    _simpleEventHandler: function(eventType, e) {\n      var target = this.findTarget(e),\n          targets = this.targets,\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n          };\n      this.fire(eventType, options);\n      target && target.fire(eventType, options);\n      if (!targets) {\n        return target;\n      }\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire(eventType, options);\n      }\n      return target;\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @param {fabric.Object} targetObj receiving event\n     * @param {Number} [button] button used in the event 1 = left, 2 = middle, 3 = right\n     * @param {Boolean} isClick for left button only, indicates that the mouse up happened without move.\n     */\n    _handleEvent: function(e, eventType, button, isClick) {\n      var target = this._target,\n          targets = this.targets || [],\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n            button: button || LEFT_CLICK,\n            isClick: isClick || false,\n            pointer: this._pointer,\n            absolutePointer: this._absolutePointer,\n            transform: this._currentTransform\n          };\n      this.fire('mouse:' + eventType, options);\n      target && target.fire('mouse' + eventType, options);\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire('mouse' + eventType, options);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e send the mouse event that generate the finalize down, so it can be used in the event\n     */\n    _finalizeCurrentTransform: function(e) {\n\n      var transform = this._currentTransform,\n          target = transform.target,\n          eventName,\n          options = {\n            e: e,\n            target: target,\n            transform: transform,\n          };\n\n      if (target._scaling) {\n        target._scaling = false;\n      }\n\n      target.setCoords();\n\n      if (transform.actionPerformed || (this.stateful && target.hasStateChanged())) {\n        if (transform.actionPerformed) {\n          eventName = this._addEventOptions(options, transform);\n          this._fire(eventName, options);\n        }\n        this._fire('modified', options);\n      }\n    },\n\n    /**\n     * Mutate option object in order to add by property and give back the event name.\n     * @private\n     * @param {Object} options to mutate\n     * @param {Object} transform to inspect action from\n     */\n    _addEventOptions: function(options, transform) {\n      // we can probably add more details at low cost\n      // scale change, rotation changes, translation changes\n      var eventName, by;\n      switch (transform.action) {\n        case 'scaleX':\n          eventName = 'scaled';\n          by = 'x';\n          break;\n        case 'scaleY':\n          eventName = 'scaled';\n          by = 'y';\n          break;\n        case 'skewX':\n          eventName = 'skewed';\n          by = 'x';\n          break;\n        case 'skewY':\n          eventName = 'skewed';\n          by = 'y';\n          break;\n        case 'scale':\n          eventName = 'scaled';\n          by = 'equally';\n          break;\n        case 'rotate':\n          eventName = 'rotated';\n          break;\n        case 'drag':\n          eventName = 'moved';\n          break;\n      }\n      options.by = by;\n      return eventName;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDownInDrawingMode: function(e) {\n      this._isCurrentlyDrawing = true;\n      if (this.getActiveObject()) {\n        this.discardActiveObject(e).requestRenderAll();\n      }\n      if (this.clipTo) {\n        fabric.util.clipContext(this, this.contextTop);\n      }\n      var pointer = this.getPointer(e);\n      this.freeDrawingBrush.onMouseDown(pointer);\n      this._handleEvent(e, 'down');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMoveInDrawingMode: function(e) {\n      if (this._isCurrentlyDrawing) {\n        var pointer = this.getPointer(e);\n        this.freeDrawingBrush.onMouseMove(pointer);\n      }\n      this.setCursor(this.freeDrawingCursor);\n      this._handleEvent(e, 'move');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUpInDrawingMode: function(e) {\n      this._isCurrentlyDrawing = false;\n      if (this.clipTo) {\n        this.contextTop.restore();\n      }\n      this.freeDrawingBrush.onMouseUp();\n      this._handleEvent(e, 'up');\n    },\n\n    /**\n     * Method that defines the actions when mouse is clicked on canvas.\n     * The method inits the currentTransform parameters and renders all the\n     * canvas so the current image can be placed on the top canvas and the rest\n     * in on the container one.\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    __onMouseDown: function (e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'down:before');\n      var target = this._target;\n      // if right click just fire events\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'down', RIGHT_CLICK);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'down', MIDDLE_CLICK);\n        }\n        return;\n      }\n\n      if (this.isDrawingMode) {\n        this._onMouseDownInDrawingMode(e);\n        return;\n      }\n\n      // ignore if some object is being transformed at this moment\n      if (this._currentTransform) {\n        return;\n      }\n\n      var pointer = this._pointer;\n      // save pointer for check in __onMouseUp event\n      this._previousPointer = pointer;\n      var shouldRender = this._shouldRender(target),\n          shouldGroup = this._shouldGroup(e, target);\n      if (this._shouldClearSelection(e, target)) {\n        this.discardActiveObject(e);\n      }\n      else if (shouldGroup) {\n        this._handleGrouping(e, target);\n        target = this._activeObject;\n      }\n\n      if (this.selection && (!target ||\n        (!target.selectable && !target.isEditing && target !== this._activeObject))) {\n        this._groupSelector = {\n          ex: pointer.x,\n          ey: pointer.y,\n          top: 0,\n          left: 0\n        };\n      }\n\n      if (target) {\n        var alreadySelected = target === this._activeObject;\n        if (target.selectable) {\n          this.setActiveObject(target, e);\n        }\n        if (target === this._activeObject && (target.__corner || !shouldGroup)) {\n          this._setupCurrentTransform(e, target, alreadySelected);\n        }\n      }\n      this._handleEvent(e, 'down');\n      // we must renderAll so that we update the visuals\n      (shouldRender || shouldGroup) && this.requestRenderAll();\n    },\n\n    /**\n     * reset cache form common information needed during event processing\n     * @private\n     */\n    _resetTransformEventData: function() {\n      this._target = null;\n      this._pointer = null;\n      this._absolutePointer = null;\n    },\n\n    /**\n     * Cache common information needed during event processing\n     * @private\n     * @param {Event} e Event object fired on event\n     */\n    _cacheTransformEventData: function(e) {\n      // reset in order to avoid stale caching\n      this._resetTransformEventData();\n      this._pointer = this.getPointer(e, true);\n      this._absolutePointer = this.restorePointerVpt(this._pointer);\n      this._target = this._currentTransform ? this._currentTransform.target : this.findTarget(e) || null;\n    },\n\n    /**\n     * @private\n     */\n    _beforeTransform: function(e) {\n      var t = this._currentTransform;\n      this.stateful && t.target.saveState();\n      this.fire('before:transform', {\n        e: e,\n        transform: t,\n      });\n      // determine if it's a drag or rotate case\n      if (t.corner) {\n        this.onBeforeScaleRotate(t.target);\n      }\n    },\n\n    /**\n     * Method that defines the actions when mouse is hovering the canvas.\n     * The currentTransform parameter will definde whether the user is rotating/scaling/translating\n     * an image or neither of them (only hovering). A group selection is also possible and would cancel\n     * all any other type of action.\n     * In case of an image transformation only the top canvas will be rendered.\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    __onMouseMove: function (e) {\n      this._handleEvent(e, 'move:before');\n      this._cacheTransformEventData(e);\n      var target, pointer;\n\n      if (this.isDrawingMode) {\n        this._onMouseMoveInDrawingMode(e);\n        return;\n      }\n      if (typeof e.touches !== 'undefined' && e.touches.length > 1) {\n        return;\n      }\n\n      var groupSelector = this._groupSelector;\n\n      // We initially clicked in an empty area, so we draw a box for multiple selection\n      if (groupSelector) {\n        pointer = this._pointer;\n\n        groupSelector.left = pointer.x - groupSelector.ex;\n        groupSelector.top = pointer.y - groupSelector.ey;\n\n        this.renderTop();\n      }\n      else if (!this._currentTransform) {\n        target = this.findTarget(e) || null;\n        this._setCursorFromEvent(e, target);\n        this._fireOverOutEvents(target, e);\n      }\n      else {\n        this._transformObject(e);\n      }\n      this._handleEvent(e, 'move');\n      this._resetTransformEventData();\n    },\n\n    /**\n     * Manage the mouseout, mouseover events for the fabric object on the canvas\n     * @param {Fabric.Object} target the target where the target from the mousemove event\n     * @param {Event} e Event object fired on mousemove\n     * @private\n     */\n    _fireOverOutEvents: function(target, e) {\n      this.fireSynteticInOutEvents(target, e, {\n        targetName: '_hoveredTarget',\n        canvasEvtOut: 'mouse:out',\n        evtOut: 'mouseout',\n        canvasEvtIn: 'mouse:over',\n        evtIn: 'mouseover',\n      });\n    },\n\n    /**\n     * Manage the dragEnter, dragLeave events for the fabric objects on the canvas\n     * @param {Fabric.Object} target the target where the target from the onDrag event\n     * @param {Event} e Event object fired on ondrag\n     * @private\n     */\n    _fireEnterLeaveEvents: function(target, e) {\n      this.fireSynteticInOutEvents(target, e, {\n        targetName: '_draggedoverTarget',\n        evtOut: 'dragleave',\n        evtIn: 'dragenter',\n      });\n    },\n\n    /**\n     * Manage the syntetic in/out events for the fabric objects on the canvas\n     * @param {Fabric.Object} target the target where the target from the supported events\n     * @param {Event} e Event object fired\n     * @param {Object} config configuration for the function to work\n     * @param {String} config.targetName property on the canvas where the old target is stored\n     * @param {String} [config.canvasEvtOut] name of the event to fire at canvas level for out\n     * @param {String} config.evtOut name of the event to fire for out\n     * @param {String} [config.canvasEvtIn] name of the event to fire at canvas level for in\n     * @param {String} config.evtIn name of the event to fire for in\n     * @private\n     */\n    fireSynteticInOutEvents: function(target, e, config) {\n      var inOpt, outOpt, oldTarget = this[config.targetName], outFires, inFires,\n          targetChanged = oldTarget !== target, canvasEvtIn = config.canvasEvtIn, canvasEvtOut = config.canvasEvtOut;\n      if (targetChanged) {\n        inOpt = { e: e, target: target, previousTarget: oldTarget };\n        outOpt = { e: e, target: oldTarget, nextTarget: target };\n        this[config.targetName] = target;\n      }\n      inFires = target && targetChanged;\n      outFires = oldTarget && targetChanged;\n      if (outFires) {\n        canvasEvtOut && this.fire(canvasEvtOut, outOpt);\n        oldTarget.fire(config.evtOut, outOpt);\n      }\n      if (inFires) {\n        canvasEvtIn && this.fire(canvasEvtIn, inOpt);\n        target.fire(config.evtIn, inOpt);\n      }\n    },\n\n    /**\n     * Method that defines actions when an Event Mouse Wheel\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseWheel: function(e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'wheel');\n      this._resetTransformEventData();\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event fired on mousemove\n     */\n    _transformObject: function(e) {\n      var pointer = this.getPointer(e),\n          transform = this._currentTransform;\n      transform.reset = false;\n      transform.target.isMoving = true;\n      transform.shiftKey = e.shiftKey;\n      transform.altKey = e[this.centeredKey];\n\n      this._beforeScaleTransform(e, transform);\n      this._performTransformAction(e, transform, pointer);\n\n      transform.actionPerformed && this.requestRenderAll();\n    },\n\n    /**\n     * @private\n     */\n    _performTransformAction: function(e, transform, pointer) {\n      var x = pointer.x,\n          y = pointer.y,\n          action = transform.action,\n          actionPerformed = false,\n          options = {\n            target: transform.target,\n            e: e,\n            transform: transform,\n            pointer: pointer\n          };\n\n      if (action === 'rotate') {\n        (actionPerformed = this._rotateObject(x, y)) && this._fire('rotating', options);\n      }\n      else if (action === 'scale') {\n        (actionPerformed = this._onScale(e, transform, x, y)) && this._fire('scaling', options);\n      }\n      else if (action === 'scaleX') {\n        (actionPerformed = this._scaleObject(x, y, 'x')) && this._fire('scaling', options);\n      }\n      else if (action === 'scaleY') {\n        (actionPerformed = this._scaleObject(x, y, 'y')) && this._fire('scaling', options);\n      }\n      else if (action === 'skewX') {\n        (actionPerformed = this._skewObject(x, y, 'x')) && this._fire('skewing', options);\n      }\n      else if (action === 'skewY') {\n        (actionPerformed = this._skewObject(x, y, 'y')) && this._fire('skewing', options);\n      }\n      else {\n        actionPerformed = this._translateObject(x, y);\n        if (actionPerformed) {\n          this._fire('moving', options);\n          this.setCursor(options.target.moveCursor || this.moveCursor);\n        }\n      }\n      transform.actionPerformed = transform.actionPerformed || actionPerformed;\n    },\n\n    /**\n     * @private\n     */\n    _fire: function(eventName, options) {\n      this.fire('object:' + eventName, options);\n      options.target.fire(eventName, options);\n    },\n\n    /**\n     * @private\n     */\n    _beforeScaleTransform: function(e, transform) {\n      if (transform.action === 'scale' || transform.action === 'scaleX' || transform.action === 'scaleY') {\n        var centerTransform = this._shouldCenterTransform(transform.target);\n\n        // Switch from a normal resize to center-based\n        if ((centerTransform && (transform.originX !== 'center' || transform.originY !== 'center')) ||\n           // Switch from center-based resize to normal one\n           (!centerTransform && transform.originX === 'center' && transform.originY === 'center')\n        ) {\n          this._resetCurrentTransform();\n          transform.reset = true;\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {Object} transform current tranform\n     * @param {Number} x mouse position x from origin\n     * @param {Number} y mouse poistion y from origin\n     * @return {Boolean} true if the scaling occurred\n     */\n    _onScale: function(e, transform, x, y) {\n      if (this._isUniscalePossible(e, transform.target)) {\n        transform.currentAction = 'scale';\n        return this._scaleObject(x, y);\n      }\n      else {\n        // Switch from a normal resize to proportional\n        if (!transform.reset && transform.currentAction === 'scale') {\n          this._resetCurrentTransform();\n        }\n\n        transform.currentAction = 'scaleEqually';\n        return this._scaleObject(x, y, 'equally');\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target current target\n     * @return {Boolean} true if unproportional scaling is possible\n     */\n    _isUniscalePossible: function(e, target) {\n      return (e[this.uniScaleKey] || this.uniScaleTransform) && !target.get('lockUniScaling');\n    },\n\n    /**\n     * Sets the cursor depending on where the canvas is being hovered.\n     * Note: very buggy in Opera\n     * @param {Event} e Event object\n     * @param {Object} target Object that the mouse is hovering, if so.\n     */\n    _setCursorFromEvent: function (e, target) {\n      if (!target) {\n        this.setCursor(this.defaultCursor);\n        return false;\n      }\n\n      var hoverCursor = target.hoverCursor || this.hoverCursor,\n          activeSelection = this._activeObject && this._activeObject.type === 'activeSelection' ?\n            this._activeObject : null,\n          // only show proper corner when group selection is not active\n          corner = (!activeSelection || !activeSelection.contains(target))\n                    && target._findTargetCorner(this.getPointer(e, true));\n\n      if (!corner) {\n        this.setCursor(hoverCursor);\n      }\n      else {\n        this.setCursor(this.getCornerCursor(corner, target, e));\n      }\n    },\n\n    /**\n     * @private\n     */\n    getCornerCursor: function(corner, target, e) {\n      if (this.actionIsDisabled(corner, target, e)) {\n        return this.notAllowedCursor;\n      }\n      else if (corner in cursorOffset) {\n        return this._getRotatedCornerCursor(corner, target, e);\n      }\n      else if (corner === 'mtr' && target.hasRotatingPoint) {\n        return this.rotationCursor;\n      }\n      else {\n        return this.defaultCursor;\n      }\n    },\n\n    actionIsDisabled: function(corner, target, e) {\n      if (corner === 'mt' || corner === 'mb') {\n        return e[this.altActionKey] ? target.lockSkewingX : target.lockScalingY;\n      }\n      else if (corner === 'ml' || corner === 'mr') {\n        return e[this.altActionKey] ? target.lockSkewingY : target.lockScalingX;\n      }\n      else if (corner === 'mtr') {\n        return target.lockRotation;\n      }\n      else {\n        return this._isUniscalePossible(e, target) ?\n          target.lockScalingX && target.lockScalingY : target.lockScalingX || target.lockScalingY;\n      }\n    },\n\n    /**\n     * @private\n     */\n    _getRotatedCornerCursor: function(corner, target, e) {\n      var n = Math.round((target.angle % 360) / 45);\n\n      if (n < 0) {\n        n += 8; // full circle ahead\n      }\n      n += cursorOffset[corner];\n      if (e[this.altActionKey] && cursorOffset[corner] % 2 === 0) {\n        //if we are holding shift and we are on a mx corner...\n        n += 2;\n      }\n      // normalize n to be from 0 to 7\n      n %= 8;\n\n      return this.cursorMap[n];\n    }\n  });\n})();\n(function() {\n\n  var min = Math.min,\n      max = Math.max;\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     * @return {Boolean}\n     */\n    _shouldGroup: function(e, target) {\n      var activeObject = this._activeObject;\n      return activeObject && this._isSelectionKeyPressed(e) && target && target.selectable && this.selection &&\n            (activeObject !== target || activeObject.type === 'activeSelection') && !target.onSelect({ e: e });\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _handleGrouping: function (e, target) {\n      var activeObject = this._activeObject;\n      // avoid multi select when shift click on a corner\n      if (activeObject.__corner) {\n        return;\n      }\n      if (target === activeObject) {\n        // if it's a group, find target again, using activeGroup objects\n        target = this.findTarget(e, true);\n        // if even object is not found or we are on activeObjectCorner, bail out\n        if (!target || !target.selectable) {\n          return;\n        }\n      }\n      if (activeObject && activeObject.type === 'activeSelection') {\n        this._updateActiveSelection(target, e);\n      }\n      else {\n        this._createActiveSelection(target, e);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _updateActiveSelection: function(target, e) {\n      var activeSelection = this._activeObject,\n          currentActiveObjects = activeSelection._objects.slice(0);\n      if (activeSelection.contains(target)) {\n        activeSelection.removeWithUpdate(target);\n        this._hoveredTarget = target;\n        if (activeSelection.size() === 1) {\n          // activate last remaining object\n          this._setActiveObject(activeSelection.item(0), e);\n        }\n      }\n      else {\n        activeSelection.addWithUpdate(target);\n        this._hoveredTarget = activeSelection;\n      }\n      this._fireSelectionEvents(currentActiveObjects, e);\n    },\n\n    /**\n     * @private\n     */\n    _createActiveSelection: function(target, e) {\n      var currentActives = this.getActiveObjects(), group = this._createGroup(target);\n      this._hoveredTarget = group;\n      this._setActiveObject(group, e);\n      this._fireSelectionEvents(currentActives, e);\n    },\n\n    /**\n     * @private\n     * @param {Object} target\n     */\n    _createGroup: function(target) {\n      var objects = this._objects,\n          isActiveLower = objects.indexOf(this._activeObject) < objects.indexOf(target),\n          groupObjects = isActiveLower\n            ? [this._activeObject, target]\n            : [target, this._activeObject];\n      this._activeObject.isEditing && this._activeObject.exitEditing();\n      return new fabric.ActiveSelection(groupObjects, {\n        canvas: this\n      });\n    },\n\n    /**\n     * @private\n     * @param {Event} e mouse event\n     */\n    _groupSelectedObjects: function (e) {\n\n      var group = this._collectObjects(e),\n          aGroup;\n\n      // do not create group for 1 element only\n      if (group.length === 1) {\n        this.setActiveObject(group[0], e);\n      }\n      else if (group.length > 1) {\n        aGroup = new fabric.ActiveSelection(group.reverse(), {\n          canvas: this\n        });\n        this.setActiveObject(aGroup, e);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _collectObjects: function(e) {\n      var group = [],\n          currentObject,\n          x1 = this._groupSelector.ex,\n          y1 = this._groupSelector.ey,\n          x2 = x1 + this._groupSelector.left,\n          y2 = y1 + this._groupSelector.top,\n          selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),\n          selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2)),\n          allowIntersect = !this.selectionFullyContained,\n          isClick = x1 === x2 && y1 === y2;\n      // we iterate reverse order to collect top first in case of click.\n      for (var i = this._objects.length; i--; ) {\n        currentObject = this._objects[i];\n\n        if (!currentObject || !currentObject.selectable || !currentObject.visible || currentObject.onSelect({ e: e })) {\n          continue;\n        }\n\n        if ((allowIntersect && currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2)) ||\n            currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2) ||\n            (allowIntersect && currentObject.containsPoint(selectionX1Y1)) ||\n            (allowIntersect && currentObject.containsPoint(selectionX2Y2))\n        ) {\n          group.push(currentObject);\n\n          // only add one object if it's a click\n          if (isClick) {\n            break;\n          }\n        }\n      }\n\n      return group;\n    },\n\n    /**\n     * @private\n     */\n    _maybeGroupObjects: function(e) {\n      if (this.selection && this._groupSelector) {\n        this._groupSelectedObjects(e);\n      }\n      this.setCursor(this.defaultCursor);\n      // clear selection and current transformation\n      this._groupSelector = null;\n    }\n  });\n\n})();\n(function () {\n\n  var supportQuality = fabric.StaticCanvas.supports('toDataURLWithQuality');\n\n  fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately\n     * @param {Object} [options] Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by, to have consistent\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 2.0.0\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     * @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}\n     * @example <caption>Generate jpeg dataURL with lower quality</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'jpeg',\n     *   quality: 0.8\n     * });\n     * @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   left: 100,\n     *   top: 100,\n     *   width: 200,\n     *   height: 200\n     * });\n     * @example <caption>Generate double scaled png dataURL</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   multiplier: 2\n     * });\n     */\n    toDataURL: function (options) {\n      options || (options = { });\n\n      var format = options.format || 'png',\n          quality = options.quality || 1,\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? 1 : 1 / this.getRetinaScaling()),\n          cropping = {\n            left: options.left || 0,\n            top: options.top || 0,\n            width: options.width || 0,\n            height: options.height || 0,\n          };\n      return this.__toDataURLWithMultiplier(format, quality, cropping, multiplier);\n    },\n\n    /**\n     * @private\n     */\n    __toDataURLWithMultiplier: function(format, quality, cropping, multiplier) {\n\n      var origWidth = this.width,\n          origHeight = this.height,\n          scaledWidth = (cropping.width || this.width) * multiplier,\n          scaledHeight = (cropping.height || this.height) * multiplier,\n          zoom = this.getZoom(),\n          newZoom = zoom * multiplier,\n          vp = this.viewportTransform,\n          translateX = (vp[4] - cropping.left) * multiplier,\n          translateY = (vp[5] - cropping.top) * multiplier,\n          newVp = [newZoom, 0, 0, newZoom, translateX, translateY],\n          originalInteractive = this.interactive,\n          originalSkipOffScreen = this.skipOffscreen,\n          needsResize = origWidth !== scaledWidth || origHeight !== scaledHeight;\n\n      this.viewportTransform = newVp;\n      this.skipOffscreen = false;\n      // setting interactive to false avoid exporting controls\n      this.interactive = false;\n      if (needsResize) {\n        this.setDimensions({ width: scaledWidth, height: scaledHeight }, { backstoreOnly: true });\n      }\n      // call a renderAll to force sync update. This will cancel the scheduled requestRenderAll\n      // from setDimensions\n      this.renderAll();\n      var data = this.__toDataURL(format, quality, cropping);\n      this.interactive = originalInteractive;\n      this.skipOffscreen = originalSkipOffScreen;\n      this.viewportTransform = vp;\n      //setDimensions with no option object is taking care of:\n      //this.width, this.height, this.requestRenderAll()\n      if (needsResize) {\n        this.setDimensions({ width: origWidth, height: origHeight }, { backstoreOnly: true });\n      }\n      this.renderAll();\n      return data;\n    },\n\n    /**\n     * @private\n     */\n    __toDataURL: function(format, quality) {\n\n      var canvasEl = this.contextContainer.canvas;\n      var data = supportQuality\n        ? canvasEl.toDataURL('image/' + format, quality)\n        : canvasEl.toDataURL('image/' + format);\n\n      return data;\n    },\n  });\n\n})();\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Populates canvas with data from the specified dataless JSON.\n   * JSON format must conform to the one of {@link fabric.Canvas#toDatalessJSON}\n   * @deprecated since 1.2.2\n   * @param {String|Object} json JSON string or object\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: {@link fabric.Image})\n   *                            are initialized\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n   * @return {fabric.Canvas} instance\n   * @chainable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n   */\n  loadFromDatalessJSON: function (json, callback, reviver) {\n    return this.loadFromJSON(json, callback, reviver);\n  },\n\n  /**\n   * Populates canvas with data from the specified JSON.\n   * JSON format must conform to the one of {@link fabric.Canvas#toJSON}\n   * @param {String|Object} json JSON string or object\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: {@link fabric.Image})\n   *                            are initialized\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n   * @return {fabric.Canvas} instance\n   * @chainable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n   * @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}\n   * @example <caption>loadFromJSON</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));\n   * @example <caption>loadFromJSON with reviver</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {\n   *   // `o` = json object\n   *   // `object` = fabric.Object instance\n   *   // ... do some stuff ...\n   * });\n   */\n  loadFromJSON: function (json, callback, reviver) {\n    if (!json) {\n      return;\n    }\n\n    // serialize if it wasn't already\n    var serialized = (typeof json === 'string')\n      ? JSON.parse(json)\n      : fabric.util.object.clone(json);\n\n    var _this = this,\n        renderOnAddRemove = this.renderOnAddRemove;\n    this.renderOnAddRemove = false;\n\n    this._enlivenObjects(serialized.objects, function (enlivenedObjects) {\n      _this.clear();\n      _this._setBgOverlay(serialized, function () {\n        enlivenedObjects.forEach(function(obj, index) {\n          // we splice the array just in case some custom classes restored from JSON\n          // will add more object to canvas at canvas init.\n          _this.insertAt(obj, index);\n        });\n        _this.renderOnAddRemove = renderOnAddRemove;\n        // remove parts i cannot set as options\n        delete serialized.objects;\n        delete serialized.backgroundImage;\n        delete serialized.overlayImage;\n        delete serialized.background;\n        delete serialized.overlay;\n        // this._initOptions does too many things to just\n        // call it. Normally loading an Object from JSON\n        // create the Object instance. Here the Canvas is\n        // already an instance and we are just loading things over it\n        _this._setOptions(serialized);\n        _this.renderAll();\n        callback && callback();\n      });\n    }, reviver);\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  _setBgOverlay: function(serialized, callback) {\n    var loaded = {\n      backgroundColor: false,\n      overlayColor: false,\n      backgroundImage: false,\n      overlayImage: false\n    };\n\n    if (!serialized.backgroundImage && !serialized.overlayImage && !serialized.background && !serialized.overlay) {\n      callback && callback();\n      return;\n    }\n\n    var cbIfLoaded = function () {\n      if (loaded.backgroundImage && loaded.overlayImage && loaded.backgroundColor && loaded.overlayColor) {\n        callback && callback();\n      }\n    };\n\n    this.__setBgOverlay('backgroundImage', serialized.backgroundImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayImage', serialized.overlayImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('backgroundColor', serialized.background, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayColor', serialized.overlay, loaded, cbIfLoaded);\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)\n   * @param {(Object|String)} value Value to set\n   * @param {Object} loaded Set loaded property to true if property is set\n   * @param {Object} callback Callback function to invoke after property is set\n   */\n  __setBgOverlay: function(property, value, loaded, callback) {\n    var _this = this;\n\n    if (!value) {\n      loaded[property] = true;\n      callback && callback();\n      return;\n    }\n\n    if (property === 'backgroundImage' || property === 'overlayImage') {\n      fabric.util.enlivenObjects([value], function(enlivedObject){\n        _this[property] = enlivedObject[0];\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n    else {\n      this['set' + fabric.util.string.capitalize(property, true)](value, function() {\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n  },\n\n  /**\n   * @private\n   * @param {Array} objects\n   * @param {Function} callback\n   * @param {Function} [reviver]\n   */\n  _enlivenObjects: function (objects, callback, reviver) {\n    if (!objects || objects.length === 0) {\n      callback && callback([]);\n      return;\n    }\n\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\n      callback && callback(enlivenedObjects);\n    }, null, reviver);\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Function} callback\n   */\n  _toDataURL: function (format, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURL(format));\n    });\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Number} multiplier\n   * @param {Function} callback\n   */\n  _toDataURLWithMultiplier: function (format, multiplier, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURLWithMultiplier(format, multiplier));\n    });\n  },\n\n  /**\n   * Clones canvas instance\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   * @param {Array} [properties] Array of properties to include in the cloned canvas and children\n   */\n  clone: function (callback, properties) {\n    var data = JSON.stringify(this.toJSON(properties));\n    this.cloneWithoutData(function(clone) {\n      clone.loadFromJSON(data, function() {\n        callback && callback(clone);\n      });\n    });\n  },\n\n  /**\n   * Clones canvas instance without cloning existing data.\n   * This essentially copies canvas dimensions, clipping properties, etc.\n   * but leaves data empty (so that you can populate it with your own)\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   */\n  cloneWithoutData: function(callback) {\n    var el = fabric.util.createCanvasElement();\n\n    el.width = this.width;\n    el.height = this.height;\n\n    var clone = new fabric.Canvas(el);\n    clone.clipTo = this.clipTo;\n    if (this.backgroundImage) {\n      clone.setBackgroundImage(this.backgroundImage.src, function() {\n        clone.renderAll();\n        callback && callback(clone);\n      });\n      clone.backgroundImageOpacity = this.backgroundImageOpacity;\n      clone.backgroundImageStretch = this.backgroundImageStretch;\n    }\n    else {\n      callback && callback(clone);\n    }\n  }\n});\n/**\n * Adds support for multi-touch gestures using the Event.js library.\n * Fires the following custom events:\n * - touch:gesture\n * - touch:drag\n * - touch:orientation\n * - touch:shake\n * - touch:longpress\n */\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      radiansToDegrees = fabric.util.radiansToDegrees;\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n    /**\n     * Method that defines actions when an Event.js gesture is detected on an object. Currently only supports\n     * 2 finger gestures.\n     * @param {Event} e Event object by Event.js\n     * @param {Event} self Event proxy object by Event.js\n     */\n    __onTransformGesture: function(e, self) {\n\n      if (this.isDrawingMode || !e.touches || e.touches.length !== 2 || 'gesture' !== self.gesture) {\n        return;\n      }\n      // fix UTM-615\n      this._target = this.findTarget(e);\n      this._handleEvent(e, 'gesture:before');\n      var target = this._target;\n      if ('undefined' !== typeof target) {\n        this.__gesturesParams = {\n          e: e,\n          self: self,\n          target: target\n        };\n\n        this.__gesturesRenderer();\n      }\n\n      this.fire('touch:gesture', {\n        target: target, e: e, self: self\n      });\n    },\n    __gesturesParams: null,\n    __gesturesRenderer: function() {\n\n      if (this.__gesturesParams === null || this._currentTransform === null) {\n        return;\n      }\n\n      var self = this.__gesturesParams.self,\n          t = this._currentTransform,\n          e = this.__gesturesParams.e;\n\n      t.action = 'scale';\n      t.originX = t.originY = 'center';\n\n      this._scaleObjectBy(self.scale, e);\n      if (self.rotation !== 0) {\n        t.action = 'rotate';\n        this._rotateObjectByAngle(self.rotation, e);\n      }\n\n      this.requestRenderAll();\n      t.action = 'drag';\n    },\n\n    /**\n     * Method that defines actions when an Event.js drag is detected.\n     *\n     * @param {Event} e Event object by Event.js\n     * @param {Event} self Event proxy object by Event.js\n     */\n    __onDrag: function(e, self) {\n      this.fire('touch:drag', {\n        e: e, self: self\n      });\n    },\n\n    /**\n     * Method that defines actions when an Event.js orientation event is detected.\n     *\n     * @param {Event} e Event object by Event.js\n     * @param {Event} self Event proxy object by Event.js\n     */\n    __onOrientationChange: function(e, self) {\n      this.fire('touch:orientation', {\n        e: e, self: self\n      });\n    },\n\n    /**\n     * Method that defines actions when an Event.js shake event is detected.\n     *\n     * @param {Event} e Event object by Event.js\n     * @param {Event} self Event proxy object by Event.js\n     */\n    __onShake: function(e, self) {\n      this.fire('touch:shake', {\n        e: e, self: self\n      });\n    },\n\n    /**\n     * Method that defines actions when an Event.js longpress event is detected.\n     *\n     * @param {Event} e Event object by Event.js\n     * @param {Event} self Event proxy object by Event.js\n     */\n    __onLongPress: function(e, self) {\n      this.fire('touch:longpress', {\n        e: e, self: self\n      });\n    },\n\n    /**\n     * Scales an object by a factor\n     * @param {Number} s The scale factor to apply to the current scale level\n     * @param {Event} e Event object by Event.js\n     */\n    _scaleObjectBy: function(s, e) {\n      var t = this._currentTransform,\n          target = t.target,\n          lockScalingX = target.get('lockScalingX'),\n          lockScalingY = target.get('lockScalingY');\n\n      if (lockScalingX && lockScalingY) {\n        return;\n      }\n\n      target._scaling = true;\n\n      var constraintPosition = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY),\n          dim = target._getTransformedDimensions();\n\n      this._setObjectScale(new fabric.Point(t.scaleX * dim.x * s / target.scaleX, t.scaleY * dim.y * s / target.scaleY),\n        t, lockScalingX, lockScalingY, null, target.get('lockScalingFlip'), dim);\n\n      target.setPositionByOrigin(constraintPosition, t.originX, t.originY);\n\n      this._fire('scaling', {\n        target: target,\n        e: e,\n        transform: t,\n      });\n    },\n\n    /**\n     * Rotates object by an angle\n     * @param {Number} curAngle The angle of rotation in degrees\n     * @param {Event} e Event object by Event.js\n     */\n    _rotateObjectByAngle: function(curAngle, e) {\n      var t = this._currentTransform;\n\n      if (t.target.get('lockRotation')) {\n        return;\n      }\n      t.target.rotate(radiansToDegrees(degreesToRadians(curAngle) + t.theta));\n      this._fire('rotating', {\n        target: t.target,\n        e: e,\n        transform: t,\n      });\n    }\n  });\n})();\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      capitalize = fabric.util.string.capitalize,\n      degreesToRadians = fabric.util.degreesToRadians,\n      supportsLineDash = fabric.StaticCanvas.supports('setLineDash'),\n      objectCaching = !fabric.isLikelyNode,\n      ALIASING_LIMIT = 2;\n\n  if (fabric.Object) {\n    return;\n  }\n\n  /**\n   * Root object class from which all 2d shape classes inherit from\n   * @class fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#objects}\n   * @see {@link fabric.Object#initialize} for constructor definition\n   *\n   * @fires added\n   * @fires removed\n   *\n   * @fires selected\n   * @fires deselected\n   * @fires modified\n   * @fires modified\n   * @fires moved\n   * @fires scaled\n   * @fires rotated\n   * @fires skewed\n   *\n   * @fires rotating\n   * @fires scaling\n   * @fires moving\n   * @fires skewing\n   *\n   * @fires mousedown\n   * @fires mouseup\n   * @fires mouseover\n   * @fires mouseout\n   * @fires mousewheel\n   * @fires mousedblclick\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   */\n  fabric.Object = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Type of an object (rect, circle, path, etc.).\n     * Note that this property is meant to be read-only and not meant to be modified.\n     * If you modify, certain parts of Fabric (such as JSON loading) won't work correctly.\n     * @type String\n     * @default\n     */\n    type:                     'object',\n\n    /**\n     * Horizontal origin of transformation of an object (one of \"left\", \"right\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originX:                  'left',\n\n    /**\n     * Vertical origin of transformation of an object (one of \"top\", \"bottom\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originY:                  'top',\n\n    /**\n     * Top position of an object. Note that by default it's relative to object top. You can change this by setting originY={top/center/bottom}\n     * @type Number\n     * @default\n     */\n    top:                      0,\n\n    /**\n     * Left position of an object. Note that by default it's relative to object left. You can change this by setting originX={left/center/right}\n     * @type Number\n     * @default\n     */\n    left:                     0,\n\n    /**\n     * Object width\n     * @type Number\n     * @default\n     */\n    width:                    0,\n\n    /**\n     * Object height\n     * @type Number\n     * @default\n     */\n    height:                   0,\n\n    /**\n     * Object scale factor (horizontal)\n     * @type Number\n     * @default\n     */\n    scaleX:                   1,\n\n    /**\n     * Object scale factor (vertical)\n     * @type Number\n     * @default\n     */\n    scaleY:                   1,\n\n    /**\n     * When true, an object is rendered as flipped horizontally\n     * @type Boolean\n     * @default\n     */\n    flipX:                    false,\n\n    /**\n     * When true, an object is rendered as flipped vertically\n     * @type Boolean\n     * @default\n     */\n    flipY:                    false,\n\n    /**\n     * Opacity of an object\n     * @type Number\n     * @default\n     */\n    opacity:                  1,\n\n    /**\n     * Angle of rotation of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    angle:                    0,\n\n    /**\n     * Angle of skew on x axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewX:                    0,\n\n    /**\n     * Angle of skew on y axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewY:                    0,\n\n    /**\n     * Size of object's controlling corners (in pixels)\n     * @type Number\n     * @default\n     */\n    cornerSize:               13,\n\n    /**\n     * When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)\n     * @type Boolean\n     * @default\n     */\n    transparentCorners:       true,\n\n    /**\n     * Default cursor value used when hovering over this object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:              null,\n\n    /**\n     * Default cursor value used when moving this object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:               null,\n\n    /**\n     * Padding between object and its controlling borders (in pixels)\n     * @type Number\n     * @default\n     */\n    padding:                  0,\n\n    /**\n     * Color of controlling borders of an object (when it's active)\n     * @type String\n     * @default\n     */\n    borderColor:              'rgba(102,153,255,0.75)',\n\n    /**\n     * Array specifying dash pattern of an object's borders (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    borderDashArray:          null,\n\n    /**\n     * Color of controlling corners of an object (when it's active)\n     * @type String\n     * @default\n     */\n    cornerColor:              'rgba(102,153,255,0.5)',\n\n    /**\n     * Color of controlling corners of an object (when it's active and transparentCorners false)\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    cornerStrokeColor:        null,\n\n    /**\n     * Specify style of control, 'rect' or 'circle'\n     * @since 1.6.2\n     * @type String\n     */\n    cornerStyle:          'rect',\n\n    /**\n     * Array specifying dash pattern of an object's control (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    cornerDashArray:          null,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being scaled via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:          false,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being rotated via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:         true,\n\n    /**\n     * Color of object's fill\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    fill:                     'rgb(0,0,0)',\n\n    /**\n     * Fill rule used to fill an object\n     * accepted values are nonzero, evenodd\n     * <b>Backwards incompatibility note:</b> This property was used for setting globalCompositeOperation until v1.4.12 (use `fabric.Object#globalCompositeOperation` instead)\n     * @type String\n     * @default\n     */\n    fillRule:                 'nonzero',\n\n    /**\n     * Composite rule used for canvas globalCompositeOperation\n     * @type String\n     * @default\n     */\n    globalCompositeOperation: 'source-over',\n\n    /**\n     * Background color of an object.\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    backgroundColor:          '',\n\n    /**\n     * Selection Background color of an object. colored layer behind the object when it is active.\n     * does not mix good with globalCompositeOperation methods.\n     * @type String\n     * @default\n     */\n    selectionBackgroundColor:          '',\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    stroke:                   null,\n\n    /**\n     * Width of a stroke used to render this object\n     * @type Number\n     * @default\n     */\n    strokeWidth:              1,\n\n    /**\n     * Array specifying dash pattern of an object's stroke (stroke must be defined)\n     * @type Array\n     */\n    strokeDashArray:          null,\n\n    /**\n     * Line offset of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeDashOffset: 0,\n\n    /**\n     * Line endings style of an object's stroke (one of \"butt\", \"round\", \"square\")\n     * @type String\n     * @default\n     */\n    strokeLineCap:            'butt',\n\n    /**\n     * Corner style of an object's stroke (one of \"bevil\", \"round\", \"miter\")\n     * @type String\n     * @default\n     */\n    strokeLineJoin:           'miter',\n\n    /**\n     * Maximum miter length (used for strokeLineJoin = \"miter\") of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeMiterLimit:         4,\n\n    /**\n     * Shadow object representing shadow of this shape\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:                   null,\n\n    /**\n     * Opacity of object's controlling borders when object is active and moving\n     * @type Number\n     * @default\n     */\n    borderOpacityWhenMoving:  0.4,\n\n    /**\n     * Scale factor of object's controlling borders\n     * @type Number\n     * @default\n     */\n    borderScaleFactor:        1,\n\n    /**\n     * Transform matrix (similar to SVG's transform matrix)\n     * @type Array\n     */\n    transformMatrix:          null,\n\n    /**\n     * Minimum allowed scale value of an object\n     * @type Number\n     * @default\n     */\n    minScaleLimit:            0,\n\n    /**\n     * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).\n     * But events still fire on it.\n     * @type Boolean\n     * @default\n     */\n    selectable:               true,\n\n    /**\n     * When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4\n     * @type Boolean\n     * @default\n     */\n    evented:                  true,\n\n    /**\n     * When set to `false`, an object is not rendered on canvas\n     * @type Boolean\n     * @default\n     */\n    visible:                  true,\n\n    /**\n     * When set to `false`, object's controls are not displayed and can not be used to manipulate object\n     * @type Boolean\n     * @default\n     */\n    hasControls:              true,\n\n    /**\n     * When set to `false`, object's controlling borders are not rendered\n     * @type Boolean\n     * @default\n     */\n    hasBorders:               true,\n\n    /**\n     * When set to `false`, object's controlling rotating point will not be visible or selectable\n     * @type Boolean\n     * @default\n     */\n    hasRotatingPoint:         true,\n\n    /**\n     * Offset for object's controlling rotating point (when enabled via `hasRotatingPoint`)\n     * @type Number\n     * @default\n     */\n    rotatingPointOffset:      40,\n\n    /**\n     * When set to `true`, objects are \"found\" on canvas on per-pixel basis rather than according to bounding box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:       false,\n\n    /**\n     * When `false`, default object's values are not included in its serialization\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues:     true,\n\n    /**\n     * Function that determines clipping of an object (context is passed as a first argument).\n     * If you are using code minification, ctx argument can be minified/manglied you should use\n     * as a workaround `var ctx = arguments[0];` in the function;\n     * Note that context origin is at the object's center point (not left/top corner)\n     * @deprecated since 2.0.0\n     * @type Function\n     */\n    clipTo:                   null,\n\n    /**\n     * When `true`, object horizontal movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementX:            false,\n\n    /**\n     * When `true`, object vertical movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementY:            false,\n\n    /**\n     * When `true`, object rotation is locked\n     * @type Boolean\n     * @default\n     */\n    lockRotation:             false,\n\n    /**\n     * When `true`, object horizontal scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingX:             false,\n\n    /**\n     * When `true`, object vertical scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingY:             false,\n\n    /**\n     * When `true`, object non-uniform scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockUniScaling:           false,\n\n    /**\n     * When `true`, object horizontal skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingX:             false,\n\n    /**\n     * When `true`, object vertical skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingY:             false,\n\n    /**\n     * When `true`, object cannot be flipped by scaling into negative values\n     * @type Boolean\n     * @default\n     */\n    lockScalingFlip:          false,\n\n    /**\n     * When `true`, object is not exported in OBJECT/JSON\n     * since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    excludeFromExport:        false,\n\n    /**\n     * When `true`, object is cached on an additional canvas.\n     * default to true\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    objectCaching:            objectCaching,\n\n    /**\n     * When `true`, object properties are checked for cache invalidation. In some particular\n     * situation you may want this to be disabled ( spray brush, very big, groups)\n     * or if your application does not allow you to modify properties for groups child you want\n     * to disable it for groups.\n     * default to false\n     * since 1.7.0\n     * @type Boolean\n     * @default false\n     */\n    statefullCache:            false,\n\n    /**\n     * When `true`, cache does not get updated during scaling. The picture will get blocky if scaled\n     * too much and will be redrawn with correct details at the end of scaling.\n     * this setting is performance and application dependant.\n     * default to true\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    noScaleCache:              true,\n\n    /**\n     * When set to `true`, object's cache will be rerendered next render call.\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    dirty:                true,\n\n    /**\n     * keeps the value of the last hovered corner during mouse move.\n     * 0 is no corner, or 'mt', 'ml', 'mtr' etc..\n     * It should be private, but there is no harm in using it as\n     * a read-only property.\n     * @type number|string|any\n     * @default 0\n     */\n    __corner: 0,\n\n    /**\n     * Determines if the fill or the stroke is drawn first (one of \"fill\" or \"stroke\")\n     * @type String\n     * @default\n     */\n    paintFirst:           'fill',\n\n    /**\n     * List of properties to consider when checking if state\n     * of an object is changed (fabric.Object#hasStateChanged)\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: (\n      'top left width height scaleX scaleY flipX flipY originX originY transformMatrix ' +\n      'stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit ' +\n      'angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor ' +\n      'skewX skewY fillRule paintFirst clipPath'\n    ).split(' '),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\n     * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\n     * and refreshed at the next render\n     * @type Array\n     */\n    cacheProperties: (\n      'fill stroke strokeWidth strokeDashArray width height paintFirst' +\n      ' strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath'\n    ).split(' '),\n\n    /**\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n     * the clipPath object gets used when the object has rendered, and the context is placed in the center\n     * of the object cacheCanvas.\n     * If you want 0,0 of a clipPath to align with an object center, use clipPath.originX/Y to 'center'\n     * @type fabric.Object\n     */\n    clipPath: undefined,\n\n    /**\n     * Meaningful ONLY when the object is used as clipPath.\n     * if true, the clipPath will make the object clip to the outside of the clipPath\n     * since 2.4.0\n     * @type boolean\n     * @default false\n     */\n    inverted: false,\n\n    /**\n     * Meaningful ONLY when the object is used as clipPath.\n     * if true, the clipPath will have its top and left relative to canvas, and will\n     * not be influenced by the object transform. This will make the clipPath relative\n     * to the canvas, but clipping just a particular object.\n     * WARNING this is beta, this feature may change or be renamed.\n     * since 2.4.0\n     * @type boolean\n     * @default false\n     */\n    absolutePositioned: false,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      if (options) {\n        this.setOptions(options);\n      }\n    },\n\n    /**\n     * Create a the canvas used to keep the cached copy of the object\n     * @private\n     */\n    _createCacheCanvas: function() {\n      this._cacheProperties = {};\n      this._cacheCanvas = fabric.util.createCanvasElement();\n      this._cacheContext = this._cacheCanvas.getContext('2d');\n      this._updateCacheCanvas();\n      // if canvas gets created, is empty, so dirty.\n      this.dirty = true;\n    },\n\n    /**\n     * Limit the cache dimensions so that X * Y do not cross fabric.perfLimitSizeTotal\n     * and each side do not cross fabric.cacheSideLimit\n     * those numbers are configurable so that you can get as much detail as you want\n     * making bargain with performances.\n     * @param {Object} dims\n     * @param {Object} dims.width width of canvas\n     * @param {Object} dims.height height of canvas\n     * @param {Object} dims.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @param {Object} dims.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _limitCacheSize: function(dims) {\n      var perfLimitSizeTotal = fabric.perfLimitSizeTotal,\n          width = dims.width, height = dims.height,\n          max = fabric.maxCacheSideLimit, min = fabric.minCacheSideLimit;\n      if (width <= max && height <= max && width * height <= perfLimitSizeTotal) {\n        if (width < min) {\n          dims.width = min;\n        }\n        if (height < min) {\n          dims.height = min;\n        }\n        return dims;\n      }\n      var ar = width / height, limitedDims = fabric.util.limitDimsByArea(ar, perfLimitSizeTotal),\n          capValue = fabric.util.capValue,\n          x = capValue(min, limitedDims.x, max),\n          y = capValue(min, limitedDims.y, max);\n      if (width > x) {\n        dims.zoomX /= width / x;\n        dims.width = x;\n        dims.capped = true;\n      }\n      if (height > y) {\n        dims.zoomY /= height / y;\n        dims.height = y;\n        dims.capped = true;\n      }\n      return dims;\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @return {Object}.x width of object to be cached\n     * @return {Object}.y height of object to be cached\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var objectScale = this.getTotalObjectScaling(),\n          dim = this._getNonTransformedDimensions(),\n          zoomX = objectScale.scaleX,\n          zoomY = objectScale.scaleY,\n          width = dim.x * zoomX,\n          height = dim.y * zoomY;\n      return {\n        // for sure this ALIASING_LIMIT is slightly crating problem\n        // in situation in wich the cache canvas gets an upper limit\n        width: width + ALIASING_LIMIT,\n        height: height + ALIASING_LIMIT,\n        zoomX: zoomX,\n        zoomY: zoomY,\n        x: dim.x,\n        y: dim.y\n      };\n    },\n\n    /**\n     * Update width and height of the canvas for cache\n     * returns true or false if canvas needed resize.\n     * @private\n     * @return {Boolean} true if the canvas has been resized\n     */\n    _updateCacheCanvas: function() {\n      var targetCanvas = this.canvas;\n      if (this.noScaleCache && targetCanvas && targetCanvas._currentTransform) {\n        var target = targetCanvas._currentTransform.target,\n            action = targetCanvas._currentTransform.action;\n        if (this === target && action.slice && action.slice(0, 5) === 'scale') {\n          return false;\n        }\n      }\n      var canvas = this._cacheCanvas,\n          dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          minCacheSize = fabric.minCacheSideLimit,\n          width = dims.width, height = dims.height, drawingWidth, drawingHeight,\n          zoomX = dims.zoomX, zoomY = dims.zoomY,\n          dimensionsChanged = width !== this.cacheWidth || height !== this.cacheHeight,\n          zoomChanged = this.zoomX !== zoomX || this.zoomY !== zoomY,\n          shouldRedraw = dimensionsChanged || zoomChanged,\n          additionalWidth = 0, additionalHeight = 0, shouldResizeCanvas = false;\n      if (dimensionsChanged) {\n        var canvasWidth = this._cacheCanvas.width,\n            canvasHeight = this._cacheCanvas.height,\n            sizeGrowing = width > canvasWidth || height > canvasHeight,\n            sizeShrinking = (width < canvasWidth * 0.9 || height < canvasHeight * 0.9) &&\n              canvasWidth > minCacheSize && canvasHeight > minCacheSize;\n        shouldResizeCanvas = sizeGrowing || sizeShrinking;\n        if (sizeGrowing && !dims.capped && (width > minCacheSize || height > minCacheSize)) {\n          additionalWidth = width * 0.1;\n          additionalHeight = height * 0.1;\n        }\n      }\n      if (shouldRedraw) {\n        if (shouldResizeCanvas) {\n          canvas.width = Math.ceil(width + additionalWidth);\n          canvas.height = Math.ceil(height + additionalHeight);\n        }\n        else {\n          this._cacheContext.setTransform(1, 0, 0, 1, 0, 0);\n          this._cacheContext.clearRect(0, 0, canvas.width, canvas.height);\n        }\n        drawingWidth = dims.x * zoomX / 2;\n        drawingHeight = dims.y * zoomY / 2;\n        this.cacheTranslationX = Math.round(canvas.width / 2 - drawingWidth) + drawingWidth;\n        this.cacheTranslationY = Math.round(canvas.height / 2 - drawingHeight) + drawingHeight;\n        this.cacheWidth = width;\n        this.cacheHeight = height;\n        this._cacheContext.translate(this.cacheTranslationX, this.cacheTranslationY);\n        this._cacheContext.scale(zoomX, zoomY);\n        this.zoomX = zoomX;\n        this.zoomY = zoomY;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Sets object's properties from options\n     * @param {Object} [options] Options object\n     */\n    setOptions: function(options) {\n      this._setOptions(options);\n      this._initGradient(options.fill, 'fill');\n      this._initGradient(options.stroke, 'stroke');\n      this._initClipping(options);\n      this._initPattern(options.fill, 'fill');\n      this._initPattern(options.stroke, 'stroke');\n    },\n\n    /**\n     * Transforms context when rendering an object\n     * @param {CanvasRenderingContext2D} ctx Context\n     */\n    transform: function(ctx) {\n      var m;\n      if (this.group && !this.group._transformDone) {\n        m = this.calcTransformMatrix();\n      }\n      else {\n        m = this.calcOwnMatrix();\n      }\n      ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n    },\n\n    /**\n     * Returns an object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n\n          object = {\n            type:                     this.type,\n            version:                  fabric.version,\n            originX:                  this.originX,\n            originY:                  this.originY,\n            left:                     toFixed(this.left, NUM_FRACTION_DIGITS),\n            top:                      toFixed(this.top, NUM_FRACTION_DIGITS),\n            width:                    toFixed(this.width, NUM_FRACTION_DIGITS),\n            height:                   toFixed(this.height, NUM_FRACTION_DIGITS),\n            fill:                     (this.fill && this.fill.toObject) ? this.fill.toObject() : this.fill,\n            stroke:                   (this.stroke && this.stroke.toObject) ? this.stroke.toObject() : this.stroke,\n            strokeWidth:              toFixed(this.strokeWidth, NUM_FRACTION_DIGITS),\n            strokeDashArray:          this.strokeDashArray ? this.strokeDashArray.concat() : this.strokeDashArray,\n            strokeLineCap:            this.strokeLineCap,\n            strokeDashOffset:         this.strokeDashOffset,\n            strokeLineJoin:           this.strokeLineJoin,\n            strokeMiterLimit:         toFixed(this.strokeMiterLimit, NUM_FRACTION_DIGITS),\n            scaleX:                   toFixed(this.scaleX, NUM_FRACTION_DIGITS),\n            scaleY:                   toFixed(this.scaleY, NUM_FRACTION_DIGITS),\n            angle:                    toFixed(this.angle, NUM_FRACTION_DIGITS),\n            flipX:                    this.flipX,\n            flipY:                    this.flipY,\n            opacity:                  toFixed(this.opacity, NUM_FRACTION_DIGITS),\n            shadow:                   (this.shadow && this.shadow.toObject) ? this.shadow.toObject() : this.shadow,\n            visible:                  this.visible,\n            clipTo:                   this.clipTo && String(this.clipTo),\n            backgroundColor:          this.backgroundColor,\n            fillRule:                 this.fillRule,\n            paintFirst:               this.paintFirst,\n            globalCompositeOperation: this.globalCompositeOperation,\n            transformMatrix:          this.transformMatrix ? this.transformMatrix.concat() : null,\n            skewX:                    toFixed(this.skewX, NUM_FRACTION_DIGITS),\n            skewY:                    toFixed(this.skewY, NUM_FRACTION_DIGITS),\n          };\n\n      if (this.clipPath) {\n        object.clipPath = this.clipPath.toObject(propertiesToInclude);\n        object.clipPath.inverted = this.clipPath.inverted;\n        object.clipPath.absolutePositioned = this.clipPath.absolutePositioned;\n      }\n\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        object = this._removeDefaultValues(object);\n      }\n\n      return object;\n    },\n\n    /**\n     * Returns (dataless) object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      // will be overwritten by subclasses\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     */\n    _removeDefaultValues: function(object) {\n      var prototype = fabric.util.getKlass(object.type).prototype,\n          stateProperties = prototype.stateProperties;\n      stateProperties.forEach(function(prop) {\n        if (object[prop] === prototype[prop]) {\n          delete object[prop];\n        }\n        var isArray = Object.prototype.toString.call(object[prop]) === '[object Array]' &&\n                      Object.prototype.toString.call(prototype[prop]) === '[object Array]';\n\n        // basically a check for [] === []\n        if (isArray && object[prop].length === 0 && prototype[prop].length === 0) {\n          delete object[prop];\n        }\n      });\n\n      return object;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.' + capitalize(this.type) + '>';\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getObjectScaling: function() {\n      var scaleX = this.scaleX, scaleY = this.scaleY;\n      if (this.group) {\n        var scaling = this.group.getObjectScaling();\n        scaleX *= scaling.scaleX;\n        scaleY *= scaling.scaleY;\n      }\n      return { scaleX: scaleX, scaleY: scaleY };\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling, zoom and retina\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getTotalObjectScaling: function() {\n      var scale = this.getObjectScaling(), scaleX = scale.scaleX, scaleY = scale.scaleY;\n      if (this.canvas) {\n        var zoom = this.canvas.getZoom();\n        var retina = this.canvas.getRetinaScaling();\n        scaleX *= zoom * retina;\n        scaleY *= zoom * retina;\n      }\n      return { scaleX: scaleX, scaleY: scaleY };\n    },\n\n    /**\n     * Return the object opacity counting also the group property\n     * @return {Number}\n     */\n    getObjectOpacity: function() {\n      var opacity = this.opacity;\n      if (this.group) {\n        opacity *= this.group.getObjectOpacity();\n      }\n      return opacity;\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Object} thisArg\n     */\n    _set: function(key, value) {\n      var shouldConstrainValue = (key === 'scaleX' || key === 'scaleY'),\n          isChanged = this[key] !== value, groupNeedsUpdate = false;\n\n      if (shouldConstrainValue) {\n        value = this._constrainScale(value);\n      }\n      if (key === 'scaleX' && value < 0) {\n        this.flipX = !this.flipX;\n        value *= -1;\n      }\n      else if (key === 'scaleY' && value < 0) {\n        this.flipY = !this.flipY;\n        value *= -1;\n      }\n      else if (key === 'shadow' && value && !(value instanceof fabric.Shadow)) {\n        value = new fabric.Shadow(value);\n      }\n      else if (key === 'dirty' && this.group) {\n        this.group.set('dirty', value);\n      }\n\n      this[key] = value;\n\n      if (isChanged) {\n        groupNeedsUpdate = this.group && this.group.isOnACache();\n        if (this.cacheProperties.indexOf(key) > -1) {\n          this.dirty = true;\n          groupNeedsUpdate && this.group.set('dirty', true);\n        }\n        else if (groupNeedsUpdate && this.stateProperties.indexOf(key) > -1) {\n          this.group.set('dirty', true);\n        }\n      }\n\n      return this;\n    },\n\n    /**\n     * This callback function is called by the parent group of an object every\n     * time a non-delegated property changes on the group. It is passed the key\n     * and value as parameters. Not adding in this function's signature to avoid\n     * Travis build error about unused variables.\n     */\n    setOnGroup: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n    /**\n     * Retrieves viewportTransform from Object's canvas if possible\n     * @method getViewportTransform\n     * @memberOf fabric.Object.prototype\n     * @return {Array}\n     */\n    getViewportTransform: function() {\n      if (this.canvas && this.canvas.viewportTransform) {\n        return this.canvas.viewportTransform;\n      }\n      return fabric.iMatrix.concat();\n    },\n\n    /*\n     * @private\n     * return if the object would be visible in rendering\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean}\n     */\n    isNotVisible: function() {\n      return this.opacity === 0 ||\n        (this.width === 0 && this.height === 0 && this.strokeWidth === 0) ||\n        !this.visible;\n    },\n\n    /**\n     * Renders an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      // do not render if width/height are zeros or object is not visible\n      if (this.isNotVisible()) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      ctx.save();\n      this._setupCompositeOperation(ctx);\n      this.drawSelectionBackground(ctx);\n      this.transform(ctx);\n      this._setOpacity(ctx);\n      this._setShadow(ctx, this);\n      if (this.transformMatrix) {\n        ctx.transform.apply(ctx, this.transformMatrix);\n      }\n      this.clipTo && fabric.util.clipContext(this, ctx);\n      if (this.shouldCache()) {\n        this.renderCache();\n        this.drawCacheOnCanvas(ctx);\n      }\n      else {\n        this._removeCacheCanvas();\n        this.dirty = false;\n        this.drawObject(ctx);\n        if (this.objectCaching && this.statefullCache) {\n          this.saveState({ propertySet: 'cacheProperties' });\n        }\n      }\n      this.clipTo && ctx.restore();\n      ctx.restore();\n    },\n\n    renderCache: function(options) {\n      options = options || {};\n      if (!this._cacheCanvas) {\n        this._createCacheCanvas();\n      }\n      if (this.isCacheDirty()) {\n        this.statefullCache && this.saveState({ propertySet: 'cacheProperties' });\n        this.drawObject(this._cacheContext, options.forClipping);\n        this.dirty = false;\n      }\n    },\n\n    /**\n     * Remove cacheCanvas and its dimensions from the objects\n     */\n    _removeCacheCanvas: function() {\n      this._cacheCanvas = null;\n      this.cacheWidth = 0;\n      this.cacheHeight = 0;\n    },\n\n    /**\n     * When set to `true`, force the object to have its own cache, even if it is inside a group\n     * it may be needed when your object behave in a particular way on the cache and always needs\n     * its own isolated canvas to render correctly.\n     * Created to be overridden\n     * since 1.7.12\n     * @returns false\n     */\n    needsItsOwnCache: function() {\n      if (this.paintFirst === 'stroke' && typeof this.shadow === 'object') {\n        return true;\n      }\n      if (this.clipPath) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      this.ownCaching = this.objectCaching &&\n      (!this.group || this.needsItsOwnCache() || !this.group.isOnACache());\n      return this.ownCaching;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * used by Group.shouldCache to know if child has a shadow recursively\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      return !!this.shadow && (this.shadow.offsetX !== 0 || this.shadow.offsetY !== 0);\n    },\n\n    /**\n     * Execute the drawing operation for an object clipPath\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawClipPathOnCache: function(ctx) {\n      var path = this.clipPath;\n      ctx.save();\n      // DEBUG: uncomment this line, comment the following\n      // ctx.globalAlpha = 0.4\n      if (path.inverted) {\n        ctx.globalCompositeOperation = 'destination-out';\n      }\n      else {\n        ctx.globalCompositeOperation = 'destination-in';\n      }\n      //ctx.scale(1 / 2, 1 / 2);\n      if (path.absolutePositioned) {\n        var m = fabric.util.invertTransform(this.calcTransformMatrix());\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      }\n      path.transform(ctx);\n      ctx.scale(1 / path.zoomX, 1 / path.zoomY);\n      ctx.drawImage(path._cacheCanvas, -path.cacheTranslationX, -path.cacheTranslationY);\n      ctx.restore();\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawObject: function(ctx, forClipping) {\n\n      if (forClipping) {\n        this._setClippingProperties(ctx);\n      }\n      else {\n        this._renderBackground(ctx);\n        this._setStrokeStyles(ctx, this);\n        this._setFillStyles(ctx, this);\n      }\n      this._render(ctx);\n      this._drawClipPath(ctx);\n    },\n\n    _drawClipPath: function(ctx) {\n      var path = this.clipPath;\n      if (!path) { return; }\n      // needed to setup a couple of variables\n      // path canvas gets overridden with this one.\n      // TODO find a better solution?\n      path.canvas = this.canvas;\n      path.shouldCache();\n      path._transformDone = true;\n      path.renderCache({ forClipping: true });\n      this.drawClipPathOnCache(ctx);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      ctx.scale(1 / this.zoomX, 1 / this.zoomY);\n      ctx.drawImage(this._cacheCanvas, -this.cacheTranslationX, -this.cacheTranslationY);\n    },\n\n    /**\n     * Check if cache is dirty\n     * @param {Boolean} skipCanvas skip canvas checks because this object is painted\n     * on parent canvas.\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.isNotVisible()) {\n        return false;\n      }\n      if (this._cacheCanvas && !skipCanvas && this._updateCacheCanvas()) {\n        // in this case the context is already cleared.\n        return true;\n      }\n      else {\n        if (this.dirty ||\n          (this.clipPath && this.clipPath.absolutePositioned) ||\n          (this.statefullCache && this.hasStateChanged('cacheProperties'))\n        ) {\n          if (this._cacheCanvas && !skipCanvas) {\n            var width = this.cacheWidth / this.zoomX;\n            var height = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-width / 2, -height / 2, width, height);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Draws a background for the object big as its untransformed dimensions\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      if (!this.backgroundColor) {\n        return;\n      }\n      var dim = this._getNonTransformedDimensions();\n      ctx.fillStyle = this.backgroundColor;\n\n      ctx.fillRect(\n        -dim.x / 2,\n        -dim.y / 2,\n        dim.x,\n        dim.y\n      );\n      // if there is background color no other shadows\n      // should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setOpacity: function(ctx) {\n      if (this.group && !this.group._transformDone) {\n        ctx.globalAlpha = this.getObjectOpacity();\n      }\n      else {\n        ctx.globalAlpha *= this.opacity;\n      }\n    },\n\n    _setStrokeStyles: function(ctx, decl) {\n      if (decl.stroke) {\n        ctx.lineWidth = decl.strokeWidth;\n        ctx.lineCap = decl.strokeLineCap;\n        ctx.lineDashOffset = decl.strokeDashOffset;\n        ctx.lineJoin = decl.strokeLineJoin;\n        ctx.miterLimit = decl.strokeMiterLimit;\n        ctx.strokeStyle = decl.stroke.toLive\n          ? decl.stroke.toLive(ctx, this)\n          : decl.stroke;\n      }\n    },\n\n    _setFillStyles: function(ctx, decl) {\n      if (decl.fill) {\n        ctx.fillStyle = decl.fill.toLive\n          ? decl.fill.toLive(ctx, this)\n          : decl.fill;\n      }\n    },\n\n    _setClippingProperties: function(ctx) {\n      ctx.globalAlpha = 1;\n      ctx.strokeStyle = 'transparent';\n      ctx.fillStyle = '#000000';\n    },\n\n    /**\n     * @private\n     * Sets line dash\n     * @param {CanvasRenderingContext2D} ctx Context to set the dash line on\n     * @param {Array} dashArray array representing dashes\n     * @param {Function} alternative function to call if browser does not support lineDash\n     */\n    _setLineDash: function(ctx, dashArray, alternative) {\n      if (!dashArray) {\n        return;\n      }\n      // Spec requires the concatenation of two copies the dash list when the number of elements is odd\n      if (1 & dashArray.length) {\n        dashArray.push.apply(dashArray, dashArray);\n      }\n      if (supportsLineDash) {\n        ctx.setLineDash(dashArray);\n      }\n      else {\n        alternative && alternative(ctx);\n      }\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [styleOverride] properties to override the object style\n     */\n    _renderControls: function(ctx, styleOverride) {\n      var vpt = this.getViewportTransform(),\n          matrix = this.calcTransformMatrix(),\n          options, drawBorders, drawControls;\n      styleOverride = styleOverride || { };\n      drawBorders = typeof styleOverride.hasBorders !== 'undefined' ? styleOverride.hasBorders : this.hasBorders;\n      drawControls = typeof styleOverride.hasControls !== 'undefined' ? styleOverride.hasControls : this.hasControls;\n      matrix = fabric.util.multiplyTransformMatrices(vpt, matrix);\n      options = fabric.util.qrDecompose(matrix);\n      ctx.save();\n      ctx.translate(options.translateX, options.translateY);\n      ctx.lineWidth = 1 * this.borderScaleFactor;\n      if (!this.group) {\n        ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      }\n      if (styleOverride.forActiveSelection) {\n        ctx.rotate(degreesToRadians(options.angle));\n        drawBorders && this.drawBordersInGroup(ctx, options, styleOverride);\n      }\n      else {\n        ctx.rotate(degreesToRadians(this.angle));\n        drawBorders && this.drawBorders(ctx, styleOverride);\n      }\n      drawControls && this.drawControls(ctx, styleOverride);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      var multX = (this.canvas && this.canvas.viewportTransform[0]) || 1,\n          multY = (this.canvas && this.canvas.viewportTransform[3]) || 1,\n          scaling = this.getObjectScaling();\n      if (this.canvas && this.canvas._isRetinaScaling()) {\n        multX *= fabric.devicePixelRatio;\n        multY *= fabric.devicePixelRatio;\n      }\n      ctx.shadowColor = this.shadow.color;\n      ctx.shadowBlur = this.shadow.blur * fabric.browserShadowBlurConstant *\n        (multX + multY) * (scaling.scaleX + scaling.scaleY) / 4;\n      ctx.shadowOffsetX = this.shadow.offsetX * multX * scaling.scaleX;\n      ctx.shadowOffsetY = this.shadow.offsetY * multY * scaling.scaleY;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _removeShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      ctx.shadowColor = '';\n      ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} filler fabric.Pattern or fabric.Gradient\n     */\n    _applyPatternGradientTransform: function(ctx, filler) {\n      if (!filler || !filler.toLive) {\n        return { offsetX: 0, offsetY: 0 };\n      }\n      var t = filler.gradientTransform || filler.patternTransform;\n      var offsetX = -this.width / 2 + filler.offsetX || 0,\n          offsetY = -this.height / 2 + filler.offsetY || 0;\n      ctx.translate(offsetX, offsetY);\n      if (t) {\n        ctx.transform(t[0], t[1], t[2], t[3], t[4], t[5]);\n      }\n      return { offsetX: offsetX, offsetY: offsetY };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderPaintInOrder: function(ctx) {\n      if (this.paintFirst === 'stroke') {\n        this._renderStroke(ctx);\n        this._renderFill(ctx);\n      }\n      else {\n        this._renderFill(ctx);\n        this._renderStroke(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderFill: function(ctx) {\n      if (!this.fill) {\n        return;\n      }\n\n      ctx.save();\n      this._applyPatternGradientTransform(ctx, this.fill);\n      if (this.fillRule === 'evenodd') {\n        ctx.fill('evenodd');\n      }\n      else {\n        ctx.fill();\n      }\n      ctx.restore();\n    },\n\n    _renderStroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      this._setLineDash(ctx, this.strokeDashArray, this._renderDashedStroke);\n      this._applyPatternGradientTransform(ctx, this.stroke);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * This function is an helper for svg import. it returns the center of the object in the svg\n     * untransformed coordinates\n     * @private\n     * @return {Object} center point from element coordinates\n     */\n    _findCenterFromElement: function() {\n      return { x: this.left + this.width / 2, y: this.top + this.height / 2 };\n    },\n\n    /**\n     * This function is an helper for svg import. it decompose the transformMatrix\n     * and assign properties to object.\n     * untransformed coordinates\n     * @private\n     * @chainable\n     */\n    _assignTransformMatrixProps: function() {\n      if (this.transformMatrix) {\n        var options = fabric.util.qrDecompose(this.transformMatrix);\n        this.flipX = false;\n        this.flipY = false;\n        this.set('scaleX', options.scaleX);\n        this.set('scaleY', options.scaleY);\n        this.angle = options.angle;\n        this.skewX = options.skewX;\n        this.skewY = 0;\n      }\n    },\n\n    /**\n     * This function is an helper for svg import. it removes the transform matrix\n     * and set to object properties that fabricjs can handle\n     * @private\n     * @param {Object} preserveAspectRatioOptions\n     * @return {thisArg}\n     */\n    _removeTransformMatrix: function(preserveAspectRatioOptions) {\n      var center = this._findCenterFromElement();\n      if (this.transformMatrix) {\n        this._assignTransformMatrixProps();\n        center = fabric.util.transformPoint(center, this.transformMatrix);\n      }\n      this.transformMatrix = null;\n      if (preserveAspectRatioOptions) {\n        this.scaleX *= preserveAspectRatioOptions.scaleX;\n        this.scaleY *= preserveAspectRatioOptions.scaleY;\n        this.cropX = preserveAspectRatioOptions.cropX;\n        this.cropY = preserveAspectRatioOptions.cropY;\n        center.x += preserveAspectRatioOptions.offsetLeft;\n        center.y += preserveAspectRatioOptions.offsetTop;\n        this.width = preserveAspectRatioOptions.width;\n        this.height = preserveAspectRatioOptions.height;\n      }\n      this.setPositionByOrigin(center, 'center', 'center');\n    },\n\n    /**\n     * Clones an instance, using a callback method will work for every object.\n     * @param {Function} callback Callback is invoked with a clone as a first argument\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     */\n    clone: function(callback, propertiesToInclude) {\n      var objectForm = this.toObject(propertiesToInclude);\n      if (this.constructor.fromObject) {\n        this.constructor.fromObject(objectForm, callback);\n      }\n      else {\n        fabric.Object._fromObject('Object', objectForm, callback);\n      }\n    },\n\n    /**\n     * Creates an instance of fabric.Image out of an object\n     * @param {Function} callback callback, invoked with an instance as a first argument\n     * @param {Object} [options] for clone as image, passed to toDataURL\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {fabric.Object} thisArg\n     */\n    cloneAsImage: function(callback, options) {\n      var dataUrl = this.toDataURL(options);\n      fabric.util.loadImage(dataUrl, function(img) {\n        if (callback) {\n          callback(new fabric.Image(img));\n        }\n      });\n      return this;\n    },\n\n    /**\n     * Converts an object into a data-url-like string\n     * @param {Object} options Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     */\n    toDataURL: function(options) {\n      options || (options = { });\n\n      var utils = fabric.util, origParams = utils.saveObjectTransform(this),\n          originalShadow = this.shadow, abs = Math.abs;\n\n      if (options.withoutTransform) {\n        utils.resetObjectTransform(this);\n      }\n      if (options.withoutShadow) {\n        this.shadow = null;\n      }\n\n      var el = fabric.util.createCanvasElement(),\n          // skip canvas zoom and calculate with setCoords now.\n          boundingRect = this.getBoundingRect(true, true),\n          shadow = this.shadow, scaling,\n          shadowOffset = { x: 0, y: 0 }, shadowBlur;\n\n      if (shadow) {\n        shadowBlur = shadow.blur;\n        scaling = this.getObjectScaling();\n        shadowOffset.x = 2 * Math.round((abs(shadow.offsetX) + shadowBlur) * abs(scaling.scaleX));\n        shadowOffset.y = 2 * Math.round((abs(shadow.offsetY) + shadowBlur) * abs(scaling.scaleY));\n      }\n      el.width = boundingRect.width + shadowOffset.x;\n      el.height = boundingRect.height + shadowOffset.y;\n      el.width += el.width % 2 ? 2 - el.width % 2 : 0;\n      el.height += el.height % 2 ? 2 - el.height % 2 : 0;\n      var canvas = new fabric.StaticCanvas(el, {\n        enableRetinaScaling: options.enableRetinaScaling,\n        renderOnAddRemove: false,\n        skipOffscreen: false,\n      });\n      if (options.format === 'jpeg') {\n        canvas.backgroundColor = '#fff';\n      }\n      this.setPositionByOrigin(new fabric.Point(canvas.width / 2, canvas.height / 2), 'center', 'center');\n\n      var originalCanvas = this.canvas;\n      canvas.add(this);\n      var data = canvas.toDataURL(options);\n      this.shadow = originalShadow;\n      this.set(origParams).setCoords();\n      this.canvas = originalCanvas;\n      // canvas.dispose will call image.dispose that will nullify the elements\n      // since this canvas is a simple element for the process, we remove references\n      // to objects in this way in order to avoid object trashing.\n      canvas._objects = [];\n      canvas.dispose();\n      canvas = null;\n\n      return data;\n    },\n\n    /**\n     * Returns true if specified type is identical to the type of an instance\n     * @param {String} type Type to check against\n     * @return {Boolean}\n     */\n    isType: function(type) {\n      return this.type === type;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance (is 1 unless subclassed)\n     */\n    complexity: function() {\n      return 1;\n    },\n\n    /**\n     * Returns a JSON representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} JSON\n     */\n    toJSON: function(propertiesToInclude) {\n      // delegate, not alias\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * Sets gradient (fill or stroke) of an object\n     * <b>Backwards incompatibility note:</b> This method was named \"setGradientFill\" until v1.1.0\n     * @param {String} property Property name 'stroke' or 'fill'\n     * @param {Object} [options] Options object\n     * @param {String} [options.type] Type of gradient 'radial' or 'linear'\n     * @param {Number} [options.x1=0] x-coordinate of start point\n     * @param {Number} [options.y1=0] y-coordinate of start point\n     * @param {Number} [options.x2=0] x-coordinate of end point\n     * @param {Number} [options.y2=0] y-coordinate of end point\n     * @param {Number} [options.r1=0] Radius of start point (only for radial gradients)\n     * @param {Number} [options.r2=0] Radius of end point (only for radial gradients)\n     * @param {Object} [options.colorStops] Color stops object eg. {0: 'ff0000', 1: '000000'}\n     * @param {Object} [options.gradientTransform] transformMatrix for gradient\n     * @return {fabric.Object} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/58y8b/|jsFiddle demo}\n     * @example <caption>Set linear gradient</caption>\n     * object.setGradient('fill', {\n     *   type: 'linear',\n     *   x1: -object.width / 2,\n     *   y1: 0,\n     *   x2: object.width / 2,\n     *   y2: 0,\n     *   colorStops: {\n     *     0: 'red',\n     *     0.5: '#005555',\n     *     1: 'rgba(0,0,255,0.5)'\n     *   }\n     * });\n     * canvas.renderAll();\n     * @example <caption>Set radial gradient</caption>\n     * object.setGradient('fill', {\n     *   type: 'radial',\n     *   x1: 0,\n     *   y1: 0,\n     *   x2: 0,\n     *   y2: 0,\n     *   r1: object.width / 2,\n     *   r2: 10,\n     *   colorStops: {\n     *     0: 'red',\n     *     0.5: '#005555',\n     *     1: 'rgba(0,0,255,0.5)'\n     *   }\n     * });\n     * canvas.renderAll();\n     */\n    setGradient: function(property, options) {\n      options || (options = { });\n\n      var gradient = { colorStops: [] };\n\n      gradient.type = options.type || (options.r1 || options.r2 ? 'radial' : 'linear');\n      gradient.coords = {\n        x1: options.x1,\n        y1: options.y1,\n        x2: options.x2,\n        y2: options.y2\n      };\n\n      if (options.r1 || options.r2) {\n        gradient.coords.r1 = options.r1;\n        gradient.coords.r2 = options.r2;\n      }\n\n      gradient.gradientTransform = options.gradientTransform;\n      fabric.Gradient.prototype.addColorStop.call(gradient, options.colorStops);\n\n      return this.set(property, fabric.Gradient.forObject(this, gradient));\n    },\n\n    /**\n     * Sets pattern fill of an object\n     * @param {Object} options Options object\n     * @param {(String|HTMLImageElement)} options.source Pattern source\n     * @param {String} [options.repeat=repeat] Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n     * @param {Number} [options.offsetX=0] Pattern horizontal offset from object's left/top corner\n     * @param {Number} [options.offsetY=0] Pattern vertical offset from object's left/top corner\n     * @param {Function} [callback] Callback to invoke when image set as a pattern\n     * @return {fabric.Object} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/QT3pa/|jsFiddle demo}\n     * @example <caption>Set pattern</caption>\n     * object.setPatternFill({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat'\n     * },canvas.renderAll.bind(canvas));\n     */\n    setPatternFill: function(options, callback) {\n      return this.set('fill', new fabric.Pattern(options, callback));\n    },\n\n    /**\n     * Sets {@link fabric.Object#shadow|shadow} of an object\n     * @param {Object|String} [options] Options object or string (e.g. \"2px 2px 10px rgba(0,0,0,0.2)\")\n     * @param {String} [options.color=rgb(0,0,0)] Shadow color\n     * @param {Number} [options.blur=0] Shadow blur\n     * @param {Number} [options.offsetX=0] Shadow horizontal offset\n     * @param {Number} [options.offsetY=0] Shadow vertical offset\n     * @return {fabric.Object} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/7gvJG/|jsFiddle demo}\n     * @example <caption>Set shadow with string notation</caption>\n     * object.setShadow('2px 2px 10px rgba(0,0,0,0.2)');\n     * canvas.renderAll();\n     * @example <caption>Set shadow with object notation</caption>\n     * object.setShadow({\n     *   color: 'red',\n     *   blur: 10,\n     *   offsetX: 20,\n     *   offsetY: 20\n     * });\n     * canvas.renderAll();\n     */\n    setShadow: function(options) {\n      return this.set('shadow', options ? new fabric.Shadow(options) : null);\n    },\n\n    /**\n     * Sets \"color\" of an instance (alias of `set('fill', &hellip;)`)\n     * @param {String} color Color value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setColor: function(color) {\n      this.set('fill', color);\n      return this;\n    },\n\n    /**\n     * Sets \"angle\" of an instance with centered rotation\n     * @param {Number} angle Angle value (in degrees)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    rotate: function(angle) {\n      var shouldCenterOrigin = (this.originX !== 'center' || this.originY !== 'center') && this.centeredRotation;\n\n      if (shouldCenterOrigin) {\n        this._setOriginToCenter();\n      }\n\n      this.set('angle', angle);\n\n      if (shouldCenterOrigin) {\n        this._resetOrigin();\n      }\n\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerH: function () {\n      this.canvas && this.canvas.centerObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterH: function () {\n      this.canvas && this.canvas.viewportCenterObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerV: function () {\n      this.canvas && this.canvas.centerObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterV: function () {\n      this.canvas && this.canvas.viewportCenterObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically and horizontally on canvas to which is was added last\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    center: function () {\n      this.canvas && this.canvas.centerObject(this);\n      return this;\n    },\n\n    /**\n     * Centers object on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenter: function () {\n      this.canvas && this.canvas.viewportCenterObject(this);\n      return this;\n    },\n\n    /**\n     * Returns coordinates of a pointer relative to an object\n     * @param {Event} e Event to operate upon\n     * @param {Object} [pointer] Pointer to operate upon (instead of event)\n     * @return {Object} Coordinates of a pointer (x, y)\n     */\n    getLocalPointer: function(e, pointer) {\n      pointer = pointer || this.canvas.getPointer(e);\n      var pClicked = new fabric.Point(pointer.x, pointer.y),\n          objectLeftTop = this._getLeftTopCoords();\n      if (this.angle) {\n        pClicked = fabric.util.rotatePoint(\n          pClicked, objectLeftTop, degreesToRadians(-this.angle));\n      }\n      return {\n        x: pClicked.x - objectLeftTop.x,\n        y: pClicked.y - objectLeftTop.y\n      };\n    },\n\n    /**\n     * Sets canvas globalCompositeOperation for specific object\n     * custom composition operation for the particular object can be specified using globalCompositeOperation property\n     * @param {CanvasRenderingContext2D} ctx Rendering canvas context\n     */\n    _setupCompositeOperation: function (ctx) {\n      if (this.globalCompositeOperation) {\n        ctx.globalCompositeOperation = this.globalCompositeOperation;\n      }\n    }\n  });\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Object);\n\n  extend(fabric.Object.prototype, fabric.Observable);\n\n  /**\n   * Defines the number of fraction digits to use when serializing object values.\n   * You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type Number\n   */\n  fabric.Object.NUM_FRACTION_DIGITS = 2;\n\n  fabric.Object._fromObject = function(className, object, callback, extraParam) {\n    var klass = fabric[className];\n    object = clone(object, true);\n    fabric.util.enlivenPatterns([object.fill, object.stroke], function(patterns) {\n      if (typeof patterns[0] !== 'undefined') {\n        object.fill = patterns[0];\n      }\n      if (typeof patterns[1] !== 'undefined') {\n        object.stroke = patterns[1];\n      }\n      fabric.util.enlivenObjects([object.clipPath], function(enlivedProps) {\n        object.clipPath = enlivedProps[0];\n        var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);\n        callback && callback(instance);\n      });\n    });\n  };\n\n  /**\n   * Unique id used internally when creating SVG elements\n   * @static\n   * @memberOf fabric.Object\n   * @type Number\n   */\n  fabric.Object.__uid = 0;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      originXOffset = {\n        left: -0.5,\n        center: 0,\n        right: 0.5\n      },\n      originYOffset = {\n        top: -0.5,\n        center: 0,\n        bottom: 0.5\n      };\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Translates the coordinates from a set of origin to another (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} fromOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} fromOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @param {String} toOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} toOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToGivenOrigin: function(point, fromOriginX, fromOriginY, toOriginX, toOriginY) {\n      var x = point.x,\n          y = point.y,\n          offsetX, offsetY, dim;\n\n      if (typeof fromOriginX === 'string') {\n        fromOriginX = originXOffset[fromOriginX];\n      }\n      else {\n        fromOriginX -= 0.5;\n      }\n\n      if (typeof toOriginX === 'string') {\n        toOriginX = originXOffset[toOriginX];\n      }\n      else {\n        toOriginX -= 0.5;\n      }\n\n      offsetX = toOriginX - fromOriginX;\n\n      if (typeof fromOriginY === 'string') {\n        fromOriginY = originYOffset[fromOriginY];\n      }\n      else {\n        fromOriginY -= 0.5;\n      }\n\n      if (typeof toOriginY === 'string') {\n        toOriginY = originYOffset[toOriginY];\n      }\n      else {\n        toOriginY -= 0.5;\n      }\n\n      offsetY = toOriginY - fromOriginY;\n\n      if (offsetX || offsetY) {\n        dim = this._getTransformedDimensions();\n        x = point.x + offsetX * dim.x;\n        y = point.y + offsetY * dim.y;\n      }\n\n      return new fabric.Point(x, y);\n    },\n\n    /**\n     * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToCenterPoint: function(point, originX, originY) {\n      var p = this.translateToGivenOrigin(point, originX, originY, 'center', 'center');\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, point, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Translates the coordinates from center to origin coordinates (based on the object's dimensions)\n     * @param {fabric.Point} center The point which corresponds to center of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToOriginPoint: function(center, originX, originY) {\n      var p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, center, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Returns the real center coordinates of the object\n     * @return {fabric.Point}\n     */\n    getCenterPoint: function() {\n      var leftTop = new fabric.Point(this.left, this.top);\n      return this.translateToCenterPoint(leftTop, this.originX, this.originY);\n    },\n\n    /**\n     * Returns the coordinates of the object based on center coordinates\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @return {fabric.Point}\n     */\n    // getOriginPoint: function(center) {\n    //   return this.translateToOriginPoint(center, this.originX, this.originY);\n    // },\n\n    /**\n     * Returns the coordinates of the object as if it has a different origin\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    getPointByOrigin: function(originX, originY) {\n      var center = this.getCenterPoint();\n      return this.translateToOriginPoint(center, originX, originY);\n    },\n\n    /**\n     * Returns the point in local coordinates\n     * @param {fabric.Point} point The point relative to the global coordinate system\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    toLocalPoint: function(point, originX, originY) {\n      var center = this.getCenterPoint(),\n          p, p2;\n\n      if (typeof originX !== 'undefined' && typeof originY !== 'undefined' ) {\n        p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      }\n      else {\n        p = new fabric.Point(this.left, this.top);\n      }\n\n      p2 = new fabric.Point(point.x, point.y);\n      if (this.angle) {\n        p2 = fabric.util.rotatePoint(p2, center, -degreesToRadians(this.angle));\n      }\n      return p2.subtractEquals(p);\n    },\n\n    /**\n     * Returns the point in global coordinates\n     * @param {fabric.Point} The point relative to the local coordinate system\n     * @return {fabric.Point}\n     */\n    // toGlobalPoint: function(point) {\n    //   return fabric.util.rotatePoint(point, this.getCenterPoint(), degreesToRadians(this.angle)).addEquals(new fabric.Point(this.left, this.top));\n    // },\n\n    /**\n     * Sets the position of the object taking into consideration the object's origin\n     * @param {fabric.Point} pos The new position of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {void}\n     */\n    setPositionByOrigin: function(pos, originX, originY) {\n      var center = this.translateToCenterPoint(pos, originX, originY),\n          position = this.translateToOriginPoint(center, this.originX, this.originY);\n      this.set('left', position.x);\n      this.set('top', position.y);\n    },\n\n    /**\n     * @param {String} to One of 'left', 'center', 'right'\n     */\n    adjustPosition: function(to) {\n      var angle = degreesToRadians(this.angle),\n          hypotFull = this.getScaledWidth(),\n          xFull = fabric.util.cos(angle) * hypotFull,\n          yFull = fabric.util.sin(angle) * hypotFull,\n          offsetFrom, offsetTo;\n\n      //TODO: this function does not consider mixed situation like top, center.\n      if (typeof this.originX === 'string') {\n        offsetFrom = originXOffset[this.originX];\n      }\n      else {\n        offsetFrom = this.originX - 0.5;\n      }\n      if (typeof to === 'string') {\n        offsetTo = originXOffset[to];\n      }\n      else {\n        offsetTo = to - 0.5;\n      }\n      this.left += xFull * (offsetTo - offsetFrom);\n      this.top += yFull * (offsetTo - offsetFrom);\n      this.setCoords();\n      this.originX = to;\n    },\n\n    /**\n     * Sets the origin/position of the object to it's center point\n     * @private\n     * @return {void}\n     */\n    _setOriginToCenter: function() {\n      this._originalOriginX = this.originX;\n      this._originalOriginY = this.originY;\n\n      var center = this.getCenterPoint();\n\n      this.originX = 'center';\n      this.originY = 'center';\n\n      this.left = center.x;\n      this.top = center.y;\n    },\n\n    /**\n     * Resets the origin/position of the object to it's original origin\n     * @private\n     * @return {void}\n     */\n    _resetOrigin: function() {\n      var originPoint = this.translateToOriginPoint(\n        this.getCenterPoint(),\n        this._originalOriginX,\n        this._originalOriginY);\n\n      this.originX = this._originalOriginX;\n      this.originY = this._originalOriginY;\n\n      this.left = originPoint.x;\n      this.top = originPoint.y;\n\n      this._originalOriginX = null;\n      this._originalOriginY = null;\n    },\n\n    /**\n     * @private\n     */\n    _getLeftTopCoords: function() {\n      return this.translateToOriginPoint(this.getCenterPoint(), 'left', 'top');\n    },\n  });\n\n})();\n(function() {\n\n  function getCoords(coords) {\n    return [\n      new fabric.Point(coords.tl.x, coords.tl.y),\n      new fabric.Point(coords.tr.x, coords.tr.y),\n      new fabric.Point(coords.br.x, coords.br.y),\n      new fabric.Point(coords.bl.x, coords.bl.y)\n    ];\n  }\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      multiplyMatrices = fabric.util.multiplyTransformMatrices,\n      transformPoint = fabric.util.transformPoint;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * properties are tl,mt,tr,ml,mr,bl,mb,br,mtr for the main controls.\n     * each property is an object with x, y and corner.\n     * The `corner` property contains in a similar manner the 4 points of the\n     * interactive area of the corner.\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\n     * skewX, skewY, angle, strokeWidth, viewportTransform, top, left, padding.\n     * The coordinates get updated with @method setCoords.\n     * You can calculate them without updating with @method calcCoords;\n     * @memberOf fabric.Object.prototype\n     */\n    oCoords: null,\n\n    /**\n     * Describe object's corner position in canvas object absolute coordinates\n     * properties are tl,tr,bl,br and describe the four main corner.\n     * each property is an object with x, y, instance of Fabric.Point.\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\n     * skewX, skewY, angle, strokeWidth, top, left.\n     * Those coordinates are usefull to understand where an object is. They get updated\n     * with oCoords but they do not need to be updated when zoom or panning change.\n     * The coordinates get updated with @method setCoords.\n     * You can calculate them without updating with @method calcCoords(true);\n     * @memberOf fabric.Object.prototype\n     */\n    aCoords: null,\n\n    /**\n     * storage for object transform matrix\n     */\n    ownMatrixCache: null,\n\n    /**\n     * storage for object full transform matrix\n     */\n    matrixCache: null,\n\n    /**\n     * return correct set of coordinates for intersection\n     */\n    getCoords: function(absolute, calculate) {\n      if (!this.oCoords) {\n        this.setCoords();\n      }\n      var coords = absolute ? this.aCoords : this.oCoords;\n      return getCoords(calculate ? this.calcCoords(absolute) : coords);\n    },\n\n    /**\n     * Checks if object intersects with an area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with an area formed by 2 points\n     */\n    intersectsWithRect: function(pointTL, pointBR, absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate),\n          intersection = fabric.Intersection.intersectPolygonRectangle(\n            coords,\n            pointTL,\n            pointBR\n          );\n      return intersection.status === 'Intersection';\n    },\n\n    /**\n     * Checks if object intersects with another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with another object\n     */\n    intersectsWithObject: function(other, absolute, calculate) {\n      var intersection = fabric.Intersection.intersectPolygonPolygon(\n        this.getCoords(absolute, calculate),\n        other.getCoords(absolute, calculate)\n      );\n\n      return intersection.status === 'Intersection'\n        || other.isContainedWithinObject(this, absolute, calculate)\n        || this.isContainedWithinObject(other, absolute, calculate);\n    },\n\n    /**\n     * Checks if object is fully contained within area of another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area of another object\n     */\n    isContainedWithinObject: function(other, absolute, calculate) {\n      var points = this.getCoords(absolute, calculate),\n          i = 0, lines = other._getImageLines(\n            calculate ? other.calcCoords(absolute) : absolute ? other.aCoords : other.oCoords\n          );\n      for (; i < 4; i++) {\n        if (!other.containsPoint(points[i], lines)) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Checks if object is fully contained within area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area formed by 2 points\n     */\n    isContainedWithinRect: function(pointTL, pointBR, absolute, calculate) {\n      var boundingRect = this.getBoundingRect(absolute, calculate);\n\n      return (\n        boundingRect.left >= pointTL.x &&\n        boundingRect.left + boundingRect.width <= pointBR.x &&\n        boundingRect.top >= pointTL.y &&\n        boundingRect.top + boundingRect.height <= pointBR.y\n      );\n    },\n\n    /**\n     * Checks if point is inside the object\n     * @param {fabric.Point} point Point to check against\n     * @param {Object} [lines] object returned from @method _getImageLines\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if point is inside the object\n     */\n    containsPoint: function(point, lines, absolute, calculate) {\n      var lines = lines || this._getImageLines(\n            calculate ? this.calcCoords(absolute) : absolute ? this.aCoords : this.oCoords\n          ),\n          xPoints = this._findCrossPoints(point, lines);\n\n      // if xPoints is odd then point is inside the object\n      return (xPoints !== 0 && xPoints % 2 === 1);\n    },\n\n    /**\n     * Checks if object is contained within the canvas with current viewportTransform\n     * the check is done stopping at first point that appears on screen\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully or partially contained within canvas\n     */\n    isOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      var points = this.getCoords(true, calculate), point;\n      for (var i = 0; i < 4; i++) {\n        point = points[i];\n        if (point.x <= pointBR.x && point.x >= pointTL.x && point.y <= pointBR.y && point.y >= pointTL.y) {\n          return true;\n        }\n      }\n      // no points on screen, check intersection with absolute coordinates\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n        return true;\n      }\n      return this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n    },\n\n    /**\n     * Checks if the object contains the midpoint between canvas extremities\n     * Does not make sense outside the context of isOnScreen and isPartiallyOnScreen\n     * @private\n     * @param {Fabric.Point} pointTL Top Left point\n     * @param {Fabric.Point} pointBR Top Right point\n     * @param {Boolean} calculate use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if the objects containe the point\n     */\n    _containsCenterOfCanvas: function(pointTL, pointBR, calculate) {\n      // worst case scenario the object is so big that contains the screen\n      var centerPoint = { x: (pointTL.x + pointBR.x) / 2, y: (pointTL.y + pointBR.y) / 2 };\n      if (this.containsPoint(centerPoint, null, true, calculate)) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Checks if object is partially contained within the canvas with current viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is partially contained within canvas\n     */\n    isPartiallyOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n        return true;\n      }\n      return this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n    },\n\n    /**\n     * Method that returns an object with the object edges in it, given the coordinates of the corners\n     * @private\n     * @param {Object} oCoords Coordinates of the object corners\n     */\n    _getImageLines: function(oCoords) {\n      return {\n        topline: {\n          o: oCoords.tl,\n          d: oCoords.tr\n        },\n        rightline: {\n          o: oCoords.tr,\n          d: oCoords.br\n        },\n        bottomline: {\n          o: oCoords.br,\n          d: oCoords.bl\n        },\n        leftline: {\n          o: oCoords.bl,\n          d: oCoords.tl\n        }\n      };\n    },\n\n    /**\n     * Helper method to determine how many cross points are between the 4 object edges\n     * and the horizontal line determined by a point on canvas\n     * @private\n     * @param {fabric.Point} point Point to check\n     * @param {Object} lines Coordinates of the object being evaluated\n     */\n    // remove yi, not used but left code here just in case.\n    _findCrossPoints: function(point, lines) {\n      var b1, b2, a1, a2, xi, // yi,\n          xcount = 0,\n          iLine;\n\n      for (var lineKey in lines) {\n        iLine = lines[lineKey];\n        // optimisation 1: line below point. no cross\n        if ((iLine.o.y < point.y) && (iLine.d.y < point.y)) {\n          continue;\n        }\n        // optimisation 2: line above point. no cross\n        if ((iLine.o.y >= point.y) && (iLine.d.y >= point.y)) {\n          continue;\n        }\n        // optimisation 3: vertical line case\n        if ((iLine.o.x === iLine.d.x) && (iLine.o.x >= point.x)) {\n          xi = iLine.o.x;\n          // yi = point.y;\n        }\n        // calculate the intersection point\n        else {\n          b1 = 0;\n          b2 = (iLine.d.y - iLine.o.y) / (iLine.d.x - iLine.o.x);\n          a1 = point.y - b1 * point.x;\n          a2 = iLine.o.y - b2 * iLine.o.x;\n\n          xi = -(a1 - a2) / (b1 - b2);\n          // yi = a1 + b1 * xi;\n        }\n        // dont count xi < point.x cases\n        if (xi >= point.x) {\n          xcount += 1;\n        }\n        // optimisation 4: specific for square images\n        if (xcount === 2) {\n          break;\n        }\n      }\n      return xcount;\n    },\n\n    /**\n     * Returns coordinates of object's bounding rectangle (left, top, width, height)\n     * the box is intented as aligned to axis of canvas.\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords / .aCoords\n     * @return {Object} Object with left, top, width, height properties\n     */\n    getBoundingRect: function(absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate);\n      return fabric.util.makeBoundingBoxFromPoints(coords);\n    },\n\n    /**\n     * Returns width of an object bounding box counting transformations\n     * before 2.0 it was named getWidth();\n     * @return {Number} width value\n     */\n    getScaledWidth: function() {\n      return this._getTransformedDimensions().x;\n    },\n\n    /**\n     * Returns height of an object bounding box counting transformations\n     * before 2.0 it was named getHeight();\n     * @return {Number} height value\n     */\n    getScaledHeight: function() {\n      return this._getTransformedDimensions().y;\n    },\n\n    /**\n     * Makes sure the scale is valid and modifies it if necessary\n     * @private\n     * @param {Number} value\n     * @return {Number}\n     */\n    _constrainScale: function(value) {\n      if (Math.abs(value) < this.minScaleLimit) {\n        if (value < 0) {\n          return -this.minScaleLimit;\n        }\n        else {\n          return this.minScaleLimit;\n        }\n      }\n      else if (value === 0) {\n        return 0.0001;\n      }\n      return value;\n    },\n\n    /**\n     * Scales an object (equally by x and y)\n     * @param {Number} value Scale factor\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scale: function(value) {\n      this._set('scaleX', value);\n      this._set('scaleY', value);\n      return this.setCoords();\n    },\n\n    /**\n     * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New width value\n     * @param {Boolean} absolute ignore viewport\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToWidth: function(value, absolute) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect(absolute).width / this.getScaledWidth();\n      return this.scale(value / this.width / boundingRectFactor);\n    },\n\n    /**\n     * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New height value\n     * @param {Boolean} absolute ignore viewport\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToHeight: function(value, absolute) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect(absolute).height / this.getScaledHeight();\n      return this.scale(value / this.height / boundingRectFactor);\n    },\n\n    /**\n     * Calculate and returns the .coords of an object.\n     * @return {Object} Object with tl, tr, br, bl ....\n     * @chainable\n     */\n    calcCoords: function(absolute) {\n      var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          startMatrix = multiplyMatrices(translateMatrix, rotateMatrix),\n          vpt = this.getViewportTransform(),\n          finalMatrix = absolute ? startMatrix : multiplyMatrices(vpt, startMatrix),\n          dim = this._getTransformedDimensions(),\n          w = dim.x / 2, h = dim.y / 2,\n          tl = transformPoint({ x: -w, y: -h }, finalMatrix),\n          tr = transformPoint({ x: w, y: -h }, finalMatrix),\n          bl = transformPoint({ x: -w, y: h }, finalMatrix),\n          br = transformPoint({ x: w, y: h }, finalMatrix);\n      if (!absolute) {\n        var padding = this.padding, angle = degreesToRadians(this.angle),\n            cos = fabric.util.cos(angle), sin = fabric.util.sin(angle),\n            cosP = cos * padding, sinP = sin * padding, cosPSinP = cosP + sinP,\n            cosPMinusSinP = cosP - sinP;\n        if (padding) {\n          tl.x -= cosPMinusSinP;\n          tl.y -= cosPSinP;\n          tr.x += cosPSinP;\n          tr.y -= cosPMinusSinP;\n          bl.x -= cosPSinP;\n          bl.y += cosPMinusSinP;\n          br.x += cosPMinusSinP;\n          br.y += cosPSinP;\n        }\n        var ml  = new fabric.Point((tl.x + bl.x) / 2, (tl.y + bl.y) / 2),\n            mt  = new fabric.Point((tr.x + tl.x) / 2, (tr.y + tl.y) / 2),\n            mr  = new fabric.Point((br.x + tr.x) / 2, (br.y + tr.y) / 2),\n            mb  = new fabric.Point((br.x + bl.x) / 2, (br.y + bl.y) / 2),\n            mtr = new fabric.Point(mt.x + sin * this.rotatingPointOffset, mt.y - cos * this.rotatingPointOffset);\n      }\n\n      // if (!absolute) {\n      //   var canvas = this.canvas;\n      //   setTimeout(function() {\n      //     canvas.contextTop.clearRect(0, 0, 700, 700);\n      //     canvas.contextTop.fillStyle = 'green';\n      //     canvas.contextTop.fillRect(mb.x, mb.y, 3, 3);\n      //     canvas.contextTop.fillRect(bl.x, bl.y, 3, 3);\n      //     canvas.contextTop.fillRect(br.x, br.y, 3, 3);\n      //     canvas.contextTop.fillRect(tl.x, tl.y, 3, 3);\n      //     canvas.contextTop.fillRect(tr.x, tr.y, 3, 3);\n      //     canvas.contextTop.fillRect(ml.x, ml.y, 3, 3);\n      //     canvas.contextTop.fillRect(mr.x, mr.y, 3, 3);\n      //     canvas.contextTop.fillRect(mt.x, mt.y, 3, 3);\n      //     canvas.contextTop.fillRect(mtr.x, mtr.y, 3, 3);\n      //   }, 50);\n      // }\n\n      var coords = {\n        // corners\n        tl: tl, tr: tr, br: br, bl: bl,\n      };\n      if (!absolute) {\n        // middle\n        coords.ml = ml;\n        coords.mt = mt;\n        coords.mr = mr;\n        coords.mb = mb;\n        // rotating point\n        coords.mtr = mtr;\n      }\n      return coords;\n    },\n\n    /**\n     * Sets corner position coordinates based on current angle, width and height.\n     * See {@link https://github.com/kangax/fabric.js/wiki/When-to-call-setCoords|When-to-call-setCoords}\n     * @param {Boolean} [ignoreZoom] set oCoords with or without the viewport transform.\n     * @param {Boolean} [skipAbsolute] skip calculation of aCoords, usefull in setViewportTransform\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setCoords: function(ignoreZoom, skipAbsolute) {\n      this.oCoords = this.calcCoords(ignoreZoom);\n      if (!skipAbsolute) {\n        this.aCoords = this.calcCoords(true);\n      }\n\n      // set coordinates of the draggable boxes in the corners used to scale/rotate the image\n      ignoreZoom || (this._setCornerCoords && this._setCornerCoords());\n\n      return this;\n    },\n\n    /**\n     * calculate rotation matrix of an object\n     * @return {Array} rotation matrix for the object\n     */\n    _calcRotateMatrix: function() {\n      if (this.angle) {\n        var theta = degreesToRadians(this.angle), cos = fabric.util.cos(theta), sin = fabric.util.sin(theta);\n        return [cos, sin, -sin, cos, 0, 0];\n      }\n      return fabric.iMatrix.concat();\n    },\n\n    /**\n     * calculate the translation matrix for an object transform\n     * @return {Array} rotation matrix for the object\n     */\n    _calcTranslateMatrix: function() {\n      var center = this.getCenterPoint();\n      return [1, 0, 0, 1, center.x, center.y];\n    },\n\n    transformMatrixKey: function(skipGroup) {\n      var sep = '_', prefix = '';\n      if (!skipGroup && this.group) {\n        prefix = this.group.transformMatrixKey(skipGroup) + sep;\n      };\n      return prefix + this.top + sep + this.left + sep + this.scaleX + sep + this.scaleY +\n        sep + this.skewX + sep + this.skewY + sep + this.angle + sep + this.originX + sep + this.originY +\n        sep + this.width + sep + this.height + sep + this.strokeWidth + this.flipX + this.flipY;\n    },\n\n    /**\n     * calculate trasform Matrix that represent current transformation from\n     * object properties.\n     * @param {Boolean} [skipGroup] return transformMatrix for object and not go upward with parents\n     * @return {Array} matrix Transform Matrix for the object\n     */\n    calcTransformMatrix: function(skipGroup) {\n      if (skipGroup) {\n        return this.calcOwnMatrix();\n      }\n      var key = this.transformMatrixKey(), cache = this.matrixCache || (this.matrixCache = {});\n      if (cache.key === key) {\n        return cache.value;\n      }\n      var matrix = this.calcOwnMatrix();\n      if (this.group) {\n        matrix = multiplyMatrices(this.group.calcTransformMatrix(), matrix);\n      }\n      cache.key = key;\n      cache.value = matrix;\n      return matrix;\n    },\n\n    calcOwnMatrix: function() {\n      var key = this.transformMatrixKey(true), cache = this.ownMatrixCache || (this.ownMatrixCache = {});\n      if (cache.key === key) {\n        return cache.value;\n      }\n      var matrix = this._calcTranslateMatrix(),\n          rotateMatrix,\n          dimensionMatrix = this._calcDimensionsTransformMatrix(this.skewX, this.skewY, true);\n      if (this.angle) {\n        rotateMatrix = this._calcRotateMatrix();\n        matrix = multiplyMatrices(matrix, rotateMatrix);\n      }\n      matrix = multiplyMatrices(matrix, dimensionMatrix);\n      cache.key = key;\n      cache.value = matrix;\n      return matrix;\n    },\n\n    _calcDimensionsTransformMatrix: function(skewX, skewY, flipping) {\n      var skewMatrix,\n          scaleX = this.scaleX * (flipping && this.flipX ? -1 : 1),\n          scaleY = this.scaleY * (flipping && this.flipY ? -1 : 1),\n          scaleMatrix = [scaleX, 0, 0, scaleY, 0, 0];\n      if (skewX) {\n        skewMatrix = [1, 0, Math.tan(degreesToRadians(skewX)), 1];\n        scaleMatrix = multiplyMatrices(scaleMatrix, skewMatrix, true);\n      }\n      if (skewY) {\n        skewMatrix = [1, Math.tan(degreesToRadians(skewY)), 0, 1];\n        scaleMatrix = multiplyMatrices(scaleMatrix, skewMatrix, true);\n      }\n      return scaleMatrix;\n    },\n\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getNonTransformedDimensions: function() {\n      var strokeWidth = this.strokeWidth,\n          w = this.width + strokeWidth,\n          h = this.height + strokeWidth;\n      return { x: w, y: h };\n    },\n\n    /*\n     * Calculate object bounding boxdimensions from its properties scale, skew.\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getTransformedDimensions: function(skewX, skewY) {\n      if (typeof skewX === 'undefined') {\n        skewX = this.skewX;\n      }\n      if (typeof skewY === 'undefined') {\n        skewY = this.skewY;\n      }\n      var dimensions = this._getNonTransformedDimensions();\n      if (skewX === 0 && skewY === 0) {\n        return { x: dimensions.x * this.scaleX, y: dimensions.y * this.scaleY };\n      }\n      var dimX = dimensions.x / 2, dimY = dimensions.y / 2,\n          points = [\n            {\n              x: -dimX,\n              y: -dimY\n            },\n            {\n              x: dimX,\n              y: -dimY\n            },\n            {\n              x: -dimX,\n              y: dimY\n            },\n            {\n              x: dimX,\n              y: dimY\n            }],\n          i, transformMatrix = this._calcDimensionsTransformMatrix(skewX, skewY, false),\n          bbox;\n      for (i = 0; i < points.length; i++) {\n        points[i] = fabric.util.transformPoint(points[i], transformMatrix);\n      }\n      bbox = fabric.util.makeBoundingBoxFromPoints(points);\n      return { x: bbox.width, y: bbox.height };\n    },\n\n    /*\n     * Calculate object dimensions for controls. include padding and canvas zoom\n     * private\n     */\n    _calculateCurrentDimensions: function()  {\n      var vpt = this.getViewportTransform(),\n          dim = this._getTransformedDimensions(),\n          p = fabric.util.transformPoint(dim, vpt, true);\n\n      return p.scalarAdd(2 * this.padding);\n    },\n  });\n})();\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * Moves an object to the bottom of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendToBack: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendToBack.call(this.group, this);\n    }\n    else {\n      this.canvas.sendToBack(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to the top of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringToFront: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringToFront.call(this.group, this);\n    }\n    else {\n      this.canvas.bringToFront(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object down in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendBackwards: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, intersecting);\n    }\n    else {\n      this.canvas.sendBackwards(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object up in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringForward: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringForward.call(this.group, this, intersecting);\n    }\n    else {\n      this.canvas.bringForward(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to specified level in stack of drawn objects\n   * @param {Number} index New position of object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  moveTo: function(index) {\n    if (this.group && this.group.type !== 'activeSelection') {\n      fabric.StaticCanvas.prototype.moveTo.call(this.group, this, index);\n    }\n    else {\n      this.canvas.moveTo(this, index);\n    }\n    return this;\n  }\n});\n/* _TO_SVG_START_ */\n(function() {\n  function getSvgColorString(prop, value) {\n    if (!value) {\n      return prop + ': none; ';\n    }\n    else if (value.toLive) {\n      return prop + ': url(#SVGID_' + value.id + '); ';\n    }\n    else {\n      var color = new fabric.Color(value),\n          str = prop + ': ' + color.toRgb() + '; ',\n          opacity = color.getAlpha();\n      if (opacity !== 1) {\n        //change the color in rgb + opacity\n        str += prop + '-opacity: ' + opacity.toString() + '; ';\n      }\n      return str;\n    }\n  }\n\n  var toFixed = fabric.util.toFixed;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n\n      var fillRule = this.fillRule ? this.fillRule : 'nonzero',\n          strokeWidth = this.strokeWidth ? this.strokeWidth : '0',\n          strokeDashArray = this.strokeDashArray ? this.strokeDashArray.join(' ') : 'none',\n          strokeDashOffset = this.strokeDashOffset ? this.strokeDashOffset : '0',\n          strokeLineCap = this.strokeLineCap ? this.strokeLineCap : 'butt',\n          strokeLineJoin = this.strokeLineJoin ? this.strokeLineJoin : 'miter',\n          strokeMiterLimit = this.strokeMiterLimit ? this.strokeMiterLimit : '4',\n          opacity = typeof this.opacity !== 'undefined' ? this.opacity : '1',\n          visibility = this.visible ? '' : ' visibility: hidden;',\n          filter = skipShadow ? '' : this.getSvgFilter(),\n          fill = getSvgColorString('fill', this.fill),\n          stroke = getSvgColorString('stroke', this.stroke);\n\n      return [\n        stroke,\n        'stroke-width: ', strokeWidth, '; ',\n        'stroke-dasharray: ', strokeDashArray, '; ',\n        'stroke-linecap: ', strokeLineCap, '; ',\n        'stroke-dashoffset: ', strokeDashOffset, '; ',\n        'stroke-linejoin: ', strokeLineJoin, '; ',\n        'stroke-miterlimit: ', strokeMiterLimit, '; ',\n        fill,\n        'fill-rule: ', fillRule, '; ',\n        'opacity: ', opacity, ';',\n        filter,\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @param {Object} style the object from which to retrieve style properties\n     * @param {Boolean} useWhiteSpace a boolean to include an additional attribute in the style.\n     * @return {String}\n     */\n    getSvgSpanStyles: function(style, useWhiteSpace) {\n      var term = '; ';\n      var fontFamily = style.fontFamily ?\n        'font-family: ' + (((style.fontFamily.indexOf('\\'') === -1 && style.fontFamily.indexOf('\"') === -1) ?\n          '\\'' + style.fontFamily  + '\\'' : style.fontFamily)) + term : '';\n      var strokeWidth = style.strokeWidth ? 'stroke-width: ' + style.strokeWidth + term : '',\n          fontFamily = fontFamily,\n          fontSize = style.fontSize ? 'font-size: ' + style.fontSize + 'px' + term : '',\n          fontStyle = style.fontStyle ? 'font-style: ' + style.fontStyle + term : '',\n          fontWeight = style.fontWeight ? 'font-weight: ' + style.fontWeight + term : '',\n          fill = style.fill ? getSvgColorString('fill', style.fill) : '',\n          stroke = style.stroke ? getSvgColorString('stroke', style.stroke) : '',\n          textDecoration = this.getSvgTextDecoration(style),\n          deltaY = style.deltaY ? 'baseline-shift: ' + (-style.deltaY) + '; ' : '';\n      if (textDecoration) {\n        textDecoration = 'text-decoration: ' + textDecoration + term;\n      }\n\n      return [\n        stroke,\n        strokeWidth,\n        fontFamily,\n        fontSize,\n        fontStyle,\n        fontWeight,\n        textDecoration,\n        fill,\n        deltaY,\n        useWhiteSpace ? 'white-space: pre; ' : ''\n      ].join('');\n    },\n\n    /**\n     * Returns text-decoration property for svg-export\n     * @param {Object} style the object from which to retrieve style properties\n     * @return {String}\n     */\n    getSvgTextDecoration: function(style) {\n      if ('overline' in style || 'underline' in style || 'linethrough' in style) {\n        return (style.overline ? 'overline ' : '') +\n          (style.underline ? 'underline ' : '') + (style.linethrough ? 'line-through ' : '');\n      }\n      return '';\n    },\n\n    /**\n     * Returns filter for svg shadow\n     * @return {String}\n     */\n    getSvgFilter: function() {\n      return this.shadow ? 'filter: url(#SVGID_' + this.shadow.id + ');' : '';\n    },\n\n    /**\n     * Returns id attribute for svg output\n     * @return {String}\n     */\n    getSvgCommons: function() {\n      return [\n        this.id ? 'id=\"' + this.id + '\" ' : '',\n        this.clipPath ? 'clip-path=\"url(#' + this.clipPath.clipPathId + ')\" ' : '',\n      ].join('');\n    },\n\n    /**\n     * Returns transform-string for svg-export\n     * @param {Boolean} use the full transform or the single object one.\n     * @return {String}\n     */\n    getSvgTransform: function(full, additionalTransform) {\n      var transform = full ? this.calcTransformMatrix() : this.calcOwnMatrix(),\n          svgTransform = transform.map(function(value) {\n            return toFixed(value, fabric.Object.NUM_FRACTION_DIGITS);\n          }).join(' ');\n      return 'transform=\"matrix(' + svgTransform + ')' +\n        (additionalTransform || '') + this.getSvgTransformMatrix() + '\" ';\n    },\n\n    /**\n     * Returns transform-string for svg-export from the transform matrix of single elements\n     * @return {String}\n     */\n    getSvgTransformMatrix: function() {\n      return this.transformMatrix ? ' matrix(' + this.transformMatrix.join(' ') + ')' : '';\n    },\n\n    _setSVGBg: function(textBgRects) {\n      if (this.backgroundColor) {\n        var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n        textBgRects.push(\n          '\\t\\t<rect ',\n          this._getFillAttributes(this.backgroundColor),\n          ' x=\"',\n          toFixed(-this.width / 2, NUM_FRACTION_DIGITS),\n          '\" y=\"',\n          toFixed(-this.height / 2, NUM_FRACTION_DIGITS),\n          '\" width=\"',\n          toFixed(this.width, NUM_FRACTION_DIGITS),\n          '\" height=\"',\n          toFixed(this.height, NUM_FRACTION_DIGITS),\n          '\"></rect>\\n');\n      }\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      return this._createBaseSVGMarkup(this._toSVG(), { reviver: reviver });\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      return '\\t' + this._createBaseClipPathSVGMarkup(this._toSVG(), { reviver: reviver });\n    },\n\n    /**\n     * @private\n     */\n    _createBaseClipPathSVGMarkup: function(objectMarkup, options) {\n      options = options || {};\n      var reviver = options.reviver,\n          additionalTransform = options.additionalTransform || '',\n          commonPieces = [\n            this.getSvgTransform(true, additionalTransform),\n            this.getSvgCommons(),\n          ].join(''),\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf('COMMON_PARTS');\n      objectMarkup[index] = commonPieces;\n      return reviver ? reviver(objectMarkup.join('')) : objectMarkup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _createBaseSVGMarkup: function(objectMarkup, options) {\n      options = options || {};\n      var noStyle = options.noStyle, withShadow = options.withShadow,\n          reviver = options.reviver,\n          styleInfo = noStyle ? '' : 'style=\"' + this.getSvgStyles() + '\" ',\n          shadowInfo = withShadow ? 'style=\"' + this.getSvgFilter() + '\" ' : '',\n          clipPath = this.clipPath,\n          absoluteClipPath = this.clipPath && this.clipPath.absolutePositioned,\n          commonPieces, markup = [], clipPathMarkup,\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf('COMMON_PARTS'),\n          additionalTransform = options.additionalTransform;\n      if (clipPath) {\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\n        clipPathMarkup = '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\n          this.clipPath.toClipPathSVG(reviver) +\n          '</clipPath>\\n';\n      }\n      if (absoluteClipPath) {\n        markup.push(\n          '<g ', shadowInfo, this.getSvgCommons(), ' >\\n'\n        );\n      }\n      markup.push(\n        '<g ',\n        this.getSvgTransform(false),\n        !absoluteClipPath ? shadowInfo + this.getSvgCommons() : '',\n        ' >\\n'\n      );\n      commonPieces = [\n        styleInfo,\n        noStyle ? '' : this.addPaintOrder(), ' ',\n        additionalTransform ? 'transform=\"' + additionalTransform + '\" ' : '',\n      ].join('');\n      objectMarkup[index] = commonPieces;\n      if (this.fill && this.fill.toLive) {\n        markup.push(this.fill.toSVG(this, false));\n      }\n      if (this.stroke && this.stroke.toLive) {\n        markup.push(this.stroke.toSVG(this, false));\n      }\n      if (this.shadow) {\n        markup.push(this.shadow.toSVG(this));\n      }\n      if (clipPath) {\n        markup.push(clipPathMarkup);\n      }\n      markup.push(objectMarkup.join(''));\n      markup.push('</g>\\n');\n      absoluteClipPath && markup.push('</g>\\n');\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n\n    addPaintOrder: function() {\n      return this.paintFirst !== 'fill' ? ' paint-order=\"' + this.paintFirst + '\" ' : '';\n    }\n  });\n})();\n/* _TO_SVG_END_ */\n(function() {\n\n  var extend = fabric.util.object.extend,\n      originalSet = 'stateProperties';\n\n  /*\n    Depends on `stateProperties`\n  */\n  function saveProps(origin, destination, props) {\n    var tmpObj = { }, deep = true;\n    props.forEach(function(prop) {\n      tmpObj[prop] = origin[prop];\n    });\n    extend(origin[destination], tmpObj, deep);\n  }\n\n  function _isEqual(origValue, currentValue, firstPass) {\n    if (origValue === currentValue) {\n      // if the objects are identical, return\n      return true;\n    }\n    else if (Array.isArray(origValue)) {\n      if (!Array.isArray(currentValue) || origValue.length !== currentValue.length) {\n        return false;\n      }\n      for (var i = 0, len = origValue.length; i < len; i++) {\n        if (!_isEqual(origValue[i], currentValue[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    else if (origValue && typeof origValue === 'object') {\n      var keys = Object.keys(origValue), key;\n      if (!currentValue ||\n          typeof currentValue !== 'object' ||\n          (!firstPass && keys.length !== Object.keys(currentValue).length)\n      ) {\n        return false;\n      }\n      for (var i = 0, len = keys.length; i < len; i++) {\n        key = keys[i];\n        // since clipPath is in the statefull cache list and the clipPath objects\n        // would be iterated as an object, this would lead to possible infinite recursion\n        if (key === 'canvas') {\n          continue;\n        }\n        if (!_isEqual(origValue[key], currentValue[key])) {\n          return false;\n        }\n      }\n      return true;\n    }\n  }\n\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Returns true if object state (one of its state properties) was changed\n     * @param {String} [propertySet] optional name for the set of property we want to save\n     * @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called\n     */\n    hasStateChanged: function(propertySet) {\n      propertySet = propertySet || originalSet;\n      var dashedPropertySet = '_' + propertySet;\n      if (Object.keys(this[dashedPropertySet]).length < this[propertySet].length) {\n        return true;\n      }\n      return !_isEqual(this[dashedPropertySet], this, true);\n    },\n\n    /**\n     * Saves state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    saveState: function(options) {\n      var propertySet = options && options.propertySet || originalSet,\n          destination = '_' + propertySet;\n      if (!this[destination]) {\n        return this.setupState(options);\n      }\n      saveProps(this, destination, this[propertySet]);\n      if (options && options.stateProperties) {\n        saveProps(this, destination, options.stateProperties);\n      }\n      return this;\n    },\n\n    /**\n     * Setups state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    setupState: function(options) {\n      options = options || { };\n      var propertySet = options.propertySet || originalSet;\n      options.propertySet = propertySet;\n      this['_' + propertySet] = { };\n      this.saveState(options);\n      return this;\n    }\n  });\n})();\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * The object interactivity controls.\n     * @private\n     */\n    _controlsVisibility: null,\n\n    /**\n     * Determines which corner has been clicked\n     * @private\n     * @param {Object} pointer The pointer indicating the mouse position\n     * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\n     */\n    _findTargetCorner: function(pointer) {\n      // objects in group, anykind, are not self modificable,\n      // must not return an hovered corner.\n      if (!this.hasControls || this.group || (!this.canvas || this.canvas._activeObject !== this)) {\n        return false;\n      }\n\n      var ex = pointer.x,\n          ey = pointer.y,\n          xPoints,\n          lines;\n      this.__corner = 0;\n      for (var i in this.oCoords) {\n\n        if (!this.isControlVisible(i)) {\n          continue;\n        }\n\n        if (i === 'mtr' && !this.hasRotatingPoint) {\n          continue;\n        }\n\n        if (this.get('lockUniScaling') &&\n           (i === 'mt' || i === 'mr' || i === 'mb' || i === 'ml')) {\n          continue;\n        }\n\n        lines = this._getImageLines(this.oCoords[i].corner);\n\n        // debugging\n\n        // canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n\n        xPoints = this._findCrossPoints({ x: ex, y: ey }, lines);\n        if (xPoints !== 0 && xPoints % 2 === 1) {\n          this.__corner = i;\n          return i;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Sets the coordinates of the draggable boxes in the corners of\n     * the image used to scale/rotate it.\n     * @private\n     */\n    _setCornerCoords: function() {\n      var coords = this.oCoords,\n          newTheta = degreesToRadians(45 - this.angle),\n          /* Math.sqrt(2 * Math.pow(this.cornerSize, 2)) / 2, */\n          /* 0.707106 stands for sqrt(2)/2 */\n          cornerHypotenuse = this.cornerSize * 0.707106,\n          cosHalfOffset = cornerHypotenuse * fabric.util.cos(newTheta),\n          sinHalfOffset = cornerHypotenuse * fabric.util.sin(newTheta),\n          x, y;\n\n      for (var point in coords) {\n        x = coords[point].x;\n        y = coords[point].y;\n        coords[point].corner = {\n          tl: {\n            x: x - sinHalfOffset,\n            y: y - cosHalfOffset\n          },\n          tr: {\n            x: x + cosHalfOffset,\n            y: y - sinHalfOffset\n          },\n          bl: {\n            x: x - cosHalfOffset,\n            y: y + sinHalfOffset\n          },\n          br: {\n            x: x + sinHalfOffset,\n            y: y + cosHalfOffset\n          }\n        };\n      }\n    },\n\n    /**\n     * Draws a colored layer behind the object, inside its selection borders.\n     * Requires public options: padding, selectionBackgroundColor\n     * this function is called when the context is transformed\n     * has checks to be skipped when the object is on a staticCanvas\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawSelectionBackground: function(ctx) {\n      if (!this.selectionBackgroundColor ||\n        (this.canvas && !this.canvas.interactive) ||\n        (this.canvas && this.canvas._activeObject !== this)\n      ) {\n        return this;\n      }\n      ctx.save();\n      var center = this.getCenterPoint(), wh = this._calculateCurrentDimensions(),\n          vpt = this.canvas.viewportTransform;\n      ctx.translate(center.x, center.y);\n      ctx.scale(1 / vpt[0], 1 / vpt[3]);\n      ctx.rotate(degreesToRadians(this.angle));\n      ctx.fillStyle = this.selectionBackgroundColor;\n      ctx.fillRect(-wh.x / 2, -wh.y / 2, wh.x, wh.y);\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBorders: function(ctx, styleOverride) {\n      styleOverride = styleOverride || {};\n      var wh = this._calculateCurrentDimensions(),\n          strokeWidth = 1 / this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth,\n          drawRotatingPoint = typeof styleOverride.hasRotatingPoint !== 'undefined' ?\n            styleOverride.hasRotatingPoint : this.hasRotatingPoint,\n          hasControls = typeof styleOverride.hasControls !== 'undefined' ?\n            styleOverride.hasControls : this.hasControls,\n          rotatingPointOffset = typeof styleOverride.rotatingPointOffset !== 'undefined' ?\n            styleOverride.rotatingPointOffset : this.rotatingPointOffset;\n\n      ctx.save();\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray, null);\n\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      if (drawRotatingPoint && this.isControlVisible('mtr') && hasControls) {\n\n        var rotateHeight = -height / 2;\n\n        ctx.beginPath();\n        ctx.moveTo(0, rotateHeight);\n        ctx.lineTo(0, rotateHeight - rotatingPointOffset);\n        ctx.stroke();\n      }\n\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box when it is inside a group.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {object} options object representing current object parameters\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBordersInGroup: function(ctx, options, styleOverride) {\n      styleOverride = styleOverride || {};\n      var p = this._getNonTransformedDimensions(),\n          matrix = fabric.util.customTransformMatrix(options.scaleX, options.scaleY, options.skewX),\n          wh = fabric.util.transformPoint(p, matrix),\n          strokeWidth = 1 / this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth;\n\n      ctx.save();\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray, null);\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws corners of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: cornerSize, padding\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawControls: function(ctx, styleOverride) {\n      styleOverride = styleOverride || {};\n      var wh = this._calculateCurrentDimensions(),\n          width = wh.x,\n          height = wh.y,\n          scaleOffset = styleOverride.cornerSize || this.cornerSize,\n          left = -(width + scaleOffset) / 2,\n          top = -(height + scaleOffset) / 2,\n          transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\n            styleOverride.transparentCorners : this.transparentCorners,\n          hasRotatingPoint = typeof styleOverride.hasRotatingPoint !== 'undefined' ?\n            styleOverride.hasRotatingPoint : this.hasRotatingPoint,\n          methodName = transparentCorners ? 'stroke' : 'fill';\n\n      ctx.save();\n      ctx.strokeStyle = ctx.fillStyle = styleOverride.cornerColor || this.cornerColor;\n      if (!this.transparentCorners) {\n        ctx.strokeStyle = styleOverride.cornerStrokeColor || this.cornerStrokeColor;\n      }\n      this._setLineDash(ctx, styleOverride.cornerDashArray || this.cornerDashArray, null);\n\n      // top-left\n      this._drawControl('tl', ctx, methodName,\n        left,\n        top, styleOverride);\n\n      // top-right\n      this._drawControl('tr', ctx, methodName,\n        left + width,\n        top, styleOverride);\n\n      // bottom-left\n      this._drawControl('bl', ctx, methodName,\n        left,\n        top + height, styleOverride);\n\n      // bottom-right\n      this._drawControl('br', ctx, methodName,\n        left + width,\n        top + height, styleOverride);\n\n      if (!this.get('lockUniScaling')) {\n\n        // middle-top\n        this._drawControl('mt', ctx, methodName,\n          left + width / 2,\n          top, styleOverride);\n\n        // middle-bottom\n        this._drawControl('mb', ctx, methodName,\n          left + width / 2,\n          top + height, styleOverride);\n\n        // middle-right\n        this._drawControl('mr', ctx, methodName,\n          left + width,\n          top + height / 2, styleOverride);\n\n        // middle-left\n        this._drawControl('ml', ctx, methodName,\n          left,\n          top + height / 2, styleOverride);\n      }\n\n      // middle-top-rotate\n      if (hasRotatingPoint) {\n        this._drawControl('mtr', ctx, methodName,\n          left + width / 2,\n          top - this.rotatingPointOffset, styleOverride);\n      }\n\n      ctx.restore();\n\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _drawControl: function(control, ctx, methodName, left, top, styleOverride) {\n      styleOverride = styleOverride || {};\n      if (!this.isControlVisible(control)) {\n        return;\n      }\n      var size = this.cornerSize, stroke = !this.transparentCorners && this.cornerStrokeColor;\n      switch (styleOverride.cornerStyle || this.cornerStyle) {\n        case 'circle':\n          ctx.beginPath();\n          ctx.arc(left + size / 2, top + size / 2, size / 2, 0, 2 * Math.PI, false);\n          ctx[methodName]();\n          if (stroke) {\n            ctx.stroke();\n          }\n          break;\n        default:\n          this.transparentCorners || ctx.clearRect(left, top, size, size);\n          ctx[methodName + 'Rect'](left, top, size, size);\n          if (stroke) {\n            ctx.strokeRect(left, top, size, size);\n          }\n      }\n    },\n\n    /**\n     * Returns true if the specified control is visible, false otherwise.\n     * @param {String} controlName The name of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @returns {Boolean} true if the specified control is visible, false otherwise\n     */\n    isControlVisible: function(controlName) {\n      return this._getControlsVisibility()[controlName];\n    },\n\n    /**\n     * Sets the visibility of the specified control.\n     * @param {String} controlName The name of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @param {Boolean} visible true to set the specified control visible, false otherwise\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlVisible: function(controlName, visible) {\n      this._getControlsVisibility()[controlName] = visible;\n      return this;\n    },\n\n    /**\n     * Sets the visibility state of object controls.\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it\n     * @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it\n     * @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it\n     * @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it\n     * @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it\n     * @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it\n     * @param {Boolean} [options.tl] true to enable the top-left control, false to disable it\n     * @param {Boolean} [options.tr] true to enable the top-right control, false to disable it\n     * @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlsVisibility: function(options) {\n      options || (options = { });\n\n      for (var p in options) {\n        this.setControlVisible(p, options[p]);\n      }\n      return this;\n    },\n\n    /**\n     * Returns the instance of the control visibility set for this object.\n     * @private\n     * @returns {Object}\n     */\n    _getControlsVisibility: function() {\n      if (!this._controlsVisibility) {\n        this._controlsVisibility = {\n          tl: true,\n          tr: true,\n          br: true,\n          bl: true,\n          ml: true,\n          mt: true,\n          mr: true,\n          mb: true,\n          mtr: true\n        };\n      }\n      return this._controlsVisibility;\n    },\n\n    /**\n     * This callback function is called every time _discardActiveObject or _setActiveObject\n     * try to to deselect this object. If the function returns true, the process is cancelled\n     * @param {Object} [options] options sent from the upper functions\n     * @param {Event} [options.e] event if the process is generated by an event\n     */\n    onDeselect: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n\n    /**\n     * This callback function is called every time _discardActiveObject or _setActiveObject\n     * try to to select this object. If the function returns true, the process is cancelled\n     * @param {Object} [options] options sent from the upper functions\n     * @param {Event} [options.e] event if the process is generated by an event\n     */\n    onSelect: function() {\n      // implemented by sub-classes, as needed.\n    }\n  });\n})();\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Animation duration (in ms) for fx* methods\n   * @type Number\n   * @default\n   */\n  FX_DURATION: 500,\n\n  /**\n   * Centers object horizontally with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectH: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.left,\n      endValue: this.getCenter().left,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('left', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Centers object vertically with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectV: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.top,\n      endValue: this.getCenter().top,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('top', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Same as `fabric.Canvas#remove` but animated\n   * @param {fabric.Object} object Object to remove\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxRemove: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.opacity,\n      endValue: 0,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('opacity', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function () {\n        _this.remove(object);\n        onComplete();\n      }\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n  /**\n   * Animates object's properties\n   * @param {String|Object} property Property to animate (if string) or properties to animate (if object)\n   * @param {Number|Object} value Value to animate property to (if string was given first) or options object\n   * @return {fabric.Object} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#animation}\n   * @chainable\n   *\n   * As object  multiple properties\n   *\n   * object.animate({ left: ..., top: ... });\n   * object.animate({ left: ..., top: ... }, { duration: ... });\n   *\n   * As string  one property\n   *\n   * object.animate('left', ...);\n   * object.animate('left', { duration: ... });\n   *\n   */\n  animate: function() {\n    if (arguments[0] && typeof arguments[0] === 'object') {\n      var propsToAnimate = [], prop, skipCallbacks;\n      for (prop in arguments[0]) {\n        propsToAnimate.push(prop);\n      }\n      for (var i = 0, len = propsToAnimate.length; i < len; i++) {\n        prop = propsToAnimate[i];\n        skipCallbacks = i !== len - 1;\n        this._animate(prop, arguments[0][prop], arguments[1], skipCallbacks);\n      }\n    }\n    else {\n      this._animate.apply(this, arguments);\n    }\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to animate\n   * @param {String} to Value to animate to\n   * @param {Object} [options] Options object\n   * @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked\n   */\n  _animate: function(property, to, options, skipCallbacks) {\n    var _this = this, propPair;\n\n    to = to.toString();\n\n    if (!options) {\n      options = { };\n    }\n    else {\n      options = fabric.util.object.clone(options);\n    }\n\n    if (~property.indexOf('.')) {\n      propPair = property.split('.');\n    }\n\n    var currentValue = propPair\n      ? this.get(propPair[0])[propPair[1]]\n      : this.get(property);\n\n    if (!('from' in options)) {\n      options.from = currentValue;\n    }\n\n    if (~to.indexOf('=')) {\n      to = currentValue + parseFloat(to.replace('=', ''));\n    }\n    else {\n      to = parseFloat(to);\n    }\n\n    fabric.util.animate({\n      startValue: options.from,\n      endValue: to,\n      byValue: options.by,\n      easing: options.easing,\n      duration: options.duration,\n      abort: options.abort && function() {\n        return options.abort.call(_this);\n      },\n      onChange: function(value, valueProgress, timeProgress) {\n        if (propPair) {\n          _this[propPair[0]][propPair[1]] = value;\n        }\n        else {\n          _this.set(property, value);\n        }\n        if (skipCallbacks) {\n          return;\n        }\n        options.onChange && options.onChange(value, valueProgress, timeProgress);\n      },\n      onComplete: function(value, valueProgress, timeProgress) {\n        if (skipCallbacks) {\n          return;\n        }\n\n        _this.setCoords();\n        options.onComplete && options.onComplete(value, valueProgress, timeProgress);\n      }\n    });\n  }\n});\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      coordProps = { x1: 1, x2: 1, y1: 1, y2: 1 },\n      supportsLineDash = fabric.StaticCanvas.supports('setLineDash');\n\n  if (fabric.Line) {\n    fabric.warn('fabric.Line is already defined');\n    return;\n  }\n\n  /**\n   * Line class\n   * @class fabric.Line\n   * @extends fabric.Object\n   * @see {@link fabric.Line#initialize} for constructor definition\n   */\n  fabric.Line = fabric.util.createClass(fabric.Object, /** @lends fabric.Line.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'line',\n\n    /**\n     * x value or first line edge\n     * @type Number\n     * @default\n     */\n    x1: 0,\n\n    /**\n     * y value or first line edge\n     * @type Number\n     * @default\n     */\n    y1: 0,\n\n    /**\n     * x value or second line edge\n     * @type Number\n     * @default\n     */\n    x2: 0,\n\n    /**\n     * y value or second line edge\n     * @type Number\n     * @default\n     */\n    y2: 0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('x1', 'x2', 'y1', 'y2'),\n\n    /**\n     * Constructor\n     * @param {Array} [points] Array of points\n     * @param {Object} [options] Options object\n     * @return {fabric.Line} thisArg\n     */\n    initialize: function(points, options) {\n      if (!points) {\n        points = [0, 0, 0, 0];\n      }\n\n      this.callSuper('initialize', options);\n\n      this.set('x1', points[0]);\n      this.set('y1', points[1]);\n      this.set('x2', points[2]);\n      this.set('y2', points[3]);\n\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n\n      this.width = Math.abs(this.x2 - this.x1);\n      this.height = Math.abs(this.y2 - this.y1);\n\n      this.left = 'left' in options\n        ? options.left\n        : this._getLeftToOriginX();\n\n      this.top = 'top' in options\n        ? options.top\n        : this._getTopToOriginY();\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      if (typeof coordProps[key] !== 'undefined') {\n        this._setWidthHeight();\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @return {Number} leftToOriginX Distance from left edge of canvas to originX of Line.\n     */\n    _getLeftToOriginX: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originX',\n        axis1: 'x1',\n        axis2: 'x2',\n        dimension: 'width'\n      },\n      { // possible values of origin\n        nearest: 'left',\n        center: 'center',\n        farthest: 'right'\n      }\n    ),\n\n    /**\n     * @private\n     * @return {Number} topToOriginY Distance from top edge of canvas to originY of Line.\n     */\n    _getTopToOriginY: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originY',\n        axis1: 'y1',\n        axis2: 'y2',\n        dimension: 'height'\n      },\n      { // possible values of origin\n        nearest: 'top',\n        center: 'center',\n        farthest: 'bottom'\n      }\n    ),\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n\n      if (!this.strokeDashArray || this.strokeDashArray && supportsLineDash) {\n        // move from center (of virtual box) to its left/top corner\n        // we can't assume x1, y1 is top left and x2, y2 is bottom right\n        var p = this.calcLinePoints();\n        ctx.moveTo(p.x1, p.y1);\n        ctx.lineTo(p.x2, p.y2);\n      }\n\n      ctx.lineWidth = this.strokeWidth;\n\n      // TODO: test this\n      // make sure setting \"fill\" changes color of a line\n      // (by copying fillStyle to strokeStyle, since line is stroked, not filled)\n      var origStrokeStyle = ctx.strokeStyle;\n      ctx.strokeStyle = this.stroke || ctx.fillStyle;\n      this.stroke && this._renderStroke(ctx);\n      ctx.strokeStyle = origStrokeStyle;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var p = this.calcLinePoints();\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, p.x1, p.y1, p.x2, p.y2, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /**\n     * This function is an helper for svg import. it returns the center of the object in the svg\n     * untransformed coordinates\n     * @private\n     * @return {Object} center point from element coordinates\n     */\n    _findCenterFromElement: function() {\n      return {\n        x: (this.x1 + this.x2) / 2,\n        y: (this.y1 + this.y2) / 2,\n      };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @methd toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), this.calcLinePoints());\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     */\n    _getNonTransformedDimensions: function() {\n      var dim = this.callSuper('_getNonTransformedDimensions');\n      if (this.strokeLineCap === 'butt') {\n        if (this.width === 0) {\n          dim.y -= this.strokeWidth;\n        }\n        if (this.height === 0) {\n          dim.x -= this.strokeWidth;\n        }\n      }\n      return dim;\n    },\n\n    /**\n     * Recalculates line points given width and height\n     * @private\n     */\n    calcLinePoints: function() {\n      var xMult = this.x1 <= this.x2 ? -1 : 1,\n          yMult = this.y1 <= this.y2 ? -1 : 1,\n          x1 = (xMult * this.width * 0.5),\n          y1 = (yMult * this.height * 0.5),\n          x2 = (xMult * this.width * -0.5),\n          y2 = (yMult * this.height * -0.5);\n\n      return {\n        x1: x1,\n        x2: x2,\n        y1: y1,\n        y2: y2\n      };\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var p = this.calcLinePoints();\n      return [\n        '<line ', 'COMMON_PARTS',\n        'x1=\"', p.x1,\n        '\" y1=\"', p.y1,\n        '\" x2=\"', p.x2,\n        '\" y2=\"', p.y2,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})\n   * @static\n   * @memberOf fabric.Line\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\n   */\n  fabric.Line.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));\n\n  /**\n   * Returns fabric.Line instance from an SVG element\n   * @static\n   * @memberOf fabric.Line\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] callback function invoked after parsing\n   */\n  fabric.Line.fromElement = function(element, callback, options) {\n    options = options || { };\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Line.ATTRIBUTE_NAMES),\n        points = [\n          parsedAttributes.x1 || 0,\n          parsedAttributes.y1 || 0,\n          parsedAttributes.x2 || 0,\n          parsedAttributes.y2 || 0\n        ];\n    callback(new fabric.Line(points, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Line instance from an object representation\n   * @static\n   * @memberOf fabric.Line\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Line.fromObject = function(object, callback) {\n    function _callback(instance) {\n      delete instance.points;\n      callback && callback(instance);\n    };\n    var options = clone(object, true);\n    options.points = [object.x1, object.y1, object.x2, object.y2];\n    fabric.Object._fromObject('Line', options, _callback, 'points');\n  };\n\n  /**\n   * Produces a function that calculates distance from canvas edge to Line origin.\n   */\n  function makeEdgeToOriginGetter(propertyNames, originValues) {\n    var origin = propertyNames.origin,\n        axis1 = propertyNames.axis1,\n        axis2 = propertyNames.axis2,\n        dimension = propertyNames.dimension,\n        nearest = originValues.nearest,\n        center = originValues.center,\n        farthest = originValues.farthest;\n\n    return function() {\n      switch (this.get(origin)) {\n        case nearest:\n          return Math.min(this.get(axis1), this.get(axis2));\n        case center:\n          return Math.min(this.get(axis1), this.get(axis2)) + (0.5 * this.get(dimension));\n        case farthest:\n          return Math.max(this.get(axis1), this.get(axis2));\n      }\n    };\n\n  }\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      pi = Math.PI;\n\n  if (fabric.Circle) {\n    fabric.warn('fabric.Circle is already defined.');\n    return;\n  }\n\n  /**\n   * Circle class\n   * @class fabric.Circle\n   * @extends fabric.Object\n   * @see {@link fabric.Circle#initialize} for constructor definition\n   */\n  fabric.Circle = fabric.util.createClass(fabric.Object, /** @lends fabric.Circle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'circle',\n\n    /**\n     * Radius of this circle\n     * @type Number\n     * @default\n     */\n    radius: 0,\n\n    /**\n     * Start angle of the circle, moving clockwise\n     * deprectated type, this should be in degree, this was an oversight.\n     * probably will change to degrees in next major version\n     * @type Number\n     * @default 0\n     */\n    startAngle: 0,\n\n    /**\n     * End angle of the circle\n     * deprectated type, this should be in degree, this was an oversight.\n     * probably will change to degrees in next major version\n     * @type Number\n     * @default 2Pi\n     */\n    endAngle: pi * 2,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('radius', 'startAngle', 'endAngle'),\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Circle} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n\n      if (key === 'radius') {\n        this.setRadius(value);\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['radius', 'startAngle', 'endAngle'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var svgString, x = 0, y = 0,\n          angle = (this.endAngle - this.startAngle) % ( 2 * pi);\n\n      if (angle === 0) {\n        svgString = [\n          '<circle ', 'COMMON_PARTS',\n          'cx=\"' + x + '\" cy=\"' + y + '\" ',\n          'r=\"', this.radius,\n          '\" />\\n'\n        ];\n      }\n      else {\n        var startX = fabric.util.cos(this.startAngle) * this.radius,\n            startY = fabric.util.sin(this.startAngle) * this.radius,\n            endX = fabric.util.cos(this.endAngle) * this.radius,\n            endY = fabric.util.sin(this.endAngle) * this.radius,\n            largeFlag = angle > pi ? '1' : '0';\n        svgString = [\n          '<path d=\"M ' + startX + ' ' + startY,\n          ' A ' + this.radius + ' ' + this.radius,\n          ' 0 ', +largeFlag + ' 1', ' ' + endX + ' ' + endY,\n          '\"', 'COMMON_PARTS', ' />\\n'\n        ];\n      }\n      return svgString;\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n      ctx.arc(\n        0,\n        0,\n        this.radius,\n        this.startAngle,\n        this.endAngle, false);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusX: function() {\n      return this.get('radius') * this.get('scaleX');\n    },\n\n    /**\n     * Returns vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusY: function() {\n      return this.get('radius') * this.get('scaleY');\n    },\n\n    /**\n     * Sets radius of an object (and updates width accordingly)\n     * @return {fabric.Circle} thisArg\n     */\n    setRadius: function(value) {\n      this.radius = value;\n      return this.set('width', value * 2).set('height', value * 2);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\n   * @static\n   * @memberOf fabric.Circle\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\n   */\n  fabric.Circle.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));\n\n  /**\n   * Returns {@link fabric.Circle} instance from an SVG element\n   * @static\n   * @memberOf fabric.Circle\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @param {Object} [options] Options object\n   * @throws {Error} If value of `r` attribute is missing or invalid\n   */\n  fabric.Circle.fromElement = function(element, callback) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Circle.ATTRIBUTE_NAMES);\n\n    if (!isValidRadius(parsedAttributes)) {\n      throw new Error('value of `r` attribute is required and can not be negative');\n    }\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.radius;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.radius;\n    callback(new fabric.Circle(parsedAttributes));\n  };\n\n  /**\n   * @private\n   */\n  function isValidRadius(attributes) {\n    return (('radius' in attributes) && (attributes.radius >= 0));\n  }\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Circle} instance from an object representation\n   * @static\n   * @memberOf fabric.Circle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {Object} Instance of fabric.Circle\n   */\n  fabric.Circle.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Circle', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Triangle) {\n    fabric.warn('fabric.Triangle is already defined');\n    return;\n  }\n\n  /**\n   * Triangle class\n   * @class fabric.Triangle\n   * @extends fabric.Object\n   * @return {fabric.Triangle} thisArg\n   * @see {@link fabric.Triangle#initialize} for constructor definition\n   */\n  fabric.Triangle = fabric.util.createClass(fabric.Object, /** @lends fabric.Triangle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'triangle',\n\n    /**\n     * Width is set to 100 to compensate the old initialize code that was setting it to 100\n     * @type Number\n     * @default\n     */\n    width: 100,\n\n    /**\n     * Height is set to 100 to compensate the old initialize code that was setting it to 100\n     * @type Number\n     * @default\n     */\n    height: 100,\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      ctx.moveTo(-widthBy2, heightBy2);\n      ctx.lineTo(0, -heightBy2);\n      ctx.lineTo(widthBy2, heightBy2);\n      ctx.closePath();\n\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, -widthBy2, heightBy2, 0, -heightBy2, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, 0, -heightBy2, widthBy2, heightBy2, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, widthBy2, heightBy2, -widthBy2, heightBy2, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2,\n          points = [\n            -widthBy2 + ' ' + heightBy2,\n            '0 ' + -heightBy2,\n            widthBy2 + ' ' + heightBy2\n          ].join(',');\n      return [\n        '<polygon ', 'COMMON_PARTS',\n        'points=\"', points,\n        '\" />'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Triangle} instance from an object representation\n   * @static\n   * @memberOf fabric.Triangle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Triangle.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Triangle', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      piBy2   = Math.PI * 2;\n\n  if (fabric.Ellipse) {\n    fabric.warn('fabric.Ellipse is already defined.');\n    return;\n  }\n\n  /**\n   * Ellipse class\n   * @class fabric.Ellipse\n   * @extends fabric.Object\n   * @return {fabric.Ellipse} thisArg\n   * @see {@link fabric.Ellipse#initialize} for constructor definition\n   */\n  fabric.Ellipse = fabric.util.createClass(fabric.Object, /** @lends fabric.Ellipse.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'ellipse',\n\n    /**\n     * Horizontal radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {fabric.Ellipse} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('rx', options && options.rx || 0);\n      this.set('ry', options && options.ry || 0);\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Ellipse} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      switch (key) {\n\n        case 'rx':\n          this.rx = value;\n          this.set('width', value * 2);\n          break;\n\n        case 'ry':\n          this.ry = value;\n          this.set('height', value * 2);\n          break;\n\n      }\n      return this;\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRx: function() {\n      return this.get('rx') * this.get('scaleX');\n    },\n\n    /**\n     * Returns Vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRy: function() {\n      return this.get('ry') * this.get('scaleY');\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      return [\n        '<ellipse ', 'COMMON_PARTS',\n        'cx=\"0\" cy=\"0\" ',\n        'rx=\"', this.rx,\n        '\" ry=\"', this.ry,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n      ctx.save();\n      ctx.transform(1, 0, 0, this.ry / this.rx, 0, 0);\n      ctx.arc(\n        0,\n        0,\n        this.rx,\n        0,\n        piBy2,\n        false);\n      ctx.restore();\n      this._renderPaintInOrder(ctx);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\n   * @static\n   * @memberOf fabric.Ellipse\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */\n  fabric.Ellipse.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an SVG element\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromElement = function(element, callback) {\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Ellipse.ATTRIBUTE_NAMES);\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.rx;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.ry;\n    callback(new fabric.Ellipse(parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an object representation\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Ellipse', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.Rect) {\n    fabric.warn('fabric.Rect is already defined');\n    return;\n  }\n\n  /**\n   * Rectangle class\n   * @class fabric.Rect\n   * @extends fabric.Object\n   * @return {fabric.Rect} thisArg\n   * @see {@link fabric.Rect#initialize} for constructor definition\n   */\n  fabric.Rect = fabric.util.createClass(fabric.Object, /** @lends fabric.Rect.prototype */ {\n\n    /**\n     * List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('rx', 'ry'),\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'rect',\n\n    /**\n     * Horizontal border radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical border radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this._initRxRy();\n    },\n\n    /**\n     * Initializes rx/ry attributes\n     * @private\n     */\n    _initRxRy: function() {\n      if (this.rx && !this.ry) {\n        this.ry = this.rx;\n      }\n      else if (this.ry && !this.rx) {\n        this.rx = this.ry;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n\n      // 1x1 case (used in spray brush) optimization was removed because\n      // with caching and higher zoom level this makes more damage than help\n\n      var rx = this.rx ? Math.min(this.rx, this.width / 2) : 0,\n          ry = this.ry ? Math.min(this.ry, this.height / 2) : 0,\n          w = this.width,\n          h = this.height,\n          x = -this.width / 2,\n          y = -this.height / 2,\n          isRounded = rx !== 0 || ry !== 0,\n          /* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */\n          k = 1 - 0.5522847498;\n      ctx.beginPath();\n\n      ctx.moveTo(x + rx, y);\n\n      ctx.lineTo(x + w - rx, y);\n      isRounded && ctx.bezierCurveTo(x + w - k * rx, y, x + w, y + k * ry, x + w, y + ry);\n\n      ctx.lineTo(x + w, y + h - ry);\n      isRounded && ctx.bezierCurveTo(x + w, y + h - k * ry, x + w - k * rx, y + h, x + w - rx, y + h);\n\n      ctx.lineTo(x + rx, y + h);\n      isRounded && ctx.bezierCurveTo(x + k * rx, y + h, x, y + h - k * ry, x, y + h - ry);\n\n      ctx.lineTo(x, y + ry);\n      isRounded && ctx.bezierCurveTo(x, y + k * ry, x + k * rx, y, x + rx, y);\n\n      ctx.closePath();\n\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var x = -this.width / 2, y = -this.height / 2;\n      return [\n        '<rect ', 'COMMON_PARTS',\n        'x=\"', x, '\" y=\"', y,\n        '\" rx=\"', this.rx, '\" ry=\"', this.ry,\n        '\" width=\"', this.width, '\" height=\"', this.height,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\n   * @static\n   * @memberOf fabric.Rect\n   * @see: http://www.w3.org/TR/SVG/shapes.html#RectElement\n   */\n  fabric.Rect.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));\n\n  /**\n   * Returns {@link fabric.Rect} instance from an SVG element\n   * @static\n   * @memberOf fabric.Rect\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Rect.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n    options = options || { };\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Rect.ATTRIBUTE_NAMES);\n\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top  = parsedAttributes.top  || 0;\n    var rect = new fabric.Rect(extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n    rect.visible = rect.visible && rect.width > 0 && rect.height > 0;\n    callback(rect);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Rect} instance from an object representation\n   * @static\n   * @memberOf fabric.Rect\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Rect instance is created\n   */\n  fabric.Rect.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Rect', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Polyline) {\n    fabric.warn('fabric.Polyline is already defined');\n    return;\n  }\n\n  /**\n   * Polyline class\n   * @class fabric.Polyline\n   * @extends fabric.Object\n   * @see {@link fabric.Polyline#initialize} for constructor definition\n   */\n  fabric.Polyline = fabric.util.createClass(fabric.Object, /** @lends fabric.Polyline.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polyline',\n\n    /**\n     * Points array\n     * @type Array\n     * @default\n     */\n    points: null,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('points'),\n\n    /**\n     * Constructor\n     * @param {Array} points Array of points (where each point is an object with x and y)\n     * @param {Object} [options] Options object\n     * @return {fabric.Polyline} thisArg\n     * @example\n     * var poly = new fabric.Polyline([\n     *     { x: 10, y: 10 },\n     *     { x: 50, y: 30 },\n     *     { x: 40, y: 70 },\n     *     { x: 60, y: 50 },\n     *     { x: 100, y: 150 },\n     *     { x: 40, y: 100 }\n     *   ], {\n     *   stroke: 'red',\n     *   left: 100,\n     *   top: 100\n     * });\n     */\n    initialize: function(points, options) {\n      options = options || {};\n      this.points = points || [];\n      this.callSuper('initialize', options);\n      var calcDim = this._calcDimensions();\n      if (typeof options.left === 'undefined') {\n        this.left = calcDim.left;\n      }\n      if (typeof options.top === 'undefined') {\n        this.top = calcDim.top;\n      }\n      this.width = calcDim.width;\n      this.height = calcDim.height;\n      this.pathOffset = {\n        x: calcDim.left + this.width / 2,\n        y: calcDim.top + this.height / 2\n      };\n    },\n\n    /**\n     * Calculate the polygon min and max point from points array,\n     * returning an object with left, top, widht, height to measure the\n     * polygon size\n     * @return {Object} object.left X coordinate of the polygon leftmost point\n     * @return {Object} object.top Y coordinate of the polygon topmost point\n     * @return {Object} object.width distance between X coordinates of the polygon leftmost and rightmost point\n     * @return {Object} object.height distance between Y coordinates of the polygon topmost and bottommost point\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var points = this.points,\n          minX = min(points, 'x') || 0,\n          minY = min(points, 'y') || 0,\n          maxX = max(points, 'x') || 0,\n          maxY = max(points, 'y') || 0,\n          width = (maxX - minX),\n          height = (maxY - minY);\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height\n      };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        points: this.points.concat()\n      });\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var points = [], diffX = this.pathOffset.x, diffY = this.pathOffset.y,\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        points.push(\n          toFixed(this.points[i].x - diffX, NUM_FRACTION_DIGITS), ',',\n          toFixed(this.points[i].y - diffY, NUM_FRACTION_DIGITS), ' '\n        );\n      }\n      return [\n        '<' + this.type + ' ', 'COMMON_PARTS',\n        'points=\"', points.join(''),\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    commonRender: function(ctx) {\n      var point, len = this.points.length,\n          x = this.pathOffset.x,\n          y = this.pathOffset.y;\n\n      if (!len || isNaN(this.points[len - 1].y)) {\n        // do not draw if no points or odd points\n        // NaN comes from parseFloat of a empty string in parser\n        return false;\n      }\n      ctx.beginPath();\n      ctx.moveTo(this.points[0].x - x, this.points[0].y - y);\n      for (var i = 0; i < len; i++) {\n        point = this.points[i];\n        ctx.lineTo(point.x - x, point.y - y);\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (!this.commonRender(ctx)) {\n        return;\n      }\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var p1, p2;\n\n      ctx.beginPath();\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        p1 = this.points[i];\n        p2 = this.points[i + 1] || p1;\n        fabric.util.drawDashedLine(ctx, p1.x, p1.y, p2.x, p2.y, this.strokeDashArray);\n      }\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.get('points').length;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})\n   * @static\n   * @memberOf fabric.Polyline\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\n   */\n  fabric.Polyline.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns fabric.Polyline instance from an SVG element\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {SVGElement} element Element to parser\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polyline.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n    options || (options = { });\n\n    var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n        parsedAttributes = fabric.parseAttributes(element, fabric.Polyline.ATTRIBUTE_NAMES);\n\n    callback(new fabric.Polyline(points, fabric.util.object.extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polyline instance from an object representation\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Polyline.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Polyline', object, callback, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.Polygon) {\n    fabric.warn('fabric.Polygon is already defined');\n    return;\n  }\n\n  /**\n   * Polygon class\n   * @class fabric.Polygon\n   * @extends fabric.Polyline\n   * @see {@link fabric.Polygon#initialize} for constructor definition\n   */\n  fabric.Polygon = fabric.util.createClass(fabric.Polyline, /** @lends fabric.Polygon.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polygon',\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (!this.commonRender(ctx)) {\n        return;\n      }\n      ctx.closePath();\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      this.callSuper('_renderDashedStroke', ctx);\n      ctx.closePath();\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\n   * @static\n   * @memberOf fabric.Polygon\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\n   */\n  fabric.Polygon.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns {@link fabric.Polygon} instance from an SVG element\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polygon.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n\n    options || (options = { });\n\n    var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n        parsedAttributes = fabric.parseAttributes(element, fabric.Polygon.ATTRIBUTE_NAMES);\n\n    callback(new fabric.Polygon(points, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polygon instance from an object representation\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Polygon.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Polygon', object, callback, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      extend = fabric.util.object.extend,\n      _toString = Object.prototype.toString,\n      drawArc = fabric.util.drawArc,\n      toFixed = fabric.util.toFixed,\n      commandLengths = {\n        m: 2,\n        l: 2,\n        h: 1,\n        v: 1,\n        c: 6,\n        s: 4,\n        q: 4,\n        t: 2,\n        a: 7\n      },\n      repeatedCommands = {\n        m: 'l',\n        M: 'L'\n      };\n\n  if (fabric.Path) {\n    fabric.warn('fabric.Path is already defined');\n    return;\n  }\n\n  /**\n   * Path class\n   * @class fabric.Path\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.Path#initialize} for constructor definition\n   */\n  fabric.Path = fabric.util.createClass(fabric.Object, /** @lends fabric.Path.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'path',\n\n    /**\n     * Array of path points\n     * @type Array\n     * @default\n     */\n    path: null,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('path', 'fillRule'),\n\n    stateProperties: fabric.Object.prototype.stateProperties.concat('path'),\n\n    /**\n     * Constructor\n     * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n     * @param {Object} [options] Options object\n     * @return {fabric.Path} thisArg\n     */\n    initialize: function(path, options) {\n      options = options || { };\n      this.callSuper('initialize', options);\n\n      if (!path) {\n        path = [];\n      }\n\n      var fromArray = _toString.call(path) === '[object Array]';\n\n      this.path = fromArray\n        ? path\n        // one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\n        : path.match && path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);\n\n      if (!this.path) {\n        return;\n      }\n\n      if (!fromArray) {\n        this.path = this._parsePath();\n      }\n\n      this._setPositionDimensions(options);\n    },\n\n    /**\n     * @private\n     * @param {Object} options Options object\n     */\n    _setPositionDimensions: function(options) {\n      var calcDim = this._parseDimensions();\n\n      this.width = calcDim.width;\n      this.height = calcDim.height;\n\n      if (typeof options.left === 'undefined') {\n        this.left = calcDim.left;\n      }\n\n      if (typeof options.top === 'undefined') {\n        this.top = calcDim.top;\n      }\n\n      this.pathOffset = this.pathOffset || {\n        x: calcDim.left + this.width / 2,\n        y: calcDim.top + this.height / 2\n      };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _renderPathCommands: function(ctx) {\n      var current, // current instruction\n          previous = null,\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          tempX,\n          tempY,\n          l = -this.pathOffset.x,\n          t = -this.pathOffset.y;\n\n      ctx.beginPath();\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'l': // lineto, relative\n            x += current[1];\n            y += current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'h': // horizontal lineto, relative\n            x += current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'H': // horizontal lineto, absolute\n            x = current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'v': // vertical lineto, relative\n            y += current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'V': // verical lineto, absolute\n            y = current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'm': // moveTo, relative\n            x += current[1];\n            y += current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'c': // bezierCurveTo, relative\n            tempX = x + current[5];\n            tempY = y + current[6];\n            controlX = x + current[3];\n            controlY = y + current[4];\n            ctx.bezierCurveTo(\n              x + current[1] + l, // x1\n              y + current[2] + t, // y1\n              controlX + l, // x2\n              controlY + t, // y2\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            x = current[5];\n            y = current[6];\n            controlX = current[3];\n            controlY = current[4];\n            ctx.bezierCurveTo(\n              current[1] + l,\n              current[2] + t,\n              controlX + l,\n              controlY + t,\n              x + l,\n              y + t\n            );\n            break;\n\n          case 's': // shorthand cubic bezierCurveTo, relative\n\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            ctx.bezierCurveTo(\n              controlX + l,\n              controlY + t,\n              x + current[1] + l,\n              y + current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = x + current[1];\n            controlY = y + current[2];\n\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'S': // shorthand cubic bezierCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            ctx.bezierCurveTo(\n              controlX + l,\n              controlY + t,\n              current[1] + l,\n              current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = current[1];\n            controlY = current[2];\n\n            break;\n\n          case 'q': // quadraticCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n\n            controlX = x + current[1];\n            controlY = y + current[2];\n\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n\n            ctx.quadraticCurveTo(\n              current[1] + l,\n              current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 't': // shorthand quadraticCurveTo, relative\n\n            // transform to absolute x,y\n            tempX = x + current[1];\n            tempY = y + current[2];\n\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n\n            break;\n\n          case 'T':\n            tempX = current[1];\n            tempY = current[2];\n\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'a':\n            // TODO: optimize this\n            drawArc(ctx, x + l, y + t, [\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + x + l,\n              current[7] + y + t\n            ]);\n            x += current[6];\n            y += current[7];\n            break;\n\n          case 'A':\n            // TODO: optimize this\n            drawArc(ctx, x + l, y + t, [\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + l,\n              current[7] + t\n            ]);\n            x = current[6];\n            y = current[7];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            ctx.closePath();\n            break;\n        }\n        previous = current;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _render: function(ctx) {\n      this._renderPathCommands(ctx);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Path (' + this.complexity() +\n        '): { \"top\": ' + this.top + ', \"left\": ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var o = extend(this.callSuper('toObject', propertiesToInclude), {\n        path: this.path.map(function(item) { return item.slice(); }),\n        top: this.top,\n        left: this.left,\n      });\n      return o;\n    },\n\n    /**\n     * Returns dataless object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var o = this.toObject(['sourcePath'].concat(propertiesToInclude));\n      if (o.sourcePath) {\n        delete o.path;\n      }\n      return o;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var path = this.path.map(function(path) {\n        return path.join(' ');\n      }).join(' ');\n      return [\n        '<path ', 'COMMON_PARTS',\n        'd=\"', path,\n        '\" stroke-linecap=\"round\" ',\n        '/>\\n'\n      ];\n    },\n\n    _getOffsetTransform: function() {\n      var digits = fabric.Object.NUM_FRACTION_DIGITS;\n      return ' translate(' + toFixed(-this.pathOffset.x, digits) + ', ' +\n          toFixed(-this.pathOffset.y, digits) + ')';\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      var additionalTransform = this._getOffsetTransform();\n      return '\\t' + this._createBaseClipPathSVGMarkup(\n        this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform }\n      );\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var additionalTransform = this._getOffsetTransform();\n      return this._createBaseSVGMarkup(this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform  });\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns number representation of an instance complexity\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.path.length;\n    },\n\n    /**\n     * @private\n     */\n    _parsePath: function() {\n      var result = [],\n          coords = [],\n          currentPath,\n          parsed,\n          re = /([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:e[-+]?\\d+)?)/ig,\n          match,\n          coordsStr;\n\n      for (var i = 0, coordsParsed, len = this.path.length; i < len; i++) {\n        currentPath = this.path[i];\n\n        coordsStr = currentPath.slice(1).trim();\n        coords.length = 0;\n\n        while ((match = re.exec(coordsStr))) {\n          coords.push(match[0]);\n        }\n\n        coordsParsed = [currentPath.charAt(0)];\n\n        for (var j = 0, jlen = coords.length; j < jlen; j++) {\n          parsed = parseFloat(coords[j]);\n          if (!isNaN(parsed)) {\n            coordsParsed.push(parsed);\n          }\n        }\n\n        var command = coordsParsed[0],\n            commandLength = commandLengths[command.toLowerCase()],\n            repeatedCommand = repeatedCommands[command] || command;\n\n        if (coordsParsed.length - 1 > commandLength) {\n          for (var k = 1, klen = coordsParsed.length; k < klen; k += commandLength) {\n            result.push([command].concat(coordsParsed.slice(k, k + commandLength)));\n            command = repeatedCommand;\n          }\n        }\n        else {\n          result.push(coordsParsed);\n        }\n      }\n\n      return result;\n    },\n\n    /**\n     * @private\n     */\n    _parseDimensions: function() {\n\n      var aX = [],\n          aY = [],\n          current, // current instruction\n          previous = null,\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          tempX,\n          tempY,\n          bounds;\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'l': // lineto, relative\n            x += current[1];\n            y += current[2];\n            bounds = [];\n            break;\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            bounds = [];\n            break;\n\n          case 'h': // horizontal lineto, relative\n            x += current[1];\n            bounds = [];\n            break;\n\n          case 'H': // horizontal lineto, absolute\n            x = current[1];\n            bounds = [];\n            break;\n\n          case 'v': // vertical lineto, relative\n            y += current[1];\n            bounds = [];\n            break;\n\n          case 'V': // verical lineto, absolute\n            y = current[1];\n            bounds = [];\n            break;\n\n          case 'm': // moveTo, relative\n            x += current[1];\n            y += current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            bounds = [];\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            bounds = [];\n            break;\n\n          case 'c': // bezierCurveTo, relative\n            tempX = x + current[5];\n            tempY = y + current[6];\n            controlX = x + current[3];\n            controlY = y + current[4];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              x + current[1], // x1\n              y + current[2], // y1\n              controlX, // x2\n              controlY, // y2\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            controlX = current[3];\n            controlY = current[4];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              controlX,\n              controlY,\n              current[5],\n              current[6]\n            );\n            x = current[5];\n            y = current[6];\n            break;\n\n          case 's': // shorthand cubic bezierCurveTo, relative\n\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              x + current[1],\n              y + current[2],\n              tempX,\n              tempY\n            );\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = x + current[1];\n            controlY = y + current[2];\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'S': // shorthand cubic bezierCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              current[1],\n              current[2],\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 'q': // quadraticCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n            controlX = x + current[1];\n            controlY = y + current[2];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            controlX = current[1];\n            controlY = current[2];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              current[3],\n              current[4]\n            );\n            x = current[3];\n            y = current[4];\n            break;\n\n          case 't': // shorthand quadraticCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[1];\n            tempY = y + current[2];\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n\n            break;\n\n          case 'T':\n            tempX = current[1];\n            tempY = current[2];\n\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'a':\n            // TODO: optimize this\n            bounds = fabric.util.getBoundsOfArc(x, y,\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + x,\n              current[7] + y\n            );\n            x += current[6];\n            y += current[7];\n            break;\n\n          case 'A':\n            // TODO: optimize this\n            bounds = fabric.util.getBoundsOfArc(x, y,\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6],\n              current[7]\n            );\n            x = current[6];\n            y = current[7];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            break;\n        }\n        previous = current;\n        bounds.forEach(function (point) {\n          aX.push(point.x);\n          aY.push(point.y);\n        });\n        aX.push(x);\n        aY.push(y);\n      }\n\n      var minX = min(aX) || 0,\n          minY = min(aY) || 0,\n          maxX = max(aX) || 0,\n          maxY = max(aY) || 0,\n          deltaX = maxX - minX,\n          deltaY = maxY - minY,\n\n          o = {\n            left: minX,\n            top: minY,\n            width: deltaX,\n            height: deltaY\n          };\n\n      return o;\n    }\n  });\n\n  /**\n   * Creates an instance of fabric.Path from an object\n   * @static\n   * @memberOf fabric.Path\n   * @param {Object} object\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Path.fromObject = function(object, callback) {\n    if (typeof object.sourcePath === 'string') {\n      var pathUrl = object.sourcePath;\n      fabric.loadSVGFromURL(pathUrl, function (elements) {\n        var path = elements[0];\n        path.setOptions(object);\n        callback && callback(path);\n      });\n    }\n    else {\n      fabric.Object._fromObject('Path', object, callback, 'path');\n    }\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\n   * @static\n   * @memberOf fabric.Path\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */\n  fabric.Path.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(['d']);\n\n  /**\n   * Creates an instance of fabric.Path from an SVG <path> element\n   * @static\n   * @memberOf fabric.Path\n   * @param {SVGElement} element to parse\n   * @param {Function} callback Callback to invoke when an fabric.Path instance is created\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   */\n  fabric.Path.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Path.ATTRIBUTE_NAMES);\n    callback(new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max;\n\n  if (fabric.Group) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.Group\n   * @extends fabric.Object\n   * @mixes fabric.Collection\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.Group#initialize} for constructor definition\n   */\n  fabric.Group = fabric.util.createClass(fabric.Object, fabric.Collection, /** @lends fabric.Group.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'group',\n\n    /**\n     * Width of stroke\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * Indicates if click events should also check for subtargets\n     * @type Boolean\n     * @default\n     */\n    subTargetCheck: false,\n\n    /**\n     * Groups are container, do not render anything on theyr own, ence no cache properties\n     * @type Array\n     * @default\n     */\n    cacheProperties: [],\n\n    /**\n     * setOnGroup is a method used for TextBox that is no more used since 2.0.0 The behavior is still\n     * available setting this boolean to true.\n     * @type Boolean\n     * @since 2.0.0\n     * @default\n     */\n    useSetOnGroup: false,\n\n    /**\n     * Constructor\n     * @param {Object} objects Group objects\n     * @param {Object} [options] Options object\n     * @param {Boolean} [isAlreadyGrouped] if true, objects have been grouped already.\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options, isAlreadyGrouped) {\n      options = options || {};\n      this._objects = [];\n      // if objects enclosed in a group have been grouped already,\n      // we cannot change properties of objects.\n      // Thus we need to set options to group without objects,\n      isAlreadyGrouped && this.callSuper('initialize', options);\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (!isAlreadyGrouped) {\n        var center = options && options.centerPoint;\n        // we want to set origins before calculating the bounding box.\n        // so that the topleft can be set with that in mind.\n        // if specific top and left are passed, are overwritten later\n        // with the callSuper('initialize', options)\n        if (options.originX !== undefined) {\n          this.originX = options.originX;\n        }\n        if (options.originY !== undefined) {\n          this.originY = options.originY;\n        }\n        // if coming from svg i do not want to calc bounds.\n        // i assume width and height are passed along options\n        center || this._calcBounds();\n        this._updateObjectsCoords(center);\n        delete options.centerPoint;\n        this.callSuper('initialize', options);\n      }\n      else {\n        this._updateObjectsACoords();\n      }\n\n      this.setCoords();\n    },\n\n    /**\n     * @private\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n     */\n    _updateObjectsACoords: function() {\n      var ignoreZoom = true, skipAbsolute = true;\n      for (var i = this._objects.length; i--; ){\n        this._objects[i].setCoords(ignoreZoom, skipAbsolute);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n     */\n    _updateObjectsCoords: function(center) {\n      var center = center || this.getCenterPoint();\n      for (var i = this._objects.length; i--; ){\n        this._updateObjectCoords(this._objects[i], center);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     * @param {fabric.Point} center, current center of group.\n     */\n    _updateObjectCoords: function(object, center) {\n      var objectLeft = object.left,\n          objectTop = object.top,\n          ignoreZoom = true, skipAbsolute = true;\n\n      object.set({\n        left: objectLeft - center.x,\n        top: objectTop - center.y\n      });\n      object.group = this;\n      object.setCoords(ignoreZoom, skipAbsolute);\n    },\n\n    /**\n     * Returns string represenation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.Group: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Adds an object to a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    addWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n      if (object) {\n        this._objects.push(object);\n        object.group = this;\n        object._set('canvas', this.canvas);\n      }\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * Removes an object from a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    removeWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n\n      this.remove(object);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _onObjectAdded: function(object) {\n      this.dirty = true;\n      object.group = this;\n      object._set('canvas', this.canvas);\n    },\n\n    /**\n     * @private\n     */\n    _onObjectRemoved: function(object) {\n      this.dirty = true;\n      delete object.group;\n    },\n\n    /**\n     * @private\n     */\n    _set: function(key, value) {\n      var i = this._objects.length;\n      if (this.useSetOnGroup) {\n        while (i--) {\n          this._objects[i].setOnGroup(key, value);\n        }\n      }\n      if (key === 'canvas') {\n        while (i--) {\n          this._objects[i]._set(key, value);\n        }\n      }\n      fabric.Object.prototype._set.call(this, key, value);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var _includeDefaultValues = this.includeDefaultValues;\n      var objsToObject = this._objects.map(function(obj) {\n        var originalDefaults = obj.includeDefaultValues;\n        obj.includeDefaultValues = _includeDefaultValues;\n        var _obj = obj.toObject(propertiesToInclude);\n        obj.includeDefaultValues = originalDefaults;\n        return _obj;\n      });\n      var obj = fabric.Object.prototype.toObject.call(this, propertiesToInclude);\n      obj.objects = objsToObject;\n      return obj;\n    },\n\n    /**\n     * Returns object representation of an instance, in dataless mode.\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var objsToObject, sourcePath = this.sourcePath;\n      if (sourcePath) {\n        objsToObject = sourcePath;\n      }\n      else {\n        var _includeDefaultValues = this.includeDefaultValues;\n        objsToObject = this._objects.map(function(obj) {\n          var originalDefaults = obj.includeDefaultValues;\n          obj.includeDefaultValues = _includeDefaultValues;\n          var _obj = obj.toDatalessObject(propertiesToInclude);\n          obj.includeDefaultValues = originalDefaults;\n          return _obj;\n        });\n      }\n      var obj = fabric.Object.prototype.toDatalessObject.call(this, propertiesToInclude);\n      obj.objects = objsToObject;\n      return obj;\n    },\n\n    /**\n     * Renders instance on a given context\n     * @param {CanvasRenderingContext2D} ctx context to render instance on\n     */\n    render: function(ctx) {\n      this._transformDone = true;\n      this.callSuper('render', ctx);\n      this._transformDone = false;\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      var ownCache = this.objectCaching && (!this.group || this.needsItsOwnCache() || !this.group.isOnACache());\n      this.ownCaching = ownCache;\n      if (ownCache) {\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          if (this._objects[i].willDrawShadow()) {\n            this.ownCaching = false;\n            return false;\n          }\n        }\n      }\n      return ownCache;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      if (this.shadow) {\n        return fabric.Object.prototype.willDrawShadow.call(this);\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].willDrawShadow()) {\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isOnACache: function() {\n      return this.ownCaching || (this.group && this.group.isOnACache());\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawObject: function(ctx) {\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i].render(ctx);\n      }\n      this._drawClipPath(ctx);\n    },\n\n    /**\n     * Check if cache is dirty\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.callSuper('isCacheDirty', skipCanvas)) {\n        return true;\n      }\n      if (!this.statefullCache) {\n        return false;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].isCacheDirty(true)) {\n          if (this._cacheCanvas) {\n            // if this group has not a cache canvas there is nothing to clean\n            var x = this.cacheWidth / this.zoomX, y = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Retores original state of each of group objects (original state is that which was before group was created).\n     * @private\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    _restoreObjectsState: function() {\n      this._objects.forEach(this._restoreObjectState, this);\n      return this;\n    },\n\n    /**\n     * Realises the transform from this group onto the supplied object\n     * i.e. it tells you what would happen if the supplied object was in\n     * the group, and then the group was destroyed. It mutates the supplied\n     * object.\n     * @param {fabric.Object} object\n     * @return {fabric.Object} transformedObject\n     */\n    realizeTransform: function(object) {\n      var matrix = object.calcTransformMatrix(),\n          options = fabric.util.qrDecompose(matrix),\n          center = new fabric.Point(options.translateX, options.translateY);\n      object.flipX = false;\n      object.flipY = false;\n      object.set('scaleX', options.scaleX);\n      object.set('scaleY', options.scaleY);\n      object.skewX = options.skewX;\n      object.skewY = options.skewY;\n      object.angle = options.angle;\n      object.setPositionByOrigin(center, 'center', 'center');\n      return object;\n    },\n\n    /**\n     * Restores original state of a specified object in group\n     * @private\n     * @param {fabric.Object} object\n     * @return {fabric.Group} thisArg\n     */\n    _restoreObjectState: function(object) {\n      this.realizeTransform(object);\n      object.setCoords();\n      delete object.group;\n      return this;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    destroy: function() {\n      // when group is destroyed objects needs to get a repaint to be eventually\n      // displayed on canvas.\n      this._objects.forEach(function(object) {\n        object.set('dirty', true);\n      });\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * make a group an active selection, remove the group from canvas\n     * the group has to be on canvas for this to work.\n     * @return {fabric.ActiveSelection} thisArg\n     * @chainable\n     */\n    toActiveSelection: function() {\n      if (!this.canvas) {\n        return;\n      }\n      var objects = this._objects, canvas = this.canvas;\n      this._objects = [];\n      var options = this.toObject();\n      delete options.objects;\n      var activeSelection = new fabric.ActiveSelection([]);\n      activeSelection.set(options);\n      activeSelection.type = 'activeSelection';\n      canvas.remove(this);\n      objects.forEach(function(object) {\n        object.group = activeSelection;\n        object.dirty = true;\n        canvas.add(object);\n      });\n      activeSelection.canvas = canvas;\n      activeSelection._objects = objects;\n      canvas._activeObject = activeSelection;\n      activeSelection.setCoords();\n      return activeSelection;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    ungroupOnCanvas: function() {\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * Sets coordinates of all objects inside group\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    setObjectsCoords: function() {\n      var ignoreZoom = true, skipAbsolute = true;\n      this.forEachObject(function(object) {\n        object.setCoords(ignoreZoom, skipAbsolute);\n      });\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _calcBounds: function(onlyWidthHeight) {\n      var aX = [],\n          aY = [],\n          o, prop,\n          props = ['tr', 'br', 'bl', 'tl'],\n          i = 0, iLen = this._objects.length,\n          j, jLen = props.length,\n          ignoreZoom = true;\n\n      for ( ; i < iLen; ++i) {\n        o = this._objects[i];\n        o.setCoords(ignoreZoom);\n        for (j = 0; j < jLen; j++) {\n          prop = props[j];\n          aX.push(o.oCoords[prop].x);\n          aY.push(o.oCoords[prop].y);\n        }\n      }\n\n      this._getBounds(aX, aY, onlyWidthHeight);\n    },\n\n    /**\n     * @private\n     */\n    _getBounds: function(aX, aY, onlyWidthHeight) {\n      var minXY = new fabric.Point(min(aX), min(aY)),\n          maxXY = new fabric.Point(max(aX), max(aY)),\n          top = minXY.y || 0, left = minXY.x || 0,\n          width = (maxXY.x - minXY.x) || 0,\n          height = (maxXY.y - minXY.y) || 0;\n      this.width = width;\n      this.height = height;\n      if (!onlyWidthHeight) {\n        // the bounding box always finds the topleft most corner.\n        // whatever is the group origin, we set up here the left/top position.\n        this.setPositionByOrigin({ x: left, y: top }, 'left', 'top');\n      }\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var svgString = [];\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        svgString.push('\\t', this._objects[i].toSVG(reviver));\n      }\n\n      return this._createBaseSVGMarkup(\n        svgString,\n        { reviver: reviver, noStyle: true, withShadow: true });\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      var svgString = [];\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        svgString.push('\\t', this._objects[i].toClipPathSVG(reviver));\n      }\n\n      return this._createBaseClipPathSVGMarkup(svgString, { reviver: reviver });\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Group} instance from an object representation\n   * @static\n   * @memberOf fabric.Group\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an group instance is created\n   */\n  fabric.Group.fromObject = function(object, callback) {\n    fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {\n      fabric.util.enlivenObjects([object.clipPath], function(enlivedClipPath) {\n        var options = fabric.util.object.clone(object, true);\n        options.clipPath = enlivedClipPath[0];\n        delete options.objects;\n        callback && callback(new fabric.Group(enlivenedObjects, options, true));\n      });\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.ActiveSelection) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.ActiveSelection\n   * @extends fabric.Group\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.ActiveSelection#initialize} for constructor definition\n   */\n  fabric.ActiveSelection = fabric.util.createClass(fabric.Group, /** @lends fabric.ActiveSelection.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'activeSelection',\n\n    /**\n     * Constructor\n     * @param {Object} objects ActiveSelection objects\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options) {\n      options = options || {};\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (options.originX) {\n        this.originX = options.originX;\n      }\n      if (options.originY) {\n        this.originY = options.originY;\n      }\n      this._calcBounds();\n      this._updateObjectsCoords();\n      fabric.Object.prototype.initialize.call(this, options);\n      this.setCoords();\n    },\n\n    /**\n     * Change te activeSelection to a normal group,\n     * High level function that automatically adds it to canvas as\n     * active object. no events fired.\n     * @since 2.0.0\n     * @return {fabric.Group}\n     */\n    toGroup: function() {\n      var objects = this._objects.concat();\n      this._objects = [];\n      var options = fabric.Object.prototype.toObject.call(this);\n      var newGroup = new fabric.Group([]);\n      delete options.type;\n      newGroup.set(options);\n      objects.forEach(function(object) {\n        object.canvas.remove(object);\n        object.group = newGroup;\n      });\n      newGroup._objects = objects;\n      if (!this.canvas) {\n        return newGroup;\n      }\n      var canvas = this.canvas;\n      canvas.add(newGroup);\n      canvas._activeObject = newGroup;\n      newGroup.setCoords();\n      return newGroup;\n    },\n\n    /**\n     * If returns true, deselection is cancelled.\n     * @since 2.0.0\n     * @return {Boolean} [cancel]\n     */\n    onDeselect: function() {\n      this.destroy();\n      return false;\n    },\n\n    /**\n     * Returns string representation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.ActiveSelection: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isOnACache: function() {\n      return false;\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [styleOverride] properties to override the object style\n     * @param {Object} [childrenOverride] properties to override the children overrides\n     */\n    _renderControls: function(ctx, styleOverride, childrenOverride) {\n      ctx.save();\n      ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      this.callSuper('_renderControls', ctx, styleOverride);\n      childrenOverride = childrenOverride || { };\n      if (typeof childrenOverride.hasControls === 'undefined') {\n        childrenOverride.hasControls = false;\n      }\n      if (typeof childrenOverride.hasRotatingPoint === 'undefined') {\n        childrenOverride.hasRotatingPoint = false;\n      }\n      childrenOverride.forActiveSelection = true;\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i]._renderControls(ctx, childrenOverride);\n      }\n      ctx.restore();\n    },\n  });\n\n  /**\n   * Returns {@link fabric.ActiveSelection} instance from an object representation\n   * @static\n   * @memberOf fabric.ActiveSelection\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an ActiveSelection instance is created\n   */\n  fabric.ActiveSelection.fromObject = function(object, callback) {\n    fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {\n      delete object.objects;\n      callback && callback(new fabric.ActiveSelection(enlivenedObjects, object, true));\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var extend = fabric.util.object.extend;\n\n  if (!global.fabric) {\n    global.fabric = { };\n  }\n\n  if (global.fabric.Image) {\n    fabric.warn('fabric.Image is already defined.');\n    return;\n  }\n\n  /**\n   * Image class\n   * @class fabric.Image\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#images}\n   * @see {@link fabric.Image#initialize} for constructor definition\n   */\n  fabric.Image = fabric.util.createClass(fabric.Object, /** @lends fabric.Image.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'image',\n\n    /**\n     * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @type String\n     * @default\n     */\n    crossOrigin: '',\n\n    /**\n     * Width of a stroke.\n     * For image quality a stroke multiple of 2 gives better results.\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * private\n     * contains last value of scaleX to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleX: 1,\n\n    /**\n     * private\n     * contains last value of scaleY to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleY: 1,\n\n    /**\n     * private\n     * contains last value of scaling applied by the apply filter chain\n     * @type Number\n     */\n    _filterScalingX: 1,\n\n    /**\n     * private\n     * contains last value of scaling applied by the apply filter chain\n     * @type Number\n     */\n    _filterScalingY: 1,\n\n    /**\n     * minimum scale factor under which any resizeFilter is triggered to resize the image\n     * 0 will disable the automatic resize. 1 will trigger automatically always.\n     * number bigger than 1 are not implemented yet.\n     * @type Number\n     */\n    minimumScaleTrigger: 0.5,\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('cropX', 'cropY'),\n\n    /**\n     * key used to retrieve the texture representing this image\n     * since 2.0.0\n     * @type String\n     * @default\n     */\n    cacheKey: '',\n\n    /**\n     * Image crop in pixels from original image size.\n     * since 2.0.0\n     * @type Number\n     * @default\n     */\n    cropX: 0,\n\n    /**\n     * Image crop in pixels from original image size.\n     * since 2.0.0\n     * @type Number\n     * @default\n     */\n    cropY: 0,\n\n    /**\n     * Constructor\n     * @param {HTMLImageElement | String} element Image element\n     * @param {Object} [options] Options object\n     * @param {function} [callback] callback function to call after eventual filters applied.\n     * @return {fabric.Image} thisArg\n     */\n    initialize: function(element, options) {\n      options || (options = { });\n      this.filters = [];\n      this.cacheKey = 'texture' + fabric.Object.__uid++;\n      this.callSuper('initialize', options);\n      this._initElement(element, options);\n    },\n\n    /**\n     * Returns image element which this instance if based on\n     * @return {HTMLImageElement} Image element\n     */\n    getElement: function() {\n      return this._element || {};\n    },\n\n    /**\n     * Sets image element for this instance to a specified one.\n     * If filters defined they are applied to new image.\n     * You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.\n     * @param {HTMLImageElement} element\n     * @param {Object} [options] Options object\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setElement: function(element, options) {\n      this.removeTexture(this.cacheKey);\n      this.removeTexture(this.cacheKey + '_filtered');\n      this._element = element;\n      this._originalElement = element;\n      this._initConfig(options);\n      if (this.filters.length !== 0) {\n        this.applyFilters();\n      }\n      // resizeFilters work on the already filtered copy.\n      // we need to apply resizeFilters AFTER normal filters.\n      // applyResizeFilters is run more often than normal fiters\n      // and is triggered by user interactions rather than dev code\n      if (this.resizeFilter) {\n        this.applyResizeFilters();\n      }\n      return this;\n    },\n\n    /**\n     * Delete a single texture if in webgl mode\n     */\n    removeTexture: function(key) {\n      var backend = fabric.filterBackend;\n      if (backend && backend.evictCachesForKey) {\n        backend.evictCachesForKey(key);\n      }\n    },\n\n    /**\n     * Delete textures, reference to elements and eventually JSDOM cleanup\n     */\n    dispose: function() {\n      this.removeTexture(this.cacheKey);\n      this.removeTexture(this.cacheKey + '_filtered');\n      this._cacheContext = undefined;\n      ['_originalElement', '_element', '_filteredEl', '_cacheCanvas'].forEach((function(element) {\n        fabric.util.cleanUpJsdomNode(this[element]);\n        this[element] = undefined;\n      }).bind(this));\n    },\n\n    /**\n     * Sets crossOrigin value (on an instance and corresponding image element)\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setCrossOrigin: function(value) {\n      this.crossOrigin = value;\n      this._element.crossOrigin = value;\n\n      return this;\n    },\n\n    /**\n     * Returns original size of an image\n     * @return {Object} Object with \"width\" and \"height\" properties\n     */\n    getOriginalSize: function() {\n      var element = this.getElement();\n      return {\n        width: element.naturalWidth || element.width,\n        height: element.naturalHeight || element.height\n      };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _stroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n      var w = this.width / 2, h = this.height / 2;\n      ctx.beginPath();\n      ctx.moveTo(-w, -h);\n      ctx.lineTo(w, -h);\n      ctx.lineTo(w, h);\n      ctx.lineTo(-w, h);\n      ctx.lineTo(-w, -h);\n      ctx.closePath();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.save();\n      this._setStrokeStyles(ctx, this);\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var filters = [];\n\n      this.filters.forEach(function(filterObj) {\n        if (filterObj) {\n          filters.push(filterObj.toObject());\n        }\n      });\n      var object = extend(\n        this.callSuper(\n          'toObject',\n          ['crossOrigin', 'cropX', 'cropY'].concat(propertiesToInclude)\n        ), {\n          src: this.getSrc(),\n          filters: filters,\n        });\n      if (this.resizeFilter) {\n        object.resizeFilter = this.resizeFilter.toObject();\n      }\n      return object;\n    },\n\n    /**\n     * Returns true if an image has crop applied, inspecting values of cropX,cropY,width,hight.\n     * @return {Boolean}\n     */\n    hasCrop: function() {\n      return this.cropX || this.cropY || this.width < this._element.width || this.height < this._element.height;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var svgString = [], imageMarkup = [], strokeSvg,\n          x = -this.width / 2, y = -this.height / 2, clipPath = '';\n      if (this.hasCrop()) {\n        var clipPathId = fabric.Object.__uid++;\n        svgString.push(\n          '<clipPath id=\"imageCrop_' + clipPathId + '\">\\n',\n          '\\t<rect x=\"' + x + '\" y=\"' + y + '\" width=\"' + this.width + '\" height=\"' + this.height + '\" />\\n',\n          '</clipPath>\\n'\n        );\n        clipPath = ' clip-path=\"url(#imageCrop_' + clipPathId + ')\" ';\n      }\n      imageMarkup.push('\\t<image ', 'COMMON_PARTS', 'xlink:href=\"', this.getSvgSrc(true),\n        '\" x=\"', x - this.cropX, '\" y=\"', y - this.cropY,\n        // we're essentially moving origin of transformation from top/left corner to the center of the shape\n        // by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\n        // so that object's center aligns with container's left/top\n        '\" width=\"', this._element.width || this._element.naturalWidth,\n        '\" height=\"', this._element.height || this._element.height,\n        '\"', clipPath,\n        '></image>\\n');\n\n      if (this.stroke || this.strokeDashArray) {\n        var origFill = this.fill;\n        this.fill = null;\n        strokeSvg = [\n          '\\t<rect ',\n          'x=\"', x, '\" y=\"', y,\n          '\" width=\"', this.width, '\" height=\"', this.height,\n          '\" style=\"', this.getSvgStyles(),\n          '\"/>\\n'\n        ];\n        this.fill = origFill;\n      }\n      if (this.paintFirst !== 'fill') {\n        svgString = svgString.concat(strokeSvg, imageMarkup);\n      }\n      else {\n        svgString = svgString.concat(imageMarkup, strokeSvg);\n      }\n      return svgString;\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns source of an image\n     * @param {Boolean} filtered indicates if the src is needed for svg\n     * @return {String} Source of an image\n     */\n    getSrc: function(filtered) {\n      var element = filtered ? this._element : this._originalElement;\n      if (element) {\n        if (element.toDataURL) {\n          return element.toDataURL();\n        }\n        return element.src;\n      }\n      else {\n        return this.src || '';\n      }\n    },\n\n    /**\n     * Sets source of an image\n     * @param {String} src Source string (URL)\n     * @param {Function} [callback] Callback is invoked when image has been loaded (and all filters have been applied)\n     * @param {Object} [options] Options object\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setSrc: function(src, callback, options) {\n      fabric.util.loadImage(src, function(img) {\n        this.setElement(img, options);\n        this._setWidthHeight();\n        callback(this);\n      }, this, options && options.crossOrigin);\n      return this;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Image: { src: \"' + this.getSrc() + '\" }>';\n    },\n\n    applyResizeFilters: function() {\n      var filter = this.resizeFilter,\n          minimumScale = this.minimumScaleTrigger,\n          objectScale = this.getTotalObjectScaling(),\n          scaleX = objectScale.scaleX,\n          scaleY = objectScale.scaleY,\n          elementToFilter = this._filteredEl || this._originalElement;\n      if (this.group) {\n        this.set('dirty', true);\n      }\n      if (!filter || (scaleX > minimumScale && scaleY > minimumScale)) {\n        this._element = elementToFilter;\n        this._filterScalingX = 1;\n        this._filterScalingY = 1;\n        this._lastScaleX = scaleX;\n        this._lastScaleY = scaleY;\n        return;\n      }\n      if (!fabric.filterBackend) {\n        fabric.filterBackend = fabric.initFilterBackend();\n      }\n      var canvasEl = fabric.util.createCanvasElement(),\n          cacheKey = this._filteredEl ? (this.cacheKey + '_filtered') : this.cacheKey,\n          sourceWidth = elementToFilter.width, sourceHeight = elementToFilter.height;\n      canvasEl.width = sourceWidth;\n      canvasEl.height = sourceHeight;\n      this._element = canvasEl;\n      this._lastScaleX = filter.scaleX = scaleX;\n      this._lastScaleY = filter.scaleY = scaleY;\n      fabric.filterBackend.applyFilters(\n        [filter], elementToFilter, sourceWidth, sourceHeight, this._element, cacheKey);\n      this._filterScalingX = canvasEl.width / this._originalElement.width;\n      this._filterScalingY = canvasEl.height / this._originalElement.height;\n    },\n\n    /**\n     * Applies filters assigned to this image (from \"filters\" array) or from filter param\n     * @method applyFilters\n     * @param {Array} filters to be applied\n     * @param {Boolean} forResizing specify if the filter operation is a resize operation\n     * @return {thisArg} return the fabric.Image object\n     * @chainable\n     */\n    applyFilters: function(filters) {\n\n      filters = filters || this.filters || [];\n      filters = filters.filter(function(filter) { return filter && !filter.isNeutralState(); });\n      this.set('dirty', true);\n\n      // needs to clear out or WEBGL will not resize correctly\n      this.removeTexture(this.cacheKey + '_filtered');\n\n      if (filters.length === 0) {\n        this._element = this._originalElement;\n        this._filteredEl = null;\n        this._filterScalingX = 1;\n        this._filterScalingY = 1;\n        return this;\n      }\n\n      var imgElement = this._originalElement,\n          sourceWidth = imgElement.naturalWidth || imgElement.width,\n          sourceHeight = imgElement.naturalHeight || imgElement.height;\n\n      if (this._element === this._originalElement) {\n        // if the element is the same we need to create a new element\n        var canvasEl = fabric.util.createCanvasElement();\n        canvasEl.width = sourceWidth;\n        canvasEl.height = sourceHeight;\n        this._element = canvasEl;\n        this._filteredEl = canvasEl;\n      }\n      else {\n        // clear the existing element to get new filter data\n        // also dereference the eventual resized _element\n        this._element = this._filteredEl;\n        this._filteredEl.getContext('2d').clearRect(0, 0, sourceWidth, sourceHeight);\n        // we also need to resize again at next renderAll, so remove saved _lastScaleX/Y\n        this._lastScaleX = 1;\n        this._lastScaleY = 1;\n      }\n      if (!fabric.filterBackend) {\n        fabric.filterBackend = fabric.initFilterBackend();\n      }\n      fabric.filterBackend.applyFilters(\n        filters, this._originalElement, sourceWidth, sourceHeight, this._element, this.cacheKey);\n      if (this._originalElement.width !== this._element.width ||\n        this._originalElement.height !== this._element.height) {\n        this._filterScalingX = this._element.width / this._originalElement.width;\n        this._filterScalingY = this._element.height / this._originalElement.height;\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (this.isMoving !== true && this.resizeFilter && this._needsResize()) {\n        this.applyResizeFilters();\n      }\n      this._stroke(ctx);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * This is the special image version where we would like to avoid caching where possible.\n     * Essentially images do not benefit from caching. They may require caching, and in that\n     * case we do it. Also caching an image usually ends in a loss of details.\n     * A full performance audit should be done.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      this.ownCaching = this.objectCaching && this.needsItsOwnCache();\n      return this.ownCaching;\n    },\n\n    _renderFill: function(ctx) {\n      var w = this.width, h = this.height, sW = w * this._filterScalingX, sH = h * this._filterScalingY,\n          x = -w / 2, y = -h / 2, elementToDraw = this._element;\n      elementToDraw && ctx.drawImage(elementToDraw,\n        this.cropX * this._filterScalingX,\n        this.cropY * this._filterScalingY,\n        sW,\n        sH,\n        x, y, w, h);\n    },\n\n    /**\n     * @private, needed to check if image needs resize\n     */\n    _needsResize: function() {\n      var scale = this.getTotalObjectScaling();\n      return (scale.scaleX !== this._lastScaleX || scale.scaleY !== this._lastScaleY);\n    },\n\n    /**\n     * @private\n     */\n    _resetWidthHeight: function() {\n      this.set(this.getOriginalSize());\n    },\n\n    /**\n     * The Image class's initialization method. This method is automatically\n     * called by the constructor.\n     * @private\n     * @param {HTMLImageElement|String} element The element representing the image\n     * @param {Object} [options] Options object\n     */\n    _initElement: function(element, options) {\n      this.setElement(fabric.util.getById(element), options);\n      fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initConfig: function(options) {\n      options || (options = { });\n      this.setOptions(options);\n      this._setWidthHeight(options);\n      if (this._element && this.crossOrigin) {\n        this._element.crossOrigin = this.crossOrigin;\n      }\n    },\n\n    /**\n     * @private\n     * @param {Array} filters to be initialized\n     * @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created\n     */\n    _initFilters: function(filters, callback) {\n      if (filters && filters.length) {\n        fabric.util.enlivenObjects(filters, function(enlivenedObjects) {\n          callback && callback(enlivenedObjects);\n        }, 'fabric.Image.filters');\n      }\n      else {\n        callback && callback();\n      }\n    },\n\n    /**\n     * @private\n     * Set the width and the height of the image object, using the element or the\n     * options.\n     * @param {Object} [options] Object with width/height properties\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n      var el = this.getElement();\n      this.width = options.width || el.naturalWidth || el.width || 0;\n      this.height = options.height || el.naturalHeight || el.height || 0;\n    },\n\n    /**\n     * Calculate offset for center and scale factor for the image in order to respect\n     * the preserveAspectRatio attribute\n     * @private\n     * @return {Object}\n     */\n    parsePreserveAspectRatioAttribute: function() {\n      var pAR = fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio || ''),\n          rWidth = this._element.width, rHeight = this._element.height,\n          scaleX = 1, scaleY = 1, offsetLeft = 0, offsetTop = 0, cropX = 0, cropY = 0,\n          offset, pWidth = this.width, pHeight = this.height, parsedAttributes = { width: pWidth, height: pHeight };\n      if (pAR && (pAR.alignX !== 'none' || pAR.alignY !== 'none')) {\n        if (pAR.meetOrSlice === 'meet') {\n          scaleX = scaleY = fabric.util.findScaleToFit(this._element, parsedAttributes);\n          offset = (pWidth - rWidth * scaleX) / 2;\n          if (pAR.alignX === 'Min') {\n            offsetLeft = -offset;\n          }\n          if (pAR.alignX === 'Max') {\n            offsetLeft = offset;\n          }\n          offset = (pHeight - rHeight * scaleY) / 2;\n          if (pAR.alignY === 'Min') {\n            offsetTop = -offset;\n          }\n          if (pAR.alignY === 'Max') {\n            offsetTop = offset;\n          }\n        }\n        if (pAR.meetOrSlice === 'slice') {\n          scaleX = scaleY = fabric.util.findScaleToCover(this._element, parsedAttributes);\n          offset = rWidth - pWidth / scaleX;\n          if (pAR.alignX === 'Mid') {\n            cropX = offset / 2;\n          }\n          if (pAR.alignX === 'Max') {\n            cropX = offset;\n          }\n          offset = rHeight - pHeight / scaleY;\n          if (pAR.alignY === 'Mid') {\n            cropY = offset / 2;\n          }\n          if (pAR.alignY === 'Max') {\n            cropY = offset;\n          }\n          rWidth = pWidth / scaleX;\n          rHeight = pHeight / scaleY;\n        }\n      }\n      else {\n        scaleX = pWidth / rWidth;\n        scaleY = pHeight / rHeight;\n      }\n      return {\n        width: rWidth,\n        height: rHeight,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        offsetLeft: offsetLeft,\n        offsetTop: offsetTop,\n        cropX: cropX,\n        cropY: cropY\n      };\n    }\n  });\n\n  /**\n   * Default CSS class name for canvas\n   * @static\n   * @type String\n   * @default\n   */\n  fabric.Image.CSS_CANVAS = 'canvas-img';\n\n  /**\n   * Alias for getSrc\n   * @static\n   */\n  fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;\n\n  /**\n   * Creates an instance of fabric.Image from its object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} callback Callback to invoke when an image instance is created\n   */\n  fabric.Image.fromObject = function(_object, callback) {\n    var object = fabric.util.object.clone(_object);\n    fabric.util.loadImage(object.src, function(img, error) {\n      if (error) {\n        callback && callback(null, error);\n        return;\n      }\n      fabric.Image.prototype._initFilters.call(object, object.filters, function(filters) {\n        object.filters = filters || [];\n        fabric.Image.prototype._initFilters.call(object, [object.resizeFilter], function(resizeFilters) {\n          object.resizeFilter = resizeFilters[0];\n          fabric.util.enlivenObjects([object.clipPath], function(enlivedProps) {\n            object.clipPath = enlivedProps[0];\n            var image = new fabric.Image(img, object);\n            callback(image);\n          });\n        });\n      });\n    }, null, object.crossOrigin);\n  };\n\n  /**\n   * Creates an instance of fabric.Image from an URL string\n   * @static\n   * @param {String} url URL to create an image from\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument)\n   * @param {Object} [imgOptions] Options object\n   */\n  fabric.Image.fromURL = function(url, callback, imgOptions) {\n    fabric.util.loadImage(url, function(img) {\n      callback && callback(new fabric.Image(img, imgOptions));\n    }, null, imgOptions && imgOptions.crossOrigin);\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\n   * @static\n   * @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}\n   */\n  fabric.Image.ATTRIBUTE_NAMES =\n    fabric.SHARED_ATTRIBUTES.concat('x y width height preserveAspectRatio xlink:href crossOrigin'.split(' '));\n\n  /**\n   * Returns {@link fabric.Image} instance from an SVG element\n   * @static\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} callback Callback to execute when fabric.Image object is created\n   * @return {fabric.Image} Instance of fabric.Image\n   */\n  fabric.Image.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Image.ATTRIBUTE_NAMES);\n    fabric.Image.fromURL(parsedAttributes['xlink:href'], callback,\n      extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n})(typeof exports !== 'undefined' ? exports : this);\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * @private\n   * @return {Number} angle value\n   */\n  _getAngleValueForStraighten: function() {\n    var angle = this.angle % 360;\n    if (angle > 0) {\n      return Math.round((angle - 1) / 90) * 90;\n    }\n    return Math.round(angle / 90) * 90;\n  },\n\n  /**\n   * Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  straighten: function() {\n    this.rotate(this._getAngleValueForStraighten());\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Object.prototype.straighten} but with animation\n   * @param {Object} callbacks Object with callback functions\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  fxStraighten: function(callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: this.get('angle'),\n      endValue: this._getAngleValueForStraighten(),\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        _this.rotate(value);\n        onChange();\n      },\n      onComplete: function() {\n        _this.setCoords();\n        onComplete();\n      },\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Straightens object, then rerenders canvas\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  straightenObject: function (object) {\n    object.straighten();\n    this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Canvas.prototype.straightenObject}, but animated\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxStraightenObject: function (object) {\n    object.fxStraighten({\n      onChange: this.requestRenderAllBound\n    });\n    return this;\n  }\n});\n(function() {\n\n  'use strict';\n\n  /**\n   * Tests if webgl supports certain precision\n   * @param {WebGL} Canvas WebGL context to test on\n   * @param {String} Precision to test can be any of following: 'lowp', 'mediump', 'highp'\n   * @returns {Boolean} Whether the user's browser WebGL supports given precision.\n   */\n  function testPrecision(gl, precision){\n    var fragmentSource = 'precision ' + precision + ' float;\\nvoid main(){}';\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Indicate whether this filtering backend is supported by the user's browser.\n   * @param {Number} tileSize check if the tileSize is supported\n   * @returns {Boolean} Whether the user's browser supports WebGL.\n   */\n  fabric.isWebglSupported = function(tileSize) {\n    if (fabric.isLikelyNode) {\n      return false;\n    }\n    tileSize = tileSize || fabric.WebglFilterBackend.prototype.tileSize;\n    var canvas = document.createElement('canvas');\n    var gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n    var isSupported = false;\n    // eslint-disable-next-line\n    if (gl) {\n      fabric.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n      isSupported = fabric.maxTextureSize >= tileSize;\n      var precisions = ['highp', 'mediump', 'lowp'];\n      for (var i = 0; i < 3; i++){\n        if (testPrecision(gl, precisions[i])){\n          fabric.webGlPrecision = precisions[i];\n          break;\n        };\n      }\n    }\n    this.isSupported = isSupported;\n    return isSupported;\n  };\n\n  fabric.WebglFilterBackend = WebglFilterBackend;\n\n  /**\n   * WebGL filter backend.\n   */\n  function WebglFilterBackend(options) {\n    if (options && options.tileSize) {\n      this.tileSize = options.tileSize;\n    }\n    this.setupGLContext(this.tileSize, this.tileSize);\n    this.captureGPUInfo();\n  };\n\n  WebglFilterBackend.prototype = /** @lends fabric.WebglFilterBackend.prototype */ {\n\n    tileSize: 2048,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you problably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {\n\n    },\n\n    /**\n     * Setup a WebGL context suitable for filtering, and bind any needed event handlers.\n     */\n    setupGLContext: function(width, height) {\n      this.dispose();\n      this.createWebGLCanvas(width, height);\n      // eslint-disable-next-line\n      this.aPosition = new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]);\n      this.chooseFastestCopyGLTo2DMethod(width, height);\n    },\n\n    /**\n     * Pick a method to copy data from GL context to 2d canvas.  In some browsers using\n     * putImageData is faster than drawImage for that specific operation.\n     */\n    chooseFastestCopyGLTo2DMethod: function(width, height) {\n      var canMeasurePerf = typeof window.performance !== 'undefined';\n      var canUseImageData;\n      try {\n        new ImageData(1, 1);\n        canUseImageData = true;\n      }\n      catch (e) {\n        canUseImageData = false;\n      }\n      // eslint-disable-next-line no-undef\n      var canUseArrayBuffer = typeof ArrayBuffer !== 'undefined';\n      // eslint-disable-next-line no-undef\n      var canUseUint8Clamped = typeof Uint8ClampedArray !== 'undefined';\n\n      if (!(canMeasurePerf && canUseImageData && canUseArrayBuffer && canUseUint8Clamped)) {\n        return;\n      }\n\n      var targetCanvas = fabric.util.createCanvasElement();\n      // eslint-disable-next-line no-undef\n      var imageBuffer = new ArrayBuffer(width * height * 4);\n      var testContext = {\n        imageBuffer: imageBuffer,\n        destinationWidth: width,\n        destinationHeight: height,\n        targetCanvas: targetCanvas\n      };\n      var startTime, drawImageTime, putImageDataTime;\n      targetCanvas.width = width;\n      targetCanvas.height = height;\n\n      startTime = window.performance.now();\n      copyGLTo2DDrawImage.call(testContext, this.gl, testContext);\n      drawImageTime = window.performance.now() - startTime;\n\n      startTime = window.performance.now();\n      copyGLTo2DPutImageData.call(testContext, this.gl, testContext);\n      putImageDataTime = window.performance.now() - startTime;\n\n      if (drawImageTime > putImageDataTime) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n      }\n      else {\n        this.copyGLTo2D = copyGLTo2DDrawImage;\n      }\n    },\n\n    /**\n     * Create a canvas element and associated WebGL context and attaches them as\n     * class properties to the GLFilterBackend class.\n     */\n    createWebGLCanvas: function(width, height) {\n      var canvas = fabric.util.createCanvasElement();\n      canvas.width = width;\n      canvas.height = height;\n      var glOptions = {\n            alpha: true,\n            premultipliedAlpha: false,\n            depth: false,\n            stencil: false,\n            antialias: false\n          },\n          gl = canvas.getContext('webgl', glOptions);\n      if (!gl) {\n        gl = canvas.getContext('experimental-webgl', glOptions);\n      }\n      if (!gl) {\n        return;\n      }\n      gl.clearColor(0, 0, 0, 0);\n      // this canvas can fire webglcontextlost and webglcontextrestored\n      this.canvas = canvas;\n      this.gl = gl;\n    },\n\n    /**\n     * Attempts to apply the requested filters to the source provided, drawing the filtered output\n     * to the provided target canvas.\n     *\n     * @param {Array} filters The filters to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} source The source to be filtered.\n     * @param {Number} width The width of the source input.\n     * @param {Number} height The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     * @param {String|undefined} cacheKey A key used to cache resources related to the source. If\n     * omitted, caching will be skipped.\n     */\n    applyFilters: function(filters, source, width, height, targetCanvas, cacheKey) {\n      var gl = this.gl;\n      var cachedTexture;\n      if (cacheKey) {\n        cachedTexture = this.getCachedTexture(cacheKey, source);\n      }\n      var pipelineState = {\n        originalWidth: source.width || source.originalWidth,\n        originalHeight: source.height || source.originalHeight,\n        sourceWidth: width,\n        sourceHeight: height,\n        destinationWidth: width,\n        destinationHeight: height,\n        context: gl,\n        sourceTexture: this.createTexture(gl, width, height, !cachedTexture && source),\n        targetTexture: this.createTexture(gl, width, height),\n        originalTexture: cachedTexture ||\n          this.createTexture(gl, width, height, !cachedTexture && source),\n        passes: filters.length,\n        webgl: true,\n        aPosition: this.aPosition,\n        programCache: this.programCache,\n        pass: 0,\n        filterBackend: this,\n        targetCanvas: targetCanvas\n      };\n      var tempFbo = gl.createFramebuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, tempFbo);\n      filters.forEach(function(filter) { filter && filter.applyTo(pipelineState); });\n      resizeCanvasIfNeeded(pipelineState);\n      this.copyGLTo2D(gl, pipelineState);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n      gl.deleteTexture(pipelineState.sourceTexture);\n      gl.deleteTexture(pipelineState.targetTexture);\n      gl.deleteFramebuffer(tempFbo);\n      targetCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\n      return pipelineState;\n    },\n\n    /**\n     * The same as the applyFilter method but with additional logging of WebGL\n     * errors.\n     */\n    applyFiltersDebug: function(filters, source, width, height, targetCanvas, cacheKey) {\n      // The following code is useful when debugging a specific issue but adds ~10x slowdown.\n      var gl = this.gl;\n      var ret = this.applyFilters(filters, source, width, height, targetCanvas, cacheKey);\n      var glError = gl.getError();\n      if (glError !== gl.NO_ERROR) {\n        var errorString = this.glErrorToString(gl, glError);\n        var error = new Error('WebGL Error ' + errorString);\n        error.glErrorCode = glError;\n        throw error;\n      }\n      return ret;\n    },\n\n    glErrorToString: function(context, errorCode) {\n      if (!context) {\n        return 'Context undefined for error code: ' + errorCode;\n      }\n      else if (typeof errorCode !== 'number') {\n        return 'Error code is not a number';\n      }\n      switch (errorCode) {\n        case context.NO_ERROR:\n          return 'NO_ERROR';\n        case context.INVALID_ENUM:\n          return 'INVALID_ENUM';\n        case context.INVALID_VALUE:\n          return 'INVALID_VALUE';\n        case context.INVALID_OPERATION:\n          return 'INVALID_OPERATION';\n        case context.INVALID_FRAMEBUFFER_OPERATION:\n          return 'INVALID_FRAMEBUFFER_OPERATION';\n        case context.OUT_OF_MEMORY:\n          return 'OUT_OF_MEMORY';\n        case context.CONTEXT_LOST_WEBGL:\n          return 'CONTEXT_LOST_WEBGL';\n        default:\n          return 'UNKNOWN_ERROR';\n      }\n    },\n\n    /**\n     * Detach event listeners, remove references, and clean up caches.\n     */\n    dispose: function() {\n      if (this.canvas) {\n        this.canvas = null;\n        this.gl = null;\n      }\n      this.clearWebGLCaches();\n    },\n\n    /**\n     * Wipe out WebGL-related caches.\n     */\n    clearWebGLCaches: function() {\n      this.programCache = {};\n      this.textureCache = {};\n    },\n\n    /**\n     * Create a WebGL texture object.\n     *\n     * Accepts specific dimensions to initialize the textuer to or a source image.\n     *\n     * @param {WebGLRenderingContext} gl The GL context to use for creating the texture.\n     * @param {Number} width The width to initialize the texture at.\n     * @param {Number} height The height to initialize the texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source for the texture data.\n     * @returns {WebGLTexture}\n     */\n    createTexture: function(gl, width, height, textureImageSource) {\n      var texture = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      if (textureImageSource) {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureImageSource);\n      }\n      else {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n      }\n      return texture;\n    },\n\n    /**\n     * Can be optionally used to get a texture from the cache array\n     *\n     * If an existing texture is not found, a new texture is created and cached.\n     *\n     * @param {String} uniqueId A cache key to use to find an existing texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source to use to create the\n     * texture cache entry if one does not already exist.\n     */\n    getCachedTexture: function(uniqueId, textureImageSource) {\n      if (this.textureCache[uniqueId]) {\n        return this.textureCache[uniqueId];\n      }\n      else {\n        var texture = this.createTexture(\n          this.gl, textureImageSource.width, textureImageSource.height, textureImageSource);\n        this.textureCache[uniqueId] = texture;\n        return texture;\n      }\n    },\n\n    /**\n     * Clear out cached resources related to a source image that has been\n     * filtered previously.\n     *\n     * @param {String} cacheKey The cache key provided when the source image was filtered.\n     */\n    evictCachesForKey: function(cacheKey) {\n      if (this.textureCache[cacheKey]) {\n        this.gl.deleteTexture(this.textureCache[cacheKey]);\n        delete this.textureCache[cacheKey];\n      }\n    },\n\n    copyGLTo2D: copyGLTo2DDrawImage,\n\n    /**\n     * Attempt to extract GPU information strings from a WebGL context.\n     *\n     * Useful information when debugging or blacklisting specific GPUs.\n     *\n     * @returns {Object} A GPU info object with renderer and vendor strings.\n     */\n    captureGPUInfo: function() {\n      if (this.gpuInfo) {\n        return this.gpuInfo;\n      }\n      var gl = this.gl;\n      var ext = gl.getExtension('WEBGL_debug_renderer_info');\n      var gpuInfo = { renderer: '', vendor: '' };\n      if (ext) {\n        var renderer = gl.getParameter(ext.UNMASKED_RENDERER_WEBGL);\n        var vendor = gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);\n        if (renderer) {\n          gpuInfo.renderer = renderer.toLowerCase();\n        }\n        if (vendor) {\n          gpuInfo.vendor = vendor.toLowerCase();\n        }\n      }\n      this.gpuInfo = gpuInfo;\n      return gpuInfo;\n    },\n  };\n})();\n\nfunction resizeCanvasIfNeeded(pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas,\n      width = targetCanvas.width, height = targetCanvas.height,\n      dWidth = pipelineState.destinationWidth,\n      dHeight = pipelineState.destinationHeight;\n\n  if (width !== dWidth || height !== dHeight) {\n    targetCanvas.width = dWidth;\n    targetCanvas.height = dHeight;\n  }\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas.\n *\n * The WebGL canvas is assumed to be upside down, with the top-left pixel of the\n * desired output image appearing in the bottom-left corner of the WebGL canvas.\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DDrawImage(gl, pipelineState) {\n  var glCanvas = gl.canvas, targetCanvas = pipelineState.targetCanvas,\n      ctx = targetCanvas.getContext('2d');\n  ctx.translate(0, targetCanvas.height); // move it down again\n  ctx.scale(1, -1); // vertical flip\n  // where is my image on the big glcanvas?\n  var sourceY = glCanvas.height - targetCanvas.height;\n  ctx.drawImage(glCanvas, 0, sourceY, targetCanvas.width, targetCanvas.height, 0, 0,\n    targetCanvas.width, targetCanvas.height);\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas using 2d canvas' putImageData\n * API. Measurably faster than using ctx.drawImage in Firefox (version 54 on OSX Sierra).\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DPutImageData(gl, pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas, ctx = targetCanvas.getContext('2d'),\n      dWidth = pipelineState.destinationWidth,\n      dHeight = pipelineState.destinationHeight,\n      numBytes = dWidth * dHeight * 4;\n\n  // eslint-disable-next-line no-undef\n  var u8 = new Uint8Array(this.imageBuffer, 0, numBytes);\n  // eslint-disable-next-line no-undef\n  var u8Clamped = new Uint8ClampedArray(this.imageBuffer, 0, numBytes);\n\n  gl.readPixels(0, 0, dWidth, dHeight, gl.RGBA, gl.UNSIGNED_BYTE, u8);\n  var imgData = new ImageData(u8Clamped, dWidth, dHeight);\n  ctx.putImageData(imgData, 0, 0);\n}\n(function() {\n\n  'use strict';\n\n  var noop = function() {};\n\n  fabric.Canvas2dFilterBackend = Canvas2dFilterBackend;\n\n  /**\n   * Canvas 2D filter backend.\n   */\n  function Canvas2dFilterBackend() {};\n\n  Canvas2dFilterBackend.prototype = /** @lends fabric.Canvas2dFilterBackend.prototype */ {\n    evictCachesForKey: noop,\n    dispose: noop,\n    clearWebGLCaches: noop,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you probably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {\n\n    },\n\n    /**\n     * Apply a set of filters against a source image and draw the filtered output\n     * to the provided destination canvas.\n     *\n     * @param {EnhancedFilter} filters The filter to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} sourceElement The source to be filtered.\n     * @param {Number} sourceWidth The width of the source input.\n     * @param {Number} sourceHeight The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     */\n    applyFilters: function(filters, sourceElement, sourceWidth, sourceHeight, targetCanvas) {\n      var ctx = targetCanvas.getContext('2d');\n      var imageData = new Image();\n      var originalImageData = new Image();\n      imageData.crossOrigin = 'anonymous';//add by zhoujun --20190623\n      imageData.onload = function(){\n        ctx.drawImage(sourceElement, 0, 0, sourceWidth, sourceHeight);\n        ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      }\n      originalImageData.crossOrigin = 'anonymous';\n      originalImageData.onload = function(){\n        ctx.drawImage(sourceElement, 0, 0, sourceWidth, sourceHeight);\n        ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      }\n\n      imageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      originalImageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var pipelineState = {\n        sourceWidth: sourceWidth,\n        sourceHeight: sourceHeight,\n        imageData: imageData,\n        originalEl: sourceElement,\n        originalImageData: originalImageData,\n        canvasEl: targetCanvas,\n        ctx: ctx,\n        filterBackend: this,\n      };\n      filters.forEach(function(filter) { filter.applyTo(pipelineState); });\n      if (pipelineState.imageData.width !== sourceWidth || pipelineState.imageData.height !== sourceHeight) {\n        targetCanvas.width = pipelineState.imageData.width;\n        targetCanvas.height = pipelineState.imageData.height;\n      }\n      ctx.putImageData(pipelineState.imageData, 0, 0);\n      return pipelineState;\n    },\n\n  };\n})();\n/**\n * @namespace fabric.Image.filters\n * @memberOf fabric.Image\n * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#image_filters}\n * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n */\nfabric.Image = fabric.Image || { };\nfabric.Image.filters = fabric.Image.filters || { };\n\n/**\n * Root filter class from which all filter classes inherit from\n * @class fabric.Image.filters.BaseFilter\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.BaseFilter = fabric.util.createClass(/** @lends fabric.Image.filters.BaseFilter.prototype */ {\n\n  /**\n   * Filter type\n   * @param {String} type\n   * @default\n   */\n  type: 'BaseFilter',\n\n  /**\n   * Array of attributes to send with buffers. do not modify\n   * @private\n   */\n\n  vertexSource: 'attribute vec2 aPosition;\\n' +\n    'varying vec2 vTexCoord;\\n' +\n    'void main() {\\n' +\n      'vTexCoord = aPosition;\\n' +\n      'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\n    '}',\n\n  fragmentSource: 'precision highp float;\\n' +\n    'varying vec2 vTexCoord;\\n' +\n    'uniform sampler2D uTexture;\\n' +\n    'void main() {\\n' +\n      'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\n    '}',\n\n  /**\n   * Constructor\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    if (options) {\n      this.setOptions(options);\n    }\n  },\n\n  /**\n   * Sets filter's properties from options\n   * @param {Object} [options] Options object\n   */\n  setOptions: function(options) {\n    for (var prop in options) {\n      this[prop] = options[prop];\n    }\n  },\n\n  /**\n   * Compile this filter's shader program.\n   *\n   * @param {WebGLRenderingContext} gl The GL canvas context to use for shader compilation.\n   * @param {String} fragmentSource fragmentShader source for compilation\n   * @param {String} vertexSource vertexShader source for compilation\n   */\n  createProgram: function(gl, fragmentSource, vertexSource) {\n    fragmentSource = fragmentSource || this.fragmentSource;\n    vertexSource = vertexSource || this.vertexSource;\n    if (fabric.webGlPrecision !== 'highp'){\n      fragmentSource = fragmentSource.replace(\n        /precision highp float/g,\n        'precision ' + fabric.webGlPrecision + ' float'\n      );\n    }\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vertexShader, vertexSource);\n    gl.compileShader(vertexShader);\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Vertex shader compile error for ' + this.type + ': ' +\n        gl.getShaderInfoLog(vertexShader)\n      );\n    }\n\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Fragment shader compile error for ' + this.type + ': ' +\n        gl.getShaderInfoLog(fragmentShader)\n      );\n    }\n\n    var program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Shader link error for \"${this.type}\" ' +\n        gl.getProgramInfoLog(program)\n      );\n    }\n\n    var attributeLocations = this.getAttributeLocations(gl, program);\n    var uniformLocations = this.getUniformLocations(gl, program) || { };\n    uniformLocations.uStepW = gl.getUniformLocation(program, 'uStepW');\n    uniformLocations.uStepH = gl.getUniformLocation(program, 'uStepH');\n    return {\n      program: program,\n      attributeLocations: attributeLocations,\n      uniformLocations: uniformLocations\n    };\n  },\n\n  /**\n   * Return a map of attribute names to WebGLAttributeLocation objects.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {WebGLShaderProgram} program The shader program from which to take attribute locations.\n   * @returns {Object} A map of attribute names to attribute locations.\n   */\n  getAttributeLocations: function(gl, program) {\n    return {\n      aPosition: gl.getAttribLocation(program, 'aPosition'),\n    };\n  },\n\n  /**\n   * Return a map of uniform names to WebGLUniformLocation objects.\n   *\n   * Intended to be overridden by subclasses.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {WebGLShaderProgram} program The shader program from which to take uniform locations.\n   * @returns {Object} A map of uniform names to uniform locations.\n   */\n  getUniformLocations: function (/* gl, program */) {\n    // in case i do not need any special uniform i need to return an empty object\n    return { };\n  },\n\n  /**\n   * Send attribute data from this filter to its shader program on the GPU.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {Object} attributeLocations A map of shader attribute names to their locations.\n   */\n  sendAttributeData: function(gl, attributeLocations, aPositionData) {\n    var attributeLocation = attributeLocations.aPosition;\n    var buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.enableVertexAttribArray(attributeLocation);\n    gl.vertexAttribPointer(attributeLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.bufferData(gl.ARRAY_BUFFER, aPositionData, gl.STATIC_DRAW);\n  },\n\n  _setupFrameBuffer: function(options) {\n    var gl = options.context, width, height;\n    if (options.passes > 1) {\n      width = options.destinationWidth;\n      height = options.destinationHeight;\n      if (options.sourceWidth !== width || options.sourceHeight !== height) {\n        gl.deleteTexture(options.targetTexture);\n        options.targetTexture = options.filterBackend.createTexture(gl, width, height);\n      }\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D,\n        options.targetTexture, 0);\n    }\n    else {\n      // draw last filter on canvas and not to framebuffer.\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.finish();\n    }\n  },\n\n  _swapTextures: function(options) {\n    options.passes--;\n    options.pass++;\n    var temp = options.targetTexture;\n    options.targetTexture = options.sourceTexture;\n    options.sourceTexture = temp;\n  },\n\n  /**\n   * Generic isNeutral implementation for one parameter based filters.\n   * Used only in image applyFilters to discard filters that will not have an effect\n   * on the image\n   * Other filters may need their own verison ( ColorMatrix, HueRotation, gamma, ComposedFilter )\n   * @param {Object} options\n   **/\n  isNeutralState: function(/* options */) {\n    var main = this.mainParameter,\n        _class = fabric.Image.filters[this.type].prototype;\n    if (main) {\n      if (Array.isArray(_class[main])) {\n        for (var i = _class[main].length; i--;) {\n          if (this[main][i] !== _class[main][i]) {\n            return false;\n          }\n        }\n        return true;\n      }\n      else {\n        return _class[main] === this[main];\n      }\n    }\n    else {\n      return false;\n    }\n  },\n\n  /**\n   * Apply this filter to the input image data provided.\n   *\n   * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n   *\n   * @param {Object} options\n   * @param {Number} options.passes The number of filters remaining to be executed\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  applyTo: function(options) {\n    if (options.webgl) {\n      this._setupFrameBuffer(options);\n      this.applyToWebGL(options);\n      this._swapTextures(options);\n    }\n    else {\n      this.applyTo2d(options);\n    }\n  },\n\n  /**\n   * Retrieves the cached shader.\n   * @param {Object} options\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  retrieveShader: function(options) {\n    if (!options.programCache.hasOwnProperty(this.type)) {\n      options.programCache[this.type] = this.createProgram(options.context);\n    }\n    return options.programCache[this.type];\n  },\n\n  /**\n   * Apply this filter using webgl.\n   *\n   * @param {Object} options\n   * @param {Number} options.passes The number of filters remaining to be executed\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n   * @param {WebGLTexture} options.originalTexture The texture of the original input image.\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  applyToWebGL: function(options) {\n    var gl = options.context;\n    var shader = this.retrieveShader(options);\n    if (options.pass === 0 && options.originalTexture) {\n      gl.bindTexture(gl.TEXTURE_2D, options.originalTexture);\n    }\n    else {\n      gl.bindTexture(gl.TEXTURE_2D, options.sourceTexture);\n    }\n    gl.useProgram(shader.program);\n    this.sendAttributeData(gl, shader.attributeLocations, options.aPosition);\n\n    gl.uniform1f(shader.uniformLocations.uStepW, 1 / options.sourceWidth);\n    gl.uniform1f(shader.uniformLocations.uStepH, 1 / options.sourceHeight);\n\n    this.sendUniformData(gl, shader.uniformLocations);\n    gl.viewport(0, 0, options.destinationWidth, options.destinationHeight);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  },\n\n  bindAdditionalTexture: function(gl, texture, textureUnit) {\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    // reset active texture to 0 as usual\n    gl.activeTexture(gl.TEXTURE0);\n  },\n\n  unbindAdditionalTexture: function(gl, textureUnit) {\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    gl.activeTexture(gl.TEXTURE0);\n  },\n\n  getMainParameter: function() {\n    return this[this.mainParameter];\n  },\n\n  setMainParameter: function(value) {\n    this[this.mainParameter] = value;\n  },\n\n  /**\n   * Send uniform data from this filter to its shader program on the GPU.\n   *\n   * Intended to be overridden by subclasses.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {Object} uniformLocations A map of shader uniform names to their locations.\n   */\n  sendUniformData: function(/* gl, uniformLocations */) {\n    // Intentionally left blank.  Override me in subclasses.\n  },\n\n  /**\n   * If needed by a 2d filter, this functions can create an helper canvas to be used\n   * remember that options.targetCanvas is available for use till end of chain.\n   */\n  createHelpLayer: function(options) {\n    if (!options.helpLayer) {\n      var helpLayer = document.createElement('canvas');\n      helpLayer.width = options.sourceWidth;\n      helpLayer.height = options.sourceHeight;\n      options.helpLayer = helpLayer;\n    }\n  },\n\n  /**\n   * Returns object representation of an instance\n   * @return {Object} Object representation of an instance\n   */\n  toObject: function() {\n    var object = { type: this.type }, mainP = this.mainParameter;\n    if (mainP) {\n      object[mainP] = this[mainP];\n    }\n    return object;\n  },\n\n  /**\n   * Returns a JSON representation of an instance\n   * @return {Object} JSON\n   */\n  toJSON: function() {\n    // delegate, not alias\n    return this.toObject();\n  }\n});\n\nfabric.Image.filters.BaseFilter.fromObject = function(object, callback) {\n  var filter = new fabric.Image.filters[object.type](object);\n  callback && callback(filter);\n  return filter;\n};\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Matrix filter class\n   * @class fabric.Image.filters.ColorMatrix\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.ColorMatrix#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @see {@Link http://www.webwasp.co.uk/tutorials/219/Color_Matrix_Filter.php}\n   * @see {@Link http://phoboslab.org/log/2013/11/fast-image-filters-with-webgl}\n   * @example <caption>Kodachrome filter</caption>\n   * var filter = new fabric.Image.filters.ColorMatrix({\n   *  matrix: [\n       1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,\n       -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,\n       -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946,\n       0, 0, 0, 1, 0\n      ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.ColorMatrix = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.ColorMatrix.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'ColorMatrix',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'uniform mat4 uColorMatrix;\\n' +\n      'uniform vec4 uConstants;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color *= uColorMatrix;\\n' +\n        'color += uConstants;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Colormatrix for pixels.\n     * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n     * outside the -1, 1 range.\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n     * @param {Array} matrix array of 20 numbers.\n     * @default\n     */\n    matrix: [\n      1, 0, 0, 0, 0,\n      0, 1, 0, 0, 0,\n      0, 0, 1, 0, 0,\n      0, 0, 0, 1, 0\n    ],\n\n    mainParameter: 'matrix',\n\n    /**\n     * Lock the colormatrix on the color part, skipping alpha, manly for non webgl scenario\n     * to save some calculation\n     */\n    colorsOnly: true,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      // create a new array instead mutating the prototype with push\n      this.matrix = this.matrix.slice(0);\n    },\n\n    /**\n     * Apply the ColorMatrix operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          iLen = data.length,\n          m = this.matrix,\n          r, g, b, a, i, colorsOnly = this.colorsOnly;\n\n      for (i = 0; i < iLen; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n        if (colorsOnly) {\n          data[i] = r * m[0] + g * m[1] + b * m[2] + m[4] * 255;\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + m[9] * 255;\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + m[14] * 255;\n        }\n        else {\n          a = data[i + 3];\n          data[i] = r * m[0] + g * m[1] + b * m[2] + a * m[3] + m[4] * 255;\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + a * m[8] + m[9] * 255;\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + a * m[13] + m[14] * 255;\n          data[i + 3] = r * m[15] + g * m[16] + b * m[17] + a * m[18] + m[19] * 255;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uColorMatrix: gl.getUniformLocation(program, 'uColorMatrix'),\n        uConstants: gl.getUniformLocation(program, 'uConstants'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var m = this.matrix,\n          matrix = [\n            m[0], m[1], m[2], m[3],\n            m[5], m[6], m[7], m[8],\n            m[10], m[11], m[12], m[13],\n            m[15], m[16], m[17], m[18]\n          ],\n          constants = [m[4], m[9], m[14], m[19]];\n      gl.uniformMatrix4fv(uniformLocations.uColorMatrix, false, matrix);\n      gl.uniform4fv(uniformLocations.uConstants, constants);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] function to invoke after filter creation\n   * @return {fabric.Image.filters.ColorMatrix} Instance of fabric.Image.filters.ColorMatrix\n   */\n  fabric.Image.filters.ColorMatrix.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Brightness filter class\n   * @class fabric.Image.filters.Brightness\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Brightness({\n   *   brightness: 0.05\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Brightness = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Brightness.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Brightness',\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uBrightness;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color.rgb += uBrightness;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Brightness value, from -1 to 1.\n     * translated to -255 to 255 for 2d\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n     * @param {Number} brightness\n     * @default\n     */\n    brightness: 0,\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'brightness',\n\n    /**\n    * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n    *\n    * @param {Object} options\n    * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n    */\n    applyTo2d: function(options) {\n      if (this.brightness === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, i, len = data.length,\n          brightness = Math.round(this.brightness * 255);\n      for (i = 0; i < len; i += 4) {\n        data[i] = data[i] + brightness;\n        data[i + 1] = data[i + 1] + brightness;\n        data[i + 2] = data[i + 2] + brightness;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uBrightness: gl.getUniformLocation(program, 'uBrightness'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uBrightness, this.brightness);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness\n   */\n  fabric.Image.filters.Brightness.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Adapted from <a href=\"http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\">html5rocks article</a>\n   * @class fabric.Image.filters.Convolute\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Sharpen filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 0, -1,  0,\n   *            -1,  5, -1,\n   *             0, -1,  0 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Blur filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter with opaqueness</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   opaque: true,\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Convolute = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Convolute.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Convolute',\n\n    /*\n     * Opaque value (true/false)\n     */\n    opaque: false,\n\n    /*\n     * matrix for the filter, max 9x9\n     */\n    matrix: [0, 0, 0, 0, 1, 0, 0, 0, 0],\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: {\n      Convolute_3_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[9];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_3_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[9];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_5_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[25];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_5_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[25];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_7_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[49];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_7_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[49];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_9_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[81];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_9_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[81];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n    },\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Convolute.prototype\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.opaque=false] Opaque value (true/false)\n     * @param {Array} [options.matrix] Filter matrix\n     */\n\n\n    /**\n    * Retrieves the cached shader.\n    * @param {Object} options\n    * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n    * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n    */\n    retrieveShader: function(options) {\n      var size = Math.sqrt(this.matrix.length);\n      var cacheKey = this.type + '_' + size + '_' + (this.opaque ? 1 : 0);\n      var shaderSource = this.fragmentSource[cacheKey];\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          weights = this.matrix,\n          side = Math.round(Math.sqrt(weights.length)),\n          halfSide = Math.floor(side / 2),\n          sw = imageData.width,\n          sh = imageData.height,\n          output = options.ctx.createImageData(sw, sh),\n          dst = output.data,\n          // go through the destination image pixels\n          alphaFac = this.opaque ? 1 : 0,\n          r, g, b, a, dstOff,\n          scx, scy, srcOff, wt,\n          x, y, cx, cy;\n\n      for (y = 0; y < sh; y++) {\n        for (x = 0; x < sw; x++) {\n          dstOff = (y * sw + x) * 4;\n          // calculate the weighed sum of the source image pixels that\n          // fall under the convolution matrix\n          r = 0; g = 0; b = 0; a = 0;\n\n          for (cy = 0; cy < side; cy++) {\n            for (cx = 0; cx < side; cx++) {\n              scy = y + cy - halfSide;\n              scx = x + cx - halfSide;\n\n              // eslint-disable-next-line max-depth\n              if (scy < 0 || scy > sh || scx < 0 || scx > sw) {\n                continue;\n              }\n\n              srcOff = (scy * sw + scx) * 4;\n              wt = weights[cy * side + cx];\n\n              r += data[srcOff] * wt;\n              g += data[srcOff + 1] * wt;\n              b += data[srcOff + 2] * wt;\n              // eslint-disable-next-line max-depth\n              if (!alphaFac) {\n                a += data[srcOff + 3] * wt;\n              }\n            }\n          }\n          dst[dstOff] = r;\n          dst[dstOff + 1] = g;\n          dst[dstOff + 2] = b;\n          if (!alphaFac) {\n            dst[dstOff + 3] = a;\n          }\n          else {\n            dst[dstOff + 3] = data[dstOff + 3];\n          }\n        }\n      }\n      options.imageData = output;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uMatrix: gl.getUniformLocation(program, 'uMatrix'),\n        uOpaque: gl.getUniformLocation(program, 'uOpaque'),\n        uHalfSize: gl.getUniformLocation(program, 'uHalfSize'),\n        uSize: gl.getUniformLocation(program, 'uSize'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1fv(uniformLocations.uMatrix, this.matrix);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        opaque: this.opaque,\n        matrix: this.matrix\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute\n   */\n  fabric.Image.filters.Convolute.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Grayscale image filter class\n   * @class fabric.Image.filters.Grayscale\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Grayscale();\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Grayscale = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Grayscale.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Grayscale',\n\n    fragmentSource: {\n      average: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = (color.r + color.b + color.g) / 3.0;\\n' +\n          'gl_FragColor = vec4(average, average, average, color.a);\\n' +\n        '}',\n      lightness: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform int uMode;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\\n' +\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\n        '}',\n      luminosity: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform int uMode;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\\n' +\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\n        '}',\n    },\n\n\n    /**\n     * Grayscale mode, between 'average', 'lightness', 'luminosity'\n     * @param {String} type\n     * @default\n     */\n    mode: 'average',\n\n    mainParameter: 'mode',\n\n    /**\n     * Apply the Grayscale operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          len = data.length, value,\n          mode = this.mode;\n      for (i = 0; i < len; i += 4) {\n        if (mode === 'average') {\n          value = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        }\n        else if (mode === 'lightness') {\n          value = (Math.min(data[i], data[i + 1], data[i + 2]) +\n            Math.max(data[i], data[i + 1], data[i + 2])) / 2;\n        }\n        else if (mode === 'luminosity') {\n          value = 0.21 * data[i] + 0.72 * data[i + 1] + 0.07 * data[i + 2];\n        }\n        data[i] = value;\n        data[i + 1] = value;\n        data[i + 2] = value;\n      }\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        var shaderSource = this.fragmentSource[this.mode];\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uMode: gl.getUniformLocation(program, 'uMode'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      // default average mode.\n      var mode = 1;\n      gl.uniform1i(uniformLocations.uMode, mode);\n    },\n\n    /**\n     * Grayscale filter isNeutralState implementation\n     * The filter is never neutral\n     * on the image\n     **/\n    isNeutralState: function() {\n      return false;\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale\n   */\n  fabric.Image.filters.Grayscale.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Invert filter class\n   * @class fabric.Image.filters.Invert\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Invert();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Invert = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Invert.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Invert',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform int uInvert;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'if (uInvert == 1) {\\n' +\n          'gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\\n' +\n        '} else {\\n' +\n          'gl_FragColor = color;\\n' +\n        '}\\n' +\n      '}',\n\n    /**\n     * Filter invert. if false, does nothing\n     * @param {Boolean} invert\n     * @default\n     */\n    invert: true,\n\n    mainParameter: 'invert',\n\n    /**\n     * Apply the Invert operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          len = data.length;\n      for (i = 0; i < len; i += 4) {\n        data[i] = 255 - data[i];\n        data[i + 1] = 255 - data[i + 1];\n        data[i + 2] = 255 - data[i + 2];\n      }\n    },\n\n    /**\n     * Invert filter isNeutralState implementation\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * @param {Object} options\n     **/\n    isNeutralState: function() {\n      return !this.invert;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uInvert: gl.getUniformLocation(program, 'uInvert'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1i(uniformLocations.uInvert, this.invert);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert\n   */\n  fabric.Image.filters.Invert.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Noise filter class\n   * @class fabric.Image.filters.Noise\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Noise#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Noise({\n   *   noise: 700\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Noise = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Noise.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Noise',\n\n    /**\n     * Fragment source for the noise program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uStepH;\\n' +\n      'uniform float uNoise;\\n' +\n      'uniform float uSeed;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'float rand(vec2 co, float seed, float vScale) {\\n' +\n        'return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\\n' +\n      '}\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'noise',\n\n    /**\n     * Noise value, from\n     * @param {Number} noise\n     * @default\n     */\n    noise: 0,\n\n    /**\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.noise === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, i, len = data.length,\n          noise = this.noise, rand;\n\n      for (i = 0, len = data.length; i < len; i += 4) {\n\n        rand = (0.5 - Math.random()) * noise;\n\n        data[i] += rand;\n        data[i + 1] += rand;\n        data[i + 2] += rand;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uNoise: gl.getUniformLocation(program, 'uNoise'),\n        uSeed: gl.getUniformLocation(program, 'uSeed'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uNoise, this.noise / 255);\n      gl.uniform1f(uniformLocations.uSeed, Math.random());\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        noise: this.noise\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise\n   */\n  fabric.Image.filters.Noise.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Pixelate filter class\n   * @class fabric.Image.filters.Pixelate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Pixelate({\n   *   blocksize: 8\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Pixelate = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Pixelate.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Pixelate',\n\n    blocksize: 4,\n\n    mainParameter: 'blocksize',\n\n    /**\n     * Fragment source for the Pixelate program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uBlocksize;\\n' +\n      'uniform float uStepW;\\n' +\n      'uniform float uStepH;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'float blockW = uBlocksize * uStepW;\\n' +\n        'float blockH = uBlocksize * uStepW;\\n' +\n        'int posX = int(vTexCoord.x / blockW);\\n' +\n        'int posY = int(vTexCoord.y / blockH);\\n' +\n        'float fposX = float(posX);\\n' +\n        'float fposY = float(posY);\\n' +\n        'vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\\n' +\n        'vec4 color = texture2D(uTexture, squareCoords);\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Apply the Pixelate operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          iLen = imageData.height,\n          jLen = imageData.width,\n          index, i, j, r, g, b, a,\n          _i, _j, _iLen, _jLen;\n\n      for (i = 0; i < iLen; i += this.blocksize) {\n        for (j = 0; j < jLen; j += this.blocksize) {\n\n          index = (i * 4) * jLen + (j * 4);\n\n          r = data[index];\n          g = data[index + 1];\n          b = data[index + 2];\n          a = data[index + 3];\n\n          _iLen = Math.min(i + this.blocksize, iLen);\n          _jLen = Math.min(j + this.blocksize, jLen);\n          for (_i = i; _i < _iLen; _i++) {\n            for (_j = j; _j < _jLen; _j++) {\n              index = (_i * 4) * jLen + (_j * 4);\n              data[index] = r;\n              data[index + 1] = g;\n              data[index + 2] = b;\n              data[index + 3] = a;\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Indicate when the filter is not gonna apply changes to the image\n     **/\n    isNeutralState: function() {\n      return this.blocksize === 1;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uBlocksize: gl.getUniformLocation(program, 'uBlocksize'),\n        uStepW: gl.getUniformLocation(program, 'uStepW'),\n        uStepH: gl.getUniformLocation(program, 'uStepH'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uBlocksize, this.blocksize);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate\n   */\n  fabric.Image.filters.Pixelate.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Remove white filter class\n   * @class fabric.Image.filters.RemoveColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.RemoveColor#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.RemoveColor({\n   *   threshold: 0.2,\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.RemoveColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.RemoveColor.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'RemoveColor',\n\n    /**\n     * Color to remove, in any format understood by fabric.Color.\n     * @param {String} type\n     * @default\n     */\n    color: '#FFFFFF',\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec4 uLow;\\n' +\n      'uniform vec4 uHigh;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\n        'if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\\n' +\n          'gl_FragColor.a = 0.0;\\n' +\n        '}\\n' +\n      '}',\n\n    /**\n     * distance to actual color, as value up or down from each r,g,b\n     * between 0 and 1\n     **/\n    distance: 0.02,\n\n    /**\n     * For color to remove inside distance, use alpha channel for a smoother deletion\n     * NOT IMPLEMENTED YET\n     **/\n    useAlpha: false,\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.RemoveWhite.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.color=#RRGGBB] Threshold value\n     * @param {Number} [options.distance=10] Distance value\n     */\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          distance = this.distance * 255,\n          r, g, b,\n          source = new fabric.Color(this.color).getSource(),\n          lowC = [\n            source[0] - distance,\n            source[1] - distance,\n            source[2] - distance,\n          ],\n          highC = [\n            source[0] + distance,\n            source[1] + distance,\n            source[2] + distance,\n          ];\n\n\n      for (i = 0; i < data.length; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        if (r > lowC[0] &&\n            g > lowC[1] &&\n            b > lowC[2] &&\n            r < highC[0] &&\n            g < highC[1] &&\n            b < highC[2]) {\n          data[i + 3] = 0;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uLow: gl.getUniformLocation(program, 'uLow'),\n        uHigh: gl.getUniformLocation(program, 'uHigh'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var source = new fabric.Color(this.color).getSource(),\n          distance = parseFloat(this.distance),\n          lowC = [\n            0 + source[0] / 255 - distance,\n            0 + source[1] / 255 - distance,\n            0 + source[2] / 255 - distance,\n            1\n          ],\n          highC = [\n            source[0] / 255 + distance,\n            source[1] / 255 + distance,\n            source[2] / 255 + distance,\n            1\n          ];\n      gl.uniform4fv(uniformLocations.uLow, lowC);\n      gl.uniform4fv(uniformLocations.uHigh, highC);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        color: this.color,\n        distance: this.distance\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.RemoveColor} Instance of fabric.Image.filters.RemoveWhite\n   */\n  fabric.Image.filters.RemoveColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  var matrices = {\n    Brownie: [\n      0.59970,0.34553,-0.27082,0,0.186,\n      -0.03770,0.86095,0.15059,0,-0.1449,\n      0.24113,-0.07441,0.44972,0,-0.02965,\n      0,0,0,1,0\n    ],\n    Vintage: [\n      0.62793,0.32021,-0.03965,0,0.03784,\n      0.02578,0.64411,0.03259,0,0.02926,\n      0.04660,-0.08512,0.52416,0,0.02023,\n      0,0,0,1,0\n    ],\n    Kodachrome: [\n      1.12855,-0.39673,-0.03992,0,0.24991,\n      -0.16404,1.08352,-0.05498,0,0.09698,\n      -0.16786,-0.56034,1.60148,0,0.13972,\n      0,0,0,1,0\n    ],\n    Technicolor: [\n      1.91252,-0.85453,-0.09155,0,0.04624,\n      -0.30878,1.76589,-0.10601,0,-0.27589,\n      -0.23110,-0.75018,1.84759,0,0.12137,\n      0,0,0,1,0\n    ],\n    Polaroid: [\n      1.438,-0.062,-0.062,0,0,\n      -0.122,1.378,-0.122,0,0,\n      -0.016,-0.016,1.483,0,0,\n      0,0,0,1,0\n    ],\n    Sepia: [\n      0.393, 0.769, 0.189, 0, 0,\n      0.349, 0.686, 0.168, 0, 0,\n      0.272, 0.534, 0.131, 0, 0,\n      0, 0, 0, 1, 0\n    ],\n    BlackWhite: [\n      1.5, 1.5, 1.5, 0, -1,\n      1.5, 1.5, 1.5, 0, -1,\n      1.5, 1.5, 1.5, 0, -1,\n      0, 0, 0, 1, 0,\n    ]\n  };\n\n  for (var key in matrices) {\n    filters[key] = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.Sepia.prototype */ {\n\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: key,\n\n      /**\n       * Colormatrix for the effect\n       * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n       * outside the -1, 1 range.\n       * @param {Array} matrix array of 20 numbers.\n       * @default\n       */\n      matrix: matrices[key],\n\n      /**\n       * Lock the matrix export for this kind of static, parameter less filters.\n       */\n      mainParameter: false,\n      /**\n       * Lock the colormatrix on the color part, skipping alpha\n       */\n      colorsOnly: true,\n\n    });\n    fabric.Image.filters[key].fromObject = fabric.Image.filters.BaseFilter.fromObject;\n  }\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Blend filter class\n   * @class fabric.Image.filter.BlendColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blend.prototype */ {\n    type: 'BlendColor',\n\n    /**\n     * Color to make the blend operation with. default to a reddish color since black or white\n     * gives always strong result.\n     **/\n    color: '#F95C63',\n\n    /**\n     * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n     * darken, lighten, overlay, exclusion, tint.\n     **/\n    mode: 'multiply',\n\n    /**\n     * alpha value. represent the strength of the blend color operation.\n     **/\n    alpha: 1,\n\n    /**\n     * Fragment source for the Multiply program\n     */\n    fragmentSource: {\n      multiply: 'gl_FragColor.rgb *= uColor.rgb;\\n',\n      screen: 'gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\\n',\n      add: 'gl_FragColor.rgb += uColor.rgb;\\n',\n      diff: 'gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\\n',\n      subtract: 'gl_FragColor.rgb -= uColor.rgb;\\n',\n      lighten: 'gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\\n',\n      darken: 'gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\\n',\n      exclusion: 'gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\\n',\n      overlay: 'if (uColor.r < 0.5) {\\n' +\n          'gl_FragColor.r *= 2.0 * uColor.r;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\\n' +\n        '}\\n' +\n        'if (uColor.g < 0.5) {\\n' +\n          'gl_FragColor.g *= 2.0 * uColor.g;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\\n' +\n        '}\\n' +\n        'if (uColor.b < 0.5) {\\n' +\n          'gl_FragColor.b *= 2.0 * uColor.b;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\\n' +\n        '}\\n',\n      tint: 'gl_FragColor.rgb *= (1.0 - uColor.a);\\n' +\n        'gl_FragColor.rgb += uColor.rgb;\\n',\n    },\n\n    /**\n     * build the fragment source for the filters, joining the common part with\n     * the specific one.\n     * @param {String} mode the mode of the filter, a key of this.fragmentSource\n     * @return {String} the source to be compiled\n     * @private\n     */\n    buildSource: function(mode) {\n      return 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'gl_FragColor = color;\\n' +\n          'if (color.a > 0.0) {\\n' +\n            this.fragmentSource[mode] +\n          '}\\n' +\n        '}';\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode, shaderSource;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        shaderSource = this.buildSource(this.mode);\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, iLen = data.length,\n          tr, tg, tb,\n          r, g, b,\n          source, alpha1 = 1 - this.alpha;\n\n      source = new fabric.Color(this.color).getSource();\n      tr = source[0] * this.alpha;\n      tg = source[1] * this.alpha;\n      tb = source[2] * this.alpha;\n\n      for (var i = 0; i < iLen; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            break;\n          case 'screen':\n            data[i] = 255 - (255 - r) * (255 - tr) / 255;\n            data[i + 1] = 255 - (255 - g) * (255 - tg) / 255;\n            data[i + 2] = 255 - (255 - b) * (255 - tb) / 255;\n            break;\n          case 'add':\n            data[i] = r + tr;\n            data[i + 1] = g + tg;\n            data[i + 2] = b + tb;\n            break;\n          case 'diff':\n          case 'difference':\n            data[i] = Math.abs(r - tr);\n            data[i + 1] = Math.abs(g - tg);\n            data[i + 2] = Math.abs(b - tb);\n            break;\n          case 'subtract':\n            data[i] = r - tr;\n            data[i + 1] = g - tg;\n            data[i + 2] = b - tb;\n            break;\n          case 'darken':\n            data[i] = Math.min(r, tr);\n            data[i + 1] = Math.min(g, tg);\n            data[i + 2] = Math.min(b, tb);\n            break;\n          case 'lighten':\n            data[i] = Math.max(r, tr);\n            data[i + 1] = Math.max(g, tg);\n            data[i + 2] = Math.max(b, tb);\n            break;\n          case 'overlay':\n            data[i] = tr < 128 ? (2 * r * tr / 255) : (255 - 2 * (255 - r) * (255 - tr) / 255);\n            data[i + 1] = tg < 128 ? (2 * g * tg / 255) : (255 - 2 * (255 - g) * (255 - tg) / 255);\n            data[i + 2] = tb < 128 ? (2 * b * tb / 255) : (255 - 2 * (255 - b) * (255 - tb) / 255);\n            break;\n          case 'exclusion':\n            data[i] = tr + r - ((2 * tr * r) / 255);\n            data[i + 1] = tg + g - ((2 * tg * g) / 255);\n            data[i + 2] = tb + b - ((2 * tb * b) / 255);\n            break;\n          case 'tint':\n            data[i] = tr + r * alpha1;\n            data[i + 1] = tg + g * alpha1;\n            data[i + 2] = tb + b * alpha1;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uColor: gl.getUniformLocation(program, 'uColor'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var source = new fabric.Color(this.color).getSource();\n      source[0] = this.alpha * source[0] / 255;\n      source[1] = this.alpha * source[1] / 255;\n      source[2] = this.alpha * source[2] / 255;\n      source[3] = this.alpha;\n      gl.uniform4fv(uniformLocations.uColor, source);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        color: this.color,\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendColor} Instance of fabric.Image.filters.BlendColor\n   */\n  fabric.Image.filters.BlendColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Image Blend filter class\n   * @class fabric.Image.filter.BlendImage\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendImage = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.BlendImage.prototype */ {\n    type: 'BlendImage',\n\n    /**\n     * Color to make the blend operation with. default to a reddish color since black or white\n     * gives always strong result.\n     **/\n    image: null,\n\n    /**\n     * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n     * darken, lighten, overlay, exclusion, tint.\n     **/\n    mode: 'multiply',\n\n    /**\n     * alpha value. represent the strength of the blend image operation.\n     * not implemented.\n     **/\n    alpha: 1,\n\n    vertexSource: 'attribute vec2 aPosition;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'varying vec2 vTexCoord2;\\n' +\n      'uniform mat3 uTransformMatrix;\\n' +\n      'void main() {\\n' +\n        'vTexCoord = aPosition;\\n' +\n        'vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\\n' +\n        'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\n      '}',\n\n    /**\n     * Fragment source for the Multiply program\n     */\n    fragmentSource: {\n      multiply: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform sampler2D uImage;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'varying vec2 vTexCoord2;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\n          'color.rgba *= color2.rgba;\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      mask: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform sampler2D uImage;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'varying vec2 vTexCoord2;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\n          'color.a = color2.a;\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode;\n      var shaderSource = this.fragmentSource[this.mode];\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    applyToWebGL: function(options) {\n      // load texture to blend.\n      var gl = options.context,\n          texture = this.createTexture(options.filterBackend, this.image);\n      this.bindAdditionalTexture(gl, texture, gl.TEXTURE1);\n      this.callSuper('applyToWebGL', options);\n      this.unbindAdditionalTexture(gl, gl.TEXTURE1);\n    },\n\n    createTexture: function(backend, image) {\n      return backend.getCachedTexture(image.cacheKey, image._element);\n    },\n\n    /**\n     * Calculate a transformMatrix to adapt the image to blend over\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    calculateMatrix: function() {\n      var image = this.image,\n          width = image._element.width,\n          height = image._element.height;\n      return [\n        1 / image.scaleX, 0, 0,\n        0, 1 / image.scaleY, 0,\n        -image.left / width, -image.top / height, 1\n      ];\n    },\n\n    /**\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          resources = options.filterBackend.resources,\n          data = imageData.data, iLen = data.length,\n          width = imageData.width,\n          height = imageData.height,\n          tr, tg, tb, ta,\n          r, g, b, a,\n          canvas1, context, image = this.image, blendData;\n\n      if (!resources.blendImage) {\n        resources.blendImage = fabric.util.createCanvasElement();\n      }\n      canvas1 = resources.blendImage;\n      context = canvas1.getContext('2d');\n      if (canvas1.width !== width || canvas1.height !== height) {\n        canvas1.width = width;\n        canvas1.height = height;\n      }\n      else {\n        context.clearRect(0, 0, width, height);\n      }\n      context.setTransform(image.scaleX, 0, 0, image.scaleY, image.left, image.top);\n      var img = new Image();\n      img.crossOrigin = 'anonymous';//add by zhoujun --20190623\n      img.onload = function(){\n        context.drawImage(image._element, 0, 0, width, height);\n        context.getImageData(0, 0, width, height);\n      }\n      img = context.getImageData(0, 0, width, height)\n      blendData = img.data;\n      for (var i = 0; i < iLen; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n        a = data[i + 3];\n\n        tr = blendData[i];\n        tg = blendData[i + 1];\n        tb = blendData[i + 2];\n        ta = blendData[i + 3];\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            data[i + 3] = a * ta / 255;\n            break;\n          case 'mask':\n            data[i + 3] = ta;\n            break;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uTransformMatrix: gl.getUniformLocation(program, 'uTransformMatrix'),\n        uImage: gl.getUniformLocation(program, 'uImage'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var matrix = this.calculateMatrix();\n      gl.uniform1i(uniformLocations.uImage, 1); // texture unit 1.\n      gl.uniformMatrix3fv(uniformLocations.uTransformMatrix, false, matrix);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        image: this.image && this.image.toObject(),\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} callback to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendImage} Instance of fabric.Image.filters.BlendImage\n   */\n  fabric.Image.filters.BlendImage.fromObject = function(object, callback) {\n    fabric.Image.fromObject(object.image, function(image) {\n      var options = fabric.util.object.clone(object);\n      options.image = image;\n      callback(new fabric.Image.filters.BlendImage(options));\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }), pow = Math.pow, floor = Math.floor,\n      sqrt = Math.sqrt, abs = Math.abs, round = Math.round, sin = Math.sin,\n      ceil = Math.ceil,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Resize image filter class\n   * @class fabric.Image.filters.Resize\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Resize();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Resize = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Resize.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Resize',\n\n    /**\n     * Resize type\n     * for webgl resizeType is just lanczos, for canvas2d can be:\n     * bilinear, hermite, sliceHack, lanczos.\n     * @param {String} resizeType\n     * @default\n     */\n    resizeType: 'hermite',\n\n    /**\n     * Scale factor for resizing, x axis\n     * @param {Number} scaleX\n     * @default\n     */\n    scaleX: 1,\n\n    /**\n     * Scale factor for resizing, y axis\n     * @param {Number} scaleY\n     * @default\n     */\n    scaleY: 1,\n\n    /**\n     * LanczosLobes parameter for lanczos filter, valid for resizeType lanczos\n     * @param {Number} lanczosLobes\n     * @default\n     */\n    lanczosLobes: 3,\n\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uDelta: gl.getUniformLocation(program, 'uDelta'),\n        uTaps: gl.getUniformLocation(program, 'uTaps'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform2fv(uniformLocations.uDelta, this.horizontal ? [1 / this.width, 0] : [0, 1 / this.height]);\n      gl.uniform1fv(uniformLocations.uTaps, this.taps);\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var filterWindow = this.getFilterWindow(), cacheKey = this.type + '_' + filterWindow;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        var fragmentShader = this.generateShader(filterWindow);\n        options.programCache[cacheKey] = this.createProgram(options.context, fragmentShader);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    getFilterWindow: function() {\n      var scale = this.tempScale;\n      return Math.ceil(this.lanczosLobes / scale);\n    },\n\n    getTaps: function() {\n      var lobeFunction = this.lanczosCreate(this.lanczosLobes), scale = this.tempScale,\n          filterWindow = this.getFilterWindow(), taps = new Array(filterWindow);\n      for (var i = 1; i <= filterWindow; i++) {\n        taps[i - 1] = lobeFunction(i * scale);\n      }\n      return taps;\n    },\n\n    /**\n     * Generate vertex and shader sources from the necessary steps numbers\n     * @param {Number} filterWindow\n     */\n    generateShader: function(filterWindow) {\n      var offsets = new Array(filterWindow),\n          fragmentShader = this.fragmentSourceTOP, filterWindow;\n\n      for (var i = 1; i <= filterWindow; i++) {\n        offsets[i - 1] = i + '.0 * uDelta';\n      }\n\n      fragmentShader += 'uniform float uTaps[' + filterWindow + '];\\n';\n      fragmentShader += 'void main() {\\n';\n      fragmentShader += '  vec4 color = texture2D(uTexture, vTexCoord);\\n';\n      fragmentShader += '  float sum = 1.0;\\n';\n\n      offsets.forEach(function(offset, i) {\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord + ' + offset + ') * uTaps[' + i + '];\\n';\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord - ' + offset + ') * uTaps[' + i + '];\\n';\n        fragmentShader += '  sum += 2.0 * uTaps[' + i + '];\\n';\n      });\n      fragmentShader += '  gl_FragColor = color / sum;\\n';\n      fragmentShader += '}';\n      return fragmentShader;\n    },\n\n    fragmentSourceTOP: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec2 uDelta;\\n' +\n      'varying vec2 vTexCoord;\\n',\n\n    /**\n     * Apply the resize filter to the image\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function(options) {\n      if (options.webgl) {\n        options.passes++;\n        this.width = options.sourceWidth;\n        this.horizontal = true;\n        this.dW = Math.round(this.width * this.scaleX);\n        this.dH = options.sourceHeight;\n        this.tempScale = this.dW / this.width;\n        this.taps = this.getTaps();\n        options.destinationWidth = this.dW;\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        options.sourceWidth = options.destinationWidth;\n\n        this.height = options.sourceHeight;\n        this.horizontal = false;\n        this.dH = Math.round(this.height * this.scaleY);\n        this.tempScale = this.dH / this.height;\n        this.taps = this.getTaps();\n        options.destinationHeight = this.dH;\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        options.sourceHeight = options.destinationHeight;\n      }\n      else {\n        this.applyTo2d(options);\n      }\n    },\n\n    isNeutralState: function() {\n      return this.scaleX === 1 && this.scaleY === 1;\n    },\n\n    lanczosCreate: function(lobes) {\n      return function(x) {\n        if (x >= lobes || x <= -lobes) {\n          return 0.0;\n        }\n        if (x < 1.19209290E-07 && x > -1.19209290E-07) {\n          return 1.0;\n        }\n        x *= Math.PI;\n        var xx = x / lobes;\n        return (sin(x) / x) * sin(xx) / xx;\n      };\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Resize.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} scaleX\n     * @param {Number} scaleY\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          scaleX = this.scaleX,\n          scaleY = this.scaleY;\n\n      this.rcpScaleX = 1 / scaleX;\n      this.rcpScaleY = 1 / scaleY;\n\n      var oW = imageData.width, oH = imageData.height,\n          dW = round(oW * scaleX), dH = round(oH * scaleY),\n          newData;\n\n      if (this.resizeType === 'sliceHack') {\n        newData = this.sliceByTwo(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'hermite') {\n        newData = this.hermiteFastResize(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'bilinear') {\n        newData = this.bilinearFiltering(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'lanczos') {\n        newData = this.lanczosResize(options, oW, oH, dW, dH);\n      }\n      options.imageData = newData;\n    },\n\n    /**\n     * Filter sliceByTwo\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    sliceByTwo: function(options, oW, oH, dW, dH) {\n      var imageData = options.imageData,\n          mult = 0.5, doneW = false, doneH = false, stepW = oW * mult,\n          stepH = oH * mult, resources = fabric.filterBackend.resources,\n          tmpCanvas, ctx, sX = 0, sY = 0, dX = oW, dY = 0;\n      if (!resources.sliceByTwo) {\n        resources.sliceByTwo = document.createElement('canvas');\n      }\n      tmpCanvas = resources.sliceByTwo;\n      if (tmpCanvas.width < oW * 1.5 || tmpCanvas.height < oH) {\n        tmpCanvas.width = oW * 1.5;\n        tmpCanvas.height = oH;\n      }\n      ctx = tmpCanvas.getContext('2d');\n      ctx.clearRect(0, 0, oW * 1.5, oH);\n      ctx.putImageData(imageData, 0, 0);\n\n      dW = floor(dW);\n      dH = floor(dH);\n\n      while (!doneW || !doneH) {\n        oW = stepW;\n        oH = stepH;\n        if (dW < floor(stepW * mult)) {\n          stepW = floor(stepW * mult);\n        }\n        else {\n          stepW = dW;\n          doneW = true;\n        }\n        if (dH < floor(stepH * mult)) {\n          stepH = floor(stepH * mult);\n        }\n        else {\n          stepH = dH;\n          doneH = true;\n        }\n        ctx.drawImage(tmpCanvas, sX, sY, oW, oH, dX, dY, stepW, stepH);\n        sX = dX;\n        sY = dY;\n        dY += stepH;\n      }\n      var img = new Image();//add by zhoujun --20190623\n      img.crossOrigin = 'anonymous';\n      img.onload = function(){\n        ctx.getImageData(sX, sY, dW, dH);\n      }\n      img = ctx.getImageData(sX, sY, dW, dH);\n      return img;\n      // return ctx.getImageData(sX, sY, dW, dH)\n    },\n\n    /**\n     * Filter lanczosResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    lanczosResize: function(options, oW, oH, dW, dH) {\n\n      function process(u) {\n        var v, i, weight, idx, a, red, green,\n            blue, alpha, fX, fY;\n        center.x = (u + 0.5) * ratioX;\n        icenter.x = floor(center.x);\n        for (v = 0; v < dH; v++) {\n          center.y = (v + 0.5) * ratioY;\n          icenter.y = floor(center.y);\n          a = 0; red = 0; green = 0; blue = 0; alpha = 0;\n          for (i = icenter.x - range2X; i <= icenter.x + range2X; i++) {\n            if (i < 0 || i >= oW) {\n              continue;\n            }\n            fX = floor(1000 * abs(i - center.x));\n            if (!cacheLanc[fX]) {\n              cacheLanc[fX] = { };\n            }\n            for (var j = icenter.y - range2Y; j <= icenter.y + range2Y; j++) {\n              if (j < 0 || j >= oH) {\n                continue;\n              }\n              fY = floor(1000 * abs(j - center.y));\n              if (!cacheLanc[fX][fY]) {\n                cacheLanc[fX][fY] = lanczos(sqrt(pow(fX * rcpRatioX, 2) + pow(fY * rcpRatioY, 2)) / 1000);\n              }\n              weight = cacheLanc[fX][fY];\n              if (weight > 0) {\n                idx = (j * oW + i) * 4;\n                a += weight;\n                red += weight * srcData[idx];\n                green += weight * srcData[idx + 1];\n                blue += weight * srcData[idx + 2];\n                alpha += weight * srcData[idx + 3];\n              }\n            }\n          }\n          idx = (v * dW + u) * 4;\n          destData[idx] = red / a;\n          destData[idx + 1] = green / a;\n          destData[idx + 2] = blue / a;\n          destData[idx + 3] = alpha / a;\n        }\n\n        if (++u < dW) {\n          return process(u);\n        }\n        else {\n          return destImg;\n        }\n      }\n\n      var srcData = options.imageData.data,\n          destImg = options.ctx.createImageData(dW, dH),\n          destData = destImg.data,\n          lanczos = this.lanczosCreate(this.lanczosLobes),\n          ratioX = this.rcpScaleX, ratioY = this.rcpScaleY,\n          rcpRatioX = 2 / this.rcpScaleX, rcpRatioY = 2 / this.rcpScaleY,\n          range2X = ceil(ratioX * this.lanczosLobes / 2),\n          range2Y = ceil(ratioY * this.lanczosLobes / 2),\n          cacheLanc = { }, center = { }, icenter = { };\n\n      return process(0);\n    },\n\n    /**\n     * bilinearFiltering\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    bilinearFiltering: function(options, oW, oH, dW, dH) {\n      var a, b, c, d, x, y, i, j, xDiff, yDiff, chnl,\n          color, offset = 0, origPix, ratioX = this.rcpScaleX,\n          ratioY = this.rcpScaleY,\n          w4 = 4 * (oW - 1), img = options.imageData,\n          pixels = img.data, destImage = options.ctx.createImageData(dW, dH),\n          destPixels = destImage.data;\n      for (i = 0; i < dH; i++) {\n        for (j = 0; j < dW; j++) {\n          x = floor(ratioX * j);\n          y = floor(ratioY * i);\n          xDiff = ratioX * j - x;\n          yDiff = ratioY * i - y;\n          origPix = 4 * (y * oW + x);\n\n          for (chnl = 0; chnl < 4; chnl++) {\n            a = pixels[origPix + chnl];\n            b = pixels[origPix + 4 + chnl];\n            c = pixels[origPix + w4 + chnl];\n            d = pixels[origPix + w4 + 4 + chnl];\n            color = a * (1 - xDiff) * (1 - yDiff) + b * xDiff * (1 - yDiff) +\n                    c * yDiff * (1 - xDiff) + d * xDiff * yDiff;\n            destPixels[offset++] = color;\n          }\n        }\n      }\n      return destImage;\n    },\n\n    /**\n     * hermiteFastResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    hermiteFastResize: function(options, oW, oH, dW, dH) {\n      var ratioW = this.rcpScaleX, ratioH = this.rcpScaleY,\n          ratioWHalf = ceil(ratioW / 2),\n          ratioHHalf = ceil(ratioH / 2),\n          img = options.imageData, data = img.data,\n          img2 = options.ctx.createImageData(dW, dH), data2 = img2.data;\n      for (var j = 0; j < dH; j++) {\n        for (var i = 0; i < dW; i++) {\n          var x2 = (i + j * dW) * 4, weight = 0, weights = 0, weightsAlpha = 0,\n              gxR = 0, gxG = 0, gxB = 0, gxA = 0, centerY = (j + 0.5) * ratioH;\n          for (var yy = floor(j * ratioH); yy < (j + 1) * ratioH; yy++) {\n            var dy = abs(centerY - (yy + 0.5)) / ratioHHalf,\n                centerX = (i + 0.5) * ratioW, w0 = dy * dy;\n            for (var xx = floor(i * ratioW); xx < (i + 1) * ratioW; xx++) {\n              var dx = abs(centerX - (xx + 0.5)) / ratioWHalf,\n                  w = sqrt(w0 + dx * dx);\n              /* eslint-disable max-depth */\n              if (w > 1 && w < -1) {\n                continue;\n              }\n              //hermite filter\n              weight = 2 * w * w * w - 3 * w * w + 1;\n              if (weight > 0) {\n                dx = 4 * (xx + yy * oW);\n                //alpha\n                gxA += weight * data[dx + 3];\n                weightsAlpha += weight;\n                //colors\n                if (data[dx + 3] < 255) {\n                  weight = weight * data[dx + 3] / 250;\n                }\n                gxR += weight * data[dx];\n                gxG += weight * data[dx + 1];\n                gxB += weight * data[dx + 2];\n                weights += weight;\n              }\n              /* eslint-enable max-depth */\n            }\n          }\n          data2[x2] = gxR / weights;\n          data2[x2 + 1] = gxG / weights;\n          data2[x2 + 2] = gxB / weights;\n          data2[x2 + 3] = gxA / weightsAlpha;\n        }\n      }\n      return img2;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        resizeType: this.resizeType,\n        lanczosLobes: this.lanczosLobes\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize\n   */\n  fabric.Image.filters.Resize.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Contrast filter class\n   * @class fabric.Image.filters.Contrast\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Contrast#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Contrast({\n   *   contrast: 40\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Contrast = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Contrast.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Contrast',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uContrast;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\\n' +\n        'color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    contrast: 0,\n\n    mainParameter: 'contrast',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Contrast.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.contrast=0] Value to contrast the image up (-1...1)\n     */\n\n    /**\n      * Apply the Contrast operation to a Uint8Array representing the pixels of an image.\n      *\n      * @param {Object} options\n      * @param {ImageData} options.imageData The Uint8Array to be filtered.\n      */\n    applyTo2d: function(options) {\n      if (this.contrast === 0) {\n        return;\n      }\n      var imageData = options.imageData, i, len,\n          data = imageData.data, len = data.length,\n          contrast = Math.floor(this.contrast * 255),\n          contrastF = 259 * (contrast + 255) / (255 * (259 - contrast));\n\n      for (i = 0; i < len; i += 4) {\n        data[i] = contrastF * (data[i] - 128) + 128;\n        data[i + 1] = contrastF * (data[i + 1] - 128) + 128;\n        data[i + 2] = contrastF * (data[i + 2] - 128) + 128;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uContrast: gl.getUniformLocation(program, 'uContrast'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uContrast, this.contrast);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Contrast} Instance of fabric.Image.filters.Contrast\n   */\n  fabric.Image.filters.Contrast.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Saturate filter class\n   * @class fabric.Image.filters.Saturation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Saturation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Saturation({\n   *   saturation: 100\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Saturation = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Saturation.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Saturation',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uSaturation;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float rgMax = max(color.r, color.g);\\n' +\n        'float rgbMax = max(rgMax, color.b);\\n' +\n        'color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\\n' +\n        'color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\\n' +\n        'color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    saturation: 0,\n\n    mainParameter: 'saturation',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Saturate.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.saturate=0] Value to saturate the image (-1...1)\n     */\n\n    /**\n     * Apply the Saturation operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.saturation === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, len = data.length,\n          adjust = -this.saturation, i, max;\n\n      for (i = 0; i < len; i += 4) {\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\n        data[i] += max !== data[i] ? (max - data[i]) * adjust : 0;\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * adjust : 0;\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * adjust : 0;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uSaturation: gl.getUniformLocation(program, 'uSaturation'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uSaturation, -this.saturation);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Saturation} Instance of fabric.Image.filters.Saturate\n   */\n  fabric.Image.filters.Saturation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Blur filter class\n   * @class fabric.Image.filters.Blur\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Blur#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Blur({\n   *   blur: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Blur = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blur.prototype */ {\n\n    type: 'Blur',\n\n    /*\n'gl_FragColor = vec4(0.0);',\n'gl_FragColor += texture2D(texture, vTexCoord + -7 * uDelta)*0.0044299121055113265;',\n'gl_FragColor += texture2D(texture, vTexCoord + -6 * uDelta)*0.00895781211794;',\n'gl_FragColor += texture2D(texture, vTexCoord + -5 * uDelta)*0.0215963866053;',\n'gl_FragColor += texture2D(texture, vTexCoord + -4 * uDelta)*0.0443683338718;',\n'gl_FragColor += texture2D(texture, vTexCoord + -3 * uDelta)*0.0776744219933;',\n'gl_FragColor += texture2D(texture, vTexCoord + -2 * uDelta)*0.115876621105;',\n'gl_FragColor += texture2D(texture, vTexCoord + -1 * uDelta)*0.147308056121;',\n'gl_FragColor += texture2D(texture, vTexCoord              )*0.159576912161;',\n'gl_FragColor += texture2D(texture, vTexCoord + 1 * uDelta)*0.147308056121;',\n'gl_FragColor += texture2D(texture, vTexCoord + 2 * uDelta)*0.115876621105;',\n'gl_FragColor += texture2D(texture, vTexCoord + 3 * uDelta)*0.0776744219933;',\n'gl_FragColor += texture2D(texture, vTexCoord + 4 * uDelta)*0.0443683338718;',\n'gl_FragColor += texture2D(texture, vTexCoord + 5 * uDelta)*0.0215963866053;',\n'gl_FragColor += texture2D(texture, vTexCoord + 6 * uDelta)*0.00895781211794;',\n'gl_FragColor += texture2D(texture, vTexCoord + 7 * uDelta)*0.0044299121055113265;',\n*/\n\n    /* eslint-disable max-len */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec2 uDelta;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'const float nSamples = 15.0;\\n' +\n      'vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\\n' +\n      'float random(vec3 scale) {\\n' +\n        /* use the fragment position for a different seed per-pixel */\n        'return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\\n' +\n      '}\\n' +\n      'void main() {\\n' +\n        'vec4 color = vec4(0.0);\\n' +\n        'float total = 0.0;\\n' +\n        'float offset = random(v3offset);\\n' +\n        'for (float t = -nSamples; t <= nSamples; t++) {\\n' +\n          'float percent = (t + offset - 0.5) / nSamples;\\n' +\n          'float weight = 1.0 - abs(percent);\\n' +\n          'color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\\n' +\n          'total += weight;\\n' +\n        '}\\n' +\n        'gl_FragColor = color / total;\\n' +\n      '}',\n    /* eslint-enable max-len */\n\n    /**\n     * blur value, in percentage of image dimensions.\n     * specific to keep the image blur constant at different resolutions\n     * range bewteen 0 and 1.\n     */\n    blur: 0,\n\n    mainParameter: 'blur',\n\n    applyTo: function(options) {\n      if (options.webgl) {\n        // this aspectRatio is used to give the same blur to vertical and horizontal\n        this.aspectRatio = options.sourceWidth / options.sourceHeight;\n        options.passes++;\n        this._setupFrameBuffer(options);\n        this.horizontal = true;\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        this._setupFrameBuffer(options);\n        this.horizontal = false;\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n      }\n      else {\n        this.applyTo2d(options);\n      }\n    },\n\n    applyTo2d: function(options) {\n      // paint canvasEl with current image data.\n      //options.ctx.putImageData(options.imageData, 0, 0);\n      options.imageData = this.simpleBlur(options);\n    },\n\n    simpleBlur: function(options) {\n      var resources = options.filterBackend.resources, canvas1, canvas2,\n          width = options.imageData.width,\n          height = options.imageData.height;\n\n      if (!resources.blurLayer1) {\n        resources.blurLayer1 = fabric.util.createCanvasElement();\n        resources.blurLayer2 = fabric.util.createCanvasElement();\n      }\n      canvas1 = resources.blurLayer1;\n      canvas2 = resources.blurLayer2;\n      if (canvas1.width !== width || canvas1.height !== height) {\n        canvas2.width = canvas1.width = width;\n        canvas2.height = canvas1.height = height;\n      }\n      var ctx1 = canvas1.getContext('2d'),\n          ctx2 = canvas2.getContext('2d'),\n          nSamples = 15,\n          random, percent, j, i,\n          blur = this.blur * 0.06 * 0.5;\n\n      // load first canvas\n      ctx1.putImageData(options.imageData, 0, 0);\n      ctx2.clearRect(0, 0, width, height);\n\n      for (i = -nSamples; i <= nSamples; i++) {\n        random = (Math.random() - 0.5) / 4;\n        percent = i / nSamples;\n        j = blur * percent * width + random;\n        ctx2.globalAlpha = 1 - Math.abs(percent);\n        ctx2.drawImage(canvas1, j, random);\n        ctx1.drawImage(canvas2, 0, 0);\n        ctx2.globalAlpha = 1;\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n      }\n      for (i = -nSamples; i <= nSamples; i++) {\n        random = (Math.random() - 0.5) / 4;\n        percent = i / nSamples;\n        j = blur * percent * height + random;\n        ctx2.globalAlpha = 1 - Math.abs(percent);\n        ctx2.drawImage(canvas1, random, j);\n        ctx1.drawImage(canvas2, 0, 0);\n        ctx2.globalAlpha = 1;\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n      }\n      var newImageData = new Image();\n      newImageData.crossOrigin = 'anonymous';//add by zhoujun --20190623\n      newImageData.onload = function(){\n        options.ctx.drawImage(canvas1, 0, 0);\n        options.ctx.getImageData(0, 0, canvas1.width, canvas1.height);\n      }\n      newImageData = options.ctx.getImageData(0, 0, canvas1.width, canvas1.height);\n      ctx1.globalAlpha = 1;\n      ctx1.clearRect(0, 0, canvas1.width, canvas1.height);\n      return newImageData;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        delta: gl.getUniformLocation(program, 'uDelta'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var delta = this.chooseRightDelta();\n      gl.uniform2fv(uniformLocations.delta, delta);\n    },\n\n    /**\n     * choose right value of image percentage to blur with\n     * @returns {Array} a numeric array with delta values\n     */\n    chooseRightDelta: function() {\n      var blurScale = 1, delta = [0, 0], blur;\n      if (this.horizontal) {\n        if (this.aspectRatio > 1) {\n          // image is wide, i want to shrink radius horizontal\n          blurScale = 1 / this.aspectRatio;\n        }\n      }\n      else {\n        if (this.aspectRatio < 1) {\n          // image is tall, i want to shrink radius vertical\n          blurScale = this.aspectRatio;\n        }\n      }\n      blur = blurScale * this.blur * 0.12;\n      if (this.horizontal) {\n        delta[0] = blur;\n      }\n      else {\n        delta[1] = blur;\n      }\n      return delta;\n    },\n  });\n\n  /**\n   * Deserialize a JSON definition of a BlurFilter into a concrete instance.\n   */\n  filters.Blur.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Gamma filter class\n   * @class fabric.Image.filters.Gamma\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Gamma#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Gamma({\n   *   brightness: 200\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Gamma = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Gamma.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Gamma',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec3 uGamma;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'vec3 correction = (1.0 / uGamma);\\n' +\n        'color.r = pow(color.r, correction.r);\\n' +\n        'color.g = pow(color.g, correction.g);\\n' +\n        'color.b = pow(color.b, correction.b);\\n' +\n        'gl_FragColor = color;\\n' +\n        'gl_FragColor.rgb *= color.a;\\n' +\n      '}',\n\n    /**\n     * Gamma array value, from 0.01 to 2.2.\n     * @param {Array} gamma\n     * @default\n     */\n    gamma: [1, 1, 1],\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'gamma',\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.gamma = [1, 1, 1];\n      filters.BaseFilter.prototype.initialize.call(this, options);\n    },\n\n    /**\n     * Apply the Gamma operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData, data = imageData.data,\n          gamma = this.gamma, len = data.length,\n          rInv = 1 / gamma[0], gInv = 1 / gamma[1],\n          bInv = 1 / gamma[2], i;\n\n      if (!this.rVals) {\n        // eslint-disable-next-line\n        this.rVals = new Uint8Array(256);\n        // eslint-disable-next-line\n        this.gVals = new Uint8Array(256);\n        // eslint-disable-next-line\n        this.bVals = new Uint8Array(256);\n      }\n\n      // This is an optimization - pre-compute a look-up table for each color channel\n      // instead of performing these pow calls for each pixel in the image.\n      for (i = 0, len = 256; i < len; i++) {\n        this.rVals[i] = Math.pow(i / 255, rInv) * 255;\n        this.gVals[i] = Math.pow(i / 255, gInv) * 255;\n        this.bVals[i] = Math.pow(i / 255, bInv) * 255;\n      }\n      for (i = 0, len = data.length; i < len; i += 4) {\n        data[i] = this.rVals[data[i]];\n        data[i + 1] = this.gVals[data[i + 1]];\n        data[i + 2] = this.bVals[data[i + 2]];\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uGamma: gl.getUniformLocation(program, 'uGamma'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform3fv(uniformLocations.uGamma, this.gamma);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Gamma} Instance of fabric.Image.filters.Gamma\n   */\n  fabric.Image.filters.Gamma.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * A container class that knows how to apply a sequence of filters to an input image.\n   */\n  filters.Composed = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Composed.prototype */ {\n\n    type: 'Composed',\n\n    /**\n     * A non sparse array of filters to apply\n     */\n    subFilters: [],\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      // create a new array instead mutating the prototype with push\n      this.subFilters = this.subFilters.slice(0);\n    },\n\n    /**\n     * Apply this container's filters to the input image provided.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be applied.\n     */\n    applyTo: function(options) {\n      options.passes += this.subFilters.length - 1;\n      this.subFilters.forEach(function(filter) {\n        filter.applyTo(options);\n      });\n    },\n\n    /**\n     * Serialize this filter into JSON.\n     *\n     * @returns {Object} A JSON representation of this filter.\n     */\n    toObject: function() {\n      return fabric.util.object.extend(this.callSuper('toObject'), {\n        subFilters: this.subFilters.map(function(filter) { return filter.toObject(); }),\n      });\n    },\n\n    isNeutralState: function() {\n      return !this.subFilters.some(function(filter) { return !filter.isNeutralState(); });\n    }\n  });\n\n  /**\n   * Deserialize a JSON definition of a ComposedFilter into a concrete instance.\n   */\n  fabric.Image.filters.Composed.fromObject = function(object, callback) {\n    var filters = object.subFilters || [],\n        subFilters = filters.map(function(filter) {\n          return new fabric.Image.filters[filter.type](filter);\n        }),\n        instance = new fabric.Image.filters.Composed({ subFilters: subFilters });\n    callback && callback(instance);\n    return instance;\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * HueRotation filter class\n   * @class fabric.Image.filters.HueRotation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.HueRotation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.HueRotation({\n   *   rotation: -0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.HueRotation = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.HueRotation.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'HueRotation',\n\n    /**\n     * HueRotation value, from -1 to 1.\n     * the unit is radians\n     * @param {Number} myParameter\n     * @default\n     */\n    rotation: 0,\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'rotation',\n\n    calculateMatrix: function() {\n      var rad = this.rotation * Math.PI, cos = fabric.util.cos(rad), sin = fabric.util.sin(rad),\n          aThird = 1 / 3, aThirdSqtSin = Math.sqrt(aThird) * sin, OneMinusCos = 1 - cos;\n      this.matrix = [\n        1, 0, 0, 0, 0,\n        0, 1, 0, 0, 0,\n        0, 0, 1, 0, 0,\n        0, 0, 0, 1, 0\n      ];\n      this.matrix[0] = cos + OneMinusCos / 3;\n      this.matrix[1] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[2] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[5] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[6] = cos + aThird * OneMinusCos;\n      this.matrix[7] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[10] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[11] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[12] = cos + aThird * OneMinusCos;\n    },\n\n    /**\n     * HueRotation isNeutralState implementation\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * @param {Object} options\n     **/\n    isNeutralState: function(options) {\n      this.calculateMatrix();\n      return filters.BaseFilter.prototype.isNeutralState.call(this, options);\n    },\n\n    /**\n     * Apply this filter to the input image data provided.\n     *\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function(options) {\n      this.calculateMatrix();\n      filters.BaseFilter.prototype.applyTo.call(this, options);\n    },\n\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.HueRotation} Instance of fabric.Image.filters.HueRotation\n   */\n  fabric.Image.filters.HueRotation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      clone = fabric.util.object.clone;\n\n  if (fabric.Text) {\n    fabric.warn('fabric.Text is already defined');\n    return;\n  }\n\n  /**\n   * Text class\n   * @class fabric.Text\n   * @extends fabric.Object\n   * @return {fabric.Text} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#text}\n   * @see {@link fabric.Text#initialize} for constructor definition\n   */\n  fabric.Text = fabric.util.createClass(fabric.Object, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Array\n     * @private\n     */\n    _dimensionAffectingProps: [\n      'fontSize',\n      'fontWeight',\n      'fontFamily',\n      'fontStyle',\n      'lineHeight',\n      'text',\n      'charSpacing',\n      'textAlign',\n      'styles',\n    ],\n\n    /**\n     * @private\n     */\n    _reNewline: /\\r?\\n/,\n\n    /**\n     * Use this regular expression to filter for whitespaces that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpacesAndTabs: /[ \\t\\r]/g,\n\n    /**\n     * Use this regular expression to filter for whitespace that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpaceAndTab: /[ \\t\\r]/,\n\n    /**\n     * Use this regular expression to filter consecutive groups of non spaces.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reWords: /\\S+/g,\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type:                 'text',\n\n    /**\n     * Font size (in pixels)\n     * @type Number\n     * @default\n     */\n    fontSize:             40,\n\n    /**\n     * Font weight (e.g. bold, normal, 400, 600, 800)\n     * @type {(Number|String)}\n     * @default\n     */\n    fontWeight:           'normal',\n\n    /**\n     * Font family\n     * @type String\n     * @default\n     */\n    fontFamily:           'Times New Roman',\n\n    /**\n     * Text decoration underline.\n     * @type Boolean\n     * @default\n     */\n    underline:       false,\n\n    /**\n     * Text decoration overline.\n     * @type Boolean\n     * @default\n     */\n    overline:       false,\n\n    /**\n     * Text decoration linethrough.\n     * @type Boolean\n     * @default\n     */\n    linethrough:       false,\n\n    /**\n     * Text alignment. Possible values: \"left\", \"center\", \"right\", \"justify\",\n     * \"justify-left\", \"justify-center\" or \"justify-right\".\n     * @type String\n     * @default\n     */\n    textAlign:            'left',\n\n    /**\n     * Font style . Possible values: \"\", \"normal\", \"italic\" or \"oblique\".\n     * @type String\n     * @default\n     */\n    fontStyle:            'normal',\n\n    /**\n     * Line height\n     * @type Number\n     * @default\n     */\n    lineHeight:           1.16,\n\n    /**\n     * Superscript schema object (minimum overlap)\n     * @type {Object}\n     * @default\n     */\n    superscript: {\n      size:      0.60, // fontSize factor\n      baseline: -0.35  // baseline-shift factor (upwards)\n    },\n\n    /**\n     * Subscript schema object (minimum overlap)\n     * @type {Object}\n     * @default\n     */\n    subscript: {\n      size:      0.60, // fontSize factor\n      baseline:  0.11  // baseline-shift factor (downwards)\n    },\n\n    /**\n     * Background color of text lines\n     * @type String\n     * @default\n     */\n    textBackgroundColor:  '',\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('fontFamily',\n      'fontWeight',\n      'fontSize',\n      'text',\n      'underline',\n      'overline',\n      'linethrough',\n      'textAlign',\n      'fontStyle',\n      'lineHeight',\n      'textBackgroundColor',\n      'charSpacing',\n      'styles'),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * @type Array\n     */\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('fontFamily',\n      'fontWeight',\n      'fontSize',\n      'text',\n      'underline',\n      'overline',\n      'linethrough',\n      'textAlign',\n      'fontStyle',\n      'lineHeight',\n      'textBackgroundColor',\n      'charSpacing',\n      'styles'),\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color.\n     * <b>Backwards incompatibility note:</b> This property was named \"strokeStyle\" until v1.1.6\n     * @type String\n     * @default\n     */\n    stroke:               null,\n\n    /**\n     * Shadow object representing shadow of this shape.\n     * <b>Backwards incompatibility note:</b> This property was named \"textShadow\" (String) until v1.2.11\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:               null,\n\n    /**\n     * @private\n     */\n    _fontSizeFraction: 0.222,\n\n    /**\n     * @private\n     */\n    offsets: {\n      underline: 0.10,\n      linethrough: -0.315,\n      overline: -0.88\n    },\n\n    /**\n     * Text Line proportion to font Size (in pixels)\n     * @type Number\n     * @default\n     */\n    _fontSizeMult:             1.13,\n\n    /**\n     * additional space between characters\n     * expressed in thousands of em unit\n     * @type Number\n     * @default\n     */\n    charSpacing:             0,\n\n    /**\n     * Object containing character styles - top-level properties -> line numbers,\n     * 2nd-level properties - charater numbers\n     * @type Object\n     * @default\n     */\n    styles: null,\n\n    /**\n     * Reference to a context to measure text char or couple of chars\n     * the cacheContext of the canvas will be used or a freshly created one if the object is not on canvas\n     * once created it will be referenced on fabric._measuringContext to avoide creating a canvas for every\n     * text object created.\n     * @type {CanvasRenderingContext2D}\n     * @default\n     */\n    _measuringContext: null,\n\n    /**\n     * Baseline shift, stlyes only, keep at 0 for the main text object\n     * @type {Number}\n     * @default\n     */\n    deltaY: 0,\n\n    /**\n     * Array of properties that define a style unit (of 'styles').\n     * @type {Array}\n     * @default\n     */\n    _styleProperties: [\n      'stroke',\n      'strokeWidth',\n      'fill',\n      'fontFamily',\n      'fontSize',\n      'fontWeight',\n      'fontStyle',\n      'underline',\n      'overline',\n      'linethrough',\n      'deltaY',\n      'textBackgroundColor',\n    ],\n\n    /**\n     * contains characters bounding boxes\n     */\n    __charBounds: [],\n\n    /**\n     * use this size when measuring text. To avoid IE11 rounding errors\n     * @type {Number}\n     * @default\n     * @readonly\n     * @private\n     */\n    CACHE_FONT_SIZE: 400,\n\n    /**\n     * contains the min text width to avoid getting 0\n     * @type {Number}\n     * @default\n     */\n    MIN_TEXT_WIDTH: 2,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    initialize: function(text, options) {\n      this.styles = options ? (options.styles || { }) : { };\n      this.text = text;\n      this.__skipDimension = true;\n      this.callSuper('initialize', options);\n      this.__skipDimension = false;\n      this.initDimensions();\n      this.setCoords();\n      this.setupState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Return a contex for measurement of text string.\n     * if created it gets stored for reuse\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    getMeasuringContext: function() {\n      // if we did not return we have to measure something.\n      if (!fabric._measuringContext) {\n        fabric._measuringContext = this.canvas && this.canvas.contextCache ||\n          fabric.util.createCanvasElement().getContext('2d');\n      }\n      return fabric._measuringContext;\n    },\n\n    /**\n     * @private\n     * Divides text into lines of text and lines of graphemes.\n     */\n    _splitText: function() {\n      var newLines = this._splitTextIntoLines(this.text);\n      this.textLines = newLines.lines;\n      this._textLines = newLines.graphemeLines;\n      this._unwrappedTextLines = newLines._unwrappedLines;\n      this._text = newLines.graphemeText;\n      return newLines;\n    },\n\n    /**\n     * Initialize or update text dimensions.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     */\n    initDimensions: function() {\n      if (this.__skipDimension) {\n        return;\n      }\n      this._splitText();\n      this._clearCache();\n      this.width = this.calcTextWidth() || this.cursorWidth || this.MIN_TEXT_WIDTH;\n      if (this.textAlign.indexOf('justify') !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      this.height = this.calcTextHeight();\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Enlarge space boxes and shift the others\n     */\n    enlargeSpaces: function() {\n      var diffSpace, currentLineWidth, numberOfSpaces, accumulatedSpace, line, charBound, spaces;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        if (this.textAlign !== 'justify' && (i === len - 1 || this.isEndOfWrapping(i))) {\n          continue;\n        }\n        accumulatedSpace = 0;\n        line = this._textLines[i];\n        currentLineWidth = this.getLineWidth(i);\n        if (currentLineWidth < this.width && (spaces = this.textLines[i].match(this._reSpacesAndTabs))) {\n          numberOfSpaces = spaces.length;\n          diffSpace = (this.width - currentLineWidth) / numberOfSpaces;\n          for (var j = 0, jlen = line.length; j <= jlen; j++) {\n            charBound = this.__charBounds[i][j];\n            if (this._reSpaceAndTab.test(line[j])) {\n              charBound.width += diffSpace;\n              charBound.kernedWidth += diffSpace;\n              charBound.left += accumulatedSpace;\n              accumulatedSpace += diffSpace;\n            }\n            else {\n              charBound.left += accumulatedSpace;\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function(lineIndex) {\n      return lineIndex === this._textLines.length - 1;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of text object\n     */\n    toString: function() {\n      return '#<fabric.Text (' + this.complexity() +\n        '): { \"text\": \"' + this.text + '\", \"fontFamily\": \"' + this.fontFamily + '\" }>';\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @param {Object} dim.x width of object to be cached\n     * @param {Object} dim.y height of object to be cached\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var dims = this.callSuper('_getCacheCanvasDimensions');\n      var fontSize = this.fontSize;\n      dims.width += fontSize * dims.zoomX;\n      dims.height += fontSize * dims.zoomY;\n      return dims;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this._setTextStyles(ctx);\n      this._renderTextLinesBackground(ctx);\n      this._renderTextDecoration(ctx, 'underline');\n      this._renderText(ctx);\n      this._renderTextDecoration(ctx, 'overline');\n      this._renderTextDecoration(ctx, 'linethrough');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderText: function(ctx) {\n      if (this.paintFirst === 'stroke') {\n        this._renderTextStroke(ctx);\n        this._renderTextFill(ctx);\n      }\n      else {\n        this._renderTextFill(ctx);\n        this._renderTextStroke(ctx);\n      }\n    },\n\n    /**\n     * Set the font parameter of the context with the object properties or with charStyle\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [charStyle] object with font style properties\n     * @param {String} [charStyle.fontFamily] Font Family\n     * @param {Number} [charStyle.fontSize] Font size in pixels. ( without px suffix )\n     * @param {String} [charStyle.fontWeight] Font weight\n     * @param {String} [charStyle.fontStyle] Font style (italic|normal)\n     */\n    _setTextStyles: function(ctx, charStyle, forMeasuring) {\n      ctx.textBaseline = 'alphabetic';\n      ctx.font = this._getFontDeclaration(charStyle, forMeasuring);\n    },\n\n    /**\n     * calculate and return the text Width measuring each line.\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {Number} Maximum width of fabric.Text object\n     */\n    calcTextWidth: function() {\n      var maxWidth = this.getLineWidth(0);\n\n      for (var i = 1, len = this._textLines.length; i < len; i++) {\n        var currentLineWidth = this.getLineWidth(i);\n        if (currentLineWidth > maxWidth) {\n          maxWidth = currentLineWidth;\n        }\n      }\n      return maxWidth;\n    },\n\n    /**\n     * @private\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Text to render\n     * @param {Number} left Left position of text\n     * @param {Number} top Top position of text\n     * @param {Number} lineIndex Index of a line in a text\n     */\n    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {\n      this._renderChars(method, ctx, line, left, top, lineIndex);\n    },\n\n    /**\n     * Renders the text background for lines, taking care of style\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextLinesBackground: function(ctx) {\n      if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor')) {\n        return;\n      }\n      var lineTopOffset = 0, heightOfLine,\n          lineLeftOffset, originalFill = ctx.fillStyle,\n          line, lastColor,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(),\n          boxStart = 0, boxWidth = 0, charBox, currentColor;\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this.getHeightOfLine(i);\n        if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor', i)) {\n          lineTopOffset += heightOfLine;\n          continue;\n        }\n        line = this._textLines[i];\n        lineLeftOffset = this._getLineLeftOffset(i);\n        boxWidth = 0;\n        boxStart = 0;\n        lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\n          if (currentColor !== lastColor) {\n            ctx.fillStyle = lastColor;\n            lastColor && ctx.fillRect(\n              leftOffset + lineLeftOffset + boxStart,\n              topOffset + lineTopOffset,\n              boxWidth,\n              heightOfLine / this.lineHeight\n            );\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastColor = currentColor;\n          }\n          else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        if (currentColor) {\n          ctx.fillStyle = currentColor;\n          ctx.fillRect(\n            leftOffset + lineLeftOffset + boxStart,\n            topOffset + lineTopOffset,\n            boxWidth,\n            heightOfLine / this.lineHeight\n          );\n        }\n        lineTopOffset += heightOfLine;\n      }\n      ctx.fillStyle = originalFill;\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {Object} decl style declaration for cache\n     * @param {String} decl.fontFamily fontFamily\n     * @param {String} decl.fontStyle fontStyle\n     * @param {String} decl.fontWeight fontWeight\n     * @return {Object} reference to cache\n     */\n    getFontCache: function(decl) {\n      var fontFamily = decl.fontFamily.toLowerCase();\n      if (!fabric.charWidthsCache[fontFamily]) {\n        fabric.charWidthsCache[fontFamily] = { };\n      }\n      var cache = fabric.charWidthsCache[fontFamily],\n          cacheProp = decl.fontStyle.toLowerCase() + '_' + (decl.fontWeight + '').toLowerCase();\n      if (!cache[cacheProp]) {\n        cache[cacheProp] = { };\n      }\n      return cache[cacheProp];\n    },\n\n    /**\n     * apply all the character style to canvas for rendering\n     * @private\n     * @param {String} _char\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} [decl]\n     */\n    _applyCharStyles: function(method, ctx, lineIndex, charIndex, styleDeclaration) {\n\n      this._setFillStyles(ctx, styleDeclaration);\n      this._setStrokeStyles(ctx, styleDeclaration);\n\n      ctx.font = this._getFontDeclaration(styleDeclaration);\n    },\n\n    /**\n     * measure and return the width of a single character.\n     * possibly overridden to accommodate different measure logic or\n     * to hook some external lib for character measurement\n     * @private\n     * @param {String} char to be measured\n     * @param {Object} charStyle style of char to be measured\n     * @param {String} [previousChar] previous char\n     * @param {Object} [prevCharStyle] style of previous char\n     */\n    _measureChar: function(_char, charStyle, previousChar, prevCharStyle) {\n      // first i try to return from cache\n      var fontCache = this.getFontCache(charStyle), fontDeclaration = this._getFontDeclaration(charStyle),\n          previousFontDeclaration = this._getFontDeclaration(prevCharStyle), couple = previousChar + _char,\n          stylesAreEqual = fontDeclaration === previousFontDeclaration, width, coupleWidth, previousWidth,\n          fontMultiplier = charStyle.fontSize / this.CACHE_FONT_SIZE, kernedWidth;\n\n      if (previousChar && fontCache[previousChar] !== undefined) {\n        previousWidth = fontCache[previousChar];\n      }\n      if (fontCache[_char] !== undefined) {\n        kernedWidth = width = fontCache[_char];\n      }\n      if (stylesAreEqual && fontCache[couple] !== undefined) {\n        coupleWidth = fontCache[couple];\n        kernedWidth = coupleWidth - previousWidth;\n      }\n      if (width === undefined || previousWidth === undefined || coupleWidth === undefined) {\n        var ctx = this.getMeasuringContext();\n        // send a TRUE to specify measuring font size CACHE_FONT_SIZE\n        this._setTextStyles(ctx, charStyle, true);\n      }\n      if (width === undefined) {\n        kernedWidth = width = ctx.measureText(_char).width;\n        fontCache[_char] = width;\n      }\n      if (previousWidth === undefined && stylesAreEqual && previousChar) {\n        previousWidth = ctx.measureText(previousChar).width;\n        fontCache[previousChar] = previousWidth;\n      }\n      if (stylesAreEqual && coupleWidth === undefined) {\n        // we can measure the kerning couple and subtract the width of the previous character\n        coupleWidth = ctx.measureText(couple).width;\n        fontCache[couple] = coupleWidth;\n        kernedWidth = coupleWidth - previousWidth;\n      }\n      return { width: width * fontMultiplier, kernedWidth: kernedWidth * fontMultiplier };\n    },\n\n    /**\n     * Computes height of character at given position\n     * @param {Number} line the line number\n     * @param {Number} char the character number\n     * @return {Number} fontSize of the character\n     */\n    getHeightOfChar: function(line, char) {\n      return this.getValueOfPropertyAt(line, char, 'fontSize');\n    },\n\n    /**\n     * measure a text line measuring all characters.\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    measureLine: function(lineIndex) {\n      var lineInfo = this._measureLine(lineIndex);\n      if (this.charSpacing !== 0) {\n        lineInfo.width -= this._getWidthOfCharSpacing();\n      }\n      if (lineInfo.width < 0) {\n        lineInfo.width = 0;\n      }\n      return lineInfo;\n    },\n\n    /**\n     * measure every grapheme of a line, populating __charBounds\n     * @param {Number} lineIndex\n     * @return {Object} object.width total width of characters\n     * @return {Object} object.widthOfSpaces length of chars that match this._reSpacesAndTabs\n     */\n    _measureLine: function(lineIndex) {\n      var width = 0, i, grapheme, line = this._textLines[lineIndex], prevGrapheme,\n          graphemeInfo, numOfSpaces = 0, lineBounds = new Array(line.length);\n\n      this.__charBounds[lineIndex] = lineBounds;\n      for (i = 0; i < line.length; i++) {\n        grapheme = line[i];\n        graphemeInfo = this._getGraphemeBox(grapheme, lineIndex, i, prevGrapheme);\n        lineBounds[i] = graphemeInfo;\n        width += graphemeInfo.kernedWidth;\n        prevGrapheme = grapheme;\n      }\n      // this latest bound box represent the last character of the line\n      // to simplify cursor handling in interactive mode.\n      lineBounds[i] = {\n        left: graphemeInfo ? graphemeInfo.left + graphemeInfo.width : 0,\n        width: 0,\n        kernedWidth: 0,\n        height: this.fontSize\n      };\n      return { width: width, numOfSpaces: numOfSpaces };\n    },\n\n    /**\n     * Measure and return the info of a single grapheme.\n     * needs the the info of previous graphemes already filled\n     * @private\n     * @param {String} grapheme to be measured\n     * @param {Number} lineIndex index of the line where the char is\n     * @param {Number} charIndex position in the line\n     * @param {String} [prevGrapheme] character preceding the one to be measured\n     */\n    _getGraphemeBox: function(grapheme, lineIndex, charIndex, prevGrapheme, skipLeft) {\n      var style = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          prevStyle = prevGrapheme ? this.getCompleteStyleDeclaration(lineIndex, charIndex - 1) : { },\n          info = this._measureChar(grapheme, style, prevGrapheme, prevStyle),\n          kernedWidth = info.kernedWidth,\n          width = info.width, charSpacing;\n\n      if (this.charSpacing !== 0) {\n        charSpacing = this._getWidthOfCharSpacing();\n        width += charSpacing;\n        kernedWidth += charSpacing;\n      }\n\n      var box = {\n        width: width,\n        left: 0,\n        height: style.fontSize,\n        kernedWidth: kernedWidth,\n        deltaY: style.deltaY,\n      };\n      if (charIndex > 0 && !skipLeft) {\n        var previousBox = this.__charBounds[lineIndex][charIndex - 1];\n        box.left = previousBox.left + previousBox.width + info.kernedWidth - info.width;\n      }\n      return box;\n    },\n\n    /**\n     * Calculate height of line at 'lineIndex'\n     * @param {Number} lineIndex index of line to calculate\n     * @return {Number}\n     */\n    getHeightOfLine: function(lineIndex) {\n      if (this.__lineHeights[lineIndex]) {\n        return this.__lineHeights[lineIndex];\n      }\n\n      var line = this._textLines[lineIndex],\n          // char 0 is measured before the line cycle because it nneds to char\n          // emptylines\n          maxHeight = this.getHeightOfChar(lineIndex, 0);\n      for (var i = 1, len = line.length; i < len; i++) {\n        maxHeight = Math.max(this.getHeightOfChar(lineIndex, i), maxHeight);\n      }\n\n      return this.__lineHeights[lineIndex] = maxHeight * this.lineHeight * this._fontSizeMult;\n    },\n\n    /**\n     * Calculate text box height\n     */\n    calcTextHeight: function() {\n      var lineHeight, height = 0;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineHeight = this.getHeightOfLine(i);\n        height += (i === len - 1 ? lineHeight / this.lineHeight : lineHeight);\n      }\n      return height;\n    },\n\n    /**\n     * @private\n     * @return {Number} Left offset\n     */\n    _getLeftOffset: function() {\n      return -this.width / 2;\n    },\n\n    /**\n     * @private\n     * @return {Number} Top offset\n     */\n    _getTopOffset: function() {\n      return -this.height / 2;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     */\n    _renderTextCommon: function(ctx, method) {\n      ctx.save();\n      var lineHeights = 0, left = this._getLeftOffset(), top = this._getTopOffset(),\n          offsets = this._applyPatternGradientTransform(ctx, method === 'fillText' ? this.fill : this.stroke);\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        var heightOfLine = this.getHeightOfLine(i),\n            maxHeight = heightOfLine / this.lineHeight,\n            leftOffset = this._getLineLeftOffset(i);\n        this._renderTextLine(\n          method,\n          ctx,\n          this._textLines[i],\n          left + leftOffset - offsets.offsetX,\n          top + lineHeights + maxHeight - offsets.offsetY,\n          i\n        );\n        lineHeights += heightOfLine;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextFill: function(ctx) {\n      if (!this.fill && !this.styleHas('fill')) {\n        return;\n      }\n\n      this._renderTextCommon(ctx, 'fillText');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextStroke: function(ctx) {\n      if ((!this.stroke || this.strokeWidth === 0) && this.isEmptyStyles()) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      this._setLineDash(ctx, this.strokeDashArray);\n      ctx.beginPath();\n      this._renderTextCommon(ctx, 'strokeText');\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Content of the line\n     * @param {Number} left\n     * @param {Number} top\n     * @param {Number} lineIndex\n     * @param {Number} charOffset\n     */\n    _renderChars: function(method, ctx, line, left, top, lineIndex) {\n      // set proper line offset\n      var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = '',\n          charBox,\n          boxWidth = 0,\n          timeToRender,\n          shortCut = !isJustify && this.charSpacing === 0 && this.isEmptyStyles(lineIndex);\n\n      ctx.save();\n      top -= lineHeight * this._fontSizeFraction / this.lineHeight;\n      if (shortCut) {\n        // render all the line in one pass without checking\n        this._renderChar(method, ctx, lineIndex, 0, this.textLines[lineIndex], left, top, lineHeight);\n        ctx.restore();\n        return;\n      }\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\n        timeToRender = i === len || this.charSpacing;\n        charsToRender += line[i];\n        charBox = this.__charBounds[lineIndex][i];\n        if (boxWidth === 0) {\n          left += charBox.kernedWidth - charBox.width;\n          boxWidth += charBox.width;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n        if (isJustify && !timeToRender) {\n          if (this._reSpaceAndTab.test(line[i])) {\n            timeToRender = true;\n          }\n        }\n        if (!timeToRender) {\n          // if we have charSpacing, we render char by char\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n          timeToRender = this._hasStyleChanged(actualStyle, nextStyle);\n        }\n        if (timeToRender) {\n          this._renderChar(method, ctx, lineIndex, i, charsToRender, left, top, lineHeight);\n          charsToRender = '';\n          actualStyle = nextStyle;\n          left += boxWidth;\n          boxWidth = 0;\n        }\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {String} _char\n     * @param {Number} left Left coordinate\n     * @param {Number} top Top coordinate\n     * @param {Number} lineHeight Height of the line\n     */\n    _renderChar: function(method, ctx, lineIndex, charIndex, _char, left, top) {\n      var decl = this._getStyleDeclaration(lineIndex, charIndex),\n          fullDecl = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          shouldFill = method === 'fillText' && fullDecl.fill,\n          shouldStroke = method === 'strokeText' && fullDecl.stroke && fullDecl.strokeWidth;\n\n      if (!shouldStroke && !shouldFill) {\n        return;\n      }\n      decl && ctx.save();\n\n      this._applyCharStyles(method, ctx, lineIndex, charIndex, fullDecl);\n\n      if (decl && decl.textBackgroundColor) {\n        this._removeShadow(ctx);\n      }\n      if (decl && decl.deltaY) {\n        top += decl.deltaY;\n      }\n\n      shouldFill && ctx.fillText(_char, left, top);\n      shouldStroke && ctx.strokeText(_char, left, top);\n      decl && ctx.restore();\n    },\n\n    /**\n     * Turns the character into a 'superior figure' (i.e. 'superscript')\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    setSuperscript: function(start, end) {\n      return this._setScript(start, end, this.superscript);\n    },\n\n    /**\n     * Turns the character into an 'inferior figure' (i.e. 'subscript')\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    setSubscript: function(start, end) {\n      return this._setScript(start, end, this.subscript);\n    },\n\n    /**\n     * Applies 'schema' at given position\n     * @private\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @param {Number} schema\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    _setScript: function(start, end, schema) {\n      var loc = this.get2DCursorLocation(start, true),\n          fontSize = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'fontSize'),\n          dy = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'deltaY'),\n          style = { fontSize: fontSize * schema.size, deltaY: dy + fontSize * schema.baseline };\n      this.setSelectionStyles(style, start, end);\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {Object} prevStyle\n     * @param {Object} thisStyle\n     */\n    _hasStyleChanged: function(prevStyle, thisStyle) {\n      return prevStyle.fill !== thisStyle.fill ||\n              prevStyle.stroke !== thisStyle.stroke ||\n              prevStyle.strokeWidth !== thisStyle.strokeWidth ||\n              prevStyle.fontSize !== thisStyle.fontSize ||\n              prevStyle.fontFamily !== thisStyle.fontFamily ||\n              prevStyle.fontWeight !== thisStyle.fontWeight ||\n              prevStyle.fontStyle !== thisStyle.fontStyle ||\n              prevStyle.deltaY !== thisStyle.deltaY;\n    },\n\n    /**\n     * @private\n     * @param {Object} prevStyle\n     * @param {Object} thisStyle\n     */\n    _hasStyleChangedForSvg: function(prevStyle, thisStyle) {\n      return this._hasStyleChanged(prevStyle, thisStyle) ||\n        prevStyle.overline !== thisStyle.overline ||\n        prevStyle.underline !== thisStyle.underline ||\n        prevStyle.linethrough !== thisStyle.linethrough;\n    },\n\n    /**\n     * @private\n     * @param {Number} lineIndex index text line\n     * @return {Number} Line left offset\n     */\n    _getLineLeftOffset: function(lineIndex) {\n      var lineWidth = this.getLineWidth(lineIndex);\n      if (this.textAlign === 'center') {\n        return (this.width - lineWidth) / 2;\n      }\n      if (this.textAlign === 'right') {\n        return this.width - lineWidth;\n      }\n      if (this.textAlign === 'justify-center' && this.isEndOfWrapping(lineIndex)) {\n        return (this.width - lineWidth) / 2;\n      }\n      if (this.textAlign === 'justify-right' && this.isEndOfWrapping(lineIndex)) {\n        return this.width - lineWidth;\n      }\n      return 0;\n    },\n\n    /**\n     * @private\n     */\n    _clearCache: function() {\n      this.__lineWidths = [];\n      this.__lineHeights = [];\n      this.__charBounds = [];\n    },\n\n    /**\n     * @private\n     */\n    _shouldClearDimensionCache: function() {\n      var shouldClear = this._forceClearCache;\n      shouldClear || (shouldClear = this.hasStateChanged('_dimensionAffectingProps'));\n      if (shouldClear) {\n        this.dirty = true;\n        this._forceClearCache = false;\n      }\n      return shouldClear;\n    },\n\n    /**\n     * Measure a single line given its index. Used to calculate the initial\n     * text bounding box. The values are calculated and stored in __lineWidths cache.\n     * @private\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    getLineWidth: function(lineIndex) {\n      if (this.__lineWidths[lineIndex]) {\n        return this.__lineWidths[lineIndex];\n      }\n\n      var width, line = this._textLines[lineIndex], lineInfo;\n\n      if (line === '') {\n        width = 0;\n      }\n      else {\n        lineInfo = this.measureLine(lineIndex);\n        width = lineInfo.width;\n      }\n      this.__lineWidths[lineIndex] = width;\n      return width;\n    },\n\n    _getWidthOfCharSpacing: function() {\n      if (this.charSpacing !== 0) {\n        return this.fontSize * this.charSpacing / 1000;\n      }\n      return 0;\n    },\n\n    /**\n     * Retrieves the value of property at given character position\n     * @param {Number} lineIndex the line number\n     * @param {Number} charIndex the charater number\n     * @param {String} property the property name\n     * @returns the value of 'property'\n     */\n    getValueOfPropertyAt: function(lineIndex, charIndex, property) {\n      var charStyle = this._getStyleDeclaration(lineIndex, charIndex);\n      if (charStyle && typeof charStyle[property] !== 'undefined') {\n        return charStyle[property];\n      }\n      return this[property];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextDecoration: function(ctx, type) {\n      if (!this[type] && !this.styleHas(type)) {\n        return;\n      }\n      var heightOfLine, size, _size,\n          lineLeftOffset, dy, _dy,\n          line, lastDecoration,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(), top,\n          boxStart, boxWidth, charBox, currentDecoration,\n          maxHeight, currentFill, lastFill,\n          charSpacing = this._getWidthOfCharSpacing();\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this.getHeightOfLine(i);\n        if (!this[type] && !this.styleHas(type, i)) {\n          topOffset += heightOfLine;\n          continue;\n        }\n        line = this._textLines[i];\n        maxHeight = heightOfLine / this.lineHeight;\n        lineLeftOffset = this._getLineLeftOffset(i);\n        boxStart = 0;\n        boxWidth = 0;\n        lastDecoration = this.getValueOfPropertyAt(i, 0, type);\n        lastFill = this.getValueOfPropertyAt(i, 0, 'fill');\n        top = topOffset + maxHeight * (1 - this._fontSizeFraction);\n        size = this.getHeightOfChar(i, 0);\n        dy = this.getValueOfPropertyAt(i, 0, 'deltaY');\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentDecoration = this.getValueOfPropertyAt(i, j, type);\n          currentFill = this.getValueOfPropertyAt(i, j, 'fill');\n          _size = this.getHeightOfChar(i, j);\n          _dy = this.getValueOfPropertyAt(i, j, 'deltaY');\n          if ((currentDecoration !== lastDecoration || currentFill !== lastFill || _size !== size || _dy !== dy) &&\n              boxWidth > 0) {\n            ctx.fillStyle = lastFill;\n            lastDecoration && lastFill && ctx.fillRect(\n              leftOffset + lineLeftOffset + boxStart,\n              top + this.offsets[type] * size + dy,\n              boxWidth,\n              this.fontSize / 15\n            );\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastDecoration = currentDecoration;\n            lastFill = currentFill;\n            size = _size;\n            dy = _dy;\n          }\n          else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        ctx.fillStyle = currentFill;\n        currentDecoration && currentFill && ctx.fillRect(\n          leftOffset + lineLeftOffset + boxStart,\n          top + this.offsets[type] * size + dy,\n          boxWidth - charSpacing,\n          this.fontSize / 15\n        );\n        topOffset += heightOfLine;\n      }\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * return font declaration string for canvas context\n     * @param {Object} [styleObject] object\n     * @returns {String} font declaration formatted for canvas context.\n     */\n    _getFontDeclaration: function(styleObject, forMeasuring) {\n      var style = styleObject || this, family = this.fontFamily,\n          fontIsGeneric = fabric.Text.genericFonts.indexOf(family.toLowerCase()) > -1;\n      var fontFamily = family === undefined ||\n      family.indexOf('\\'') > -1 ||\n      family.indexOf('\"') > -1 || fontIsGeneric\n        ? style.fontFamily : '\"' + style.fontFamily + '\"';\n      return [\n        // node-canvas needs \"weight style\", while browsers need \"style weight\"\n        (fabric.isLikelyNode ? style.fontWeight : style.fontStyle),\n        (fabric.isLikelyNode ? style.fontStyle : style.fontWeight),\n        forMeasuring ? this.CACHE_FONT_SIZE + 'px' : style.fontSize + 'px',\n        fontFamily\n      ].join(' ');\n    },\n\n    /**\n     * Renders text instance on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      // do not render if object is not visible\n      if (!this.visible) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n      }\n      this.callSuper('render', ctx);\n    },\n\n    /**\n     * Returns the text as an array of lines.\n     * @param {String} text text to split\n     * @returns {Array} Lines in the text\n     */\n    _splitTextIntoLines: function(text) {\n      var lines = text.split(this._reNewline),\n          newLines = new Array(lines.length),\n          newLine = ['\\n'],\n          newText = [];\n      for (var i = 0; i < lines.length; i++) {\n        newLines[i] = fabric.util.string.graphemeSplit(lines[i]);\n        newText = newText.concat(newLines[i], newLine);\n      }\n      newText.pop();\n      return { _unwrappedLines: newLines, lines: lines, graphemeText: newText, graphemeLines: newLines };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var additionalProperties = [\n        'text',\n        'fontSize',\n        'fontWeight',\n        'fontFamily',\n        'fontStyle',\n        'lineHeight',\n        'underline',\n        'overline',\n        'linethrough',\n        'textAlign',\n        'textBackgroundColor',\n        'charSpacing',\n      ].concat(propertiesToInclude);\n      var obj = this.callSuper('toObject', additionalProperties);\n      obj.styles = clone(this.styles, true);\n      return obj;\n    },\n\n    /**\n     * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n     * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n     * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    set: function(key, value) {\n      this.callSuper('set', key, value);\n      var needsDims = false;\n      if (typeof key === 'object') {\n        for (var _key in key) {\n          needsDims = needsDims || this._dimensionAffectingProps.indexOf(_key) !== -1;\n        }\n      }\n      else {\n        needsDims = this._dimensionAffectingProps.indexOf(key) !== -1;\n      }\n      if (needsDims) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      return this;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})\n   * @static\n   * @memberOf fabric.Text\n   * @see: http://www.w3.org/TR/SVG/text.html#TextElement\n   */\n  fabric.Text.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    'x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor'.split(' '));\n\n  /**\n   * Default SVG font size\n   * @static\n   * @memberOf fabric.Text\n   */\n  fabric.Text.DEFAULT_SVG_FONT_SIZE = 16;\n\n  /**\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\n   * @static\n   * @memberOf fabric.Text\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Text.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Text.ATTRIBUTE_NAMES),\n        parsedAnchor = parsedAttributes.textAnchor || 'left';\n    options = fabric.util.object.extend((options ? clone(options) : { }), parsedAttributes);\n\n    options.top = options.top || 0;\n    options.left = options.left || 0;\n    if (parsedAttributes.textDecoration) {\n      var textDecoration = parsedAttributes.textDecoration;\n      if (textDecoration.indexOf('underline') !== -1) {\n        options.underline = true;\n      }\n      if (textDecoration.indexOf('overline') !== -1) {\n        options.overline = true;\n      }\n      if (textDecoration.indexOf('line-through') !== -1) {\n        options.linethrough = true;\n      }\n      delete options.textDecoration;\n    }\n    if ('dx' in parsedAttributes) {\n      options.left += parsedAttributes.dx;\n    }\n    if ('dy' in parsedAttributes) {\n      options.top += parsedAttributes.dy;\n    }\n    if (!('fontSize' in options)) {\n      options.fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n    }\n\n    var textContent = '';\n\n    // The XML is not properly parsed in IE9 so a workaround to get\n    // textContent is through firstChild.data. Another workaround would be\n    // to convert XML loaded from a file to be converted using DOMParser (same way loadSVGFromString() does)\n    if (!('textContent' in element)) {\n      if ('firstChild' in element && element.firstChild !== null) {\n        if ('data' in element.firstChild && element.firstChild.data !== null) {\n          textContent = element.firstChild.data;\n        }\n      }\n    }\n    else {\n      textContent = element.textContent;\n    }\n\n    textContent = textContent.replace(/^\\s+|\\s+$|\\n+/g, '').replace(/\\s+/g, ' ');\n    var originalStrokeWidth = options.strokeWidth;\n    options.strokeWidth = 0;\n\n    var text = new fabric.Text(textContent, options),\n        textHeightScaleFactor = text.getScaledHeight() / text.height,\n        lineHeightDiff = (text.height + text.strokeWidth) * text.lineHeight - text.height,\n        scaledDiff = lineHeightDiff * textHeightScaleFactor,\n        textHeight = text.getScaledHeight() + scaledDiff,\n        offX = 0;\n    /*\n      Adjust positioning:\n        x/y attributes in SVG correspond to the bottom-left corner of text bounding box\n        fabric output by default at top, left.\n    */\n    if (parsedAnchor === 'center') {\n      offX = text.getScaledWidth() / 2;\n    }\n    if (parsedAnchor === 'right') {\n      offX = text.getScaledWidth();\n    }\n    text.set({\n      left: text.left - offX,\n      top: text.top - (textHeight - text.fontSize * (0.07 + text._fontSizeFraction)) / text.lineHeight,\n      strokeWidth: typeof originalStrokeWidth !== 'undefined' ? originalStrokeWidth : 1,\n    });\n    callback(text);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Text instance from an object representation\n   * @static\n   * @memberOf fabric.Text\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Text instance is created\n   */\n  fabric.Text.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Text', object, callback, 'text');\n  };\n\n  fabric.Text.genericFonts = ['sans-serif', 'serif', 'cursive', 'fantasy', 'monospace'];\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Text);\n\n})(typeof exports !== 'undefined' ? exports : this);\n(function() {\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function(lineIndex) {\n      if (!this.styles) {\n        return true;\n      }\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\n        return true;\n      }\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          // eslint-disable-next-line no-unused-vars\n          for (var p3 in obj[p1][p2]) {\n            return false;\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Returns true if object has a style property or has it ina specified line\n     * @param {Number} lineIndex\n     * @return {Boolean}\n     */\n    styleHas: function(property, lineIndex) {\n      if (!this.styles || !property || property === '') {\n        return false;\n      }\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\n        return false;\n      }\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      // eslint-disable-next-line\n      for (var p1 in obj) {\n        // eslint-disable-next-line\n        for (var p2 in obj[p1]) {\n          if (typeof obj[p1][p2][property] !== 'undefined') {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if characters in a text have a value for a property\n     * whose value matches the textbox's value for that property.  If so,\n     * the character-level property is deleted.  If the character\n     * has no other properties, then it is also deleted.  Finally,\n     * if the line containing that character has no other characters\n     * then it also is deleted.\n     *\n     * @param {string} property The property to compare between characters and text.\n     */\n    cleanStyle: function(property) {\n      if (!this.styles || !property || property === '') {\n        return false;\n      }\n      var obj = this.styles, stylesCount = 0, letterCount, stylePropertyValue,\n          allStyleObjectPropertiesMatch = true, graphemeCount = 0, styleObject;\n      // eslint-disable-next-line\n      for (var p1 in obj) {\n        letterCount = 0;\n        // eslint-disable-next-line\n        for (var p2 in obj[p1]) {\n          var styleObject = obj[p1][p2],\n              stylePropertyHasBeenSet = styleObject.hasOwnProperty(property);\n\n          stylesCount++;\n\n          if (stylePropertyHasBeenSet) {\n            if (!stylePropertyValue) {\n              stylePropertyValue = styleObject[property];\n            }\n            else if (styleObject[property] !== stylePropertyValue) {\n              allStyleObjectPropertiesMatch = false;\n            }\n\n            if (styleObject[property] === this[property]) {\n              delete styleObject[property];\n            }\n          }\n          else {\n            allStyleObjectPropertiesMatch = false;\n          }\n\n          if (Object.keys(styleObject).length !== 0) {\n            letterCount++;\n          }\n          else {\n            delete obj[p1][p2];\n          }\n        }\n\n        if (letterCount === 0) {\n          delete obj[p1];\n        }\n      }\n      // if every grapheme has the same style set then\n      // delete those styles and set it on the parent\n      for (var i = 0; i < this._textLines.length; i++) {\n        graphemeCount += this._textLines[i].length;\n      }\n      if (allStyleObjectPropertiesMatch && stylesCount === graphemeCount) {\n        this[property] = stylePropertyValue;\n        this.removeStyle(property);\n      }\n    },\n\n    /**\n     * Remove a style property or properties from all individual character styles\n     * in a text object.  Deletes the character style object if it contains no other style\n     * props.  Deletes a line style object if it contains no other character styles.\n     *\n     * @param {String} props The property to remove from character styles.\n     */\n    removeStyle: function(property) {\n      if (!this.styles || !property || property === '') {\n        return;\n      }\n      var obj = this.styles, line, lineNum, charNum;\n      for (lineNum in obj) {\n        line = obj[lineNum];\n        for (charNum in line) {\n          delete line[charNum][property];\n          if (Object.keys(line[charNum]).length === 0) {\n            delete line[charNum];\n          }\n        }\n        if (Object.keys(line).length === 0) {\n          delete obj[lineNum];\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _extendStyles: function(index, styles) {\n      var loc = this.get2DCursorLocation(index);\n\n      if (!this._getLineStyle(loc.lineIndex)) {\n        this._setLineStyle(loc.lineIndex, {});\n      }\n\n      if (!this._getStyleDeclaration(loc.lineIndex, loc.charIndex)) {\n        this._setStyleDeclaration(loc.lineIndex, loc.charIndex, {});\n      }\n\n      fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex, loc.charIndex), styles);\n    },\n\n    /**\n     * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)\n     * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n     * @param {Boolean} [skipWrapping] consider the location for unwrapped lines. usefull to manage styles.\n     */\n    get2DCursorLocation: function(selectionStart, skipWrapping) {\n      if (typeof selectionStart === 'undefined') {\n        selectionStart = this.selectionStart;\n      }\n      var lines = skipWrapping ? this._unwrappedTextLines : this._textLines;\n      var len = lines.length;\n      for (var i = 0; i < len; i++) {\n        if (selectionStart <= lines[i].length) {\n          return {\n            lineIndex: i,\n            charIndex: selectionStart\n          };\n        }\n        selectionStart -= lines[i].length + 1;\n      }\n      return {\n        lineIndex: i - 1,\n        charIndex: lines[i - 1].length < selectionStart ? lines[i - 1].length : selectionStart\n      };\n    },\n\n    /**\n     * Gets style of a current selection/cursor (at the start position)\n     * if startIndex or endIndex are not provided, slectionStart or selectionEnd will be used.\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n     * @param {Boolean} [complete] get full style or not\n     * @return {Array} styles an array with one, zero or more Style objects\n     */\n    getSelectionStyles: function(startIndex, endIndex, complete) {\n      if (typeof startIndex === 'undefined') {\n        startIndex = this.selectionStart || 0;\n      }\n      if (typeof endIndex === 'undefined') {\n        endIndex = this.selectionEnd || startIndex;\n      }\n      var styles = [];\n      for (var i = startIndex; i < endIndex; i++) {\n        styles.push(this.getStyleAtPosition(i, complete));\n      }\n      return styles;\n    },\n\n    /**\n     * Gets style of a current selection/cursor position\n     * @param {Number} position  to get styles at\n     * @param {Boolean} [complete] full style if true\n     * @return {Object} style Style object at a specified index\n     * @private\n     */\n    getStyleAtPosition: function(position, complete) {\n      var loc = this.get2DCursorLocation(position),\n          style = complete ? this.getCompleteStyleDeclaration(loc.lineIndex, loc.charIndex) :\n            this._getStyleDeclaration(loc.lineIndex, loc.charIndex);\n      return style || {};\n    },\n\n    /**\n     * Sets style of a current selection, if no selection exist, do not set anything.\n     * @param {Object} [styles] Styles object\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    setSelectionStyles: function(styles, startIndex, endIndex) {\n      if (typeof startIndex === 'undefined') {\n        startIndex = this.selectionStart || 0;\n      }\n      if (typeof endIndex === 'undefined') {\n        endIndex = this.selectionEnd || startIndex;\n      }\n      for (var i = startIndex; i < endIndex; i++) {\n        this._extendStyles(i, styles);\n      }\n      /* not included in _extendStyles to avoid clearing cache more than once */\n      this._forceClearCache = true;\n      return this;\n    },\n\n    /**\n     * get the reference, not a clone, of the style object for a given character\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @return {Object} style object\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex) {\n      var lineStyle = this.styles && this.styles[lineIndex];\n      if (!lineStyle) {\n        return null;\n      }\n      return lineStyle[charIndex];\n    },\n\n    /**\n     * return a new object that contains all the style property for a character\n     * the object returned is newly created\n     * @param {Number} lineIndex of the line where the character is\n     * @param {Number} charIndex position of the character on the line\n     * @return {Object} style object\n     */\n    getCompleteStyleDeclaration: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex) || { },\n          styleObject = { }, prop;\n      for (var i = 0; i < this._styleProperties.length; i++) {\n        prop = this._styleProperties[i];\n        styleObject[prop] = typeof style[prop] === 'undefined' ? this[prop] : style[prop];\n      }\n      return styleObject;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     *\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      return this.styles[lineIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function(lineIndex, style) {\n      this.styles[lineIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _deleteLineStyle: function(lineIndex) {\n      delete this.styles[lineIndex];\n    }\n  });\n})();\n(function() {\n\n  function parseDecoration(object) {\n    if (object.textDecoration) {\n      object.textDecoration.indexOf('underline') > -1 && (object.underline = true);\n      object.textDecoration.indexOf('line-through') > -1 && (object.linethrough = true);\n      object.textDecoration.indexOf('overline') > -1 && (object.overline = true);\n      delete object.textDecoration;\n    }\n  }\n\n  /**\n   * IText class (introduced in <b>v1.4</b>) Events are also fired with \"text:\"\n   * prefix when observing canvas.\n   * @class fabric.IText\n   * @extends fabric.Text\n   * @mixes fabric.Observable\n   *\n   * @fires changed\n   * @fires selection:changed\n   * @fires editing:entered\n   * @fires editing:exited\n   *\n   * @return {fabric.IText} thisArg\n   * @see {@link fabric.IText#initialize} for constructor definition\n   *\n   * <p>Supported key combinations:</p>\n   * <pre>\n   *   Move cursor:                    left, right, up, down\n   *   Select character:               shift + left, shift + right\n   *   Select text vertically:         shift + up, shift + down\n   *   Move cursor by word:            alt + left, alt + right\n   *   Select words:                   shift + alt + left, shift + alt + right\n   *   Move cursor to line start/end:  cmd + left, cmd + right or home, end\n   *   Select till start/end of line:  cmd + shift + left, cmd + shift + right or shift + home, shift + end\n   *   Jump to start/end of text:      cmd + up, cmd + down\n   *   Select till start/end of text:  cmd + shift + up, cmd + shift + down or shift + pgUp, shift + pgDown\n   *   Delete character:               backspace\n   *   Delete word:                    alt + backspace\n   *   Delete line:                    cmd + backspace\n   *   Forward delete:                 delete\n   *   Copy text:                      ctrl/cmd + c\n   *   Paste text:                     ctrl/cmd + v\n   *   Cut text:                       ctrl/cmd + x\n   *   Select entire text:             ctrl/cmd + a\n   *   Quit editing                    tab or esc\n   * </pre>\n   *\n   * <p>Supported mouse/touch combination</p>\n   * <pre>\n   *   Position cursor:                click/touch\n   *   Create selection:               click/touch & drag\n   *   Create selection:               click & shift + click\n   *   Select word:                    double click\n   *   Select line:                    triple click\n   * </pre>\n   */\n  fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'i-text',\n\n    /**\n     * Index where text selection starts (or where cursor is when there is no selection)\n     * @type Number\n     * @default\n     */\n    selectionStart: 0,\n\n    /**\n     * Index where text selection ends\n     * @type Number\n     * @default\n     */\n    selectionEnd: 0,\n\n    /**\n     * Color of text selection\n     * @type String\n     * @default\n     */\n    selectionColor: 'rgba(17,119,255,0.3)',\n\n    /**\n     * Indicates whether text is in editing mode\n     * @type Boolean\n     * @default\n     */\n    isEditing: false,\n\n    /**\n     * Indicates whether a text can be edited\n     * @type Boolean\n     * @default\n     */\n    editable: true,\n\n    /**\n     * Border color of text object while it's in editing mode\n     * @type String\n     * @default\n     */\n    editingBorderColor: 'rgba(102,153,255,0.25)',\n\n    /**\n     * Width of cursor (in px)\n     * @type Number\n     * @default\n     */\n    cursorWidth: 2,\n\n    /**\n     * Color of default cursor (when not overwritten by character style)\n     * @type String\n     * @default\n     */\n    cursorColor: '#333',\n\n    /**\n     * Delay between cursor blink (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDelay: 1000,\n\n    /**\n     * Duration of cursor fadein (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDuration: 600,\n\n    /**\n     * Indicates whether internal text char widths can be cached\n     * @type Boolean\n     * @default\n     */\n    caching: true,\n\n    /**\n     * @private\n     */\n    _reSpace: /\\s|\\n/,\n\n    /**\n     * @private\n     */\n    _currentCursorOpacity: 0,\n\n    /**\n     * @private\n     */\n    _selectionDirection: null,\n\n    /**\n     * @private\n     */\n    _abortCursorAnimation: false,\n\n    /**\n     * @private\n     */\n    __widthOfSpace: [],\n\n    /**\n     * Helps determining when the text is in composition, so that the cursor\n     * rendering is altered.\n     */\n    inCompositionMode: false,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.IText} thisArg\n     */\n    initialize: function(text, options) {\n      this.callSuper('initialize', text, options);\n      this.initBehavior();\n    },\n\n    /**\n     * Sets selection start (left boundary of a selection)\n     * @param {Number} index Index to set selection start to\n     */\n    setSelectionStart: function(index) {\n      index = Math.max(index, 0);\n      this._updateAndFire('selectionStart', index);\n    },\n\n    /**\n     * Sets selection end (right boundary of a selection)\n     * @param {Number} index Index to set selection end to\n     */\n    setSelectionEnd: function(index) {\n      index = Math.min(index, this.text.length);\n      this._updateAndFire('selectionEnd', index);\n    },\n\n    /**\n     * @private\n     * @param {String} property 'selectionStart' or 'selectionEnd'\n     * @param {Number} index new position of property\n     */\n    _updateAndFire: function(property, index) {\n      if (this[property] !== index) {\n        this._fireSelectionChanged();\n        this[property] = index;\n      }\n      this._updateTextarea();\n    },\n\n    /**\n     * Fires the even of selection changed\n     * @private\n     */\n    _fireSelectionChanged: function() {\n      this.fire('selection:changed');\n      this.canvas && this.canvas.fire('text:selection:changed', { target: this });\n    },\n\n    /**\n     * Initialize text dimensions. Render all text on given context\n     * or on a offscreen canvas to get the text width with measureText.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     * @private\n     */\n    initDimensions: function() {\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this.callSuper('initDimensions');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      this.clearContextTop();\n      this.callSuper('render', ctx);\n      // clear the cursorOffsetCache, so we ensure to calculate once per renderCursor\n      // the correct position but not at every cursor animation.\n      this.cursorOffsetCache = { };\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this.callSuper('_render', ctx);\n    },\n\n    /**\n     * Prepare and clean the contextTop\n     */\n    clearContextTop: function(skipRestore) {\n      if (!this.isEditing) {\n        return;\n      }\n      if (this.canvas && this.canvas.contextTop) {\n        var ctx = this.canvas.contextTop, v = this.canvas.viewportTransform;\n        ctx.save();\n        ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        this.transform(ctx);\n        this.transformMatrix && ctx.transform.apply(ctx, this.transformMatrix);\n        this._clearTextArea(ctx);\n        skipRestore || ctx.restore();\n      }\n    },\n\n    /**\n     * Renders cursor or selection (depending on what exists)\n     */\n    renderCursorOrSelection: function() {\n      if (!this.isEditing || !this.canvas) {\n        return;\n      }\n      var boundaries = this._getCursorBoundaries(), ctx;\n      if (this.canvas && this.canvas.contextTop) {\n        ctx = this.canvas.contextTop;\n        this.clearContextTop(true);\n      }\n      else {\n        ctx = this.canvas.contextContainer;\n        ctx.save();\n      }\n      if (this.selectionStart === this.selectionEnd) {\n        this.renderCursor(boundaries, ctx);\n      }\n      else {\n        this.renderSelection(boundaries, ctx);\n      }\n      ctx.restore();\n    },\n\n    _clearTextArea: function(ctx) {\n      // we add 4 pixel, to be sure to do not leave any pixel out\n      var width = this.width + 4, height = this.height + 4;\n      ctx.clearRect(-width / 2, -height / 2, width, height);\n    },\n\n    /**\n     * Returns cursor boundaries (left, top, leftOffset, topOffset)\n     * @private\n     * @param {Array} chars Array of characters\n     * @param {String} typeOfBoundaries\n     */\n    _getCursorBoundaries: function(position) {\n\n      // left/top are left/top of entire text box\n      // leftOffset/topOffset are offset from that left/top point of a text box\n\n      if (typeof position === 'undefined') {\n        position = this.selectionStart;\n      }\n\n      var left = this._getLeftOffset(),\n          top = this._getTopOffset(),\n          offsets = this._getCursorBoundariesOffsets(position);\n\n      return {\n        left: left,\n        top: top,\n        leftOffset: offsets.left,\n        topOffset: offsets.top\n      };\n    },\n\n    /**\n     * @private\n     */\n    _getCursorBoundariesOffsets: function(position) {\n      if (this.cursorOffsetCache && 'top' in this.cursorOffsetCache) {\n        return this.cursorOffsetCache;\n      }\n      var lineLeftOffset,\n          lineIndex,\n          charIndex,\n          topOffset = 0,\n          leftOffset = 0,\n          boundaries,\n          cursorPosition = this.get2DCursorLocation(position);\n      charIndex = cursorPosition.charIndex;\n      lineIndex = cursorPosition.lineIndex;\n      for (var i = 0; i < lineIndex; i++) {\n        topOffset += this.getHeightOfLine(i);\n      }\n      lineLeftOffset = this._getLineLeftOffset(lineIndex);\n      var bound = this.__charBounds[lineIndex][charIndex];\n      bound && (leftOffset = bound.left);\n      if (this.charSpacing !== 0 && charIndex === this._textLines[lineIndex].length) {\n        leftOffset -= this._getWidthOfCharSpacing();\n      }\n      boundaries = {\n        top: topOffset,\n        left: lineLeftOffset + (leftOffset > 0 ? leftOffset : 0),\n      };\n      this.cursorOffsetCache = boundaries;\n      return this.cursorOffsetCache;\n    },\n\n    /**\n     * Renders cursor\n     * @param {Object} boundaries\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderCursor: function(boundaries, ctx) {\n      var cursorLocation = this.get2DCursorLocation(),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex > 0 ? cursorLocation.charIndex - 1 : 0,\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize'),\n          multiplier = this.scaleX * this.canvas.getZoom(),\n          cursorWidth = this.cursorWidth / multiplier,\n          topOffset = boundaries.topOffset,\n          dy = this.getValueOfPropertyAt(lineIndex, charIndex, 'deltaY');\n\n      topOffset += (1 - this._fontSizeFraction) * this.getHeightOfLine(lineIndex) / this.lineHeight\n        - charHeight * (1 - this._fontSizeFraction);\n\n      if (this.inCompositionMode) {\n        this.renderSelection(boundaries, ctx);\n      }\n\n      // ctx.fillStyle = this.getValueOfPropertyAt(lineIndex, charIndex, 'fill');\n      ctx.fillStyle = this.cursorColor; // BUG bug\n      ctx.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity;\n      ctx.fillRect(\n        boundaries.left + boundaries.leftOffset - cursorWidth / 2,\n        topOffset + boundaries.top + dy,\n        cursorWidth,\n        charHeight);\n    },\n\n    /**\n     * Renders text selection\n     * @param {Object} boundaries Object with left/top/leftOffset/topOffset\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderSelection: function(boundaries, ctx) {\n\n      var selectionStart = this.inCompositionMode ? this.compositionStart : this.selectionStart,\n          selectionEnd = this.inCompositionMode ? this.hiddenTextarea.selectionEnd : this.selectionEnd,\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          start = this.get2DCursorLocation(selectionStart),\n          end = this.get2DCursorLocation(selectionEnd),\n          startLine = start.lineIndex,\n          endLine = end.lineIndex,\n          startChar = start.charIndex < 0 ? 0 : start.charIndex,\n          endChar = end.charIndex < 0 ? 0 : end.charIndex;\n\n      for (var i = startLine; i <= endLine; i++) {\n        var lineOffset = this._getLineLeftOffset(i) || 0,\n            lineHeight = this.getHeightOfLine(i),\n            realLineHeight = 0, boxStart = 0, boxEnd = 0;\n\n        if (i === startLine) {\n          boxStart = this.__charBounds[startLine][startChar].left;\n        }\n        if (i >= startLine && i < endLine) {\n          boxEnd = isJustify && !this.isEndOfWrapping(i) ? this.width : this.getLineWidth(i) || 5; // WTF is this 5?\n        }\n        else if (i === endLine) {\n          if (endChar === 0) {\n            boxEnd = this.__charBounds[endLine][endChar].left;\n          }\n          else {\n            var charSpacing = this._getWidthOfCharSpacing();\n            boxEnd = this.__charBounds[endLine][endChar - 1].left\n              + this.__charBounds[endLine][endChar - 1].width - charSpacing;\n          }\n        }\n        realLineHeight = lineHeight;\n        if (this.lineHeight < 1 || (i === endLine && this.lineHeight > 1)) {\n          lineHeight /= this.lineHeight;\n        }\n        if (this.inCompositionMode) {\n          ctx.fillStyle = this.compositionColor || 'black';\n          ctx.fillRect(\n            boundaries.left + lineOffset + boxStart,\n            boundaries.top + boundaries.topOffset + lineHeight,\n            boxEnd - boxStart,\n            1);\n        }\n        else {\n          ctx.fillStyle = this.selectionColor;\n          ctx.fillRect(\n            boundaries.left + lineOffset + boxStart,\n            boundaries.top + boundaries.topOffset,\n            boxEnd - boxStart,\n            lineHeight);\n        }\n\n\n        boundaries.topOffset += realLineHeight;\n      }\n    },\n\n    /**\n     * High level function to know the height of the cursor.\n     * the currentChar is the one that precedes the cursor\n     * Returns fontSize of char at the current cursor\n     * @return {Number} Character font size\n     */\n    getCurrentCharFontSize: function() {\n      var cp = this._getCurrentCharIndex();\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fontSize');\n    },\n\n    /**\n     * High level function to know the color of the cursor.\n     * the currentChar is the one that precedes the cursor\n     * Returns color (fill) of char at the current cursor\n     * @return {String} Character color (fill)\n     */\n    getCurrentCharColor: function() {\n      var cp = this._getCurrentCharIndex();\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fill');\n    },\n\n    /**\n     * Returns the cursor position for the getCurrent.. functions\n     * @private\n     */\n    _getCurrentCharIndex: function() {\n      var cursorPosition = this.get2DCursorLocation(this.selectionStart, true),\n          charIndex = cursorPosition.charIndex > 0 ? cursorPosition.charIndex - 1 : 0;\n      return { l: cursorPosition.lineIndex, c: charIndex };\n    }\n  });\n\n  /**\n   * Returns fabric.IText instance from an object representation\n   * @static\n   * @memberOf fabric.IText\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as argument\n   */\n  fabric.IText.fromObject = function(object, callback) {\n    parseDecoration(object);\n    if (object.styles) {\n      for (var i in object.styles) {\n        for (var j in object.styles[i]) {\n          parseDecoration(object.styles[i][j]);\n        }\n      }\n    }\n    fabric.Object._fromObject('IText', object, callback, 'text');\n  };\n})();\n(function() {\n\n  var clone = fabric.util.object.clone;\n\n  fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Initializes all the interactive behavior of IText\n     */\n    initBehavior: function() {\n      this.initAddedHandler();\n      this.initRemovedHandler();\n      this.initCursorSelectionHandlers();\n      this.initDoubleClickSimulation();\n      this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\n    },\n\n    onDeselect: function() {\n      this.isEditing && this.exitEditing();\n      this.selected = false;\n    },\n\n    /**\n     * Initializes \"added\" event handler\n     */\n    initAddedHandler: function() {\n      var _this = this;\n      this.on('added', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          if (!canvas._hasITextHandlers) {\n            canvas._hasITextHandlers = true;\n            _this._initCanvasHandlers(canvas);\n          }\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          canvas._iTextInstances.push(_this);\n        }\n      });\n    },\n\n    initRemovedHandler: function() {\n      var _this = this;\n      this.on('removed', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          fabric.util.removeFromArray(canvas._iTextInstances, _this);\n          if (canvas._iTextInstances.length === 0) {\n            canvas._hasITextHandlers = false;\n            _this._removeCanvasHandlers(canvas);\n          }\n        }\n      });\n    },\n\n    /**\n     * register canvas event to manage exiting on other instances\n     * @private\n     */\n    _initCanvasHandlers: function(canvas) {\n      canvas._mouseUpITextHandler = function() {\n        if (canvas._iTextInstances) {\n          canvas._iTextInstances.forEach(function(obj) {\n            obj.__isMousedown = false;\n          });\n        }\n      };\n      canvas.on('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * remove canvas event to manage exiting on other instances\n     * @private\n     */\n    _removeCanvasHandlers: function(canvas) {\n      canvas.off('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * @private\n     */\n    _tick: function() {\n      this._currentTickState = this._animateCursor(this, 1, this.cursorDuration, '_onTickComplete');\n    },\n\n    /**\n     * @private\n     */\n    _animateCursor: function(obj, targetOpacity, duration, completeMethod) {\n\n      var tickState;\n\n      tickState = {\n        isAborted: false,\n        abort: function() {\n          this.isAborted = true;\n        },\n      };\n\n      obj.animate('_currentCursorOpacity', targetOpacity, {\n        duration: duration,\n        onComplete: function() {\n          if (!tickState.isAborted) {\n            obj[completeMethod]();\n          }\n        },\n        onChange: function() {\n          // we do not want to animate a selection, only cursor\n          if (obj.canvas && obj.selectionStart === obj.selectionEnd) {\n            obj.renderCursorOrSelection();\n          }\n        },\n        abort: function() {\n          return tickState.isAborted;\n        }\n      });\n      return tickState;\n    },\n\n    /**\n     * @private\n     */\n    _onTickComplete: function() {\n\n      var _this = this;\n\n      if (this._cursorTimeout1) {\n        clearTimeout(this._cursorTimeout1);\n      }\n      this._cursorTimeout1 = setTimeout(function() {\n        _this._currentTickCompleteState = _this._animateCursor(_this, 0, this.cursorDuration / 2, '_tick');\n      }, 100);\n    },\n\n    /**\n     * Initializes delayed cursor\n     */\n    initDelayedCursor: function(restart) {\n      var _this = this,\n          delay = restart ? 0 : this.cursorDelay;\n\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this._cursorTimeout2 = setTimeout(function() {\n        _this._tick();\n      }, delay);\n    },\n\n    /**\n     * Aborts cursor animation and clears all timeouts\n     */\n    abortCursorAnimation: function() {\n      var shouldClear = this._currentTickState || this._currentTickCompleteState,\n          canvas = this.canvas;\n      this._currentTickState && this._currentTickState.abort();\n      this._currentTickCompleteState && this._currentTickCompleteState.abort();\n\n      clearTimeout(this._cursorTimeout1);\n      clearTimeout(this._cursorTimeout2);\n\n      this._currentCursorOpacity = 0;\n      // to clear just itext area we need to transform the context\n      // it may not be worth it\n      if (shouldClear && canvas) {\n        canvas.clearContext(canvas.contextTop || canvas.contextContainer);\n      }\n\n    },\n\n    /**\n     * Selects entire text\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    selectAll: function() {\n      this.selectionStart = 0;\n      this.selectionEnd = this._text.length;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      return this;\n    },\n\n    /**\n     * Returns selected text\n     * @return {String}\n     */\n    getSelectedText: function() {\n      return this._text.slice(this.selectionStart, this.selectionEnd).join('');\n    },\n\n    /**\n     * Find new selection index representing start of current word according to current selection index\n     * @param {Number} startFrom Surrent selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      // remove space before cursor first\n      if (this._reSpace.test(this._text[index])) {\n        while (this._reSpace.test(this._text[index])) {\n          offset++;\n          index--;\n        }\n      }\n      while (/\\S/.test(this._text[index]) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      // remove space after cursor first\n      if (this._reSpace.test(this._text[index])) {\n        while (this._reSpace.test(this._text[index])) {\n          offset++;\n          index++;\n        }\n      }\n      while (/\\S/.test(this._text[index]) && index < this.text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Find new selection index representing start of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      while (!/\\n/.test(this._text[index]) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      while (!/\\n/.test(this._text[index]) && index < this.text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Finds index corresponding to beginning or end of a word\n     * @param {Number} selectionStart Index of a character\n     * @param {Number} direction 1 or -1\n     * @return {Number} Index of the beginning or end of a word\n     */\n    searchWordBoundary: function(selectionStart, direction) {\n      var index     = this._reSpace.test(this.text.charAt(selectionStart)) ? selectionStart - 1 : selectionStart,\n          _char     = this.text.charAt(index),\n          reNonWord = /[ \\n\\.,;!\\?\\-]/;\n\n      while (!reNonWord.test(_char) && index > 0 && index < this.text.length) {\n        index += direction;\n        _char = this.text.charAt(index);\n      }\n      if (reNonWord.test(_char) && _char !== '\\n') {\n        index += direction === 1 ? 0 : 1;\n      }\n      return index;\n    },\n\n    /**\n     * Selects a word based on the index\n     * @param {Number} selectionStart Index of a character\n     */\n    selectWord: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.searchWordBoundary(selectionStart, -1), /* search backwards */\n          newSelectionEnd = this.searchWordBoundary(selectionStart, 1); /* search forward */\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * Selects a line based on the index\n     * @param {Number} selectionStart Index of a character\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    selectLine: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.findLineBoundaryLeft(selectionStart),\n          newSelectionEnd = this.findLineBoundaryRight(selectionStart);\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      return this;\n    },\n\n    /**\n     * Enters editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    enterEditing: function(e) {\n      if (this.isEditing || !this.editable) {\n        return;\n      }\n\n      if (this.canvas) {\n        this.canvas.calcOffset();\n        this.exitEditingOnOthers(this.canvas);\n      }\n\n      this.isEditing = true;\n\n      this.initHiddenTextarea(e);\n      this.hiddenTextarea.focus();\n      this.hiddenTextarea.value = this.text;\n      this._updateTextarea();\n      this._saveEditingProps();\n      this._setEditingProps();\n      this._textBeforeEdit = this.text;\n\n      this._tick();\n      this.fire('editing:entered');\n      this._fireSelectionChanged();\n      if (!this.canvas) {\n        return this;\n      }\n      this.canvas.fire('text:editing:entered', { target: this });\n      this.initMouseMoveHandler();\n      this.canvas.requestRenderAll();\n      return this;\n    },\n\n    exitEditingOnOthers: function(canvas) {\n      if (canvas._iTextInstances) {\n        canvas._iTextInstances.forEach(function(obj) {\n          obj.selected = false;\n          if (obj.isEditing) {\n            obj.exitEditing();\n          }\n        });\n      }\n    },\n\n    /**\n     * Initializes \"mousemove\" event handler\n     */\n    initMouseMoveHandler: function() {\n      this.canvas.on('mouse:move', this.mouseMoveHandler);\n    },\n\n    /**\n     * @private\n     */\n    mouseMoveHandler: function(options) {\n      if (!this.__isMousedown || !this.isEditing) {\n        return;\n      }\n\n      var newSelectionStart = this.getSelectionStartFromPointer(options.e),\n          currentStart = this.selectionStart,\n          currentEnd = this.selectionEnd;\n      if (\n        (newSelectionStart !== this.__selectionStartOnMouseDown || currentStart === currentEnd)\n        &&\n        (currentStart === newSelectionStart || currentEnd === newSelectionStart)\n      ) {\n        return;\n      }\n      if (newSelectionStart > this.__selectionStartOnMouseDown) {\n        this.selectionStart = this.__selectionStartOnMouseDown;\n        this.selectionEnd = newSelectionStart;\n      }\n      else {\n        this.selectionStart = newSelectionStart;\n        this.selectionEnd = this.__selectionStartOnMouseDown;\n      }\n      if (this.selectionStart !== currentStart || this.selectionEnd !== currentEnd) {\n        this.restartCursorIfNeeded();\n        this._fireSelectionChanged();\n        this._updateTextarea();\n        this.renderCursorOrSelection();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setEditingProps: function() {\n      this.hoverCursor = 'text';\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this.canvas.moveCursor = 'text';\n      }\n\n      this.borderColor = this.editingBorderColor;\n\n      this.hasControls = this.selectable = false;\n      this.lockMovementX = this.lockMovementY = true;\n    },\n\n    /**\n     * convert from textarea to grapheme indexes\n     */\n    fromStringToGraphemeSelection: function(start, end, text) {\n      var smallerTextStart = text.slice(0, start),\n          graphemeStart = fabric.util.string.graphemeSplit(smallerTextStart).length;\n      if (start === end) {\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n      }\n      var smallerTextEnd = text.slice(start, end),\n          graphemeEnd = fabric.util.string.graphemeSplit(smallerTextEnd).length;\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\n    },\n\n    /**\n     * convert from fabric to textarea values\n     */\n    fromGraphemeToStringSelection: function(start, end, _text) {\n      var smallerTextStart = _text.slice(0, start),\n          graphemeStart = smallerTextStart.join('').length;\n      if (start === end) {\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n      }\n      var smallerTextEnd = _text.slice(start, end),\n          graphemeEnd = smallerTextEnd.join('').length;\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\n    },\n\n    /**\n     * @private\n     */\n    _updateTextarea: function() {\n      this.cursorOffsetCache = { };\n      if (!this.hiddenTextarea) {\n        return;\n      }\n      if (!this.inCompositionMode) {\n        var newSelection = this.fromGraphemeToStringSelection(this.selectionStart, this.selectionEnd, this._text);\n        this.hiddenTextarea.selectionStart = newSelection.selectionStart;\n        this.hiddenTextarea.selectionEnd = newSelection.selectionEnd;\n      }\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * @private\n     */\n    updateFromTextArea: function() {\n      if (!this.hiddenTextarea) {\n        return;\n      }\n      this.cursorOffsetCache = { };\n      this.text = this.hiddenTextarea.value;\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      var newSelection = this.fromStringToGraphemeSelection(\n        this.hiddenTextarea.selectionStart, this.hiddenTextarea.selectionEnd, this.hiddenTextarea.value);\n      this.selectionEnd = this.selectionStart = newSelection.selectionEnd;\n      if (!this.inCompositionMode) {\n        this.selectionStart = newSelection.selectionStart;\n      }\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * @private\n     */\n    updateTextareaPosition: function() {\n      if (this.selectionStart === this.selectionEnd) {\n        var style = this._calcTextareaPosition();\n        this.hiddenTextarea.style.left = style.left;\n        this.hiddenTextarea.style.top = style.top;\n      }\n    },\n\n    /**\n     * @private\n     * @return {Object} style contains style for hiddenTextarea\n     */\n    _calcTextareaPosition: function() {\n      if (!this.canvas) {\n        return { x: 1, y: 1 };\n      }\n      var desiredPostion = this.inCompositionMode ? this.compositionStart : this.selectionStart,\n          boundaries = this._getCursorBoundaries(desiredPostion),\n          cursorLocation = this.get2DCursorLocation(desiredPostion),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex,\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize') * this.lineHeight,\n          leftOffset = boundaries.leftOffset,\n          m = this.calcTransformMatrix(),\n          p = {\n            x: boundaries.left + leftOffset,\n            y: boundaries.top + boundaries.topOffset + charHeight\n          },\n          upperCanvas = this.canvas.upperCanvasEl,\n          upperCanvasWidth = upperCanvas.width,\n          upperCanvasHeight = upperCanvas.height,\n          maxWidth = upperCanvasWidth - charHeight,\n          maxHeight = upperCanvasHeight - charHeight,\n          scaleX = upperCanvas.clientWidth / upperCanvasWidth,\n          scaleY = upperCanvas.clientHeight / upperCanvasHeight;\n\n      p = fabric.util.transformPoint(p, m);\n      p = fabric.util.transformPoint(p, this.canvas.viewportTransform);\n      p.x *= scaleX;\n      p.y *= scaleY;\n      if (p.x < 0) {\n        p.x = 0;\n      }\n      if (p.x > maxWidth) {\n        p.x = maxWidth;\n      }\n      if (p.y < 0) {\n        p.y = 0;\n      }\n      if (p.y > maxHeight) {\n        p.y = maxHeight;\n      }\n\n      // add canvas offset on document\n      p.x += this.canvas._offset.left;\n      p.y += this.canvas._offset.top;\n      // fix UTM-759\n      // return { left: '-1000px', top: '-1000px', fontSize: charHeight + 'px', charHeight: charHeight };\n      return { left: p.x + 'px', top: p.y + 'px', fontSize: charHeight + 'px', charHeight: charHeight };\n    },\n\n    /**\n     * @private\n     */\n    _saveEditingProps: function() {\n      this._savedProps = {\n        hasControls: this.hasControls,\n        borderColor: this.borderColor,\n        lockMovementX: this.lockMovementX,\n        lockMovementY: this.lockMovementY,\n        hoverCursor: this.hoverCursor,\n        defaultCursor: this.canvas && this.canvas.defaultCursor,\n        moveCursor: this.canvas && this.canvas.moveCursor\n      };\n    },\n\n    /**\n     * @private\n     */\n    _restoreEditingProps: function() {\n      if (!this._savedProps) {\n        return;\n      }\n\n      this.hoverCursor = this._savedProps.hoverCursor;\n      this.hasControls = this._savedProps.hasControls;\n      this.borderColor = this._savedProps.borderColor;\n      this.lockMovementX = this._savedProps.lockMovementX;\n      this.lockMovementY = this._savedProps.lockMovementY;\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this._savedProps.defaultCursor;\n        this.canvas.moveCursor = this._savedProps.moveCursor;\n      }\n    },\n\n    /**\n     * Exits from editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    exitEditing: function() {\n      var isTextChanged = (this._textBeforeEdit !== this.text);\n      this.selected = false;\n      this.isEditing = false;\n      this.selectable = true;\n\n      this.selectionEnd = this.selectionStart;\n\n      if (this.hiddenTextarea) {\n        this.hiddenTextarea.blur && this.hiddenTextarea.blur();\n        this.canvas && this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);\n        this.hiddenTextarea = null;\n      }\n\n      this.abortCursorAnimation();\n      this._restoreEditingProps();\n      this._currentCursorOpacity = 0;\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      this.fire('editing:exited');\n      isTextChanged && this.fire('modified');\n      if (this.canvas) {\n        this.canvas.off('mouse:move', this.mouseMoveHandler);\n        this.canvas.fire('text:editing:exited', { target: this });\n        isTextChanged && this.canvas.fire('object:modified', { target: this });\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _removeExtraneousStyles: function() {\n      for (var prop in this.styles) {\n        if (!this._textLines[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * remove and reflow a style block from start to end.\n     * @param {Number} start linear start position for removal (included in removal)\n     * @param {Number} end linear end position for removal ( excluded from removal )\n     */\n    removeStyleFromTo: function(start, end) {\n      var cursorStart = this.get2DCursorLocation(start, true),\n          cursorEnd = this.get2DCursorLocation(end, true),\n          lineStart = cursorStart.lineIndex,\n          charStart = cursorStart.charIndex,\n          lineEnd = cursorEnd.lineIndex,\n          charEnd = cursorEnd.charIndex,\n          i, styleObj;\n      if (lineStart !== lineEnd) {\n        // step1 remove the trailing of lineStart\n        if (this.styles[lineStart]) {\n          for (i = charStart; i < this._unwrappedTextLines[lineStart].length; i++) {\n            delete this.styles[lineStart][i];\n          }\n        }\n        // step2 move the trailing of lineEnd to lineStart if needed\n        if (this.styles[lineEnd]) {\n          for (i = charEnd; i < this._unwrappedTextLines[lineEnd].length; i++) {\n            styleObj = this.styles[lineEnd][i];\n            if (styleObj) {\n              this.styles[lineStart] || (this.styles[lineStart] = { });\n              this.styles[lineStart][charStart + i - charEnd] = styleObj;\n            }\n          }\n        }\n        // step3 detects lines will be completely removed.\n        for (i = lineStart + 1; i <= lineEnd; i++) {\n          delete this.styles[i];\n        }\n        // step4 shift remaining lines.\n        this.shiftLineStyles(lineEnd, lineStart - lineEnd);\n      }\n      else {\n        // remove and shift left on the same line\n        if (this.styles[lineStart]) {\n          styleObj = this.styles[lineStart];\n          var diff = charEnd - charStart, numericChar, _char;\n          for (i = charStart; i < charEnd; i++) {\n            delete styleObj[i];\n          }\n          for (_char in this.styles[lineStart]) {\n            numericChar = parseInt(_char, 10);\n            if (numericChar >= charEnd) {\n              styleObj[numericChar - diff] = styleObj[_char];\n              delete styleObj[_char];\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Shifts line styles up or down\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} offset Can any number?\n     */\n    shiftLineStyles: function(lineIndex, offset) {\n      // shift all line styles by offset upward or downward\n      // do not clone deep. we need new array, not new style objects\n      var clonedStyles = clone(this.styles);\n      for (var line in this.styles) {\n        var numericLine = parseInt(line, 10);\n        if (numericLine > lineIndex) {\n          this.styles[numericLine + offset] = clonedStyles[numericLine];\n          if (!clonedStyles[numericLine - offset]) {\n            delete this.styles[numericLine];\n          }\n        }\n      }\n    },\n\n    restartCursorIfNeeded: function() {\n      if (!this._currentTickState || this._currentTickState.isAborted\n        || !this._currentTickCompleteState || this._currentTickCompleteState.isAborted\n      ) {\n        this.initDelayedCursor();\n      }\n    },\n\n    /**\n     * Inserts new style object\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Number} qty number of lines to add\n     * @param {Array} copiedStyle Array of objects styles\n     */\n    insertNewlineStyleObject: function(lineIndex, charIndex, qty, copiedStyle) {\n      var currentCharStyle,\n          newLineStyles = {},\n          somethingAdded = false;\n\n      qty || (qty = 1);\n      this.shiftLineStyles(lineIndex, qty);\n      if (this.styles[lineIndex]) {\n        currentCharStyle = this.styles[lineIndex][charIndex === 0 ? charIndex : charIndex - 1];\n      }\n\n      // we clone styles of all chars\n      // after cursor onto the current line\n      for (var index in this.styles[lineIndex]) {\n        var numIndex = parseInt(index, 10);\n        if (numIndex >= charIndex) {\n          somethingAdded = true;\n          newLineStyles[numIndex - charIndex] = this.styles[lineIndex][index];\n          // remove lines from the previous line since they're on a new line now\n          delete this.styles[lineIndex][index];\n        }\n      }\n      if (somethingAdded) {\n        this.styles[lineIndex + qty] = newLineStyles;\n      }\n      else {\n        delete this.styles[lineIndex + qty];\n      }\n      // for the other lines\n      // we clone current char style onto the next (otherwise empty) line\n      while (qty > 1) {\n        qty--;\n        if (copiedStyle && copiedStyle[qty]) {\n          this.styles[lineIndex + qty] = { 0: clone(copiedStyle[qty]) };\n        }\n        else if (currentCharStyle) {\n          this.styles[lineIndex + qty] = { 0: clone(currentCharStyle) };\n        }\n        else {\n          delete this.styles[lineIndex + qty];\n        }\n      }\n      this._forceClearCache = true;\n    },\n\n    /**\n     * Inserts style object for a given line/char index\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Number} quantity number Style object to insert, if given\n     * @param {Array} copiedStyle array of style objecs\n     */\n    insertCharStyleObject: function(lineIndex, charIndex, quantity, copiedStyle) {\n      if (!this.styles) {\n        this.styles = {};\n      }\n      var currentLineStyles       = this.styles[lineIndex],\n          currentLineStylesCloned = currentLineStyles ? clone(currentLineStyles) : {};\n\n      quantity || (quantity = 1);\n      // shift all char styles by quantity forward\n      // 0,1,2,3 -> (charIndex=2) -> 0,1,3,4 -> (insert 2) -> 0,1,2,3,4\n      for (var index in currentLineStylesCloned) {\n        var numericIndex = parseInt(index, 10);\n        if (numericIndex >= charIndex) {\n          currentLineStyles[numericIndex + quantity] = currentLineStylesCloned[numericIndex];\n          // only delete the style if there was nothing moved there\n          if (!currentLineStylesCloned[numericIndex - quantity]) {\n            delete currentLineStyles[numericIndex];\n          }\n        }\n      }\n      this._forceClearCache = true;\n      if (copiedStyle) {\n        while (quantity--) {\n          if (!Object.keys(copiedStyle[quantity]).length) {\n            continue;\n          }\n          if (!this.styles[lineIndex]) {\n            this.styles[lineIndex] = {};\n          }\n          this.styles[lineIndex][charIndex + quantity] = clone(copiedStyle[quantity]);\n        }\n        return;\n      }\n      if (!currentLineStyles) {\n        return;\n      }\n      var newStyle = currentLineStyles[charIndex ? charIndex - 1 : 1];\n      while (newStyle && quantity--) {\n        this.styles[lineIndex][charIndex + quantity] = clone(newStyle);\n      }\n    },\n\n    /**\n     * Inserts style object(s)\n     * @param {Array} insertedText Characters at the location where style is inserted\n     * @param {Number} start cursor index for inserting style\n     * @param {Array} [copiedStyle] array of style objects to insert.\n     */\n    insertNewStyleBlock: function(insertedText, start, copiedStyle) {\n      var cursorLoc = this.get2DCursorLocation(start, true),\n          addedLines = [0], linesLenght = 0;\n      for (var i = 0; i < insertedText.length; i++) {\n        if (insertedText[i] === '\\n') {\n          linesLenght++;\n          addedLines[linesLenght] = 0;\n        }\n        else {\n          addedLines[linesLenght]++;\n        }\n      }\n      if (addedLines[0] > 0) {\n        this.insertCharStyleObject(cursorLoc.lineIndex, cursorLoc.charIndex, addedLines[0], copiedStyle);\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[0] + 1);\n      }\n      linesLenght && this.insertNewlineStyleObject(\n        cursorLoc.lineIndex, cursorLoc.charIndex + addedLines[0], linesLenght);\n      for (var i = 1; i < linesLenght; i++) {\n        if (addedLines[i] > 0) {\n          this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\n        }\n        else if (copiedStyle) {\n          this.styles[cursorLoc.lineIndex + i][0] = copiedStyle[0];\n        }\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[i] + 1);\n      }\n      // we use i outside the loop to get it like linesLength\n      if (addedLines[i] > 0) {\n        this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\n      }\n    },\n\n    /**\n     * Set the selectionStart and selectionEnd according to the ne postion of cursor\n     * mimic the key - mouse navigation when shift is pressed.\n     */\n    setSelectionStartEndWithShift: function(start, end, newSelection) {\n      if (newSelection <= start) {\n        if (end === start) {\n          this._selectionDirection = 'left';\n        }\n        else if (this._selectionDirection === 'right') {\n          this._selectionDirection = 'left';\n          this.selectionEnd = start;\n        }\n        this.selectionStart = newSelection;\n      }\n      else if (newSelection > start && newSelection < end) {\n        if (this._selectionDirection === 'right') {\n          this.selectionEnd = newSelection;\n        }\n        else {\n          this.selectionStart = newSelection;\n        }\n      }\n      else {\n        // newSelection is > selection start and end\n        if (end === start) {\n          this._selectionDirection = 'right';\n        }\n        else if (this._selectionDirection === 'left') {\n          this._selectionDirection = 'right';\n          this.selectionStart = end;\n        }\n        this.selectionEnd = newSelection;\n      }\n    },\n\n    setSelectionInBoundaries: function() {\n      var length = this.text.length;\n      if (this.selectionStart > length) {\n        this.selectionStart = length;\n      }\n      else if (this.selectionStart < 0) {\n        this.selectionStart = 0;\n      }\n      if (this.selectionEnd > length) {\n        this.selectionEnd = length;\n      }\n      else if (this.selectionEnd < 0) {\n        this.selectionEnd = 0;\n      }\n    }\n  });\n})();\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n  /**\n   * Initializes \"dbclick\" event handler\n   */\n  initDoubleClickSimulation: function() {\n\n    // for double click\n    this.__lastClickTime = +new Date();\n\n    // for triple click\n    this.__lastLastClickTime = +new Date();\n\n    this.__lastPointer = { };\n\n    this.on('mousedown', this.onMouseDown);\n  },\n\n  /**\n   * Default event handler to simulate triple click\n   * @private\n   */\n  onMouseDown: function(options) {\n    if (!this.canvas) {\n      return;\n    }\n    this.__newClickTime = +new Date();\n    var newPointer = options.pointer;\n    if (this.isTripleClick(newPointer)) {\n      this.fire('tripleclick', options);\n      this._stopEvent(options.e);\n    }\n    this.__lastLastClickTime = this.__lastClickTime;\n    this.__lastClickTime = this.__newClickTime;\n    this.__lastPointer = newPointer;\n    this.__lastIsEditing = this.isEditing;\n    this.__lastSelected = this.selected;\n  },\n\n  isTripleClick: function(newPointer) {\n    return this.__newClickTime - this.__lastClickTime < 500 &&\n        this.__lastClickTime - this.__lastLastClickTime < 500 &&\n        this.__lastPointer.x === newPointer.x &&\n        this.__lastPointer.y === newPointer.y;\n  },\n\n  /**\n   * @private\n   */\n  _stopEvent: function(e) {\n    e.preventDefault && e.preventDefault();\n    e.stopPropagation && e.stopPropagation();\n  },\n\n  /**\n   * Initializes event handlers related to cursor or selection\n   */\n  initCursorSelectionHandlers: function() {\n    this.initMousedownHandler();\n    this.initMouseupHandler();\n    this.initClicks();\n  },\n\n  /**\n   * Initializes double and triple click event handlers\n   */\n  initClicks: function() {\n    this.on('mousedblclick', function(options) {\n      this.selectWord(this.getSelectionStartFromPointer(options.e));\n    });\n    this.on('tripleclick', function(options) {\n      this.selectLine(this.getSelectionStartFromPointer(options.e));\n    });\n  },\n\n  /**\n   * Default event handler for the basic functionalities needed on _mouseDown\n   * can be overridden to do something different.\n   * Scope of this implementation is: find the click position, set selectionStart\n   * find selectionEnd, initialize the drawing of either cursor or selection area\n   */\n  _mouseDownHandler: function(options) {\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n\n    this.__isMousedown = true;\n\n    if (this.selected) {\n      this.setCursorByClick(options.e);\n    }\n\n    if (this.isEditing) {\n      this.__selectionStartOnMouseDown = this.selectionStart;\n      if (this.selectionStart === this.selectionEnd) {\n        this.abortCursorAnimation();\n      }\n      this.renderCursorOrSelection();\n    }\n  },\n\n  /**\n   * Default event handler for the basic functionalities needed on mousedown:before\n   * can be overridden to do something different.\n   * Scope of this implementation is: verify the object is already selected when mousing down\n   */\n  _mouseDownHandlerBefore: function(options) {\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n    if (this === this.canvas._activeObject) {\n      this.selected = true;\n    }\n  },\n\n  /**\n   * Initializes \"mousedown\" event handler\n   */\n  initMousedownHandler: function() {\n    this.on('mousedown', this._mouseDownHandler);\n    this.on('mousedown:before', this._mouseDownHandlerBefore);\n  },\n\n  /**\n   * Initializes \"mouseup\" event handler\n   */\n  initMouseupHandler: function() {\n    this.on('mouseup', this.mouseUpHandler);\n  },\n\n  /**\n   * standard hander for mouse up, overridable\n   * @private\n   */\n  mouseUpHandler: function(options) {\n    this.__isMousedown = false;\n    if (!this.editable || this.group ||\n      (options.transform && options.transform.actionPerformed) ||\n      (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n\n    if (this.canvas) {\n      var currentActive = this.canvas._activeObject;\n      if (currentActive && currentActive !== this) {\n        // avoid running this logic when there is an active object\n        // this because is possible with shift click and fast clicks,\n        // to rapidly deselect and reselect this object and trigger an enterEdit\n        return;\n      }\n    }\n\n    if (this.__lastSelected && !this.__corner) {\n      this.selected = false;\n      this.__lastSelected = false;\n      this.enterEditing(options.e);\n      if (this.selectionStart === this.selectionEnd) {\n        this.initDelayedCursor(true);\n      }\n      else {\n        this.renderCursorOrSelection();\n      }\n    }\n    else {\n      this.selected = true;\n    }\n  },\n\n  /**\n   * Changes cursor location in a text depending on passed pointer (x/y) object\n   * @param {Event} e Event object\n   */\n  setCursorByClick: function(e) {\n    var newSelection = this.getSelectionStartFromPointer(e),\n        start = this.selectionStart, end = this.selectionEnd;\n    if (e.shiftKey) {\n      this.setSelectionStartEndWithShift(start, end, newSelection);\n    }\n    else {\n      this.selectionStart = newSelection;\n      this.selectionEnd = newSelection;\n    }\n    if (this.isEditing) {\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Returns index of a character corresponding to where an object was clicked\n   * @param {Event} e Event object\n   * @return {Number} Index of a character\n   */\n  getSelectionStartFromPointer: function(e) {\n    var mouseOffset = this.getLocalPointer(e),\n        prevWidth = 0,\n        width = 0,\n        height = 0,\n        charIndex = 0,\n        lineIndex = 0,\n        lineLeftOffset,\n        line;\n\n    for (var i = 0, len = this._textLines.length; i < len; i++) {\n      if (height <= mouseOffset.y) {\n        height += this.getHeightOfLine(i) * this.scaleY;\n        lineIndex = i;\n        if (i > 0) {\n          charIndex += this._textLines[i - 1].length + 1;\n        }\n      }\n      else {\n        break;\n      }\n    }\n    lineLeftOffset = this._getLineLeftOffset(lineIndex);\n    width = lineLeftOffset * this.scaleX;\n    line = this._textLines[lineIndex];\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\n      prevWidth = width;\n      // i removed something about flipX here, check.\n      width += this.__charBounds[lineIndex][j].kernedWidth * this.scaleX;\n      if (width <= mouseOffset.x) {\n        charIndex++;\n      }\n      else {\n        break;\n      }\n    }\n    return this._getNewSelectionStartFromOffset(mouseOffset, prevWidth, width, charIndex, jlen);\n  },\n\n  /**\n   * @private\n   */\n  _getNewSelectionStartFromOffset: function(mouseOffset, prevWidth, width, index, jlen) {\n    // we need Math.abs because when width is after the last char, the offset is given as 1, while is 0\n    var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,\n        distanceBtwNextCharAndCursor = width - mouseOffset.x,\n        offset = distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ||\n          distanceBtwNextCharAndCursor < 0 ? 0 : 1,\n        newSelectionStart = index + offset;\n    // if object is horizontally flipped, mirror cursor location from the end\n    if (this.flipX) {\n      newSelectionStart = jlen - newSelectionStart;\n    }\n\n    if (newSelectionStart > this._text.length) {\n      newSelectionStart = this._text.length;\n    }\n\n    return newSelectionStart;\n  }\n});\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n  /**\n   * Initializes hidden textarea (needed to bring up keyboard in iOS)\n   */\n  initHiddenTextarea: function() {\n    this.hiddenTextarea = fabric.document.createElement('textarea');\n    this.hiddenTextarea.setAttribute('autocapitalize', 'off');\n    this.hiddenTextarea.setAttribute('autocorrect', 'off');\n    this.hiddenTextarea.setAttribute('autocomplete', 'off');\n    this.hiddenTextarea.setAttribute('spellcheck', 'false');\n    this.hiddenTextarea.setAttribute('data-fabric-hiddentextarea', '');\n    this.hiddenTextarea.setAttribute('wrap', 'off');\n    var style = this._calcTextareaPosition();\n    // line-height: 1px; was removed from the style to fix this:\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=870966\n    this.hiddenTextarea.style.cssText = 'position: absolute; top: ' + style.top +\n    '; left: ' + style.left + '; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;' +\n    ' paddingtop: ' + style.fontSize + ';';\n    fabric.document.body.appendChild(this.hiddenTextarea);\n\n    fabric.util.addListener(this.hiddenTextarea, 'keydown', this.onKeyDown.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'keyup', this.onKeyUp.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'input', this.onInput.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'copy', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'cut', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'paste', this.paste.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionstart', this.onCompositionStart.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionupdate', this.onCompositionUpdate.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionend', this.onCompositionEnd.bind(this));\n\n    if (!this._clickHandlerInitialized && this.canvas) {\n      fabric.util.addListener(this.canvas.upperCanvasEl, 'click', this.onClick.bind(this));\n      this._clickHandlerInitialized = true;\n    }\n  },\n\n  /**\n   * For functionalities on keyDown\n   * Map a special key to a function of the instance/prototype\n   * If you need different behaviour for ESC or TAB or arrows, you have to change\n   * this map setting the name of a function that you build on the fabric.Itext or\n   * your prototype.\n   * the map change will affect all Instances unless you need for only some text Instances\n   * in that case you have to clone this object and assign your Instance.\n   * this.keysMap = fabric.util.object.clone(this.keysMap);\n   * The function must be in fabric.Itext.prototype.myFunction And will receive event as args[0]\n   */\n  keysMap: {\n    9:  'exitEditing',\n    27: 'exitEditing',\n    33: 'moveCursorUp',\n    34: 'moveCursorDown',\n    35: 'moveCursorRight',\n    36: 'moveCursorLeft',\n    37: 'moveCursorLeft',\n    38: 'moveCursorUp',\n    39: 'moveCursorRight',\n    40: 'moveCursorDown',\n  },\n\n  /**\n   * For functionalities on keyUp + ctrl || cmd\n   */\n  ctrlKeysMapUp: {\n    67: 'copy',\n    88: 'cut'\n  },\n\n  /**\n   * For functionalities on keyDown + ctrl || cmd\n   */\n  ctrlKeysMapDown: {\n    65: 'selectAll'\n  },\n\n  onClick: function() {\n    // No need to trigger click event here, focus is enough to have the keyboard appear on Android\n    this.hiddenTextarea && this.hiddenTextarea.focus();\n  },\n\n  /**\n   * Handles keyup event\n   * @param {Event} e Event object\n   */\n  onKeyDown: function(e) {\n    if (!this.isEditing || this.inCompositionMode) {\n      return;\n    }\n    if (e.keyCode in this.keysMap) {\n      this[this.keysMap[e.keyCode]](e);\n    }\n    else if ((e.keyCode in this.ctrlKeysMapDown) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapDown[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    if (e.keyCode >= 33 && e.keyCode <= 40) {\n      // if i press an arrow key just update selection\n      this.clearContextTop();\n      this.renderCursorOrSelection();\n    }\n    else {\n      this.canvas && this.canvas.requestRenderAll();\n    }\n  },\n\n  /**\n   * Handles keyup event\n   * We handle KeyUp because ie11 and edge have difficulties copy/pasting\n   * if a copy/cut event fired, keyup is dismissed\n   * @param {Event} e Event object\n   */\n  onKeyUp: function(e) {\n    if (!this.isEditing || this._copyDone || this.inCompositionMode) {\n      this._copyDone = false;\n      return;\n    }\n    if ((e.keyCode in this.ctrlKeysMapUp) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapUp[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    this.canvas && this.canvas.requestRenderAll();\n  },\n\n  /**\n   * Handles onInput event\n   * @param {Event} e Event object\n   */\n  onInput: function(e) {\n    var fromPaste = this.fromPaste;\n    this.fromPaste = false;\n    e && e.stopPropagation();\n    if (!this.isEditing) {\n      return;\n    }\n    // decisions about style changes.\n    var nextText = this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,\n        charCount = this._text.length,\n        nextCharCount = nextText.length,\n        removedText, insertedText,\n        charDiff = nextCharCount - charCount;\n    if (this.hiddenTextarea.value === '') {\n      this.styles = { };\n      this.updateFromTextArea();\n      this.fire('changed', e);\n      if (this.canvas) {\n        this.canvas.fire('text:changed', { target: this });\n        this.canvas.requestRenderAll();\n      }\n      return;\n    }\n\n    var textareaSelection = this.fromStringToGraphemeSelection(\n      this.hiddenTextarea.selectionStart,\n      this.hiddenTextarea.selectionEnd,\n      this.hiddenTextarea.value\n    );\n    var backDelete = this.selectionStart > textareaSelection.selectionStart;\n\n    if (this.selectionStart !== this.selectionEnd) {\n      removedText = this._text.slice(this.selectionStart, this.selectionEnd);\n      charDiff += this.selectionEnd - this.selectionStart;\n    }\n    else if (nextCharCount < charCount) {\n      if (backDelete) {\n        removedText = this._text.slice(this.selectionEnd + charDiff, this.selectionEnd);\n      }\n      else {\n        removedText = this._text.slice(this.selectionStart, this.selectionStart - charDiff);\n      }\n    }\n    insertedText = nextText.slice(textareaSelection.selectionEnd - charDiff, textareaSelection.selectionEnd);\n    if (removedText && removedText.length) {\n      if (this.selectionStart !== this.selectionEnd) {\n        this.removeStyleFromTo(this.selectionStart, this.selectionEnd);\n      }\n      else if (backDelete) {\n        // detect differencies between forwardDelete and backDelete\n        this.removeStyleFromTo(this.selectionEnd - removedText.length, this.selectionEnd);\n      }\n      else {\n        this.removeStyleFromTo(this.selectionEnd, this.selectionEnd + removedText.length);\n      }\n    }\n    if (insertedText.length) {\n      if (fromPaste && insertedText.join('') === fabric.copiedText) {\n        this.insertNewStyleBlock(insertedText, this.selectionStart, fabric.copiedTextStyle);\n      }\n      else {\n        this.insertNewStyleBlock(insertedText, this.selectionStart);\n      }\n    }\n    this.updateFromTextArea();\n    this.fire('changed', e);\n    if (this.canvas) {\n      this.canvas.fire('text:changed', { target: this });\n      this.canvas.requestRenderAll();\n    }\n  },\n  /**\n   * Composition start\n   */\n  onCompositionStart: function() {\n    this.inCompositionMode = true;\n  },\n\n  /**\n   * Composition end\n   */\n  onCompositionEnd: function() {\n    this.inCompositionMode = false;\n  },\n\n  // /**\n  //  * Composition update\n  //  */\n  onCompositionUpdate: function(e) {\n    this.compositionStart = e.target.selectionStart;\n    this.compositionEnd = e.target.selectionEnd;\n    this.updateTextareaPosition();\n  },\n\n  /**\n   * Copies selected text\n   * @param {Event} e Event object\n   */\n  copy: function() {\n    if (this.selectionStart === this.selectionEnd) {\n      //do not cut-copy if no selection\n      return;\n    }\n\n    fabric.copiedText = this.getSelectedText();\n    fabric.copiedTextStyle = this.getSelectionStyles(this.selectionStart, this.selectionEnd, true);\n    this._copyDone = true;\n  },\n\n  /**\n   * Pastes text\n   * @param {Event} e Event object\n   */\n  paste: function() {\n    this.fromPaste = true;\n  },\n\n  /**\n   * @private\n   * @param {Event} e Event object\n   * @return {Object} Clipboard data object\n   */\n  _getClipboardData: function(e) {\n    return (e && e.clipboardData) || fabric.window.clipboardData;\n  },\n\n  /**\n   * Finds the width in pixels before the cursor on the same line\n   * @private\n   * @param {Number} lineIndex\n   * @param {Number} charIndex\n   * @return {Number} widthBeforeCursor width before cursor\n   */\n  _getWidthBeforeCursor: function(lineIndex, charIndex) {\n    var widthBeforeCursor = this._getLineLeftOffset(lineIndex), bound;\n\n    if (charIndex > 0) {\n      bound = this.__charBounds[lineIndex][charIndex - 1];\n      widthBeforeCursor += bound.left + bound.width;\n    }\n    return widthBeforeCursor;\n  },\n\n  /**\n   * Gets start offset of a selection\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getDownCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    // if on last line, down cursor goes to end of line\n    if (lineIndex === this._textLines.length - 1 || e.metaKey || e.keyCode === 34) {\n      // move to the end of a text\n      return this._text.length - selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex + 1, widthBeforeCursor),\n        textAfterCursor = this._textLines[lineIndex].slice(charIndex);\n    return textAfterCursor.length + indexOnOtherLine + 2;\n  },\n\n  /**\n   * private\n   * Helps finding if the offset should be counted from Start or End\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  _getSelectionForOffset: function(e, isRight) {\n    if (e.shiftKey && this.selectionStart !== this.selectionEnd && isRight) {\n      return this.selectionEnd;\n    }\n    else {\n      return this.selectionStart;\n    }\n  },\n\n  /**\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getUpCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    if (lineIndex === 0 || e.metaKey || e.keyCode === 33) {\n      // if on first line, up cursor goes to start of line\n      return -selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex - 1, widthBeforeCursor),\n        textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex);\n    // return a negative offset\n    return -this._textLines[lineIndex - 1].length + indexOnOtherLine - textBeforeCursor.length;\n  },\n\n  /**\n   * for a given width it founds the matching character.\n   * @private\n   */\n  _getIndexOnLine: function(lineIndex, width) {\n\n    var line = this._textLines[lineIndex],\n        lineLeftOffset = this._getLineLeftOffset(lineIndex),\n        widthOfCharsOnLine = lineLeftOffset,\n        indexOnLine = 0, charWidth, foundMatch;\n\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\n      charWidth = this.__charBounds[lineIndex][j].width;\n      widthOfCharsOnLine += charWidth;\n      if (widthOfCharsOnLine > width) {\n        foundMatch = true;\n        var leftEdge = widthOfCharsOnLine - charWidth,\n            rightEdge = widthOfCharsOnLine,\n            offsetFromLeftEdge = Math.abs(leftEdge - width),\n            offsetFromRightEdge = Math.abs(rightEdge - width);\n\n        indexOnLine = offsetFromRightEdge < offsetFromLeftEdge ? j : (j - 1);\n        break;\n      }\n    }\n\n    // reached end\n    if (!foundMatch) {\n      indexOnLine = line.length - 1;\n    }\n\n    return indexOnLine;\n  },\n\n\n  /**\n   * Moves cursor down\n   * @param {Event} e Event object\n   */\n  moveCursorDown: function(e) {\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\n      return;\n    }\n    this._moveCursorUpOrDown('Down', e);\n  },\n\n  /**\n   * Moves cursor up\n   * @param {Event} e Event object\n   */\n  moveCursorUp: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorUpOrDown('Up', e);\n  },\n\n  /**\n   * Moves cursor up or down, fires the events\n   * @param {String} direction 'Up' or 'Down'\n   * @param {Event} e Event object\n   */\n  _moveCursorUpOrDown: function(direction, e) {\n    // getUpCursorOffset\n    // getDownCursorOffset\n    var action = 'get' + direction + 'CursorOffset',\n        offset = this[action](e, this._selectionDirection === 'right');\n    if (e.shiftKey) {\n      this.moveCursorWithShift(offset);\n    }\n    else {\n      this.moveCursorWithoutShift(offset);\n    }\n    if (offset !== 0) {\n      this.setSelectionInBoundaries();\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor with shift\n   * @param {Number} offset\n   */\n  moveCursorWithShift: function(offset) {\n    var newSelection = this._selectionDirection === 'left'\n      ? this.selectionStart + offset\n      : this.selectionEnd + offset;\n    this.setSelectionStartEndWithShift(this.selectionStart, this.selectionEnd, newSelection);\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor up without shift\n   * @param {Number} offset\n   */\n  moveCursorWithoutShift: function(offset) {\n    if (offset < 0) {\n      this.selectionStart += offset;\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionEnd += offset;\n      this.selectionStart = this.selectionEnd;\n    }\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor left\n   * @param {Event} e Event object\n   */\n  moveCursorLeft: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Left', e);\n  },\n\n  /**\n   * @private\n   * @return {Boolean} true if a change happened\n   */\n  _move: function(e, prop, direction) {\n    var newValue;\n    if (e.altKey) {\n      newValue = this['findWordBoundary' + direction](this[prop]);\n    }\n    else if (e.metaKey || e.keyCode === 35 ||  e.keyCode === 36 ) {\n      newValue = this['findLineBoundary' + direction](this[prop]);\n    }\n    else {\n      this[prop] += direction === 'Left' ? -1 : 1;\n      return true;\n    }\n    if (typeof newValue !== undefined && this[prop] !== newValue) {\n      this[prop] = newValue;\n      return true;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _moveLeft: function(e, prop) {\n    return this._move(e, prop, 'Left');\n  },\n\n  /**\n   * @private\n   */\n  _moveRight: function(e, prop) {\n    return this._move(e, prop, 'Right');\n  },\n\n  /**\n   * Moves cursor left without keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithoutShift: function(e) {\n    var change = true;\n    this._selectionDirection = 'left';\n\n    // only move cursor when there is no selection,\n    // otherwise we discard it, and leave cursor on same place\n    if (this.selectionEnd === this.selectionStart && this.selectionStart !== 0) {\n      change = this._moveLeft(e, 'selectionStart');\n\n    }\n    this.selectionEnd = this.selectionStart;\n    return change;\n  },\n\n  /**\n   * Moves cursor left while keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithShift: function(e) {\n    if (this._selectionDirection === 'right' && this.selectionStart !== this.selectionEnd) {\n      return this._moveLeft(e, 'selectionEnd');\n    }\n    else if (this.selectionStart !== 0){\n      this._selectionDirection = 'left';\n      return this._moveLeft(e, 'selectionStart');\n    }\n  },\n\n  /**\n   * Moves cursor right\n   * @param {Event} e Event object\n   */\n  moveCursorRight: function(e) {\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Right', e);\n  },\n\n  /**\n   * Moves cursor right or Left, fires event\n   * @param {String} direction 'Left', 'Right'\n   * @param {Event} e Event object\n   */\n  _moveCursorLeftOrRight: function(direction, e) {\n    var actionName = 'moveCursor' + direction + 'With';\n    this._currentCursorOpacity = 1;\n\n    if (e.shiftKey) {\n      actionName += 'Shift';\n    }\n    else {\n      actionName += 'outShift';\n    }\n    if (this[actionName](e)) {\n      this.abortCursorAnimation();\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor right while keeping selection\n   * @param {Event} e\n   */\n  moveCursorRightWithShift: function(e) {\n    if (this._selectionDirection === 'left' && this.selectionStart !== this.selectionEnd) {\n      return this._moveRight(e, 'selectionStart');\n    }\n    else if (this.selectionEnd !== this._text.length) {\n      this._selectionDirection = 'right';\n      return this._moveRight(e, 'selectionEnd');\n    }\n  },\n\n  /**\n   * Moves cursor right without keeping selection\n   * @param {Event} e Event object\n   */\n  moveCursorRightWithoutShift: function(e) {\n    var changed = true;\n    this._selectionDirection = 'right';\n\n    if (this.selectionStart === this.selectionEnd) {\n      changed = this._moveRight(e, 'selectionStart');\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionStart = this.selectionEnd;\n    }\n    return changed;\n  },\n\n  /**\n   * Removes characters from start/end\n   * start/end ar per grapheme position in _text array.\n   *\n   * @param {Number} start\n   * @param {Number} end default to start + 1\n   */\n  removeChars: function(start, end) {\n    if (typeof end === 'undefined') {\n      end = start + 1;\n    }\n    this.removeStyleFromTo(start, end);\n    this._text.splice(start, end - start);\n    this.text = this._text.join('');\n    this.set('dirty', true);\n    if (this._shouldClearDimensionCache()) {\n      this.initDimensions();\n      this.setCoords();\n    }\n    this._removeExtraneousStyles();\n  },\n\n  /**\n   * insert characters at start position, before start position.\n   * start  equal 1 it means the text get inserted between actual grapheme 0 and 1\n   * if style array is provided, it must be as the same length of text in graphemes\n   * if end is provided and is bigger than start, old text is replaced.\n   * start/end ar per grapheme position in _text array.\n   *\n   * @param {String} text text to insert\n   * @param {Array} style array of style objects\n   * @param {Number} start\n   * @param {Number} end default to start + 1\n   */\n  insertChars: function(text, style, start, end) {\n    if (typeof end === 'undefined') {\n      end = start;\n    }\n    if (end > start) {\n      this.removeStyleFromTo(start, end);\n    }\n    var graphemes = fabric.util.string.graphemeSplit(text);\n    this.insertNewStyleBlock(graphemes, start, style);\n    this._text = [].concat(this._text.slice(0, start), graphemes, this._text.slice(end));\n    this.text = this._text.join('');\n    this.set('dirty', true);\n    if (this._shouldClearDimensionCache()) {\n      this.initDimensions();\n      this.setCoords();\n    }\n    this._removeExtraneousStyles();\n  },\n\n});\n/* _TO_SVG_START_ */\n(function() {\n  var toFixed = fabric.util.toFixed,\n      multipleSpacesRegex = /  +/g;\n\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var offsets = this._getSVGLeftTopOffsets(),\n          textAndBg = this._getSVGTextAndBg(offsets.textTop, offsets.textLeft),\n          internalMarkup = this._wrapSVGTextAndBg(textAndBg);\n      return this._createBaseSVGMarkup(\n        internalMarkup, { reviver: reviver, noStyle: true, withShadow: true });\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLeftTopOffsets: function() {\n      return {\n        textLeft: -this.width / 2,\n        textTop: -this.height / 2,\n        lineTop: this.getHeightOfLine(0)\n      };\n    },\n\n    /**\n     * @private\n     */\n    _wrapSVGTextAndBg: function(textAndBg) {\n      var noShadow = true,\n          textDecoration = this.getSvgTextDecoration(this);\n      return [\n        textAndBg.textBgRects.join(''),\n        '\\t\\t<text xml:space=\"preserve\" ',\n        (this.fontFamily ? 'font-family=\"' + this.fontFamily.replace(/\"/g, '\\'') + '\" ' : ''),\n        (this.fontSize ? 'font-size=\"' + this.fontSize + '\" ' : ''),\n        (this.fontStyle ? 'font-style=\"' + this.fontStyle + '\" ' : ''),\n        (this.fontWeight ? 'font-weight=\"' + this.fontWeight + '\" ' : ''),\n        (textDecoration ? 'text-decoration=\"' + textDecoration + '\" ' : ''),\n        'style=\"', this.getSvgStyles(noShadow), '\"', this.addPaintOrder(), ' >',\n        textAndBg.textSpans.join(''),\n        '</text>\\n'\n      ];\n    },\n\n    /**\n     * @private\n     * @param {Number} textTopOffset Text top offset\n     * @param {Number} textLeftOffset Text left offset\n     * @return {Object}\n     */\n    _getSVGTextAndBg: function(textTopOffset, textLeftOffset) {\n      var textSpans = [],\n          textBgRects = [],\n          height = textTopOffset, lineOffset;\n      // bounding-box background\n      this._setSVGBg(textBgRects);\n\n      // text and text-background\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineOffset = this._getLineLeftOffset(i);\n        if (this.textBackgroundColor || this.styleHas('textBackgroundColor', i)) {\n          this._setSVGTextLineBg(textBgRects, i, textLeftOffset + lineOffset, height);\n        }\n        this._setSVGTextLineText(textSpans, i, textLeftOffset + lineOffset, height);\n        height += this.getHeightOfLine(i);\n      }\n\n      return {\n        textSpans: textSpans,\n        textBgRects: textBgRects\n      };\n    },\n\n    /**\n     * @private\n     */\n    _createTextCharSpan: function(_char, styleDecl, left, top) {\n      var shouldUseWhitespace = _char !== _char.trim() || _char.match(multipleSpacesRegex),\n          styleProps = this.getSvgSpanStyles(styleDecl, shouldUseWhitespace),\n          fillStyles = styleProps ? 'style=\"' + styleProps + '\"' : '',\n          dy = styleDecl.deltaY, dySpan = '',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n      if (dy) {\n        dySpan = ' dy=\"' + toFixed(dy, NUM_FRACTION_DIGITS) + '\" ';\n      }\n      return [\n        '<tspan x=\"', toFixed(left, NUM_FRACTION_DIGITS), '\" y=\"',\n        toFixed(top, NUM_FRACTION_DIGITS), '\" ', dySpan,\n        fillStyles, '>',\n        fabric.util.string.escapeXml(_char),\n        '</tspan>'\n      ].join('');\n    },\n\n    _setSVGTextLineText: function(textSpans, lineIndex, textLeftOffset, textTopOffset) {\n      // set proper line offset\n      var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = '',\n          charBox, style,\n          boxWidth = 0,\n          line = this._textLines[lineIndex],\n          timeToRender;\n\n      textTopOffset += lineHeight * (1 - this._fontSizeFraction) / this.lineHeight;\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\n        timeToRender = i === len || this.charSpacing;\n        charsToRender += line[i];\n        charBox = this.__charBounds[lineIndex][i];\n        if (boxWidth === 0) {\n          textLeftOffset += charBox.kernedWidth - charBox.width;\n          boxWidth += charBox.width;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n        if (isJustify && !timeToRender) {\n          if (this._reSpaceAndTab.test(line[i])) {\n            timeToRender = true;\n          }\n        }\n        if (!timeToRender) {\n          // if we have charSpacing, we render char by char\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n          timeToRender = this._hasStyleChangedForSvg(actualStyle, nextStyle);\n        }\n        if (timeToRender) {\n          style = this._getStyleDeclaration(lineIndex, i) || { };\n          textSpans.push(this._createTextCharSpan(charsToRender, style, textLeftOffset, textTopOffset));\n          charsToRender = '';\n          actualStyle = nextStyle;\n          textLeftOffset += boxWidth;\n          boxWidth = 0;\n        }\n      }\n    },\n\n    _pushTextBgRect: function(textBgRects, color, left, top, width, height) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n      textBgRects.push(\n        '\\t\\t<rect ',\n        this._getFillAttributes(color),\n        ' x=\"',\n        toFixed(left, NUM_FRACTION_DIGITS),\n        '\" y=\"',\n        toFixed(top, NUM_FRACTION_DIGITS),\n        '\" width=\"',\n        toFixed(width, NUM_FRACTION_DIGITS),\n        '\" height=\"',\n        toFixed(height, NUM_FRACTION_DIGITS),\n        '\"></rect>\\n');\n    },\n\n    _setSVGTextLineBg: function(textBgRects, i, leftOffset, textTopOffset) {\n      var line = this._textLines[i],\n          heightOfLine = this.getHeightOfLine(i) / this.lineHeight,\n          boxWidth = 0,\n          boxStart = 0,\n          charBox, currentColor,\n          lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\n      for (var j = 0, jlen = line.length; j < jlen; j++) {\n        charBox = this.__charBounds[i][j];\n        currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\n        if (currentColor !== lastColor) {\n          lastColor && this._pushTextBgRect(textBgRects, lastColor, leftOffset + boxStart,\n            textTopOffset, boxWidth, heightOfLine);\n          boxStart = charBox.left;\n          boxWidth = charBox.width;\n          lastColor = currentColor;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n      }\n      currentColor && this._pushTextBgRect(textBgRects, currentColor, leftOffset + boxStart,\n        textTopOffset, boxWidth, heightOfLine);\n    },\n\n    /**\n     * Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\n     * we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\n     *\n     * @private\n     * @param {*} value\n     * @return {String}\n     */\n    _getFillAttributes: function(value) {\n      var fillColor = (value && typeof value === 'string') ? new fabric.Color(value) : '';\n      if (!fillColor || !fillColor.getSource() || fillColor.getAlpha() === 1) {\n        return 'fill=\"' + value + '\"';\n      }\n      return 'opacity=\"' + fillColor.getAlpha() + '\" fill=\"' + fillColor.setAlpha(1).toRgb() + '\"';\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLineTopOffset: function(lineIndex) {\n      var lineTopOffset = 0, lastHeight = 0;\n      for (var j = 0; j < lineIndex; j++) {\n        lineTopOffset += this.getHeightOfLine(j);\n      }\n      lastHeight = this.getHeightOfLine(j);\n      return {\n        lineTop: lineTopOffset,\n        offset: (this._fontSizeMult - this._fontSizeFraction) * lastHeight / (this.lineHeight * this._fontSizeMult)\n      };\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n      var svgStyle = fabric.Object.prototype.getSvgStyles.call(this, skipShadow);\n      return svgStyle + ' white-space: pre;';\n    },\n  });\n})();\n/* _TO_SVG_END_ */\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  /**\n   * Textbox class, based on IText, allows the user to resize the text rectangle\n   * and wraps lines automatically. Textboxes have their Y scaling locked, the\n   * user can only change width. Height is adjusted automatically based on the\n   * wrapping of lines.\n   * @class fabric.Textbox\n   * @extends fabric.IText\n   * @mixes fabric.Observable\n   * @return {fabric.Textbox} thisArg\n   * @see {@link fabric.Textbox#initialize} for constructor definition\n   */\n  fabric.Textbox = fabric.util.createClass(fabric.IText, fabric.Observable, {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'textbox',\n\n    /**\n     * Minimum width of textbox, in pixels.\n     * @type Number\n     * @default\n     */\n    minWidth: 20,\n\n    /**\n     * Minimum calculated width of a textbox, in pixels.\n     * fixed to 2 so that an empty textbox cannot go to 0\n     * and is still selectable without text.\n     * @type Number\n     * @default\n     */\n    dynamicMinWidth: 2,\n\n    /**\n     * Cached array of text wrapping.\n     * @type Array\n     */\n    __cachedLines: null,\n\n    /**\n     * Override standard Object class values\n     */\n    lockScalingFlip: true,\n\n    /**\n     * Override standard Object class values\n     * Textbox needs this on false\n     */\n    noScaleCache: false,\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Object\n     * @private\n     */\n    _dimensionAffectingProps: fabric.Text.prototype._dimensionAffectingProps.concat('width'),\n\n    /**\n     * Unlike superclass's version of this function, Textbox does not update\n     * its width.\n     * @private\n     * @override\n     */\n    initDimensions: function() {\n      if (this.__skipDimension) {\n        return;\n      }\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this._clearCache();\n      // clear dynamicMinWidth as it will be different after we re-wrap line\n      this.dynamicMinWidth = 0;\n      // wrap lines\n      this._styleMap = this._generateStyleMap(this._splitText());\n      // if after wrapping, the width is smaller than dynamicMinWidth, change the width and re-wrap\n      if (this.dynamicMinWidth > this.width) {\n        this._set('width', this.dynamicMinWidth);\n      }\n      if (this.textAlign.indexOf('justify') !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      // clear cache and re-calculate height\n      this.height = this.calcTextHeight();\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Generate an object that translates the style object so that it is\n     * broken up by visual lines (new lines and automatic wrapping).\n     * The original text styles object is broken up by actual lines (new lines only),\n     * which is only sufficient for Text / IText\n     * @private\n     */\n    _generateStyleMap: function(textInfo) {\n      var realLineCount     = 0,\n          realLineCharCount = 0,\n          charCount         = 0,\n          map               = {};\n\n      for (var i = 0; i < textInfo.graphemeLines.length; i++) {\n        if (textInfo.graphemeText[charCount] === '\\n' && i > 0) {\n          realLineCharCount = 0;\n          charCount++;\n          realLineCount++;\n        }\n        else if (this._reSpaceAndTab.test(textInfo.graphemeText[charCount]) && i > 0) {\n          // this case deals with space's that are removed from end of lines when wrapping\n          realLineCharCount++;\n          charCount++;\n        }\n\n        map[i] = { line: realLineCount, offset: realLineCharCount };\n\n        charCount += textInfo.graphemeLines[i].length;\n        realLineCharCount += textInfo.graphemeLines[i].length;\n      }\n\n      return map;\n    },\n\n    /**\n     * Returns true if object has a style property or has it ina specified line\n     * @param {Number} lineIndex\n     * @return {Boolean}\n     */\n    styleHas: function(property, lineIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (map) {\n          lineIndex = map.line;\n        }\n      }\n      return fabric.Text.prototype.styleHas.call(this, property, lineIndex);\n    },\n\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function(lineIndex) {\n      var offset = 0, nextLineIndex = lineIndex + 1, nextOffset, obj, shouldLimit = false;\n      var map = this._styleMap[lineIndex];\n      var mapNextLine = this._styleMap[lineIndex + 1];\n      if (map) {\n        lineIndex = map.line;\n        offset = map.offset;\n      }\n      if (mapNextLine) {\n        nextLineIndex = mapNextLine.line;\n        shouldLimit = nextLineIndex === lineIndex;\n        nextOffset = mapNextLine.offset;\n      }\n      obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          if (p2 >= offset && (!shouldLimit || p2 < nextOffset)) {\n            // eslint-disable-next-line no-unused-vars\n            for (var p3 in obj[p1][p2]) {\n              return false;\n            }\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (!map) {\n          return null;\n        }\n        lineIndex = map.line;\n        charIndex = map.offset + charIndex;\n      }\n      return this.callSuper('_getStyleDeclaration', lineIndex, charIndex);\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n    * probably broken need a fix\n     * @param {Number} lineIndex\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      return this.styles[map.line];\n    },\n\n    /**\n     * probably broken need a fix\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function(lineIndex, style) {\n      var map = this._styleMap[lineIndex];\n      this.styles[map.line] = style;\n    },\n\n    /**\n     * probably broken need a fix\n     * @param {Number} lineIndex\n     * @private\n     */\n    _deleteLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      delete this.styles[map.line];\n    },\n\n    /**\n     * Wraps text using the 'width' property of Textbox. First this function\n     * splits text on newlines, so we preserve newlines entered by the user.\n     * Then it wraps each line using the width of the Textbox by calling\n     * _wrapLine().\n     * @param {Array} lines The string array of text that is split into lines\n     * @param {Number} desiredWidth width you want to wrap to\n     * @returns {Array} Array of lines\n     */\n    _wrapText: function(lines, desiredWidth) {\n      var wrapped = [], i;\n      this.isWrapping = true;\n      for (i = 0; i < lines.length; i++) {\n        wrapped = wrapped.concat(this._wrapLine(lines[i], i, Number.MAX_SAFE_INTEGER)); // fix auto wrap line\n      }\n      this.isWrapping = false;\n      return wrapped;\n    },\n\n    /**\n     * Helper function to measure a string of text, given its lineIndex and charIndex offset\n     * it gets called when charBounds are not available yet.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {String} text\n     * @param {number} lineIndex\n     * @param {number} charOffset\n     * @returns {number}\n     * @private\n     */\n    _measureWord: function(word, lineIndex, charOffset) {\n      var width = 0, prevGrapheme, skipLeft = true;\n      charOffset = charOffset || 0;\n      for (var i = 0, len = word.length; i < len; i++) {\n        var box = this._getGraphemeBox(word[i], lineIndex, i + charOffset, prevGrapheme, skipLeft);\n        width += box.kernedWidth;\n        prevGrapheme = word[i];\n      }\n      return width;\n    },\n\n    /**\n     * Wraps a line of text using the width of the Textbox and a context.\n     * @param {Array} line The grapheme array that represent the line\n     * @param {Number} lineIndex\n     * @param {Number} desiredWidth width you want to wrap the line to\n     * @param {Number} reservedSpace space to remove from wrapping for custom functionalities\n     * @returns {Array} Array of line(s) into which the given text is wrapped\n     * to.\n     */\n    _wrapLine: function(_line, lineIndex, desiredWidth, reservedSpace) {\n      var lineWidth        = 0,\n          graphemeLines    = [],\n          line             = [],\n          // spaces in different languges?\n          words            = _line.split(this._reSpaceAndTab),\n          word             = '',\n          offset           = 0,\n          infix            = ' ',\n          wordWidth        = 0,\n          infixWidth       = 0,\n          largestWordWidth = 0,\n          lineJustStarted = true,\n          additionalSpace = this._getWidthOfCharSpacing(),\n          reservedSpace = reservedSpace || 0;\n\n      desiredWidth -= reservedSpace;\n      for (var i = 0; i < words.length; i++) {\n        // i would avoid resplitting the graphemes\n        word = fabric.util.string.graphemeSplit(words[i]);\n        wordWidth = this._measureWord(word, lineIndex, offset);\n        offset += word.length;\n\n        lineWidth += infixWidth + wordWidth - additionalSpace;\n\n        if (lineWidth >= desiredWidth && !lineJustStarted) {\n          graphemeLines.push(line);\n          line = [];\n          lineWidth = wordWidth;\n          lineJustStarted = true;\n        }\n        else {\n          lineWidth += additionalSpace;\n        }\n\n        if (!lineJustStarted) {\n          line.push(infix);\n        }\n        line = line.concat(word);\n\n        infixWidth = this._measureWord([infix], lineIndex, offset);\n        offset++;\n        lineJustStarted = false;\n        // keep track of largest word\n        if (wordWidth > largestWordWidth) {\n          largestWordWidth = wordWidth;\n        }\n      }\n\n      i && graphemeLines.push(line);\n\n      if (largestWordWidth + reservedSpace > this.dynamicMinWidth) {\n        this.dynamicMinWidth = largestWordWidth - additionalSpace + reservedSpace;\n      }\n\n      return graphemeLines;\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @param {Number} lineIndex text to split\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function(lineIndex) {\n      if (!this._styleMap[lineIndex + 1]) {\n        // is last line, return true;\n        return true;\n      }\n      if (this._styleMap[lineIndex + 1].line !== this._styleMap[lineIndex].line) {\n        // this is last line before a line break, return true;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n    * Gets lines of text to render in the Textbox. This function calculates\n    * text wrapping on the fly every time it is called.\n    * @param {String} text text to split\n    * @returns {Array} Array of lines in the Textbox.\n    * @override\n    */\n    _splitTextIntoLines: function(text) {\n      var newText = fabric.Text.prototype._splitTextIntoLines.call(this, text),\n          graphemeLines = this._wrapText(newText.lines, this.width),\n          lines = new Array(graphemeLines.length);\n\n      for (var i = 0; i < graphemeLines.length; i++) {\n        lines[i] = graphemeLines[i].join('');\n      }\n      newText.lines = lines;\n      newText.graphemeLines = graphemeLines;\n      return newText;\n    },\n\n    getMinWidth: function() {\n      return Math.max(this.minWidth, this.dynamicMinWidth);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['minWidth'].concat(propertiesToInclude));\n    }\n  });\n\n  /**\n   * Returns fabric.Textbox instance from an object representation\n   * @static\n   * @memberOf fabric.Textbox\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Textbox instance is created\n   */\n  fabric.Textbox.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Textbox', object, callback, 'text');\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n(function() {\n\n  /**\n   * Override _setObjectScale and add Textbox specific resizing behavior. Resizing\n   * a Textbox doesn't scale text, it only changes width and makes text wrap automatically.\n   */\n  var setObjectScaleOverridden = fabric.Canvas.prototype._setObjectScale;\n\n  fabric.Canvas.prototype._setObjectScale = function(localMouse, transform,\n    lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {\n\n    var t = transform.target;\n    if (by === 'x' && t instanceof fabric.Textbox) {\n      var tw = t._getTransformedDimensions().x;\n      var w = t.width * (localMouse.x / tw);\n      if (w >= t.getMinWidth()) {\n        t.set('width', w);\n        return true;\n      }\n    }\n    else {\n      return setObjectScaleOverridden.call(fabric.Canvas.prototype, localMouse, transform,\n        lockScalingX, lockScalingY, by, lockScalingFlip, _dim);\n    }\n  };\n\n  fabric.util.object.extend(fabric.Textbox.prototype, /** @lends fabric.IText.prototype */ {\n    /**\n     * @private\n     */\n    _removeExtraneousStyles: function() {\n      for (var prop in this._styleMap) {\n        if (!this._textLines[prop]) {\n          delete this.styles[this._styleMap[prop].line];\n        }\n      }\n    },\n\n  });\n})();\n"],"sourceRoot":""}