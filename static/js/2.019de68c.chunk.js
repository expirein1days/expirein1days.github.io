(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{442:function(t,e,i){"use strict";var a=i(83);function s(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Object(a.a)(t)););return t}var r=i(71);function h(t,e,i,a){return(h="undefined"!==typeof Reflect&&Reflect.set?Reflect.set:function(t,e,i,a){var h,n=s(t,e);if(n){if((h=Object.getOwnPropertyDescriptor(n,e)).set)return h.set.call(a,i),!0;if(!h.writable)return!1}if(h=Object.getOwnPropertyDescriptor(a,e)){if(!h.writable)return!1;h.value=i,Object.defineProperty(a,e,h)}else Object(r.a)(a,e,i);return!0})(t,e,i,a)}var n=i(184);function o(t,e,i){return(o=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,i){var a=[null];a.push.apply(a,e);var s=new(Function.bind.apply(t,a));return i&&Object(n.a)(s,i.prototype),s}).apply(null,arguments)}function l(t){var e="function"===typeof Map?new Map:void 0;return(l=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,s)}function s(){return o(t,arguments,Object(a.a)(this).constructor)}return s.prototype=Object.create(t.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),Object(n.a)(s,t)})(t)}var c=i(99);function m(t,e,i){return(m="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var a=s(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}var u,d,f=i(98),g=i(66),x=i(67);i.d(e,"b",function(){return _}),i.d(e,"a",function(){return d}),function(t){var e=function(){function e(t,i){Object(g.a)(this,e),this.weakMode=!1,this.mAcc_x=0,this.mAcc_y=0,this.mAccVel_x=0,this.mAccVel_y=0,this.mAccPos_x=0,this.mAccPos_y=0,this.currentScale=0,this._zoomTryed=!1,this._lastRad=0,this.countUpForce=0,this.FACTOR=.25,this.ACC_INTERVAL_TIME=33.3,this.dirty=!0,this.acc_l=.45,this.mNeedCache=!1,this.weakMode=i,this._isZoom=!1,this.currentScale=this._isZoom?1:0,this.blendMode=null,this.soundEnable=!0,this._sensorAlltime=t,d.Context3D.MAX_TEXTURE=12}return Object(x.a)(e,[{key:"initWithData",value:function(t,e,i){this.init3D(t,e,i)}},{key:"dispose",value:function(){this.stopRendering(),this.stage3d.removeEventListener(d.events.Event.CONTEXT3D_CREATE,this.context3DCreateHandler),this.stage3d.removeEventListener(d.events.Event.ENTER_FRAME,this.onEnterFrame),this.mNoMipShader.dispose(),this.mNoMipShader=null,this.mUniformMatrix.length=0,this.mUniformMatrix=null,this.mUniformColor.length=0,this.mUniformColor=null,this.mScreenMatrix=null,this.mFBOMatrix=null,this.mDisplayFboMatrix=null,this.mTexBaseT&&this.mTexBaseT.dispose(),this.mFBOBlendBuffer&&this.mFBOBlendBuffer.dispose(),this.mBlendDistTexture&&this.mBlendDistTexture.dispose(),this.mDisplayFbo&&this.mDisplayFbo.dispose(),this.mFBOFrontBuffer&&this.mFBOFrontBuffer.dispose(),this.mFrontTexture&&this.mFrontTexture.dispose(),this.texTopLayer&&this.texTopLayer.dispose(),this.mTexBaseT=null,this.mFBOBlendBuffer=null,this.mBlendDistTexture=null,this.mDisplayFbo=null,this.mFBOFrontBuffer=null,this.mFrontTexture=null,this.mMipShader.dispose(),this.mMipShader=null,this._bmdFrontImage=null,this._bmdBackImage=null,this.mVerts.dispose(),this.mVerts=null,this.mCoords.dispose(),this.mCoords=null,this.mReversedCoords.dispose(),this.mReversedCoords=null,this.mVertsStage.dispose(),this.mVertsStage=null,this.mIndicies.dispose(),this.mIndicies=null,this.mFBO.dispose(),this.mFBO=null,this.mDPlate=null,this.mCtx3D.dispose(),this.mCtx3D=null,this.stage3d=null}},{key:"stopRendering",value:function(){this._drawingEnabled=!1,console.log("_drawingEnabled:",this._drawingEnabled)}},{key:"startRendering",value:function(){this._drawingEnabled=!0,console.log("_drawingEnabled:",this._drawingEnabled),this._toScale=0,this.mAcc_x=0,this.mAcc_y=0}},{key:"toggleScale",value:function(){this._isZoom=!this._isZoom}},{key:"setup",value:function(){}},{key:"init3D",value:function(e,i,a){var s=this;this.soundNum=0,this._drawingEnabled=!1,this._bmdBackImage=i,this._bmdFrontImage=a,this._useFrontBuffer=null!=this._bmdFrontImage,this.mScreenMatrix=new d.geom.Matrix3D,this.stage3d=e,this.stage3d.addEventListener(d.events.Event.CONTEXT3D_CREATE,function(t){s.context3DCreateHandler(t)}),this.stage3d.requestContext3D(),this.mDPlate=new t.DraggablePlateRect,this.mDPlate.setup(0,0,0,1024,1024)}},{key:"updateTopLayer",value:function(){this.hasTopLayer=!1}},{key:"context3DCreateHandler",value:function(e){console.log("context created"),this.stage3d.removeEventListener(d.events.Event.CONTEXT3D_CREATE,this.context3DCreateHandler),this.onDeactive(),this.mTexBaseT=null,this.mBlendDistTexture=null,this.mCtx3D=this.stage3d.context3D,this.mMipShader=t.Stage3DHelper.createMainProgram(this.mCtx3D,!0),this.mNoMipShader=t.Stage3DHelper.createMainProgram(this.mCtx3D,!1),this.onResize();var i=t.UTItemManager.IMAGE_HEIGHT/t.UTItemManager.IMAGE_WIDTH,a=[-.5,.5*-i,.5,.5*-i,-.5,.5*i,.5,.5*i];this.mVerts=this.mCtx3D.createVertexBuffer(4,2),this.mVerts.uploadFromVector([-.5,-.5,.5,-.5,-.5,.5,.5,.5],0,4),this.mCoords=this.mCtx3D.createVertexBuffer(4,2),this.mCoords.uploadFromVector([0,1,1,1,0,0,1,0],0,4),this.mReversedCoords=this.mCtx3D.createVertexBuffer(4,2),this.mReversedCoords.uploadFromVector([0,0,1,0,0,1,1,1],0,4),this.mVertsStage=this.mCtx3D.createVertexBuffer(4,2),this.mVertsStage.uploadFromVector(a,0,4);if(this.mIndicies=this.mCtx3D.createIndexBuffer(6),this.mIndicies.uploadFromVector([0,2,1,2,3,1],0,6),this.mUniformMatrix=[0,0,0,1],this.mUniformColor=[1,1,1,1],this.mFBOMatrix=new d.geom.Matrix3D,this.mFBOMatrix.appendTranslation(.5*t.UTItemManager.IMAGE_WIDTH,.5*-t.UTItemManager.IMAGE_HEIGHT,0),this.mFBOMatrix.appendScale(1/(.5*t.UTItemManager.IMAGE_WIDTH),1/(.5*t.UTItemManager.IMAGE_HEIGHT),1),this.mFBO=this.mCtx3D.createTexture(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,d.Context3DTextureFormat.BGRA,!0),this.mFBOBlendBuffer=this.mCtx3D.createTexture(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,d.Context3DTextureFormat.BGRA,!0),this._useFrontBuffer){this.mFBOFrontBuffer=this.mCtx3D.createTexture(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,d.Context3DTextureFormat.BGRA,!0);var s=new d.BitmapData(1024,1024,!0,0),r=new t.Matrix;r.scale(s.width/this._bmdFrontImage.width,s.height/this._bmdFrontImage.height),s.draw(this._bmdFrontImage,r,null,null,null,!0),this.mFrontTexture=t.Stage3DHelper.uploadTexture(this.mCtx3D,s,d.Context3DTextureFormat.BGRA,!0,!0),this.mFrontTexture.uploadFromImage(s.canvas,0),s.dispose()}if(this.mDisplayFboMatrix=new d.geom.Matrix3D,this.mDisplayFboMatrix.appendScale(1/512,1/512,1),this.mCtx3D.setVertexBufferAt(1,this.mCoords,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ONE,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA),this.mCtx3D.setCulling(d.Context3DTriangleFace.BACK),this.updateTopLayer(),this._clear(),null!=this.mCacheBmd){this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=1024,this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.mUniformColor[3]=1,this.mCtx3D.setProgram(this.mNoMipShader);var h=t.Stage3DHelper.uploadTexture(this.mCtx3D,this.mCacheBmd,d.Context3DTextureFormat.BGRA,!1,!0);this.mCtx3D.setRenderToTexture(this.mFBO),this.mCtx3D.clear(0,0,0,0),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,h,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor),h.dispose(),this.mCacheBmd=null}this.mCtx3D.setProgram(this.mMipShader),this.mCtx3D.setVertexBufferAt(1,this.mCoords,0,d.Context3DVertexBufferFormat.FLOAT_2),this.setup(),this.onActive(),dispatchEvent(new Event(d.events.Event.ACTIVATE))}},{key:"onActive",value:function(){var t=this;null==this.mCtx3D||this._mcWidth<1||this._mcHeight<1||this.stage3d.addEventListener(d.events.Event.ENTER_FRAME,function(e){t.onEnterFrame(e)})}},{key:"onDeactive",value:function(){this.stage3d.removeEventListener(d.events.Event.ENTER_FRAME,this.onEnterFrame)}},{key:"onResize",value:function(){this._mcWidth=this.stage3d.stageWidth/t.AppVals.GLOBAL_SCALE,this._mcHeight=this.stage3d.stageHeight/t.AppVals.GLOBAL_SCALE-t.AppVals.STATUSBAR_HEIGHT,this._currentRect=t.UTItemManager.getZoomRectMotion(this.currentScale,this._mcWidth,this._mcHeight),null==this.mCtx3D||this._mcWidth<1||this._mcHeight<1||(this.mCtx3D.configureBackBuffer(this.stage3d.stageWidth,this.stage3d.stageHeight,0,!1),this.mScreenMatrix.identity(),this.mScreenMatrix.appendTranslation(0,.5*-t.AppVals.STATUSBAR_HEIGHT,0),this.mScreenMatrix.appendScale(1/(.5*this._mcWidth),1/(.5*(this._mcHeight+t.AppVals.STATUSBAR_HEIGHT)),1))}},{key:"draw",value:function(){this.mCtx3D.setTextureAt(0,this.mTexBaseT),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,[0,0,1,1]),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,[-512,512,0,100]),this.mCtx3D.drawTriangles(this.mIndicies)}},{key:"setBlendMode",value:function(e){switch(this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.mUniformColor[3]=1,e){case t.BlendMode.ALPHA:this.mUniformColor[0]=.6,this.mUniformColor[1]=.6,this.mUniformColor[2]=.6,this.mUniformColor[3]=.6,this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ONE,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA);break;case t.BlendMode.ADD:this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.SOURCE_ALPHA,d.Context3DBlendFactor.ONE);break;case t.BlendMode.MULTIPLY:t.UTItemManager.wkMultiply?this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.DESTINATION_COLOR,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA):this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ONE_MINUS_DESTINATION_ALPHA,d.Context3DBlendFactor.SOURCE_COLOR);break;case"MULTI_ADD":this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ONE_MINUS_DESTINATION_ALPHA,d.Context3DBlendFactor.ONE);break;case t.BlendMode.SCREEN:this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ONE,d.Context3DBlendFactor.ONE_MINUS_SOURCE_COLOR);break;case t.BlendMode.ERASE:this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ZERO,d.Context3DBlendFactor.SOURCE_ALPHA);break;case"SOURCE":this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.SOURCE_ALPHA,d.Context3DBlendFactor.ZERO);break;case"LAYOUT":this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.SOURCE_COLOR,d.Context3DBlendFactor.ZERO);break;default:this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ONE,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA)}}},{key:"onEnterFrame",value:function(e){this.mCtx3D.setRenderToTexture(this.mFBO),this.mCtx3D.setVertexBufferAt(0,this.mVerts,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,this.mFBOMatrix,!0),this.draw(),this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.mUniformColor[3]=1,this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=1024,this._useFrontBuffer&&(this.mCtx3D.setRenderToTexture(this.mFBOFrontBuffer),this.mCtx3D.clear(0,0,0,0),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,this.mFrontTexture,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,this.mFBO,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor)),this.mCtx3D.setRenderToTexture(this.mFBOBlendBuffer),this.blendMode==t.BlendMode.MULTIPLY?t.UTItemManager.wkMultiply?this.mCtx3D.clear(255,255,255,255):this.mCtx3D.clear(255,255,255,0):this.mCtx3D.clear(0,0,0,0),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,this.mBlendDistTexture,this.mVerts,this.mReversedCoords,this.mUniformMatrix,this.mUniformColor),this.setBlendMode(this.blendMode),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,this._useFrontBuffer?this.mFBOFrontBuffer:this.mFBO,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor),this.blendMode!=t.BlendMode.MULTIPLY||t.UTItemManager.wkMultiply||(this.setBlendMode("MULTI_ADD"),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,this.mBlendDistTexture,this.mVerts,this.mReversedCoords,this.mUniformMatrix,this.mUniformColor)),this.setBlendMode(null),this.hasTopLayer&&t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,this.texTopLayer,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor),this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=1,this.mCtx3D.setRenderToBackBuffer(),this.mCtx3D.clear(0,0,0,0),this.mDPlate.update(),this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.mUniformMatrix[2]=0;this._currentRect.width,t.UTItemManager.wkWidth;this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[3]=this._currentRect.width,t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mScreenMatrix,this.mTexBaseT,this.mVerts,this.mReversedCoords,this.mUniformMatrix,this.mUniformColor);var i;(this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[3]=this._currentRect.width,t.UTItemManager.wkMultiply&&this.setBlendMode(t.BlendMode.MULTIPLY),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mScreenMatrix,this.mFBOBlendBuffer,this.mVertsStage,this.mCoords,this.mUniformMatrix,this.mUniformColor),this.setBlendMode(null),this._isZoom?1!=this._toScale&&(this._toScale=1,this._frScale=this.currentScale,this._ticktime=(new Date).getTime()):0!=this._toScale&&(this._toScale=0,this._frScale=this.currentScale,this._ticktime=(new Date).getTime()),this.currentScale!=this._toScale&&this._drawingEnabled)&&((i=((new Date).getTime()-this._ticktime)/300)>1?(i=1,this.currentScale=this._toScale,this._currentRect=t.UTItemManager.getZoomRectMotion(this.currentScale,this._mcWidth,this._mcHeight)):(i=t.Easing.easeOutCubic(i,0,1,1),this.currentScale=this._frScale+(this._toScale-this._frScale)*i,this._currentRect=t.UTItemManager.getZoomRectMotion(this.currentScale,this._mcWidth,this._mcHeight)));null!=e&&this.mCtx3D.present(),this.acc()}},{key:"acc",value:function(){var t=this._accelerationX,e=this._accelerationY,i=Math.sqrt(t*t+e*e);if(i>this.acc_l){var a=40+10*i*(1+this.countUpForce);a>250&&(a=250),t=t/i*a,e=e/i*a,this.mAccVel_x+=t/5,this.mAccVel_y+=e/5,(this._sensorAlltime||Math.random()<.5*(1-Math.pow(a/250,1.3)))&&this.addPerticles(t,e),this.soundForce(t,e),this.countUpForce+=.09}else this.countUpForce*=.9;this.mAccVel_x=.75*(this.mAccVel_x-.1*this.mAccPos_x),this.mAccVel_y=.75*(this.mAccVel_y-.1*this.mAccPos_y),this.mAccPos_x+=this.mAccVel_x,this.mAccPos_y+=this.mAccVel_y}},{key:"convertMousePos",value:function(e,i){e/=t.AppVals.GLOBAL_SCALE,i/=t.AppVals.GLOBAL_SCALE;var a=.5*-this._mcWidth+.5*this._currentRect.width+this._currentRect.x,s=.5*-this._mcHeight+.5*this._currentRect.height+this._currentRect.y,r=this._currentRect.width*t.UTItemManager.wkWidth;this._cnverted_X=(e-.5*this._mcWidth-a)/r*1024,this._cnverted_Y=-(i-.5*this._mcHeight-s-t.AppVals.STATUSBAR_HEIGHT)/r*1024;var h=t.UTItemManager.wkWidth+(1-t.UTItemManager.wkWidth)*this.currentScale*.1;this._cnverted_X*=h,this._cnverted_Y*=h}},{key:"onMousePress",value:function(e,i){var a,s;this._drawingEnabled&&(this.mDPlate.drag(this.mAccPos_x,this.mAccPos_y,!1,!1),this.convertMousePos(e,i),a=this._cnverted_X,s=this._cnverted_Y,t.AppVals.REMIX_MOVE_RIMIT?this.mDPlate.drag(a*t.AppVals.REMIX_MOVE_RIMIT_RATE,s*t.AppVals.REMIX_MOVE_RIMIT_RATE,!0,!1):this.mDPlate.drag(a,s,!0,!1),this.mPrevMouseX=a,this.mPrevMouseY=s)}},{key:"onMouseDrag",value:function(e,i){var a,s;this._drawingEnabled&&(this.convertMousePos(e,i),a=this._cnverted_X,s=this._cnverted_Y,t.AppVals.REMIX_MOVE_RIMIT?this.mDPlate.drag(a*t.AppVals.REMIX_MOVE_RIMIT_RATE,s*t.AppVals.REMIX_MOVE_RIMIT_RATE,!0,!1):this.mDPlate.drag(a,s,!0,!1),this.addPerticles(1.2*(a-this.mPrevMouseX),1.2*(s-this.mPrevMouseY)),this.soundForce(a-this.mPrevMouseX,s-this.mPrevMouseY),this.mPrevMouseX=a,this.mPrevMouseY=s)}},{key:"onMouseUp",value:function(e,i){var a,s;this._drawingEnabled&&(this.convertMousePos(e,i),a=this._cnverted_X,s=this._cnverted_Y,t.AppVals.REMIX_MOVE_RIMIT?this.mDPlate.drag(a*t.AppVals.REMIX_MOVE_RIMIT_RATE,s*t.AppVals.REMIX_MOVE_RIMIT_RATE,!1,!1):this.mDPlate.drag(a,s,!1,!1),this.mPrevMouseX=a,this.mPrevMouseY=s)}},{key:"addedForce",value:function(t,e){}},{key:"addPerticles",value:function(t,e){this._drawingEnabled&&this.addedForce(t,e)}},{key:"soundForce",value:function(t,e){if(this._drawingEnabled&&this.soundEnable){var i=Math.atan2(e,t),a=Math.abs(this._lastRad-i);Math.PI<a&&(a=2*Math.PI-a),(a>.5*Math.PI||this._weakforce)&&Math.sqrt(t*t+e*e)>25&&(this._lastRad=i),0==Math.sqrt(t*t+e*e)&&(this._weakforce=!0)}}},{key:"captureCurrentBuffer",value:function(){this.stage3d.removeEventListener(d.events.Event.ENTER_FRAME,this.onEnterFrame);var t=new d.BitmapData(this.stage3d.stageWidth,this.stage3d.stageHeight,!1,16777215);return this.onEnterFrame(null),this.mCtx3D.drawToBitmapData(t),this.mCtx3D.present(),t}},{key:"drawBufferToBitmap",value:function(t){this.onEnterFrame(null),this.mCtx3D.drawToBitmapData(t)}},{key:"captureToBitmap",value:function(e){this.mTexBaseT&&this.mTexBaseT.dispose(),this.mFBOBlendBuffer&&this.mFBOBlendBuffer.dispose(),this.mBlendDistTexture&&this.mBlendDistTexture.dispose(),this.mDisplayFbo&&this.mDisplayFbo.dispose(),this.mFBOFrontBuffer&&this.mFBOFrontBuffer.dispose(),this.mFrontTexture&&this.mFrontTexture.dispose(),this.mTexBaseT=null,this.mFBOBlendBuffer=null,this.mBlendDistTexture=null,this.mDisplayFbo=null,this.mFBOFrontBuffer=null,this.mFrontTexture=null,this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.mUniformColor[3]=1;var i,a,s=Math.min(Math.min(this.stage3d.stageWidth,this.stage3d.stageHeight),Math.max(e.width/2,e.height/2)),r=new d.geom.Matrix3D,h=new t.Matrix,n=new d.BitmapData(s,s,!0,0);if(this.mCtx3D.configureBackBuffer(s,s,16,!1),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,this.mUniformColor),this.mCtx3D.setVertexBufferAt(1,this.mCoords,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setVertexBufferAt(0,this.mVertsStage,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setProgram(this.mNoMipShader),this._useFrontBuffer||this.mNeedCache){this.mCtx3D.setRenderToBackBuffer(),this.mCacheBmd=new d.BitmapData(t.AppVals.TEXTURE_WIDTH,t.AppVals.TEXTURE_WIDTH,!0,0);var o=s*t.UTItemManager.IMAGE_HEIGHT/t.UTItemManager.IMAGE_WIDTH;for(this.mUniformMatrix[2]=0,this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[3]=e.width,r.identity(),r.appendScale(1/(.5*s),1/(.5*o),1),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,r,!1),this.mCtx3D.setTextureAt(0,this.mFBO),i=0;i<Math.ceil(e.width/s);i++)for(a=0;a<Math.ceil(e.height/s);a++)this.mCtx3D.clear(0,0,0,0),this.mUniformMatrix[0]=-i*s+(.5*e.width-.5*s),this.mUniformMatrix[1]=a*o-(.5*e.height-.5*o),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies),this.mCtx3D.drawToBitmapData(n),this.mCacheBmd.copyPixels(n,n.rect,{x:s*i,y:s*a})}if(this.blendMode==t.BlendMode.ERASE){var l,c=this.mCtx3D.createTexture(t.AppVals.TEXTURE_WIDTH,t.AppVals.TEXTURE_WIDTH,d.Context3DTextureFormat.BGRA,!0);for(this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=1024,this._useFrontBuffer&&(this.mCtx3D.setRenderToTexture(c),this.mCtx3D.clear(0,0,0,0),h.identity(),h.scale(t.AppVals.TEXTURE_WIDTH/this._bmdFrontImage.width,t.AppVals.TEXTURE_WIDTH/this._bmdFrontImage.height),e.draw(this._bmdFrontImage,h,null,null,null,!0),(l=this.mCtx3D.createTexture(t.AppVals.TEXTURE_WIDTH,t.AppVals.TEXTURE_WIDTH,d.Context3DTextureFormat.BGRA,!1)).uploadFromBitmapData(e),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,l,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor),l.dispose(),l=null,t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,this.mFBO,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor),e.fillRect(e.rect,0)),this.mCtx3D.setRenderToTexture(this._useFrontBuffer?this.mFBO:c),this.mCtx3D.clear(0,0,0,0),h.identity(),h.scale(t.AppVals.TEXTURE_WIDTH/this._bmdBackImage.width,t.AppVals.TEXTURE_WIDTH/this._bmdBackImage.height),e.draw(this._bmdBackImage,h,null,null,null,!0),(l=this.mCtx3D.createTexture(t.AppVals.TEXTURE_WIDTH,t.AppVals.TEXTURE_WIDTH,d.Context3DTextureFormat.BGRA,!1)).uploadFromBitmapData(e),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,l,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor),l.dispose(),l=null,this.setBlendMode(this.blendMode),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,this._useFrontBuffer?c:this.mFBO,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor),this.setBlendMode(null),this._useFrontBuffer?c.dispose():this.mFBO.dispose(),this.mCtx3D.setRenderToBackBuffer(),this.mUniformMatrix[2]=0,this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[3]=e.width,r.identity(),r.appendScale(1/(.5*s),1/(.5*s),1),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,r,!1),this.mCtx3D.setTextureAt(0,this._useFrontBuffer?this.mFBO:c),this.mCtx3D.setVertexBufferAt(1,this.mCoords,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setVertexBufferAt(0,this.mVertsStage,0,d.Context3DVertexBufferFormat.FLOAT_2),i=0;i<Math.ceil(e.width/s);i++)for(a=0;a<Math.ceil(e.height/s);a++)this.mCtx3D.clear(0,0,0,0),this.mUniformMatrix[0]=-i*s+(.5*e.width-.5*s),this.mUniformMatrix[1]=a*s-(.5*e.height-.5*s),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies),this.mCtx3D.drawToBitmapData(n),e.copyPixels(n,n.rect,{x:s*i,y:s*a})}else if(this.blendMode==t.BlendMode.ALPHA||this.blendMode==t.BlendMode.ADD||this.blendMode==t.BlendMode.MULTIPLY||this.blendMode==t.BlendMode.SCREEN){null!=this._bmdBackImage&&e.copyPixels(this._bmdBackImage,this._bmdBackImage.rect,{x:0,y:0});var m=this.blendMode==t.BlendMode.ALPHA?null:this.blendMode,u=this.blendMode==t.BlendMode.ALPHA?new t.ColorTransform(1,1,1,.6):null;if(this.mCtx3D.setRenderToBackBuffer(),this.mUniformMatrix[2]=0,this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[3]=e.width,r.identity(),r.appendScale(1/(.5*s),1/(.5*s),1),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,r,!1),this.mCtx3D.setTextureAt(0,this.mFBO),this._useFrontBuffer)var f=new p(0,0,s,s),g=new d.BitmapData(s,s,!0,0);for(i=0;i<Math.ceil(e.width/s);i++)for(a=0;a<Math.ceil(e.height/s);a++)this.mCtx3D.clear(0,0,0,0),this.mUniformMatrix[0]=-i*s+(.5*e.width-.5*s),this.mUniformMatrix[1]=a*s-(.5*e.height-.5*s),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies),this.mCtx3D.drawToBitmapData(n),h.identity(),h.translate(s*i,s*a),this._useFrontBuffer?(f.x=s*i,f.y=s*a,g.copyPixels(this._bmdFrontImage,f,{x:0,y:0}),g.draw(n),e.draw(g,h,u,m)):e.draw(n,h,u,m)}else for(null!=this._bmdBackImage?(e.copyPixels(this._bmdBackImage,this._bmdBackImage.rect,{x:0,y:0}),this._useFrontBuffer&&e.draw(this._bmdFrontImage)):this._useFrontBuffer&&e.copyPixels(this._bmdFrontImage,this._bmdFrontImage.rect,{x:0,y:0}),this.mCtx3D.setRenderToBackBuffer(),this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=e.width,r.identity(),r.appendScale(1/(.5*s),1/(.5*s),1),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,r,!1),this.mCtx3D.setTextureAt(0,this.mFBO),i=0;i<Math.ceil(e.width/s);i++)for(a=0;a<Math.ceil(e.height/s);a++)this.mCtx3D.clear(0,0,0,0),this.mUniformMatrix[0]=-i*s+(.5*e.width-.5*s),this.mUniformMatrix[1]=a*s-(.5*e.height-.5*s),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies),this.mCtx3D.drawToBitmapData(n),h.identity(),h.translate(s*i,s*a),e.draw(n,h);n.dispose()}},{key:"_clear",value:function(){if(this.mCtx3D&&(this.mCtx3D.setRenderToBackBuffer(),this.mCtx3D.clear(0,0,0,0),this.mCtx3D.setRenderToTexture(this.mFBO),this.mCtx3D.clear(0,0,0,0),this.mCtx3D.setRenderToTexture(this.mFBOBlendBuffer),this.mCtx3D.clear(0,0,0,0),this._useFrontBuffer&&(this.mCtx3D.setRenderToTexture(this.mFBOFrontBuffer),this.mCtx3D.clear(0,0,0,0)),null==this.mTexBaseT&&this.canvasChange(),null==this.mBlendDistTexture)){var e;if(e=new d.BitmapData(1024,1024,!0,0),this._bmdBackImage){var i=new t.Matrix;i.scale(e.width/this._bmdBackImage.width,e.height/this._bmdBackImage.height),e.draw(this._bmdBackImage,i,null,null,null,!0)}this.mBlendDistTexture=t.Stage3DHelper.uploadTexture(this.mCtx3D,e,d.Context3DTextureFormat.BGRA,!0,!0),e.dispose()}}},{key:"canvasChange",value:function(){var e;e=new d.BitmapData(1024,1024,!0,0),this.mTexBaseT=t.Stage3DHelper.uploadTexture(this.mCtx3D,e,d.Context3DTextureFormat.BGRA,!0,!0,"baseT",!1),this._currentRect=t.UTItemManager.getZoomRectMotion(this.currentScale,this._mcWidth,this._mcHeight),e.dispose()}},{key:"clear",value:function(){this._clear()}}]),e}();t.RemixBaseImpl=e}(_||(_={})),function(t){var e=function(e){function i(t,e){var s;Object(g.a)(this,i),(s=Object(c.a)(this,Object(a.a)(i).call(this,!0,e)))._isMotion=!1,s._rad=0,s._range=0,s.INIT_NUM_LINE=7,s.mMainVerts=new Array,s.mMainCoords=new Array,s.mMainIndicies=new Array,s.gliLines=new Array,s.playing=!0,s.mMom=t,s._addShapeLimit=s.INIT_NUM_LINE,s.numLine=150,s.weakMode&&(s.numLine=20),s.vertNum=4*s.numLine,s.indNum=6*s.numLine;for(var r=0;r<s.numLine;r++)s.mMainVerts.push(0),s.mMainVerts.push(0),s.mMainVerts.push(0),s.mMainVerts.push(0),s.mMainVerts.push(0),s.mMainVerts.push(0),s.mMainVerts.push(0),s.mMainVerts.push(0),s.mMainCoords.push(0),s.mMainCoords.push(0),s.mMainCoords.push(0),s.mMainCoords.push(0),s.mMainCoords.push(0),s.mMainCoords.push(0),s.mMainCoords.push(0),s.mMainCoords.push(0),s.mMainIndicies.push(0),s.mMainIndicies.push(0),s.mMainIndicies.push(0),s.mMainIndicies.push(0),s.mMainIndicies.push(0),s.mMainIndicies.push(0);for(r=0;r<s.numLine;r++)s.mMainIndicies[6*r+0]=4*r,s.mMainIndicies[6*r+1]=4*r+2,s.mMainIndicies[6*r+2]=4*r+1,s.mMainIndicies[6*r+3]=4*r+2,s.mMainIndicies[6*r+4]=4*r+3,s.mMainIndicies[6*r+5]=4*r+1;return s}return Object(f.a)(i,e),Object(x.a)(i,[{key:"initWithData",value:function(t,e,s){this.addedForce(0,0),this._srcBmd=s,m(Object(a.a)(i.prototype),"init3D",this).call(this,t,e,null)}},{key:"dispose",value:function(){this._srcBmd=null,m(Object(a.a)(i.prototype),"dispose",this).call(this)}},{key:"setup",value:function(){if(this.mFBO.dispose(),this.mFBO=this.mCtx3D.createTexture(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,d.Context3DTextureFormat.BGRA,!0,0,"mFBO",!1),this.mTCoords=this.mCtx3D.createVertexBuffer(this.vertNum,2),this.mTVers=this.mCtx3D.createVertexBuffer(this.vertNum,2),this.mTIndicies=this.mCtx3D.createIndexBuffer(this.indNum),this.mTIndicies.uploadFromVector(this.mMainIndicies,0,this.indNum),this.mTVers.uploadFromVector(this.mMainVerts,0,this.vertNum),this._srcBmd.width==t.AppVals.TEXTURE_WIDTH&&this._srcBmd.height==t.AppVals.TEXTURE_WIDTH)this.mainTexture=t.Stage3DHelper.uploadTexture(this.mCtx3D,this._srcBmd,d.Context3DTextureFormat.BGRA,!1,!1,"main",!1);else{var e=new d.BitmapData(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,!0,0),i=new t.Matrix;i.scale((e.width-2)/this._srcBmd.width,(e.height-2)/this._srcBmd.height),e.draw(this._srcBmd,i,null,null,null,!0),this.mainTexture=t.Stage3DHelper.uploadTexture(this.mCtx3D,e,d.Context3DTextureFormat.BGRA,!1,!0,"main",!1)}this.mTCoords.uploadFromVector(this.mMainCoords,0,this.vertNum),this.mTVers.uploadFromVector(this.mMainVerts,0,this.vertNum)}},{key:"stop",value:function(){this.playing=!1,this.soundEnable=!1,this.mMom.playStageChange(this.playing)}},{key:"start",value:function(){this.playing=!0,this.soundEnable=!0,this.mMom.playStageChange(this.playing)}},{key:"draw",value:function(){if(this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.SOURCE_ALPHA,d.Context3DBlendFactor.ZERO),this.mUniformMatrix[0]=.5*-t.UTItemManager.IMAGE_WIDTH,this.mUniformMatrix[1]=.5*t.UTItemManager.IMAGE_HEIGHT,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=1,this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.playing){var e,i,a,s,r,h,n,o,l,c,m,u,f;for(o=Math.random()*this._range-.5*this._range,e=0;e<this.numLine;e++)i=this.gliLines[e],a=this.gliLines[e+1],s=this._tx1+(this._tx3-this._tx1)*i,r=this._ty1+(this._ty3-this._ty1)*i,h=this._tx2+(this._tx4-this._tx2)*i,n=this._ty2+(this._ty4-this._ty2)*i,l=o=Math.pow(Math.random(),3)*this._range*1*(0==o?Math.random()<.5?1:-1:o<0?1:-1),o>0?l+=Math.random()*this._range*.25:o-=Math.random()*this._range*.25,this.weakMode&&(o*=.1,l*=.1),a-i>.1&&this._addShapeLimit<20&&(o=l=0),c=(h-s)*o,m=(n-r)*o,u=(h-s)*l,f=(n-r)*l,this.mMainCoords[8*e]=this._tx1+(this._tx3-this._tx1)*i+c,this.mMainCoords[8*e+1]=this._ty1+(this._ty3-this._ty1)*i+m,this.mMainCoords[8*e+2]=this._tx2+(this._tx4-this._tx2)*i+u,this.mMainCoords[8*e+3]=this._ty2+(this._ty4-this._ty2)*i+f,this.mMainCoords[8*e+4]=this._tx1+(this._tx3-this._tx1)*a+c,this.mMainCoords[8*e+5]=this._ty1+(this._ty3-this._ty1)*a+m,this.mMainCoords[8*e+6]=this._tx2+(this._tx4-this._tx2)*a+u,this.mMainCoords[8*e+7]=this._ty2+(this._ty4-this._ty2)*a+f;this.mTCoords.uploadFromVector(this.mMainCoords,0,this.vertNum),this.mTVers.uploadFromVector(this.mMainVerts,0,this.vertNum),this._isMotion&&(this._range<.002?(this._range=0,this._addShapeLimit=this.INIT_NUM_LINE,this._isMotion=!1,this.mMom.motionStateChange(this._isMotion)):this._range*=.986)}else this._isMotion||this.start();this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,this.mUniformColor),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.setVertexBufferAt(0,this.mTVers,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setVertexBufferAt(1,this.mTCoords,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,this.mFBOMatrix,!0),this.mCtx3D.setTextureAt(0,this.mainTexture),this.mCtx3D.drawTriangles(this.mTIndicies),this.mCtx3D.setProgram(this.mMipShader)}},{key:"addedForce",value:function(e,i){if(this.playing){0==e&&0==i||(this.mMom.motionStateChange(this._isMotion),this._addShapeLimit+=.03,this._addShapeLimit>this.numLine&&(this._addShapeLimit=this.numLine),(Math.sqrt(e*e+i*i)>50||!this._isMotion)&&(this._rad=Math.atan2(-i,e),Math.random()<.2&&(this.gliLines.length=0)),this._range+=Math.sqrt(e*e+i*i)/t.UTItemManager.IMAGE_WIDTH*.25,!this.mMom.showingStopAlert&&this._range>.3&&this.mMom.showStopAlert(),this._isMotion=!0);t.UTItemManager.IMAGE_HEIGHT,Number(this.numLine);var a=2*(.5*t.UTItemManager.IMAGE_HEIGHT+.5*t.UTItemManager.IMAGE_WIDTH);this.centerX=.5*a;var s,r=this._rad+.25*Math.PI,h=Math.cos(r+.5*Math.PI)*this.centerX,n=-Math.sin(r+.5*Math.PI)*this.centerX,o=Math.cos(r)*this.centerX,l=-Math.sin(r)*this.centerX,c=Math.cos(r+Math.PI)*this.centerX,m=-Math.sin(r+Math.PI)*this.centerX,u=Math.cos(r-.5*Math.PI)*this.centerX,d=-Math.sin(r-.5*Math.PI)*this.centerX,f=a/Math.sqrt(2)/t.UTItemManager.IMAGE_WIDTH*.5,g=a/Math.sqrt(2)/t.UTItemManager.IMAGE_HEIGHT*.5,x=this._rad,_=Math.sin(x),p=Math.cos(x);for(this._tx1=.5-f*p-f*_,this._ty1=.5+(-f*_+f*p)*g/f,this._tx2=.5+f*p-f*_,this._ty2=.5+(+f*_+f*p)*g/f,this._tx3=.5-f*p+f*_,this._ty3=.5+(-f*_-f*p)*g/f,this._tx4=.5+f*p+f*_,this._ty4=.5+(+f*_-f*p)*g/f,this.gliLines.push(0);this.gliLines.length<this.numLine;)this.gliLines.push(1);for(s=1;s<this.numLine;s++)s<this._addShapeLimit?1==this.gliLines[s]&&(this.gliLines[s]=Math.random()):this.gliLines[s]=1;for(this.gliLines.sort(),s=1;s<this.gliLines.length;)this.gliLines[s]-this.gliLines[s-1]<5/a?this.gliLines.splice(s,1):s++;for(;this.gliLines.length<this.numLine;)this.gliLines.push(1);for(this.gliLines.push(1),s=0;s<this.numLine;s++){var M=this.gliLines[s],D=this.gliLines[s+1];this.mMainVerts[8*s]=h+(c-h)*M,this.mMainVerts[8*s+1]=n+(m-n)*M,this.mMainVerts[8*s+2]=o+(u-o)*M,this.mMainVerts[8*s+3]=l+(d-l)*M,this.mMainVerts[8*s+4]=h+(c-h)*D,this.mMainVerts[8*s+5]=n+(m-n)*D,this.mMainVerts[8*s+6]=o+(u-o)*D,this.mMainVerts[8*s+7]=l+(d-l)*D}}}},{key:"captureToBitmap",value:function(e){if(this._isMotion||this.blendMode==t.BlendMode.ERASE)this.mFBO.dispose(),this.mFBO=this.mCtx3D.createTexture(t.AppVals.TEXTURE_WIDTH,t.AppVals.TEXTURE_WIDTH,d.Context3DTextureFormat.BGRA,!0),this.mCtx3D.setRenderToTexture(this.mFBO,!1,4),this.mCtx3D.clear(0,0,0,0),this.mCtx3D.setProgram(this.mNoMipShader),this.mUniformMatrix[0]=.5*t.UTItemManager.IMAGE_WIDTH,this.mUniformMatrix[1]=.5*t.UTItemManager.IMAGE_HEIGHT,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=1,this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.mTCoords.uploadFromVector(this.mMainCoords,0,this.vertNum),this.mTVers.uploadFromVector(this.mMainVerts,0,this.vertNum),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,this.mUniformColor),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.setVertexBufferAt(0,this.mTVers,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setVertexBufferAt(1,this.mTCoords,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,this.mFBOMatrix,!0),this.mCtx3D.setTextureAt(0,this.mainTexture),this.mCtx3D.drawTriangles(this.mTIndicies),this.mCtx3D.setProgram(this.mMipShader),m(Object(a.a)(i.prototype),"captureToBitmap",this).call(this,e);else{null==this._bmdBackImage||t.UTStampManager.getActiveLayerTop()||e.copyPixels(this._bmdBackImage,this._bmdBackImage.rect,{x:0,y:0});var s=this.blendMode==t.BlendMode.ALPHA?null:this.blendMode,r=this.blendMode==t.BlendMode.ALPHA?new t.ColorTransform(1,1,1,.6):null;e.draw(this._srcBmd,null,r,s)}}},{key:"clear",value:function(){this._rad=0,this._addShapeLimit=this.INIT_NUM_LINE,this._range=0,this.addedForce(0,0),m(Object(a.a)(i.prototype),"clear",this).call(this),this.start(),this.mMom.playStageChange(this.playing)}}]),i}(t.RemixBaseImpl);t.GlichImpl=e}(_||(_={})),function(t){var e=function(){function t(){Object(g.a)(this,t),this.children=[],this.canvas=document.createElement("canvas")}return Object(x.a)(t,[{key:"addChild",value:function(t){this.children.push(t)}}]),t}();t.DisplayObject=e}(d||(d={})),function(t){var e=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto";arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(g.a)(this,e),(t=Object(c.a)(this,Object(a.a)(e).call(this)))._bitmapData=i,t.pixelSnapping=s,t}return Object(f.a)(e,t),Object(x.a)(e,[{key:"bitmapData",get:function(){return this._bitmapData},set:function(t){this._bitmapData=t}}]),e}(t.DisplayObject);t.Bitmap=e}(d||(d={})),function(t){var e=function(e){function i(e){var s;if(Object(g.a)(this,i),(s=Object(c.a)(this,Object(a.a)(i).call(this,!0,e))).layouts=new Array,s.perticles=new Array,s.projectionMatrix=new d.geom.Matrix3D,s.projectionMatrix.appendTranslation(.5*-t.UTItemManager.IMAGE_WIDTH,.5*-t.UTItemManager.IMAGE_HEIGHT,0),s.projectionMatrix.appendScale(1/(.5*t.UTItemManager.IMAGE_WIDTH),-1/(.5*t.UTItemManager.IMAGE_HEIGHT),1),s.srcViewId=t.UTCreateMain.getActiveSrcType(),s.srcViewId==t.AppStoryDefs.VIEW_SRC_TYPO){for(var r=0;r<s.texts.length;r++)s.texts[r]+="</TEXTFORMAT>";s.texts.pop()}return s.srcViewId,t.AppStoryDefs.VIEW_SRC_STAMP,s._step=0,s}return Object(f.a)(i,e),Object(x.a)(i,[{key:"initWithData",value:function(e,s,r){this._srcBmd=r,m(Object(a.a)(i.prototype),"init3D",this).call(this,e,s,null),t.LayoutPericleGenelator._step=this._step}},{key:"dispose",value:function(){this._step=t.LayoutPericleGenelator._step,m(Object(a.a)(i.prototype),"dispose",this).call(this)}},{key:"setup",value:function(){var e,i;for(this.mFBO.dispose(),this.mFBO=this.mCtx3D.createTexture(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,d.Context3DTextureFormat.BGRA,!0),e=0;e<this.layouts.length;e++)this.layouts[e].dispose();this.layouts.length=0;var a,s,r,h,n,o,l=new t.Matrix,c=0,m=0,u=new t.Matrix,f=0;if(a=new d.BitmapData(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,!0,0),this.srcViewId==t.AppStoryDefs.VIEW_SRC_TYPO||this.srcViewId==t.AppStoryDefs.VIEW_SRC_STAMP)if(s=new d.BitmapData(t.AppVals.TEXTURE_WIDTH,t.AppVals.TEXTURE_WIDTH,!0,0),this.srcViewId==t.AppStoryDefs.VIEW_SRC_TYPO)for(e=0;e<this.texts.length;e++){this.textField.htmlText=this.texts[e],this.textField.autoSize=d.TextFieldAutoSize.LEFT,this.textField.scaleX=this.textField.scaleY=1;var g,x;this.textField.width,this.textField.height;if(o=this.textField.width>this.textField.height?500/this.textField.width:500/this.textField.height,l.identity(),l.scale(o,o),g=.5*(700-this.textField.width*o),x=.5*(700-this.textField.height*o),l.translate(g,x),a.fillRect(a.rect,0),a.drawWithQuality(this.textField,l,null,null,null,!0,d.StageQuality.HIGH),(i=a.getColorBoundsRect(4278190080,0,!1))&&i.width>0&&i.height>0){if(m+i.height>t.AppVals.TEXTURE_WIDTH){if(++f>3){console.log("SORRY,OVER THE TEXTURE!!!",this.layouts.length);break}m=0,c+=512}u.identity(),u.scale(o,o),u.translate(g-i.x+c,x-i.y+m),s.drawWithQuality(this.textField,u,null,null,null,!0,d.StageQuality.HIGH),(r=new t.LayoutObject).setup(this.mCtx3D,this.mIndicies,this.projectionMatrix),r.textIndex=e,r.setRectangleType(i,c,m,1/o),r.orgX=(g-i.x-.5*i.width)/o,r.orgY=(x-i.y-.5*i.height)/o,this.layouts.push(r),m+=i.height+2}}else this.srcViewId,t.AppStoryDefs.VIEW_SRC_STAMP;else{this._srcBmd.width==t.UTItemManager.IMAGE_WIDTH&&this._srcBmd.height==t.UTItemManager.IMAGE_HEIGHT?this.mainTexture=t.Stage3DHelper.uploadTexture(this.mCtx3D,this._srcBmd,d.Context3DTextureFormat.BGRA,!1,!1,"mainTexture",!0):(h=new d.BitmapData(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,!0,0),l.scale(h.width/this._srcBmd.width,h.height/this._srcBmd.height),h.draw(this._srcBmd,l,null,null,null,!0),this.mainTexture=t.Stage3DHelper.uploadTexture(this.mCtx3D,h,d.Context3DTextureFormat.BGRA,!0,!0,"mainTexture",!0)),i=this._srcBmd.getColorBoundsRect(4278190080,0,!1);var _=new t.LayoutObject;_.setup(this.mCtx3D,this.mIndicies,this.projectionMatrix),_.setRectangle(i,1),_.setTexture(this.mainTexture),this.layouts.push(_)}if(o=a.width/Math.max(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT),l.identity(),l.scale(o,o),a.fillRect(a.rect,0),a.draw(this._srcBmd,l,null,null,null,!0),i=a.getColorBoundsRect(4278190080,0,!1),h=new d.BitmapData(512,512,!0,0),n=512/Math.max(i.width,i.height),l.identity(),l.scale(o,o),l.translate(-i.x,-i.y),l.scale(n,n*t.UTItemManager.IMAGE_WIDTH/t.UTItemManager.IMAGE_HEIGHT),h.draw(this._srcBmd,l,null,null,null,!0),i.width=i.width*n*4,i.height=i.height*n*4,n=1/(o*n*4),this.typeMainLayouts=new t.LayoutObject,this.typeMainLayouts.setup(this.mCtx3D,this.mIndicies,this.projectionMatrix),this.typeMainLayouts.setRectangleType(i,0,0,n),this.typeMainLayouts.setTexture(t.Stage3DHelper.uploadTexture(this.mCtx3D,h,d.Context3DTextureFormat.BGRA,!0,!0,"",!0)),this.typeMainLayouts.x=.5*i.width*n+i.x/o,this.typeMainLayouts.y=.5*i.height*n+i.y/o,this.perticles.length>0&&this._isMotion)for(console.log("restore perticle layouts"),e=0;e<this.perticles.length;e++)this.perticles[e].updateLayoutObject(this.layouts[this.perticles[e].index]);else this.clear()}},{key:"draw",value:function(){var t;for(this.mCtx3D.clear(0,0,0,0),t=0;t<this.perticles.length;t++)this.perticles[t].draw(),this.perticles[t].dumpingForce=this.force;this.force*=.95}},{key:"addedForce",value:function(e,i){if(this.force<.3&&(this.counter=51),this.force=1,this.counter++,this.counter>10){this._isMotion=!0;for(var a=this.perticles.length,s=0;s<a;)this.perticles[s].willDelete?(this.perticles.splice(s,1),a--):(this.perticles[s].willDelete=!0,s++);t.LayoutPericleGenelator.generateLayout(this.perticles,this.layouts,this.srcViewId==t.AppStoryDefs.VIEW_SRC_TYPO,this.weakMode),this.counter=0}for(s=0;s<a;)this.perticles[s].willDelete?(this.perticles.splice(s,1),a--):s++}},{key:"captureToBitmap",value:function(e){var s,r,h;if(this.srcViewId==t.AppStoryDefs.VIEW_SRC_TYPO||this.srcViewId==t.AppStoryDefs.VIEW_SRC_STAMP){if(this._isMotion){var n,o,l;this.perticles.length;if(r=new t.Matrix,s=new d.BitmapData(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,!0,0),this.srcViewId==t.AppStoryDefs.VIEW_SRC_TYPO)for(n=0;n<this.perticles.length;n++)o=this.perticles[n],r.identity(),l=this.layouts[o.index],this.textField.htmlText=this.texts[l.textIndex],r.translate(l.orgX,l.orgY),r.rotate(o._angle),r.scale(o._scale,o._scale),r.translate(o._x,o._y),s.drawWithQuality(this.textField,r,null,null,null,!0,d.StageQuality.HIGH);else for(var c=new d.Bitmap(null,"auto",!0),u=t.UTStampManager.getActive(),f=null,g=0;g<this.layouts.length;g++){for(l=this.layouts[g],n=0;n<this.perticles.length;n++)if((o=this.perticles[n]).index==g){var x,_=0;o._scale<.5?_=1:(x=f,_=u.ThumbnailScale),c.bitmapData=x,c.smoothing=!0,1;var p=o._scale;l.angle;if(r.identity(),r.translate(.5*-x.width,.5*-x.height),r.rotate(o._angle),r.scale(p/_*1,p/_*1),r.translate(o._x,o._y),u.LayoutFringe){var M=new d.GlowFilter(u.EdgeColor,1,2,2,10,4,!1,!1),D=new d.GlowFilter(u.EdgeColor,1,u.EdgeWidth*p*1,u.EdgeWidth*p*1,300,4,!1,!1);c.filters=[D,M],s.drawWithQuality(c,r,null,null,null,!0,d.StageQuality.HIGH)}else s.drawWithQuality(x,r,null,null,null,!0,d.StageQuality.HIGH)}null!=f&&f.dispose(),f=null}}else s=this._srcBmd;if(this.blendMode==t.BlendMode.ERASE){var v;if(this.mFBO.dispose(),this.mFBO=this.mCtx3D.createTexture(t.AppVals.TEXTURE_WIDTH,t.AppVals.TEXTURE_WIDTH,d.Context3DTextureFormat.BGRA,!0),this.mCtx3D.setRenderToTexture(this.mFBO,!1,4),this.mCtx3D.clear(0,0,0,0),this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=1024,this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,s.width==t.AppVals.TEXTURE_WIDTH&&s.height==t.AppVals.TEXTURE_WIDTH)v=t.Stage3DHelper.uploadTexture(this.mCtx3D,s,d.Context3DTextureFormat.BGRA,!1,!1);else{var T=new d.BitmapData(t.AppVals.TEXTURE_WIDTH,t.AppVals.TEXTURE_WIDTH,!0,0);(r=new t.Matrix).scale(T.width/s.width,T.height/s.height),T.draw(s,r,null,null,null,!0),v=t.Stage3DHelper.uploadTexture(this.mCtx3D,T,d.Context3DTextureFormat.BGRA,!1,!1)}this.mCtx3D.setProgram(this.mNoMipShader),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,v,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor),this.mCtx3D.setProgram(this.mMipShader),m(Object(a.a)(i.prototype),"captureToBitmap",this).call(this,e)}else{null==this._bmdBackImage||t.UTStampManager.getActiveLayerTop()||e.copyPixels(this._bmdBackImage,this._bmdBackImage.rect,{x:0,y:0}),h=this.blendMode==t.BlendMode.ALPHA?null:this.blendMode;var w=this.blendMode==t.BlendMode.ALPHA?new t.ColorTransform(1,1,1,.6):null;e.draw(s,null,w,h)}this._isMotion&&s.dispose()}else if(this._isMotion||this.blendMode==t.BlendMode.ERASE)m(Object(a.a)(i.prototype),"captureToBitmap",this).call(this,e);else{null==this._bmdBackImage||t.UTStampManager.getActiveLayerTop()||e.copyPixels(this._bmdBackImage,this._bmdBackImage.rect,{x:0,y:0}),h=this.blendMode==t.BlendMode.ALPHA?null:this.blendMode;var y=this.blendMode==t.BlendMode.ALPHA?new t.ColorTransform(1,1,1,.6):null;e.draw(this._srcBmd,null,y,h)}}},{key:"clear",value:function(){var e;t.LayoutPericleGenelator.layoutReset(),this._isMotion=!1,this.counter=0,this.force=1,this.perticles.length=0,(e=new t.perticleObject(this.typeMainLayouts,-1)).willDelete=!1,e.setPositon(this.typeMainLayouts.x,this.typeMainLayouts.y,this.typeMainLayouts.scale,this.typeMainLayouts.angle),this.perticles.push(e)}}]),i}(t.RemixBaseImpl);e.bm=new d.Bitmap,t.LayoutImpl=e}(_||(_={})),function(t){var e=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(g.a)(this,t),this.x=e,this.y=i,this.z=a,this.w=s}return Object(x.a)(t,[{key:"multiply4",value:function(t){this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w}},{key:"multiplyed4",value:function(e){var i=new t(this.x,this.y,this.z,this.w);return i.multiply4(e),i}},{key:"add4",value:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w}},{key:"added4",value:function(e){var i=new t(this.x,this.y,this.z,this.w);return i.add4(e),i}},{key:"substract4",value:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w}},{key:"substracted4",value:function(e){var i=new t(this.x,this.y,this.z,this.w);return i.substract4(e),i}},{key:"division4",value:function(t){this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w}},{key:"divisioned4",value:function(e){var i=new t(this.x,this.y,this.z,this.w);return i.division4(e),i}},{key:"multiply",value:function(t){this.x*=t,this.y*=t,this.z*=t,this.w*=t}},{key:"multiplyed",value:function(e){var i=new t(this.x,this.y,this.z,this.w);return i.multiply(e),i}},{key:"add",value:function(t){this.x+=t,this.y+=t,this.z+=t,this.w+=t}},{key:"added",value:function(e){var i=new t(this.x,this.y,this.z,this.w);return i.add(e),i}},{key:"substract",value:function(t){this.x-=t,this.y-=t,this.z-=t,this.w-=t}},{key:"substracted",value:function(e){var i=new t(this.x,this.y,this.z,this.w);return i.substract(e),i}},{key:"division",value:function(t){this.x/=t,this.y/=t,this.z/=t,this.w/=t}},{key:"divisioned",value:function(e){var i=new t(this.x,this.y,this.z,this.w);return i.division(e),i}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"rotate2d",value:function(t){this.rotate2dRad(t*Math.PI/180)}},{key:"rotate2dRad",value:function(t){var e=this.x*Math.cos(t)-this.y*Math.sin(t);this.y=this.x*Math.sin(t)+this.y*Math.cos(t),this.x=e}},{key:"normalize",value:function(){var t=this.length();t>0&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalized",value:function(){var e=new t(this.x,this.y,this.z,this.w);return e.normalize(),e}}]),t}();t.Vec4=e}(_||(_={})),function(t){var e=function(e){function i(e,s){var r,h;for(Object(g.a)(this,i),(r=Object(c.a)(this,Object(a.a)(i).call(this,!0,e))).knlHeight=512,r.knlWidth=r.knlHeight*t.UTItemManager.IMAGE_WIDTH/t.UTItemManager.IMAGE_HEIGHT,r.prtHeight=60,r.prtWidth=r.prtHeight*t.UTItemManager.IMAGE_WIDTH/t.UTItemManager.IMAGE_HEIGHT,r.rndWidth=t.UTItemManager.IMAGE_WIDTH,r.rndHeight=t.UTItemManager.IMAGE_HEIGHT,r.mStyle=-1,r.changeNextBtnCallback=null,r.optImage=null,r.srcImage=null,r.BOOST_SPEED=2,r.LIGHT_SPEED=2,r.isMonoral=!1,r._colorNoize=.066,r._brigtnessNoize=.066,r._alpha=1,r._alphaStep=.095,r._scale=.7,r._lifeLength=300/r.BOOST_SPEED,r._brightness=1,r._contrast=1.5,r._saturation=1.5,r._BORDER_MARGIN=50,r.toggler=0,r.mActivePow=0,r.mTime=-1,r._colorNoize_s=.066,r._brigtnessNoize_s=.066,r._alpha_s=1,r._alphaStep_s=.095,r._scale_s=.7,r._lifeLength_s=300/r.BOOST_SPEED,r._brightness_s=1,r._contrast_s=1.5,r._saturation_s=1.5,r._colorNoize_e=.066,r._brigtnessNoize_e=.066,r._alpha_e=1,r._alphaStep_e=.095,r._scale_e=.7,r._lifeLength_e=300/r.BOOST_SPEED,r._brightness_e=1,r._contrast_e=1.5,r._saturation_e=1.5,r.mNeedCache=!0,r.parts=new Array,r.knlHeight=256,r.knlWidth=Math.floor(r.knlHeight*t.UTItemManager.IMAGE_WIDTH/t.UTItemManager.IMAGE_HEIGHT),r.prtHeight=64,r.prtWidth=Math.floor(r.prtHeight*t.UTItemManager.IMAGE_WIDTH/t.UTItemManager.IMAGE_HEIGHT),r.rndWidth=t.UTItemManager.IMAGE_WIDTH,r.rndHeight=t.UTItemManager.IMAGE_HEIGHT,r.KernelCovorRangeX=r.rndWidth/(r.knlWidth-1)*5,r.KernelCovorRangeY=r.rndHeight/(r.knlHeight-1)*5,r.particle=s,h=0;h<r.prtHeight*r.prtWidth;h++)r.parts.push(new t.IPPerticles);return r.setStyle(r.mStyle),r}return Object(f.a)(i,e),Object(x.a)(i,[{key:"initWithData",value:function(e,s,r){if(null==this.srcImage){var h=new d.BitmapData(this.knlWidth,this.knlHeight,!0,0),n=new t.Matrix;n.scale(h.width/r.width,h.height/r.height),h.draw(r,n,null,null,null,!0),this.srcImage=h.getPixels(h.rect);var o=new d.BitmapData(this.knlWidth,this.knlHeight,!0,0);o.perlinNoise(this.knlHeight/30,this.knlHeight/30,1e4*Math.random(),!1,!0);o.rect;o.draw(h,null,null,null,o.rect),this.optImage=t.MOMA01ImageUtils.calcOpticalFlowByteArray(o)}m(Object(a.a)(i.prototype),"init3D",this).call(this,e,s,null)}},{key:"ContrastSaturationBrightness",value:function(e,a,s,r){var h=new t.Vec4(e.x,e.y,e.z,e.w);e.multiply(a);var n=h.dot(i.LumCoeff)*(1-s);h.multiply(s),h.add(n),h.multiply(r);var o=.5*(1-r);return h.add(o),h}},{key:"getRandom",value:function(){return 2*Math.random()-1}},{key:"setup",value:function(){this.texture=t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle,d.Context3DTextureFormat.BGRA,!1,!1,"particle")}},{key:"draw",value:function(){if(this.mActivePow*=.9,!(this.motion<1)){var e,i;this.motion--,this.mCtx3D.setTextureAt(0,this.texture),this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.SOURCE_ALPHA,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA);var a,s=new t.Vec4,r=new t.Vec4;for(this.toggler++,this.toggler+1>this.LIGHT_SPEED&&(this.toggler=0),e=0;e<this.prtHeight*this.prtWidth;e++)if(e%this.LIGHT_SPEED==this.toggler){var h=this.parts[e];if(h.orgAlpha){a=t.MOMA01ImageUtils.clampi(h.y/(this.rndHeight-1)*(this.knlHeight-1),0,this.knlHeight-1)*this.knlWidth+t.MOMA01ImageUtils.clampi(h.x/(this.rndWidth-1)*(this.knlWidth-1),0,this.knlWidth-1),s.x=.02*(this.optImage[2*a]-127)*10*this.BOOST_SPEED,s.y=.02*(this.optImage[2*a+1]-127)*10*this.BOOST_SPEED,h.x+=s.x,h.y+=s.y,this.mUniformMatrix[0]=h.x-this.rndWidth,this.mUniformMatrix[1]=this.rndHeight-h.y,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=40*h.scale,this.mUniformColor[3]=h.alpha*h.orgAlpha,this.mUniformColor[0]=h.r*this.mUniformColor[3],this.mUniformColor[1]=h.g*this.mUniformColor[3],this.mUniformColor[2]=h.b*this.mUniformColor[3];var n=.55*this.mUniformMatrix[3];this.mUniformColor[3]>0&&(h.x>n&&h.y>n&&h.x<t.UTItemManager.IMAGE_WIDTH-n&&h.y<t.UTItemManager.IMAGE_HEIGHT-n?(this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,this.mUniformColor),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies)):h.orgAlpha=0),h.alpha<1&&(h.alpha+=this._alphaStep,h.alpha>1&&(h.alpha=1))}if(h.life--,h.life<0){h.x=h.orgX+this.getRandom()*this.KernelCovorRangeX-.5*this.KernelCovorRangeX,h.y=h.orgY+this.getRandom()*this.KernelCovorRangeY-.5*this.KernelCovorRangeY,h.life=Math.random()*this._lifeLength,h.scale=Math.random()*this._scale+.1,a=t.MOMA01ImageUtils.clampi(h.y/(this.rndHeight-1)*(this.knlHeight-1),0,this.knlHeight-1)*this.knlWidth+t.MOMA01ImageUtils.clampi(h.x/(this.rndWidth-1)*(this.knlWidth-1),0,this.knlWidth-1),r.x=this.srcImage[4*a+1]/255,r.y=this.srcImage[4*a+2]/255,r.z=this.srcImage[4*a+3]/255,(i=this.ContrastSaturationBrightness(r,this._brightness,this.isMonoral?.1:this._saturation,this._contrast)).x=t.MOMA01ImageUtils.clampf(i.x,0,1),i.y=t.MOMA01ImageUtils.clampf(i.y,0,1),i.z=t.MOMA01ImageUtils.clampf(i.z,0,1);var o=this.getRandom()*this._brigtnessNoize;h.r=i.x+this.getRandom()*this._colorNoize+o,h.g=i.y+this.getRandom()*this._colorNoize+o,h.b=i.z+this.getRandom()*this._colorNoize+o,h.orgAlpha=this.srcImage[4*a]/255,h.alpha=this._alpha}}this.dirty=!1}}},{key:"addedForce",value:function(t,e){this.motion+=1;var i=(new Date).getTime();this.mActivePow+=Math.min(Math.sqrt(t*t+e*e)*(i-this.mTime)/1500,.5),this.mTime=i;var a=(this.mActivePow-5)/4;a<0&&(a=0),a>1&&(a=1),this._colorNoize=this._colorNoize_s+(this._colorNoize_e-this._colorNoize_s)*a,this._brigtnessNoize=this._brigtnessNoize_s+(this._brigtnessNoize_e-this._brigtnessNoize_s)*a,this._alpha=this._alpha_s,this._alphaStep=this._alphaStep_s,this._scale=this._scale_s+(this._scale_e-this._scale_s)*a,this._lifeLength=this._lifeLength_s+(this._lifeLength_e-this._lifeLength_s)*a,this._brightness=this._brightness_s+(this._brightness_e-this._brightness_s)*a,this._contrast=this._contrast_s+(this._contrast_e-this._contrast_s)*a,this._saturation=this._saturation_s+(this._saturation_e-this._saturation_s)*a,!this._isEnableNextBtn&&this._counter>10&&(this._isEnableNextBtn=!0,this.changeNextBtnCallback(!0)),this._counter++,this.dirty=!0}},{key:"setStyle",value:function(t){switch(this.mStyle=t,this.mStyle){case 1:this._colorNoize_s=.066,this._brigtnessNoize_s=.2,this._alpha_s=1,this._alphaStep_s=.095,this._scale_s=.5,this._lifeLength_s=300/this.BOOST_SPEED,this._brightness_s=1,this._contrast_s=1.5,this._saturation_s=1.5,this._colorNoize_e=.5,this._brigtnessNoize_e=.5,this._alpha_e=1,this._alphaStep_e=1,this._scale_e=.32,this._lifeLength_e=500/this.BOOST_SPEED,this._brightness_e=1,this._contrast_e=1.5,this._saturation_e=1.5;break;case 2:this._colorNoize_s=.5,this._brigtnessNoize_s=.1215,this._alpha_s=1,this._alphaStep_s=1,this._scale_s=.8,this._lifeLength_s=4/this.BOOST_SPEED,this._brightness_s=1,this._contrast_s=1.5,this._saturation_s=1.29,this._colorNoize_e=.2,this._brigtnessNoize_e=.123,this._alpha_e=1,this._alphaStep_e=1,this._scale_e=1.5,this._lifeLength_e=4/this.BOOST_SPEED,this._brightness_e=1,this._contrast_e=1.5,this._saturation_e=1.29;break;default:this._colorNoize_s=.1,this._brigtnessNoize_s=.1,this._alpha_s=1,this._alphaStep_s=.02,this._scale_s=1,this._lifeLength_s=50/this.BOOST_SPEED,this._brightness_s=1,this._contrast_s=1.505,this._saturation_s=1.28,this._colorNoize_e=.2,this._brigtnessNoize_e=.1,this._alpha_e=0,this._alphaStep_e=.03,this._scale_e=1,this._lifeLength_e=50/this.BOOST_SPEED,this._brightness_e=1,this._contrast_e=1.505,this._saturation_e=1.28}this.clear()}},{key:"clear",value:function(){var t,e;for(this._isEnableNextBtn=!1,null!=this.changeNextBtnCallback&&this.changeNextBtnCallback(!1),this._counter=0,this.motion=0,this.mActivePow=0,t=0;t<this.prtHeight;t++)for(e=0;e<this.prtWidth;e++)this.parts[Math.floor(t*this.prtWidth+e)].orgX=this.rndWidth*e/this.prtWidth+this.rndWidth/this.prtWidth*.5,this.parts[Math.floor(t*this.prtWidth+e)].orgY=this.rndHeight*t/this.prtHeight+this.rndHeight/this.prtHeight*.5,this.parts[Math.floor(t*this.prtWidth+e)].life=150*Math.random(),this.parts[Math.floor(t*this.prtWidth+e)].alpha=0,this.parts[Math.floor(t*this.prtWidth+e)].orgAlpha=0;this.mCtx3D&&m(Object(a.a)(i.prototype),"clear",this).call(this)}}]),i}(t.RemixBaseImpl);e.LumCoeff=new t.Vec4(.2125,.7154,.0721),e.AvgLumin=new t.Vec4(.5,.5,.5),t.MOMA01Impl=e}(_||(_={})),function(t){var e=function(e){function i(e){var s;Object(g.a)(this,i),(s=Object(c.a)(this,Object(a.a)(i).call(this,!0,e))).SHADOW_WIDTH=30,s.MIN_WIDTH=100,s.MAX_PERTS=60,s.activeIndex=0,s.SCALE_BIAS_UP=4,s.SCALE_BIAS=1/s.SCALE_BIAS_UP,s.BOOST_SPEED=2,s.LIGHT_SPEED=5,s.mStyle=0,s.changeNextBtnCallback=null,s.mActivePow=0,s.mTime=-1,s._animaCounter=0,d.Context3D.MAX_TEXTURE=6,s.parts=new Array;for(var r=0;r<s.MAX_PERTS;r++)s.parts.push(new t.MOMA02CPerticles);return s.mask=new d.Shape,s.tmpView=new d.MovieClip,s.tmpViewlayer=new d.Bitmap,s.tmpView.addChild(s.tmpViewlayer),s.tmpView.addChild(s.mask),s.tmpViewlayer.mask=s.mask,s.shadwoPreviewActive=new d.DropShadowFilter(0,0,0,.3,s.SHADOW_WIDTH*s.SCALE_BIAS,s.SHADOW_WIDTH*s.SCALE_BIAS,1,2),s.shadwoOutActive=new d.DropShadowFilter(0,0,0,.3,s.SHADOW_WIDTH,s.SHADOW_WIDTH,1,2),s.shadwoInPreviewActive=new d.DropShadowFilter(0,0,0,1,s.SHADOW_WIDTH*s.SCALE_BIAS*.2,s.SHADOW_WIDTH*s.SCALE_BIAS*.2,1,2),s.shadwoINOutActive=new d.DropShadowFilter(0,0,0,1,.2*s.SHADOW_WIDTH,.2*s.SHADOW_WIDTH,1,2),s.colorManager=new d.AdjustColor,s.colorManager.brightness=0,s.colorManager.contrast=0,s.colorManager.saturation=0,s.colFilter=new d.ColorMatrixFilter,s._srcTypePhoto=t.UTCreateMain.getActiveSrcType()==t.AppStoryDefs.VIEW_SRC_PHOTO,s}return Object(f.a)(i,e),Object(x.a)(i,[{key:"initWithData",value:function(e,s,r){var h;this._srcBmd=r,this.srcRect=this._srcBmd.getColorBoundsRect(4278190080,0,!1),this._thumBmd=new d.BitmapData(this._srcBmd.width*this.SCALE_BIAS,this._srcBmd.height*this.SCALE_BIAS,!0,0),(h=new t.Matrix).scale(this._thumBmd.width/this._srcBmd.width,this._thumBmd.height/this._srcBmd.height),this._thumBmd.draw(this._srcBmd,h,null,null,null,!0),this.tmpViewlayer.bitmapData=this._thumBmd,this.tmpViewlayer.smoothing=!0,m(Object(a.a)(i.prototype),"init3D",this).call(this,e,s,null)}},{key:"getRandom",value:function(){return 2*Math.random()-1}},{key:"setup",value:function(){var e;for(this.mFBO.dispose(),this.mFBO=this.mCtx3D.createTexture(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,d.Context3DTextureFormat.BGRA,!0),e=0;e<this.MAX_PERTS;e++)this.parts[e].setCtx(this.mCtx3D);this.recreateTexture()}},{key:"draw",value:function(){var t;for(this.mCtx3D.clear(0,0,0,0),this.mCtx3D.setProgram(this.mNoMipShader),this.mCtx3D.setVertexBufferAt(0,this.mVerts,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,this.mFBOMatrix,!0),t=this.activeIndex;t<this.parts.length;t++)this.parts[t].draw(this.mIndicies);for(t=0;t<this.activeIndex;t++)this.parts[t].draw(this.mIndicies);this.mCtx3D.setProgram(this.mMipShader),this.mActivePow*=.9}},{key:"recreateTexture",value:function(){var e;this.tmpViewlayer.bitmapData=this._thumBmd;var i=new t.Matrix,a=new p,s=this.SCALE_BIAS;for(e=0;e<this.MAX_PERTS;e++){var r=this.parts[e];if(r.bAllocated){a.x=r.org_x-.5*r.org_width,a.y=r.org_y-.5*r.org_height,a.width=r.org_width,a.height=r.org_height,this.updateMask(a,this.mStyle,s);var h=new d.BitmapData(1*r.texSize,1*r.texSize,!0,0);i.identity(),i.translate(1*-r.tx,1*-r.ty),this.colorManager.hue=r.hue,this.colFilter.matrix=this.colorManager.CalculateFinalFlatArray(),this.tmpView.filters=[this.colFilter,this.shadwoPreviewActive,this.shadwoInPreviewActive],h.drawWithQuality(this.tmpViewlayer.bitmapData.canvas,i,null,null,null,!0,d.StageQuality.HIGH),r.updateTexture(h),h.dispose()}}}},{key:"setStyle",value:function(t){this.mStyle=t,this.clear()}},{key:"updateMask",value:function(t,e,i){if(this.mask.graphics.clear(),this.mask.graphics.beginFill(16777215,1),1==e)this.mask.graphics.drawRoundRect(this.SHADOW_WIDTH*i,this.SHADOW_WIDTH*i,(t.width-2*this.SHADOW_WIDTH)*i,(t.height-2*this.SHADOW_WIDTH)*i,(t.width-2*this.SHADOW_WIDTH)*i,(t.height-2*this.SHADOW_WIDTH)*i);else if(2==e){for(var a=new Array,s=0;s<3;s++)a.push(this.SHADOW_WIDTH*i+Math.random()*(t.width-2*this.SHADOW_WIDTH)*i),a.push(this.SHADOW_WIDTH*i+Math.random()*(t.height-2*this.SHADOW_WIDTH)*i);this.mask.graphics.drawTriangles(a)}else this.mask.graphics.drawRect(this.SHADOW_WIDTH*i,this.SHADOW_WIDTH*i,(t.width-2*this.SHADOW_WIDTH)*i,(t.height-2*this.SHADOW_WIDTH)*i);this.mask.graphics.endFill(),this.tmpViewlayer.x=-t.x*i,this.tmpViewlayer.y=-t.y*i}},{key:"addedForce",value:function(e,i){var a=(new Date).getTime();this.mActivePow+=Math.min(Math.sqrt(e*e+i*i)*(a-this.mTime)/1e3,1),this.mTime=a;var s=this.mActivePow;if(s<0&&(s=0),s>1&&(s=1),this._animaCounter+=s,this._animaCounter<1);else{if(this.motion+=1,this.motion<3)return;this.motion=0;var r=null,h=.8*Math.random()+.5+0*(1-s),n=.13*(Math.random()-.5),o=t.UTItemManager.IMAGE_WIDTH,l=t.UTItemManager.IMAGE_HEIGHT,c=700+-350*(1-s),m=600+-400*(1-s),u=c*c,f=m*m,g=(this.SHADOW_WIDTH,this.MIN_WIDTH,f+(u-f)*Math.random()),x=Math.sqrt(g);if(null==r){r=new p;var _=new p,M=200;M=0;1==this.mStyle&&this._srcTypePhoto&&(M=0),_.x=Math.max(0,this.srcRect.x-M),_.y=Math.max(0,this.srcRect.y-M),_.width=Math.min(o-_.x,this.srcRect.width+2*M),_.height=Math.min(l-_.y,this.srcRect.height+2*M),1==this.mStyle?(r.width=r.height=Math.sqrt(g),r.x=Math.random()*(_.width-r.width)+_.x,r.y=Math.random()*(_.height-r.height)+_.y):(Math.random()<.5?(r.width=Math.min(1024,Math.max(x*(.4+Math.random()))),r.height=Math.min(1024,g/r.width)):(r.height=Math.min(1024,Math.max(x*(.4+Math.random()))),r.width=Math.min(1024,g/r.height)),r.x=Math.random()*(_.width-r.width)+_.x,r.y=Math.random()*(_.height-r.height)+_.y)}r.width/=4,r.height/=4,r.x=Math.random()*_.width,r.y=Math.random()*_.height,this.updateMask(r,this.mStyle,this.SCALE_BIAS);var D=new d.BitmapData(r.width*this.SCALE_BIAS,r.height*this.SCALE_BIAS,!0,0),v=this.parts[this.activeIndex];v.hue=20*(Math.random()-.5),this.colorManager.hue=v.hue,this.colFilter.matrix=this.colorManager.CalculateFinalFlatArray(),this.tmpView.filters=[this.colFilter,this.shadwoPreviewActive,this.shadwoInPreviewActive];var T=this.tmpViewlayer._bitmapData,w=new p(r.x*this.SCALE_BIAS,r.y*this.SCALE_BIAS,r.width*this.SCALE_BIAS,r.height*this.SCALE_BIAS),y=document.createElement("canvas");if(y.width=T.canvas.width,y.height=T.canvas.height,D.drawWithQuality(T.canvas,null,null,null,w,!0,d.StageQuality.HIGH),1==this.mStyle){var C=D.context;C.globalCompositeOperation="destination-in",C.beginPath(),C.arc(D.width/2,D.height/2,Math.min(D.width/2,D.height/2),0,2*Math.PI),C.fillStyle="rgba(0, 0, 0, 255)",C.fill(),C.closePath()}var E=Math.max(Math.abs(.5*r.width*h*Math.cos(n)-.5*r.height*h*Math.sin(n)),Math.abs(.5*r.width*h*Math.cos(n)+.5*r.height*h*Math.sin(n))),I=Math.max(Math.abs(.5*r.width*h*Math.sin(n)+.5*r.height*h*Math.cos(n)),Math.abs(.5*r.width*h*Math.sin(n)-.5*r.height*h*Math.cos(n))),A=r.x+.5*r.width,S=r.y+.5*r.height;A-E<0&&(h*=A/E),A+E>o&&(h*=(o-A)/E),S-I<0&&(h*=S/I),S+I>l&&(h*=(l-S)/I),v.setup(D,A,S,r.width,r.height,n,h*this.SCALE_BIAS_UP),D.dispose()}this.activeIndex++,this.activeIndex+1>this.MAX_PERTS&&(this.activeIndex=0),(v=this.parts[this.activeIndex]).setOrgRadWithScale(0,0),!this._isEnableNextBtn&&this.activeIndex>3&&(this._isEnableNextBtn=!0,this.changeNextBtnCallback(!0))}},{key:"clear",value:function(){this._isEnableNextBtn=!1,this.changeNextBtnCallback(!1),this._intervalPoinst=0,this.motion=0,this.activeIndex=0,this.itemIndex=0,this.partsIndex=0,this.mActivePow=0,this._animaCounter=100;for(var t=0;t<this.MAX_PERTS;t++)this.parts[t].dispose();m(Object(a.a)(i.prototype),"clear",this).call(this)}}]),i}(t.RemixBaseImpl);t.MOMA02Impl=e}(_||(_={})),function(t){var e=function(e){function i(e,s){var r;for(Object(g.a)(this,i),(r=Object(c.a)(this,Object(a.a)(i).call(this,!0,s))).margin=7,r.InMargin=256/252*2.2,r.updatePointsX=[],r.updatePointsY=[],r.updatePointsLod=[],r._lodSum=0,r._lod1Count=0,r.textureMosiac=e,r.textureIndex=2,r._mozWidth=Math.floor(40),r._mozHeight=Math.floor(48),r._mosicRemderSize=47.8,r.weakMode&&(r._mozWidth*=1.5,r._mozHeight*=1.5,r._mosicRemderSize*=2/3),r._martigX=.5*(t.UTItemManager.IMAGE_WIDTH-r._mosicRemderSize*r._mozWidth),r._martigY=.5*(t.UTItemManager.IMAGE_HEIGHT-r._mosicRemderSize*r._mozHeight),r._LODLevel=new d.ByteArray,r._LODLevel.length=r._mozWidth*r._mozHeight,r._LODLevel.position=0;r._LODLevel.position<r._LODLevel.length;)r._LODLevel.writeByte(1);return r._enableTransparentWhite=!1,r}return Object(f.a)(i,e),Object(x.a)(i,[{key:"generateMipmapWithBitmap",value:function(e,i,a){var s=i,r=a,h=new t.Matrix;e.width;h.identity(),h.scale(s/e.width,s/e.width);for(var n,o,l,c,m,u,f=e;s>0&&r>0;)(n=new d.BitmapData(s,r,!0,0)).draw(f,h,null,null,null,!1),h.scale(.5,.5),0,s>>=1,r>>=1,this._mipmaps.push(n);for((f=this._mipmaps[0]).lock(),c=0;c<2;c++)for(l=0==c?0:f.height-1,o=0;o<f.width;o++)u=(m=f.getPixel32(o,l))>>24&255,m=(u*=.65)<<24|(m>>16&255)<<16|(m>>8&255)<<8|(m>>0&255)<<0,f.setPixel32(o,l,m);for(c=0;c<2;c++)for(o=0==c?0:f.width-1,l=0;l<f.height;l++)u=(m=f.getPixel32(o,l))>>24&255,m=(u*=.65)<<24|(m>>16&255)<<16|(m>>8&255)<<8|(m>>0&255)<<0,f.setPixel32(o,l,m);f.unlock(),f=null}},{key:"initWithData",value:function(t,e,s){this._mipmaps=[],this.generateMipmapWithBitmap(s,s.width/this._mozWidth,s.height/this._mozHeight),this.maxCellNum=this._mozHeight*this._mozWidth,this.maxCellLod=this._mozHeight*this._mozWidth*(this._mipmaps.length-1-2),m(Object(a.a)(i.prototype),"init3D",this).call(this,t,e,null)}},{key:"dispose",value:function(){for(var t=0;t<this._mipmaps.length;t++)this._mipmaps[t].dispose(),this._mipmaps[t]=null;this._mipmaps.length=0,this._texture.dispose(),this._texture=null,m(Object(a.a)(i.prototype),"dispose",this).call(this)}},{key:"setup",value:function(){this._bUpdated=!0,this._bClear=!0,this.setTexture(this.textureIndex)}},{key:"setTexture",value:function(e){if(this.textureIndex=e,this.mCtx3D){var i=this.textureMosiac,a=new t.Matrix,s=new d.BitmapData(1024,1024,!0,0);switch(this.textureIndex){case 2:i.gotoAndStop(2),this.margin=7;break;case 3:i.gotoAndStop(3),this.margin=7;break;default:i.gotoAndStop(1),this.margin=0}s.hasOwnProperty("drawWithQuality"),s.draw(i,a,null,null,null,!0),this._texture&&this._texture.dispose(),this._texture=t.Stage3DHelper.uploadTexture(this.mCtx3D,s,d.Context3DTextureFormat.BGRA,!0,!0),this._bUpdated=!0,this._bClear=!0}}},{key:"draw",value:function(){if(this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,this.mFBOMatrix,!0),this._bUpdated){var t,e,i,a,s,r,h;if(this._bClear){for(this.mCtx3D.clear(0,0,0,0),this.mCtx3D.setTextureAt(0,this._texture),this._LODLevel.position=0,s=0;s<this._mozHeight;s++)for(a=0;a<this._mozWidth;a++)i=this._LODLevel.readUnsignedByte(),a%(e=Math.pow(2,i-1))==0&&s%e==0&&(((t=this._mipmaps[i-1].getPixel32(a/e,s/e))>>24&255)<10||this._enableTransparentWhite&&(t>>16&255)>235&&(t>>8&255)>235&&(t>>0&255)>235||(h=(t>>24&255)/255,this.mUniformColor[0]=h*(t>>16&255)/255,this.mUniformColor[1]=h*(t>>8&255)/255,this.mUniformColor[2]=h*(t>>0&255)/255,this.mUniformColor[3]=h,this.mUniformMatrix[0]=a*this._mosicRemderSize-1024+this._mosicRemderSize*e*.5,this.mUniformMatrix[1]=1152-(s*this._mosicRemderSize+this._mosicRemderSize*e*.5),this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=this._mosicRemderSize*e*this.InMargin,this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,this.mUniformColor),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies)));this._bClear=!1}else{for(this.mCtx3D.setTextureAt(0,this._texture),r=0;r<this.updatePointsLod.length;r++)a=this.updatePointsX[r],s=this.updatePointsY[r],this._LODLevel.position=a+this._mozWidth*s,i=this.updatePointsLod[r],a%(e=Math.pow(2,i-1))==0&&s%e==0&&(h=((t=this._mipmaps[i-1].getPixel32(a/e,s/e))>>24&255)/255,this.mUniformColor[0]=h*(t>>16&255)/255,this.mUniformColor[1]=h*(t>>8&255)/255,this.mUniformColor[2]=h*(t>>0&255)/255,this.mUniformColor[3]=h,this.mUniformMatrix[0]=a*this._mosicRemderSize-1024+this._mosicRemderSize*e*.5,this.mUniformMatrix[0]>0&&(this.mUniformMatrix[0]=0),this.mUniformMatrix[1]=s*this._mosicRemderSize+this._mosicRemderSize*e*.5,this.mUniformMatrix[1]<0&&(this.mUniformMatrix[1]=0),this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=this._mosicRemderSize*e*this.InMargin,this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,this.mUniformColor),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies),this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ONE,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA),(t>>24&255)<10||this._enableTransparentWhite&&(t>>16&255)>235&&(t>>8&255)>235&&(t>>0&255)>235||this.mCtx3D.drawTriangles(this.mIndicies));this.updatePointsX.length=0,this.updatePointsY.length=0,this.updatePointsLod.length=0}this.mUniformColor[3]=1,this._bUpdated=!1}}},{key:"addedForce",value:function(e,i){var a=this;this._bUpdated=!0;var s,r,h,n,o,l,c,m,u,d,f,g,x,_=this._lodSum/this.maxCellLod,p=8*(1-_);if(!(p<5&&Math.random()>(p/5*.5+.05)*t.AppVals.REMIX_PERTICLE_SPEED)){var M=function(){if(1==_)return{v:void 0};!function t(){r=Math.floor(a._mozWidth*Math.random()),h=Math.floor(a._mozHeight*Math.random());!function e(){a._LODLevel.position=r+a._mozWidth*h;var i,s=a._LODLevel.readUnsignedByte();i=s+1;var M,D,v=Math.pow(2,i-1);r=Math.floor(r/v)*v;var T=!0;for(M=h=Math.floor(h/v)*v;M<h+v;M++){if(M<a._mozHeight){for(a._LODLevel.position=r+a._mozWidth*M,D=r;D<r+v&&D<a._mozWidth;D++)if(a._LODLevel.readUnsignedByte()!=s)return r=D,h=M,void e()}else T=!1;if(!T)break}if(T){if(s==a._mipmaps.length-3&&p<5){if(!(Math.random()<Math.pow(1-p/5,2)))return void t();if(a._lod1Count<a.maxCellNum&&Math.random()<.6)return void t()}if(s!=a._mipmaps.length-2)if(a.weakMode&&2==s)t();else{T=!1,v=Math.pow(2,i-1);var w=Math.pow(2,s-1);for(M=h;M<h+v&&M<a._mozHeight;M++)for(D=r;D<r+v&&D<a._mozWidth;D++)D%w==0&&M%w==0&&(x=a._mipmaps[s-1].getPixel32(D/w,M/w),d=x>>16&255,f=x>>8&255,g=x>>0&255,T?(n>d&&(n=d),c<d&&(c=d),o>f&&(o=f),m<f&&(m=f),l>g&&(l=g),u<g&&(u=g)):(T=!0,n=c=d,o=m=f,l=u=g));d=c-n,f=m-o,g=u-l;var y=Math.sqrt(d*d+f*f+g*g)/(500*_);if(!(a.weakMode&&y>.6))if(y>.92&&(y=.92),y=Math.pow(y,2),Math.random()<y)t();else{for(M=h;M<h+v&&M<a._mozHeight;M++)for(a._LODLevel.position=r+a._mozWidth*M,D=r;D<r+v&&D<a._mozWidth;D++)a._LODLevel.writeByte(i),a._lodSum++,2==i&&a._lod1Count++;a.updatePointsX.push(r),a.updatePointsY.push(h),a.updatePointsLod.push(i)}}else t()}else t()}()}()};for(s=0;s<p*t.AppVals.REMIX_PERTICLE_SPEED;s++){var D=M();if("object"===typeof D)return D.v}}}},{key:"clear",value:function(){for(this._LODLevel.position=0;this._LODLevel.position<this._LODLevel.length;)this._LODLevel.writeByte(1);m(Object(a.a)(i.prototype),"clear",this).call(this),this._bClear=!0,this._bUpdated=!0,this._lodSum=0,this._lod1Count=0}}]),i}(t.RemixBaseImpl);t.MosaicImpl=e}(_||(_={})),function(t){var e=function(){function e(i,a,s,r,h,n,o){Object(g.a)(this,e),this.mFudeSize=1.2,this.mColorRandRange=1,this.mActiveColor=16711935,this.currentScale=0,this.colorSelectMode=!1,this.selectedColor=0,this.CBcolorChanged=null,this.dirty=!0,this.colArray=new Array,this.mVF=new t.PVVectprField,this.mParticles=new Array,this.mTexParts=new Array,this._isZoom=!1,this.currentScale=this._isZoom?1:0,this._painted=!1,this.particle1=i,this.particle2=a,this.particle3=s,this.particle4=r,this.particle5=h,this.particle6=n,this.particle7=o}return Object(x.a)(e,[{key:"initWithData",value:function(t,e,i){this.mCacheBmd=i,this.mBackImage=e,this.init3D(t,this.mBackImage)}},{key:"dispose",value:function(){var t=this;this.stopRendering(),this.stage3d.removeEventListener(d.events.Event.CONTEXT3D_CREATE,function(e){t.context3DCreateHandler(e)}),this.mParticles.length=0,this.mMipShader.dispose(),this.mMipShader=null,this.mNoMipShader.dispose(),this.mNoMipShader=null,this.mVerts.dispose(),this.mVerts=null,this.mCoords.dispose(),this.mCoords=null,this.mVertsStage.dispose(),this.mVertsStage=null,this.mIndicies.dispose(),this.mIndicies=null;for(var e=0;e<this.mTexParts.length;e++)this.mTexParts[e].dispose();this.mTexParts.length=0,this.mTexParts=null,this.mTexBaseT&&this.mTexBaseT.dispose(),this.mTexBaseT=null,this.mFBO.dispose(),this.mFBO=null,this.mUniformMatrix.length=0,this.mUniformMatrix=null,this.mUniformColor.length=0,this.mUniformColor=null,this.mScreenMatrix=null,this.mFBOMatrix=null,this.mCacheBmd=null,this._bmdBackImage=null,this.mCtx3D.dispose(),this.mCtx3D=null,this.stage3d=null}},{key:"stopRendering",value:function(){this._drawingEnabled=!1}},{key:"startRendering",value:function(){this._drawingEnabled=!0,this._toScale=0}},{key:"toggleScale",value:function(){this._isZoom=!this._isZoom}},{key:"setEraseMode",value:function(t){this.mParticles.length=0,this._eraseMode=t}},{key:"getEraseMode",value:function(){return this._eraseMode}},{key:"setSelectedToolMode",value:function(e){"eraserMenuBtn"==e?t.AppVals.SELECTED_TOOL_MODE=t.AppVals.ERASE_MODE:"thickBrushBtn"==e?t.AppVals.SELECTED_TOOL_MODE=t.AppVals.THICK_BRUSH_MODE:"thinBrushBtn"==e&&(t.AppVals.SELECTED_TOOL_MODE=t.AppVals.THIN_BRUSH_MODE)}},{key:"getSelectedToolMode",value:function(){return t.AppVals.SELECTED_TOOL_MODE}},{key:"init3D",value:function(e,i){var a=this;this.mScreenMatrix=new d.geom.Matrix3D,this.mVF.setupField(t.UTItemManager.IMAGE_WIDTH/75,t.UTItemManager.IMAGE_HEIGHT,t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT),this._drawingEnabled=!1,this._bmdBackImage=i,this.stage3d=e,this.stage3d.addEventListener(d.events.Event.CONTEXT3D_CREATE,function(t){a.context3DCreateHandler(t)}),this.stage3d.requestContext3D()}},{key:"updateTopLayer",value:function(){}},{key:"context3DCreateHandler",value:function(e){console.log("context created"),this.onDeactive(),this.mTexBaseT=null,this.mCtx3D=this.stage3d.context3D,this.mMipShader=t.Stage3DHelper.createMainProgram(this.mCtx3D,!0),this.mNoMipShader=t.Stage3DHelper.createMainProgram(this.mCtx3D,!1),this.mCtx3D.configureBackBuffer(this.stage3d.stageWidth,this.stage3d.stageHeight,0,!0),this.onResize();var i=t.UTItemManager.IMAGE_HEIGHT/t.UTItemManager.IMAGE_WIDTH,a=[-.5,.5*-i,.5,.5*-i,-.5,.5*i,.5,.5*i];this.mVerts=this.mCtx3D.createVertexBuffer(4,2),this.mVerts.uploadFromVector([-.5,-.5,.5,-.5,-.5,.5,.5,.5],0,4),this.mCoords=this.mCtx3D.createVertexBuffer(4,2),this.mCoords.uploadFromVector([0,1,1,1,0,0,1,0],0,4),this.mVertsStage=this.mCtx3D.createVertexBuffer(4,2),this.mVertsStage.uploadFromVector(a,0,4);if(this.mIndicies=this.mCtx3D.createIndexBuffer(6),this.mIndicies.uploadFromVector([0,2,1,2,3,1],0,6),this.mFBOMatrix=new d.geom.Matrix3D,this.mFBOMatrix.appendTranslation(.5*-t.UTItemManager.IMAGE_WIDTH,.5*-t.UTItemManager.IMAGE_HEIGHT,0),this.mFBOMatrix.appendScale(1/(.5*t.UTItemManager.IMAGE_WIDTH),1/(.5*t.UTItemManager.IMAGE_HEIGHT),1),this.mFBO=this.mCtx3D.createTexture(t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT,d.Context3DTextureFormat.BGRA,!0,0,"mFBO"),this.mUniformMatrix=[0,0,0,1],this.mUniformColor=[1,1,1,1],this.mTexParts=null,this.mTexParts=new Array,this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle1,d.Context3DTextureFormat.BGRA,!0,!0,"p1")),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle2,d.Context3DTextureFormat.BGRA,!0,!0,"p2")),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle4,d.Context3DTextureFormat.BGRA,!0,!0,"p4")),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle5,d.Context3DTextureFormat.BGRA,!0,!0,"p5")),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle6,d.Context3DTextureFormat.BGRA,!0,!0,"p6")),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle7,d.Context3DTextureFormat.BGRA,!0,!0,"p7")),this.mDisplayFboMatrix=new d.geom.Matrix3D,this.mDisplayFboMatrix.appendScale(1/512,1/512,1),this.mCtx3D.setVertexBufferAt(1,this.mCoords,2,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ONE,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA),this.mCtx3D.setCulling(d.Context3DTriangleFace.BACK),this.updateTopLayer(),this.clear(),null!=this.mCacheBmd){this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=1024,this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.mUniformColor[3]=1,this.mCtx3D.setProgram(this.mNoMipShader);var s=t.Stage3DHelper.uploadTexture(this.mCtx3D,this.mCacheBmd,d.Context3DTextureFormat.BGRA,!0,!0,"tmp");this.mCtx3D.setRenderToTexture(this.mFBO),t.Stage3DHelper.drawTriangles(this.mCtx3D,this.mIndicies,this.mDisplayFboMatrix,s,this.mVerts,this.mCoords,this.mUniformMatrix,this.mUniformColor),s.dispose(),this.mCacheBmd=null,this._painted=!0}this.mCtx3D.setProgram(this.mMipShader),this.mCtx3D.setVertexBufferAt(0,this.mVerts,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setVertexBufferAt(1,this.mCoords,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,this.mFBOMatrix),this.mCtx3D.setRenderToBackBuffer(),this.onActive(),dispatchEvent(new Event(d.events.Event.ACTIVATE))}},{key:"onActive",value:function(){var t=this;null==this.mCtx3D||this._mcWidth<1||this._mcHeight<1||this.stage3d.addEventListener(d.events.Event.ENTER_FRAME,function(e){t.onEnterFrame(e)})}},{key:"onDeactive",value:function(){this.stage3d.removeEventListener(d.events.Event.ENTER_FRAME,this.onEnterFrame)}},{key:"onResize",value:function(){this._mcWidth=this.stage3d.stageWidth/t.AppVals.GLOBAL_SCALE,this._mcHeight=this.stage3d.stageHeight/t.AppVals.GLOBAL_SCALE-t.AppVals.STATUSBAR_HEIGHT,this._currentRect=t.UTItemManager.getZoomRectMotion(this.currentScale,this._mcWidth,this._mcHeight),null==this.mCtx3D||this._mcWidth<1||this._mcHeight<1||(this.mCtx3D.configureBackBuffer(this.stage3d.stageWidth,this.stage3d.stageHeight,0,!1),this.mScreenMatrix.identity(),this.mScreenMatrix.appendTranslation(0,.5*-t.AppVals.STATUSBAR_HEIGHT,0),this.mScreenMatrix.appendScale(1/(.5*this._mcWidth),1/(.5*(this._mcHeight+t.AppVals.STATUSBAR_HEIGHT)),1))}},{key:"draw",value:function(){var e=this.mParticles.length;if(e>0){var i;this._eraseMode?this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ZERO,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA):this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ONE,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA);for(var a=-1,s=0;s<e;)(i=this.mParticles[s]).flg&&Math.random()>.5||(i.posX-.55*i.scale>0&&i.posY-.55*i.scale>0&&i.posX+.55*i.scale<t.UTItemManager.IMAGE_WIDTH&&i.posY+.55*i.scale<t.UTItemManager.IMAGE_HEIGHT||this._eraseMode)&&(a!=i.texIndex&&(this.mCtx3D.setTextureAt(0,this.mTexParts[Math.floor(i.texIndex)]),a=i.texIndex),i.flg?(this.mUniformMatrix[0]=i.posX+(1*Math.random()-.5)*i.scale*.06,this.mUniformMatrix[1]=i.posY+(1*Math.random()-.5)*i.scale*.06,this.mUniformMatrix[3]=i.scale*(.4*Math.random()+.8),this.mUniformColor[3]=Math.random(),this.mUniformColor[0]=i.r*this.mUniformColor[3],this.mUniformColor[1]=i.g*this.mUniformColor[3],this.mUniformColor[2]=i.b*this.mUniformColor[3]):(this.mUniformMatrix[0]=i.posX,this.mUniformMatrix[1]=i.posY,this.mUniformMatrix[3]=i.scale,this.mUniformColor[0]=i.r,this.mUniformColor[1]=i.g,this.mUniformColor[2]=i.b,this.mUniformColor[3]=1),this.mUniformMatrix[2]=i.angle,this.mUniformMatrix[3]=i.scale,this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,this.mUniformColor),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies),this._painted||(this.onPainted&&this.onPainted(),this._painted=!0)),i.life>0?(this.mVF.getForceFromPos(i.posX,i.posY),i.setVFupdate(this.mVF.outX,this.mVF.outY),s++):(this.mParticles.splice(s,1),e--);this.mUniformColor[3]=1}this.mVF.fadeField(.96),this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.ONE,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA)}},{key:"onEnterFrame",value:function(e){if(this.dirty||0!=this.mParticles.length){var i;if(this._drawingEnabled&&this.draw(),this.dirty=this.mParticles.length>0,this._isZoom?1!=this._toScale&&(this._toScale=1,this._frScale=this.currentScale,this._ticktime=(new Date).getTime()):0!=this._toScale&&(this._toScale=0,this._frScale=this.currentScale,this._ticktime=(new Date).getTime()),this.currentScale!=this._toScale&&this._drawingEnabled)(i=((new Date).getTime()-this._ticktime)/300)>1?(i=1,this.currentScale=this._toScale,this._currentRect=t.UTItemManager.getZoomRectMotion(this.currentScale,this._mcWidth,this._mcHeight)):(i=t.Easing.easeOutCubic(i,0,1,1),this.currentScale=this._frScale+(this._toScale-this._frScale)*i,this._currentRect=t.UTItemManager.getZoomRectMotion(this.currentScale,this._mcWidth,this._mcHeight));null!=e&&this.mCtx3D.present()}}},{key:"captureCurrentBuffer",value:function(){this.stage3d.removeEventListener(d.events.Event.ENTER_FRAME,this.onEnterFrame);var t=new d.BitmapData(this.stage3d.stageWidth,this.stage3d.stageHeight,!1,16777215);return this.onEnterFrame(null),this.mCtx3D.drawToBitmapData(t),this.mCtx3D.present(),t}},{key:"drawBufferToBitmap",value:function(t){this.onEnterFrame(null),this.mCtx3D.drawToBitmapData(t)}},{key:"captureToBitmap",value:function(e,i){this.mTexBaseT&&this.mTexBaseT.dispose(),this.mTexBaseT=null,this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.mUniformColor[3]=1;Math.min(Math.min(this.stage3d.stageWidth,this.stage3d.stageHeight),Math.max(e.width/2,e.height/2));var a,s,r=new d.geom.Matrix3D,h=(new t.Matrix,new d.BitmapData(128,128,!0,0));for(this.mCtx3D.configureBackBuffer(128,128,16,!1),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,this.mUniformColor),this.mCtx3D.setVertexBufferAt(1,this.mCoords,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setVertexBufferAt(0,this.mVertsStage,0,d.Context3DVertexBufferFormat.FLOAT_2),this.mCtx3D.setProgram(this.mNoMipShader),this.mCtx3D.setRenderToBackBuffer(),this.mCtx3D.setTextureAt(0,this.mFBO),this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=e.width,r.identity(),r.appendScale(1/64,1/64,1),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,r,!0),this.mCtx3D.setTextureAt(0,this.mFBO),a=0;a<Math.ceil(e.width/128);a++)for(s=0;s<Math.ceil(e.height/128);s++)this.mCtx3D.clear(0,0,0,0),this.mUniformMatrix[0]=128*-a+(.5*e.width-64),this.mUniformMatrix[1]=128*s-(.5*e.height-64),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies),this.mCtx3D.drawToBitmapData(h),e.copyPixels(h,h.rect,{x:128*a,y:128*s});var n=128*t.UTItemManager.IMAGE_HEIGHT/t.UTItemManager.IMAGE_WIDTH;for(this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=e.width,r.identity(),r.appendScale(1/64,1/(.5*n),1),this.mCtx3D.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,r,!1),a=0;a<Math.ceil(t.UTItemManager.IMAGE_WIDTH/128);a++)for(s=0;s<Math.ceil(t.UTItemManager.IMAGE_HEIGHT/128);s++)this.mCtx3D.clear(0,0,0,0),this.mUniformMatrix[0]=128*-a+(.5*t.UTItemManager.IMAGE_WIDTH-64),this.mUniformMatrix[1]=s*n-(.5*t.UTItemManager.IMAGE_HEIGHT-.5*n),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies),this.mCtx3D.drawToBitmapData(h),i.copyPixels(h,h.rect,{x:128*a,y:128*s});h.dispose()}},{key:"setColor",value:function(t){this.colArray.length=0;for(var e=0;e<t.length;e++)this.colArray.push(t[e]);this.setColorIndex(this.selectedColor)}},{key:"setColorIndex",value:function(t){this.selectedColor=t<this.colArray.length?t:0,this.mActiveColor=this.colArray[this.selectedColor],this.CBcolorChanged&&this.CBcolorChanged()}},{key:"convertMousePos",value:function(e,i){e/=t.AppVals.GLOBAL_SCALE,i/=t.AppVals.GLOBAL_SCALE;var a=.5*-this._mcWidth+.5*this._currentRect.width+this._currentRect.x+this._currentRect.width*t.UTItemManager.wkCenter.x-.5*this._currentRect.width,s=-(.5*-this._mcHeight+.5*this._currentRect.height+this._currentRect.y+this._currentRect.height*t.UTItemManager.wkCenter.y-.5*this._currentRect.height),r=this._currentRect.width*t.UTItemManager.wkWidth;this._cnverted_X=(e-.5*this._mcWidth-a)/r*t.UTItemManager.IMAGE_WIDTH+.5*t.UTItemManager.IMAGE_WIDTH,this._cnverted_Y=-(i-.5*this._mcHeight+s-t.AppVals.STATUSBAR_HEIGHT)/r*t.UTItemManager.IMAGE_WIDTH+.5*t.UTItemManager.IMAGE_HEIGHT}},{key:"onMousePress",value:function(t,e){this._drawingEnabled&&(this.convertMousePos(t,e),this.mPrevMouseX=this._cnverted_X,this.mPrevMouseY=this._cnverted_Y,this.mPrevDiffX=0,this.mPrevDiffY=0)}},{key:"onMouseRelease",value:function(t,e){this.colorSelectMode||this._eraseMode||(this.selectedColor++,this.selectedColor>this.colArray.length-1&&(this.selectedColor=0),this.setColorIndex(this.selectedColor))}},{key:"onMouseDrag",value:function(e,i){if(this._drawingEnabled){var a,s,r,h,n=this.mFudeSize;t.AppVals.SELECTED_TOOL_MODE==t.AppVals.THICK_BRUSH_MODE?n=this.mFudeSize:t.AppVals.SELECTED_TOOL_MODE==t.AppVals.THIN_BRUSH_MODE?n=this.mFudeSize/16:t.AppVals.SELECTED_TOOL_MODE==t.AppVals.ERASE_MODE&&(n=this.mFudeSize),this.convertMousePos(e,i),a=this._cnverted_X,s=this._cnverted_Y,r=a-this.mPrevMouseX,h=s-this.mPrevMouseY;for(var o,l,c,m,u,d,f,g,x=Math.max(Math.sqrt(r*r+h*h)/20,1),_=0;_<x;_++){f=(_+1)/x,o=a-this.mPrevMouseX,l=s-this.mPrevMouseY,o*=f,l*=f,o=this.mPrevMouseX+o,l=this.mPrevMouseY+l,c=r-this.mPrevDiffX,m=h-this.mPrevDiffY,c*=f,m*=f,c=this.mPrevDiffX+c,m=this.mPrevDiffY+m;var p,M=.2+Math.min(n,Math.sqrt(c*c+m*m)/50);this.mVF.addVectorCircle(o,l,.5*c,.5*m,80,.3);for(var D=0;D<10;D++){var v,T=this._eraseMode?1e3:1e3*Math.random(),w=new t.PVParticle;if(w.angle=720*Math.random(),w.flg=!1,Math.random()<.1){var y=255*(Math.random()*this.mColorRandRange-.5*this.mColorRandRange),C=(this.mActiveColor>>16&255)+y,E=(this.mActiveColor>>8&255)+y,I=(this.mActiveColor>>0&255)+y;v=(C=C<0?0:C>255?255:C)<<16|(E=E<0?0:E>255?255:E)<<8|(I=I<0?0:I>255?255:I)}else v=this.mActiveColor;if(w.r=(v>>16&255)/255,w.g=(v>>8&255)/255,w.b=(v>>0&255)/255,u=100*Math.random()-50,d=100*Math.random()-50,u/=f=Math.sqrt(u*u+d*d),d/=f,u*=g=50*Math.random()-25,d*=g,T<10?(Math.random()<.1?w.scale=6*Math.random():w.scale=3*Math.random(),w.setInitialCondition(o+100*Math.random()-50,l+100*Math.random()-50,0,0,0),w.texIndex=6*Math.random()):T<30?(Math.random()<.1?(w.scale=4*Math.random(),w.texIndex=1):(w.scale=.5*Math.random()+1,w.texIndex=6*Math.random()),p=.7*Math.random()+.3,w.setInitialCondition(o+c*p*15,l+m*p*15,0,0,0)):T<50?(p=.7*Math.random()+.3,w.scale=.1*Math.random()+.5,w.setInitialCondition(o+u,l+d,c*p,m*p,30*Math.pow(M,.7)),w.texIndex=0,w.flg=!0):(w.setInitialCondition(o+u,l+d,.1*c,.1*m,30),w.texIndex=Math.random()<.2?1:0,w.scale=.3*Math.random()+1.2),w.scale*=1.2,w.scale*=40*M,this.mParticles.push(w),this.mParticles.length>500){var A=Math.floor(250*Math.random());this.mParticles.splice(A,1)}}}this.mPrevDiffX=r,this.mPrevDiffY=h,this.mPrevMouseX=a,this.mPrevMouseY=s}}},{key:"clear",value:function(){this._painted=!1,this.mParticles.length=0,this.mCtx3D.setRenderToBackBuffer(),this.mCtx3D.clear(0,0,0,0),null==this.mTexBaseT&&this.canvasChange()}},{key:"canvasChange",value:function(){var e=new d.BitmapData(1024,1024,!1,16777215);t.UTImageBuilder.createPrintedImage(e,this._bmdBackImage,t.UTItemManager.wkMultiply,!1,!1,!1),this.mTexBaseT=t.Stage3DHelper.uploadTexture(this.mCtx3D,e,d.Context3DTextureFormat.BGRA,!1,!1,"mTexBaseT"),this._currentRect=t.UTItemManager.getZoomRectMotion(this.currentScale,this._mcWidth,this._mcHeight)}}]),e}();t.PaintImpl=e}(_||(_={})),function(t){var e=function(e){function i(t,e,s,r,h,n,o,l){var m;return Object(g.a)(this,i),(m=Object(c.a)(this,Object(a.a)(i).call(this,!1,t))).mColorRandRange=.3,m.mFudeSize=3,m.srcRate=.6,m.mWeakCounter=0,m.mParticles=new Array,m.particle1=e,m.particle2=s,m.particle3=r,m.particle4=h,m.particle5=n,m.particle6=o,m.particle7=l,m}return Object(f.a)(i,e),Object(x.a)(i,[{key:"initWithData",value:function(e,s,r){this.mColorBmd=new d.BitmapData(t.UTItemManager.IMAGE_WIDTH*this.srcRate,t.UTItemManager.IMAGE_HEIGHT*this.srcRate,!0,0);var h=new t.Matrix;h.scale(this.mColorBmd.width/r.width,this.mColorBmd.height/r.height),this.mColorBmd.draw(r,h,null,null,null,!1),this.mSrcImage=r,m(Object(a.a)(i.prototype),"init3D",this).call(this,e,s,r)}},{key:"dispose",value:function(){this.mSrcImage=null,this.mParticles.length=0,this.mColorBmd.dispose(),this.mColorBmd=null;for(var t=0;t<this.mTexParts.length;t++)this.mTexParts[t].dispose();this.mTexParts.length=0,this.mTexParts=null,m(Object(a.a)(i.prototype),"dispose",this).call(this)}},{key:"setup",value:function(){this.mTexParts=null,this.mTexParts=new Array,this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle1,d.Context3DTextureFormat.BGRA,!0,!0)),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle2,d.Context3DTextureFormat.BGRA,!0,!0)),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle3,d.Context3DTextureFormat.BGRA,!0,!0)),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle4,d.Context3DTextureFormat.BGRA,!0,!0)),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle5,d.Context3DTextureFormat.BGRA,!0,!0)),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle6,d.Context3DTextureFormat.BGRA,!0,!0)),this.mTexParts.push(t.Stage3DHelper.uploadTexture(this.mCtx3D,this.particle7,d.Context3DTextureFormat.BGRA,!0,!0))}},{key:"draw",value:function(){for(var e,i=-1,a=this.mParticles.length,s=0;s<a;)(e=this.mParticles[s]).posX-.55*e.scale>0&&e.posY-.55*e.scale>0&&e.posX+.55*e.scale<t.UTItemManager.IMAGE_WIDTH&&e.posY+.55*e.scale<t.UTItemManager.IMAGE_HEIGHT&&(e.flg&&Math.random()>.7||(i!=e.texIndex&&(this.mCtx3D.setTextureAt(0,this.mTexParts[e.texIndex]),i=e.texIndex),this.mUniformMatrix[0]=e.posX+(1*Math.random()-.5)*e.scale*.06-t.UTItemManager.IMAGE_WIDTH,this.mUniformMatrix[1]=t.UTItemManager.IMAGE_HEIGHT-e.posY+(1*Math.random()-.5)*e.scale*.06,this.mUniformMatrix[3]=e.scale*(.4*Math.random()+.8),e.flg||Math.random()<.1?(this.mUniformColor[3]=Math.random(),this.mUniformColor[0]=e.r*this.mUniformColor[3],this.mUniformColor[1]=e.g*this.mUniformColor[3],this.mUniformColor[2]=e.b*this.mUniformColor[3]):(this.mUniformColor[0]=e.r,this.mUniformColor[1]=e.g,this.mUniformColor[2]=e.b,this.mUniformColor[3]=1),this.mUniformMatrix[2]=e.flg?100*Math.random():e.angle,this.mUniformMatrix[3]=e.scale,this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,this.mUniformColor),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.mUniformMatrix),this.mCtx3D.drawTriangles(this.mIndicies))),e.life>0?(e.update(),s++):(this.mParticles.splice(s,1),a--);this.mUniformColor[3]=1}},{key:"addedForce",value:function(e,i){var a,s;this.mWeakCounter++;var r,h,n,o,l,c,m,u,d=.5*-e,f=.5*-i,g=.1+Math.min(this.mFudeSize,Math.sqrt(d*d+f*f)/50),x=Math.max(Math.sqrt(d*d+f*f),10);this.weakMode&&g>1.2&&(g=1.2);for(var _=0;_<x;_++){for(var p=0;p<50&&(s=Math.floor(Math.random()*t.UTItemManager.IMAGE_HEIGHT),a=Math.floor(Math.random()*t.UTItemManager.IMAGE_WIDTH),!((u=(h=this.mColorBmd.getPixel32(a/t.UTItemManager.IMAGE_WIDTH*(t.UTItemManager.IMAGE_WIDTH*this.srcRate),(t.UTItemManager.IMAGE_HEIGHT-s)/t.UTItemManager.IMAGE_HEIGHT*(t.UTItemManager.IMAGE_HEIGHT*this.srcRate)))>>24&255)>0));p++);if(u<1)return;(m=Math.pow(u/255,5))<1&&(m*=.5);var M,D=1e3*Math.random(),v=new t.PVParticle;if(v.angle=720*Math.random(),v.flg=!1,Math.random()<.1){var T=255*(Math.random()*this.mColorRandRange-.5*this.mColorRandRange),w=(h>>16&255)+T,y=(h>>8&255)+T,C=(h>>0&255)+T;M=(w=w<0?0:w>255?255:w)<<16|(y=y<0?0:y>255?255:y)<<8|(C=C<0?0:C>255?255:C)}else M=h;if(v.r=(M>>16&255)/255,v.g=(M>>8&255)/255,v.b=(M>>0&255)/255,n=100*Math.random()-50,o=100*Math.random()-50,n/=l=Math.sqrt(n*n+o*o),o/=l,n*=c=50*Math.random()-25,o*=c,D<10?(v.scale=2*Math.pow(Math.random(),.3)*g*m*(this.weakMode?.3:1),v.texIndex=Math.floor(6*Math.random()),2==v.texIndex&&(v.texIndex=6),v.setInitialCondition(a+400*Math.random()-200,s+400*Math.random()-200,0,0,0)):D<20?(v.scale=4*Math.pow(Math.random(),.3)*g*m*(this.weakMode?.3:1),v.texIndex=Math.floor(6*Math.random()),2==v.texIndex&&(v.texIndex=6),v.setInitialCondition(a+100*Math.random()-50,s+100*Math.random()-50,0,0,0)):D<30?(r=.5*(.7*Math.random()+.3)*m*g*(this.weakMode?.3:1),v.scale=(.5*Math.random()+1)*m*g*(this.weakMode?.3:1),v.setInitialCondition(a+n,s+o,d*r,f*r,this.weakMode?10:30),v.texIndex=0,v.flg=Math.random()<.8):(r=.3*Math.pow(Math.random(),2)*m*(this.weakMode?.3:1),v.setInitialCondition(a+n,s+o,d*r,f*r,this.weakMode?3:10),v.texIndex=Math.random()<.8?0:2,v.scale=(1.6*Math.random()+.4)*m*g*(this.weakMode?.3:1),v.flg=!(0==v.texIndex&&r<.2)),v.scale*=20,this.mParticles.push(v),this.mParticles.length>500){var E=250*Math.random();this.mParticles.splice(E,1)}}}},{key:"clear",value:function(){this.mWeakCounter=0,this.mParticles.length=0,m(Object(a.a)(i.prototype),"clear",this).call(this)}}]),i}(t.RemixBaseImpl);t.SplashImpl=e}(_||(_={})),function(t){var e=function(){function t(e){Object(g.a)(this,t),this.type=void 0,this.target=void 0,this.type=e}return Object(x.a)(t,[{key:"clone",value:function(){return new t(this.type)}}]),t}();e.CONTEXT3D_CREATE="CONTEXT3D_CREATE",e.ENTER_FRAME="ENTER_FRAME",e.ACTIVATE="ACTIVATE",t.Event=e}((u=d||(d={})).events||(u.events={})),function(t){!function(e){var i=function(t){function e(){return Object(g.a)(this,e),Object(c.a)(this,Object(a.a)(e).call(this,e.ERROR))}return Object(f.a)(e,t),e}(t.events.Event);i.ERROR="error",e.ErrorEvent=i}(t.events||(t.events={}))}(d||(d={})),function(t){!function(t){var e=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(g.a)(this,t),this.listeners=new Array,this.target=e||this}return Object(x.a)(t,[{key:"addEventListener",value:function(t,e){void 0===this.listeners[t]&&(this.listeners[t]=new Array),-1===this.getEventListenerIndex(t,e)&&this.listeners[t].push(e)}},{key:"removeEventListener",value:function(t,e){var i=this.getEventListenerIndex(t,e);-1!==i&&this.listeners[t].splice(i,1)}},{key:"dispatchEvent",value:function(t){var e=this.listeners[t.type];if(void 0!==e){var i=e.length;t.target=this.target;for(var a=0;a<i;a++)e[a](t)}}},{key:"getEventListenerIndex",value:function(t,e){if(void 0!==this.listeners[t])for(var i=this.listeners[t],a=i.length,s=0;s<a;s++)if(e==i[s])return s;return-1}},{key:"hasEventListener",value:function(t,e){return null!=e?-1!==this.getEventListenerIndex(t,e):void 0!==this.listeners[t]&&this.listeners[t].length>0}}]),t}();t.EventDispatcher=e}(t.events||(t.events={}))}(d||(d={})),function(t){!function(t){var e=function t(){Object(g.a)(this,t)};e.AXIS_ANGLE="axisAngle",e.EULER_ANGLES="eulerAngles",e.QUATERNION="quaternion",t.Orientation3D=e}(t.geom||(t.geom={}))}(d||(d={})),function(t){!function(t){var e=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(g.a)(this,t),this.x=e,this.y=i,this.z=a,this.w=s}return Object(x.a)(t,[{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)}},{key:"subtract",value:function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)}},{key:"incrementBy",value:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}},{key:"decrementBy",value:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}},{key:"equals",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.x==t.x&&this.y==t.y&&this.z==t.z&&(!e||this.w==t.w)}},{key:"nearEquals",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=Math.abs;return a(this.x-t.x)<e&&a(this.y-t.y)<e&&a(this.z-t.z)<e&&(!i||a(this.w-t.w)<e)}},{key:"clone",value:function(){return new t(this.x,this.y,this.z,this.w)}},{key:"copyFrom",value:function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w}},{key:"negate",value:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z}},{key:"scaleBy",value:function(t){this.x*=t,this.y*=t,this.z*=t}},{key:"setTo",value:function(t,e,i){this.x=t,this.y=e,this.z=i}},{key:"normalize",value:function(){var t=this.length;return 0!=t&&this.scaleBy(1/t),t}},{key:"crossProduct",value:function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}},{key:"dotProduct",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"project",value:function(){0!=this.w&&(this.x/=this.w,this.y/=this.w,this.z/=this.w)}},{key:"toString",value:function(){return"[Vector3D] (x:"+this.x+" ,y:"+this.y+", z:"+this.z+", w:"+this.w+")"}},{key:"length",get:function(){return Math.sqrt(this.lengthSquared)}},{key:"lengthSquared",get:function(){return this.x*this.x+this.y*this.y+this.z*this.z}}],[{key:"angleBetween",value:function(t,e){return Math.acos(t.dotProduct(e)/(t.length*e.length))}},{key:"distance",value:function(t,e){var i=t.x-e.x,a=t.y-e.y,s=t.z-e.z;return Math.sqrt(i*i+a*a+s*s)}}]),t}();e.X_AXIS=new e(1,0,0),e.Y_AXIS=new e(0,1,0),e.Z_AXIS=new e(0,0,1),t.Vector3D=e}(t.geom||(t.geom={}))}(d||(d={})),function(t){!function(e){var i=function(){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(g.a)(this,i),null!=t&&16==t.length?this.rawData=new Float32Array(t.slice(0)):this.rawData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return Object(x.a)(i,[{key:"append",value:function(t){var e=t.rawData[0],i=t.rawData[1],a=t.rawData[2],s=t.rawData[3],r=t.rawData[4],h=t.rawData[5],n=t.rawData[6],o=t.rawData[7],l=t.rawData[8],c=t.rawData[9],m=t.rawData[10],u=t.rawData[11],d=t.rawData[12],f=t.rawData[13],g=t.rawData[14],x=t.rawData[15],_=this.rawData[0],p=this.rawData[1],M=this.rawData[2],D=this.rawData[3],v=this.rawData[4],T=this.rawData[5],w=this.rawData[6],y=this.rawData[7],C=this.rawData[8],E=this.rawData[9],I=this.rawData[10],A=this.rawData[11],S=this.rawData[12],B=this.rawData[13],R=this.rawData[14],b=this.rawData[15];this.rawData[0]=e*_+i*v+a*C+s*S,this.rawData[1]=e*p+i*T+a*E+s*B,this.rawData[2]=e*M+i*w+a*I+s*R,this.rawData[3]=e*D+i*y+a*A+s*b,this.rawData[4]=r*_+h*v+n*C+o*S,this.rawData[5]=r*p+h*T+n*E+o*B,this.rawData[6]=r*M+h*w+n*I+o*R,this.rawData[7]=r*D+h*y+n*A+o*b,this.rawData[8]=l*_+c*v+m*C+u*S,this.rawData[9]=l*p+c*T+m*E+u*B,this.rawData[10]=l*M+c*w+m*I+u*R,this.rawData[11]=l*D+c*y+m*A+u*b,this.rawData[12]=d*_+f*v+g*C+x*S,this.rawData[13]=d*p+f*T+g*E+x*B,this.rawData[14]=d*M+f*w+g*I+x*R,this.rawData[15]=d*D+f*y+g*A+x*b}},{key:"prepend",value:function(t){var e=t.rawData[0],i=t.rawData[1],a=t.rawData[2],s=t.rawData[3],r=t.rawData[4],h=t.rawData[5],n=t.rawData[6],o=t.rawData[7],l=t.rawData[8],c=t.rawData[9],m=t.rawData[10],u=t.rawData[11],d=t.rawData[12],f=t.rawData[13],g=t.rawData[14],x=t.rawData[15],_=this.rawData[0],p=this.rawData[1],M=this.rawData[2],D=this.rawData[3],v=this.rawData[4],T=this.rawData[5],w=this.rawData[6],y=this.rawData[7],C=this.rawData[8],E=this.rawData[9],I=this.rawData[10],A=this.rawData[11],S=this.rawData[12],B=this.rawData[13],R=this.rawData[14],b=this.rawData[15];this.rawData[0]=_*e+p*r+M*l+D*d,this.rawData[1]=_*i+p*h+M*c+D*f,this.rawData[2]=_*a+p*n+M*m+D*g,this.rawData[3]=_*s+p*o+M*u+D*x,this.rawData[4]=v*e+T*r+w*l+y*d,this.rawData[5]=v*i+T*h+w*c+y*f,this.rawData[6]=v*a+T*n+w*m+y*g,this.rawData[7]=v*s+T*o+w*u+y*x,this.rawData[8]=C*e+E*r+I*l+A*d,this.rawData[9]=C*i+E*h+I*c+A*f,this.rawData[10]=C*a+E*n+I*m+A*g,this.rawData[11]=C*s+E*o+I*u+A*x,this.rawData[12]=S*e+B*r+R*l+b*d,this.rawData[13]=S*i+B*h+R*c+b*f,this.rawData[14]=S*a+B*n+R*m+b*g,this.rawData[15]=S*s+B*o+R*u+b*x}},{key:"appendScale",value:function(t,e,i){this.rawData[0]*=t,this.rawData[1]*=t,this.rawData[2]*=t,this.rawData[3]*=t,this.rawData[4]*=e,this.rawData[5]*=e,this.rawData[6]*=e,this.rawData[7]*=e,this.rawData[8]*=i,this.rawData[9]*=i,this.rawData[10]*=i,this.rawData[11]*=i}},{key:"prependScale",value:function(t,e,i){this.rawData[0]*=t,this.rawData[1]*=e,this.rawData[2]*=i,this.rawData[4]*=t,this.rawData[5]*=e,this.rawData[6]*=i,this.rawData[8]*=t,this.rawData[9]*=e,this.rawData[10]*=i,this.rawData[12]*=t,this.rawData[13]*=e,this.rawData[14]*=i}},{key:"appendTranslation",value:function(t,e,i){this.rawData[0]+=this.rawData[12]*t,this.rawData[1]+=this.rawData[13]*t,this.rawData[2]+=this.rawData[14]*t,this.rawData[3]+=this.rawData[15]*t,this.rawData[4]+=this.rawData[12]*e,this.rawData[5]+=this.rawData[14]*e,this.rawData[6]+=this.rawData[14]*e,this.rawData[7]+=this.rawData[15]*e,this.rawData[8]+=this.rawData[12]*i,this.rawData[9]+=this.rawData[13]*i,this.rawData[10]+=this.rawData[14]*i,this.rawData[11]+=this.rawData[15]*i}},{key:"prependTranslation",value:function(t,e,i){this.rawData[3]=this.rawData[0]*t+this.rawData[1]*e+this.rawData[2]*i+this.rawData[3],this.rawData[7]=this.rawData[4]*t+this.rawData[5]*e+this.rawData[6]*i+this.rawData[7],this.rawData[11]=this.rawData[8]*t+this.rawData[9]*e+this.rawData[10]*i+this.rawData[11],this.rawData[15]=this.rawData[12]*t+this.rawData[13]*e+this.rawData[14]*i+this.rawData[15]}},{key:"appendRotation",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=this.getRotateMatrix(e,t*i.DEG_2_RAD);a?(this.appendTranslation(-a.x,-a.y,-a.z),this.append(s),this.appendTranslation(a.x,a.y,a.z)):this.append(s)}},{key:"prependRotation",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=this.getRotateMatrix(e,t*i.DEG_2_RAD);a?(this.prependTranslation(a.x,a.y,a.z),this.prepend(s),this.prependTranslation(-a.x,-a.y,-a.z)):this.prepend(s)}},{key:"clone",value:function(){return new i(Array.prototype.slice.call(this.rawData))}},{key:"copyColumnFrom",value:function(t,e){if(t<0||t>3)throw new Error("column error");this.rawData[t]=e.x,this.rawData[t+4]=e.y,this.rawData[t+8]=e.z,this.rawData[t+12]=e.w}},{key:"copyColumnTo",value:function(t,e){if(t<0||t>3)throw new Error("column error");e.x=this.rawData[t],e.y=this.rawData[t+4],e.z=this.rawData[t+8],e.w=this.rawData[t+12]}},{key:"copyFrom",value:function(t){this.rawData.set(t.rawData)}},{key:"copyRawDataFrom",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i&&this.transpose();var a=t.length-e;if(a<16)throw new Error("Arguments Error");a>16&&(a=16);for(var s=0;s<a;s++)this.rawData[s]=t[s+e];i&&this.transpose()}},{key:"copyRawDataTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(i&&this.transpose(),e>0)for(var a=0;a<e;a++)t[a]=0;for(var s=this.rawData.length,r=0;r<s;r++)t[r+e]=this.rawData[r];i&&this.transpose()}},{key:"copyRowFrom",value:function(t,e){if(t<0||t>3)throw new Error("row error");this.rawData[4*t+0]=e.x,this.rawData[4*t+1]=e.y,this.rawData[4*t+2]=e.z,this.rawData[4*t+3]=e.w}},{key:"copyRowTo",value:function(t,e){if(t<0||t>3)throw new Error("row error");e.x=this.rawData[4*t],e.y=this.rawData[4*t+1],e.z=this.rawData[4*t+2],e.w=this.rawData[4*t+3]}},{key:"copyToMatrix3D",value:function(t){t.rawData.set(this.rawData)}},{key:"decompose",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"eulerAngles",a=[],s=this.clone().rawData,r=new e.Vector3D(s[12],s[13],s[14]);s[12]=0,s[13]=0,s[14]=0;var h=new e.Vector3D;h.x=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),h.y=Math.sqrt(s[4]*s[4]+s[5]*s[5]+s[6]*s[6]),h.z=Math.sqrt(s[8]*s[8]+s[9]*s[9]+s[10]*s[10]),s[0]*(s[5]*s[10]-s[6]*s[9])-s[1]*(s[4]*s[10]-s[6]*s[8])+s[2]*(s[4]*s[9]-s[5]*s[8])<0&&(h.z=-h.z),s[0]/=h.x,s[1]/=h.x,s[2]/=h.x,s[4]/=h.y,s[5]/=h.y,s[6]/=h.y,s[8]/=h.z,s[9]/=h.z,s[10]/=h.z;var n=new e.Vector3D;switch(i){case t.geom.Orientation3D.AXIS_ANGLE:n.w=Math.acos((s[0]+s[5]+s[10]-1)/2);var o=Math.sqrt((s[6]-s[9])*(s[6]-s[9])+(s[8]-s[2])*(s[8]-s[2])+(s[1]-s[4])*(s[1]-s[4]));n.x=(s[6]-s[9])/o,n.y=(s[8]-s[2])/o,n.z=(s[1]-s[4])/o;break;case t.geom.Orientation3D.QUATERNION:var l=s[0]+s[5]+s[10];l>0?(n.w=Math.sqrt(1+l)/2,n.x=(s[6]-s[9])/(4*n.w),n.y=(s[8]-s[2])/(4*n.w),n.z=(s[1]-s[4])/(4*n.w)):s[0]>s[5]&&s[0]>s[10]?(n.x=Math.sqrt(1+s[0]-s[5]-s[10])/2,n.w=(s[6]-s[9])/(4*n.x),n.y=(s[1]+s[4])/(4*n.x),n.z=(s[8]+s[2])/(4*n.x)):s[5]>s[10]?(n.y=Math.sqrt(1+s[5]-s[0]-s[10])/2,n.x=(s[1]+s[4])/(4*n.y),n.w=(s[8]-s[2])/(4*n.y),n.z=(s[6]+s[9])/(4*n.y)):(n.z=Math.sqrt(1+s[10]-s[0]-s[5])/2,n.x=(s[8]+s[2])/(4*n.z),n.y=(s[6]+s[9])/(4*n.z),n.w=(s[1]-s[4])/(4*n.z));break;case t.geom.Orientation3D.EULER_ANGLES:n.y=Math.asin(-s[2]),1!=s[2]&&-1!=s[2]?(n.x=Math.atan2(s[6],s[10]),n.z=Math.atan2(s[1],s[0])):(n.z=0,n.x=Math.atan2(s[4],s[5]))}return a.push(r),a.push(n),a.push(h),a}},{key:"identity",value:function(){this.rawData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"interpolateTo",value:function(t,e){this.rawData.set(i.interpolate(this,t,e).rawData)}},{key:"invert",value:function(){var t=this.determinant,e=Math.abs(t)>1e-11;if(e){t=1/t;var i=this.rawData[0],a=this.rawData[4],s=this.rawData[8],r=this.rawData[12],h=this.rawData[1],n=this.rawData[5],o=this.rawData[9],l=this.rawData[13],c=this.rawData[2],m=this.rawData[6],u=this.rawData[10],d=this.rawData[14],f=this.rawData[3],g=this.rawData[7],x=this.rawData[11],_=this.rawData[15];this.rawData[0]=t*(n*(u*_-d*x)-o*(m*_-d*g)+l*(m*x-u*g)),this.rawData[1]=-t*(h*(u*_-d*x)-o*(c*_-d*f)+l*(c*x-u*f)),this.rawData[2]=t*(h*(m*_-d*g)-n*(c*_-d*f)+l*(c*g-m*f)),this.rawData[3]=-t*(h*(m*x-u*g)-n*(c*x-u*f)+o*(c*g-m*f)),this.rawData[4]=-t*(a*(u*_-d*x)-s*(m*_-d*g)+r*(m*x-u*g)),this.rawData[5]=t*(i*(u*_-d*x)-s*(c*_-d*f)+r*(c*x-u*f)),this.rawData[6]=-t*(i*(m*_-d*g)-a*(c*_-d*f)+r*(c*g-m*f)),this.rawData[7]=t*(i*(m*x-u*g)-a*(c*x-u*f)+s*(c*g-m*f)),this.rawData[8]=t*(a*(o*_-l*x)-s*(n*_-l*g)+r*(n*x-o*g)),this.rawData[9]=-t*(i*(o*_-l*x)-s*(h*_-l*f)+r*(h*x-o*f)),this.rawData[10]=t*(i*(n*_-l*g)-a*(h*_-l*f)+r*(h*g-n*f)),this.rawData[11]=-t*(i*(n*x-o*g)-a*(h*x-o*f)+s*(h*g-n*f)),this.rawData[12]=-t*(a*(o*d-l*u)-s*(n*d-l*m)+r*(n*u-o*m)),this.rawData[13]=t*(i*(o*d-l*u)-s*(h*d-l*c)+r*(h*u-o*c)),this.rawData[14]=-t*(i*(n*d-l*m)-a*(h*d-l*c)+r*(h*m-n*c)),this.rawData[15]=t*(i*(n*u-o*m)-a*(h*u-o*c)+s*(h*m-n*c))}return e}},{key:"pointAt",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];console.log("pointAt not impletement")}},{key:"recompose",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.length<3)return!1;var i=e[2],a=e[0],s=e[1];return this.identity(),this.appendScale(i.x,i.y,i.z),this.append(this.getRotateMatrix(t.geom.Vector3D.X_AXIS,s.x)),this.append(this.getRotateMatrix(t.geom.Vector3D.Y_AXIS,s.y)),this.append(this.getRotateMatrix(t.geom.Vector3D.Z_AXIS,s.z)),this.rawData[12]=a.x,this.rawData[13]=a.y,this.rawData[14]=a.z,this.rawData[15]=1,!0}},{key:"transformVector",value:function(t){return new e.Vector3D(t.x*this.rawData[0]+t.y*this.rawData[1]+t.z*this.rawData[2]+this.rawData[3],t.x*this.rawData[4]+t.y*this.rawData[5]+t.z*this.rawData[6]+this.rawData[7],t.x*this.rawData[8]+t.y*this.rawData[9]+t.z*this.rawData[10]+this.rawData[11],1)}},{key:"deltaTransformVector",value:function(t){return new e.Vector3D(t.x*this.rawData[0]+t.y*this.rawData[1]+t.z*this.rawData[2],t.x*this.rawData[4]+t.y*this.rawData[5]+t.z*this.rawData[6],t.x*this.rawData[8]+t.y*this.rawData[9]+t.z*this.rawData[10],0)}},{key:"transformVectors",value:function(t,i){for(var a=0,s=new e.Vector3D,r=new e.Vector3D;a+3<=t.length;)s.x=t[a],s.y=t[a+1],s.z=t[a+2],r=this.transformVector(s),i[a]=r.x,i[a+1]=r.y,i[a+2]=r.z,a+=3}},{key:"transpose",value:function(){var t=this.rawData[1],e=this.rawData[2],i=this.rawData[3],a=this.rawData[4],s=this.rawData[6],r=this.rawData[7],h=this.rawData[8],n=this.rawData[9],o=this.rawData[11],l=this.rawData[12],c=this.rawData[13],m=this.rawData[14];this.rawData[1]=a,this.rawData[2]=h,this.rawData[3]=l,this.rawData[4]=t,this.rawData[6]=n,this.rawData[7]=c,this.rawData[8]=e,this.rawData[9]=s,this.rawData[11]=m,this.rawData[12]=i,this.rawData[13]=r,this.rawData[14]=o}},{key:"toString",value:function(){for(var t="[Matrix3D]\n",e=0;e<this.rawData.length;e++)t+=this.rawData[e]+"  , ",(e+1)%4==0&&(t+="\n");return t}},{key:"getRotateMatrix",value:function(t,e){var a,s=t.x,r=t.y,h=t.z,n=Math.cos(e),o=Math.sin(e);if(0!=s&&0==r&&0==h)a=new i([1,0,0,0,0,n,-o,0,0,o,n,0,0,0,0,1]);else if(0!=r&&0==s&&0==h)a=new i([n,0,o,0,0,1,0,0,-o,0,n,0,0,0,0,1]);else if(0!=h&&0==s&&0==r)a=new i([n,-o,0,0,o,n,0,0,0,0,1,0,0,0,0,1]);else{var l=t.lengthSquared;if(Math.abs(l-1)>1e-4){var c=1/Math.sqrt(l);s=t.x*c,r=t.y*c,h=t.z*c}var m=1-n;a=new i([s*s*m+n,s*r*m-h*o,s*h*m+r*o,0,s*r*m+h*o,r*r*m+n,r*h*m-s*o,0,s*h*m-r*o,r*h*m+s*o,h*h*m+n,0,0,0,0,1])}return a}},{key:"determinant",get:function(){return(this.rawData[0]*this.rawData[5]-this.rawData[4]*this.rawData[1])*(this.rawData[10]*this.rawData[15]-this.rawData[14]*this.rawData[11])-(this.rawData[0]*this.rawData[9]-this.rawData[8]*this.rawData[1])*(this.rawData[6]*this.rawData[15]-this.rawData[14]*this.rawData[7])+(this.rawData[0]*this.rawData[13]-this.rawData[12]*this.rawData[1])*(this.rawData[6]*this.rawData[11]-this.rawData[10]*this.rawData[7])+(this.rawData[4]*this.rawData[9]-this.rawData[8]*this.rawData[5])*(this.rawData[2]*this.rawData[15]-this.rawData[14]*this.rawData[3])-(this.rawData[4]*this.rawData[13]-this.rawData[12]*this.rawData[5])*(this.rawData[2]*this.rawData[11]-this.rawData[10]*this.rawData[3])+(this.rawData[8]*this.rawData[13]-this.rawData[12]*this.rawData[9])*(this.rawData[2]*this.rawData[7]-this.rawData[6]*this.rawData[3])}},{key:"position",get:function(){return new e.Vector3D(this.rawData[3],this.rawData[7],this.rawData[11])}}],[{key:"interpolate",value:function(t,i,a){var s=(new e.Quaternion).fromMatrix3D(t),r=(new e.Quaternion).fromMatrix3D(i);return e.Quaternion.lerp(s,r,a).toMatrix3D()}}]),i}();i.DEG_2_RAD=Math.PI/180,e.Matrix3D=i}(t.geom||(t.geom={}))}(d||(d={})),function(t){!function(t){var e=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(g.a)(this,e),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=i,this.z=a,this.w=s}return Object(x.a)(e,[{key:"fromMatrix3D",value:function(t){var e,i=t.rawData[0],a=t.rawData[1],s=t.rawData[2],r=t.rawData[4],h=t.rawData[5],n=t.rawData[6],o=t.rawData[8],l=t.rawData[9],c=t.rawData[10],m=i+h+c;return m>0?(e=1/(2*Math.sqrt(m+1)),this.x=(n-l)*e,this.y=(o-s)*e,this.z=(a-r)*e,this.w=.25/e):i>h&&i>c?(e=1/(2*Math.sqrt(1+i-h+c)),this.x=(r+a)*e,this.y=(s+o)*e,this.z=(l-n)*e,this.w=.25/e):h>i&&h>c?(e=1/Math.sqrt(1+h-i-c),this.x=.25/e,this.y=(l+n)*e,this.z=(s-o)*e,this.w=(r+a)*e):c>i&&c>h&&(e=1/Math.sqrt(1+c-i-h),this.x=(l+n)*e,this.y=.25/e,this.z=(r-a)*e,this.w=(s+o)*e),this}},{key:"toMatrix3D",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=this.x+this.x,a=this.y+this.y,s=this.z+this.z,r=this.x*i,h=this.x*a,n=this.x*s,o=this.y*a,l=this.y*s,c=this.z*s,m=this.w*i,u=this.w*a,d=this.w*s;return e||(e=new t.Matrix3D),e.rawData[0]=1-(o+c),e.rawData[1]=h+d,e.rawData[2]=n-u,e.rawData[3]=0,e.rawData[4]=h-d,e.rawData[5]=1-(r+c),e.rawData[6]=l+m,e.rawData[7]=0,e.rawData[8]=n+u,e.rawData[9]=l-m,e.rawData[10]=1-(r+o),e.rawData[11]=0,e.rawData[12]=0,e.rawData[13]=0,e.rawData[14]=0,e.rawData[15]=1,e}},{key:"fromAxisAngle",value:function(t,e){var i=.5*e,a=Math.sin(i),s=Math.cos(i);this.x=t.x*a,this.y=t.y*a,this.z=t.z*a,this.w=s}},{key:"conjugate",value:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z}},{key:"toString",value:function(){return"[Quaternion] (x:"+this.x+" ,y:"+this.y+", z:"+this.z+", w:"+this.w+")"}}],[{key:"lerp",value:function(t,i,a){return t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w<0?new e(t.x+a*(-i.x-t.x),t.y+a*(-i.y-t.y),t.z+a*(-i.z-t.z),t.w+a*(-i.w-i.w)):new e(t.x+a*(i.x-t.x),t.y+a*(i.y-t.y),t.z+a*(i.z-t.z),t.w+a*(i.w-i.w))}}]),e}();t.Quaternion=e}(t.geom||(t.geom={}))}(d||(d={})),function(t){!function(t){var e=function(t){function e(){return Object(g.a)(this,e),Object(c.a)(this,Object(a.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(x.a)(e,[{key:"lookAtLH",value:function(t,e,i){var a=e.x-t.x,s=e.y-t.y,r=e.z-t.z,h=1/Math.sqrt(a*a+s*s+r*r);a*=h,s*=h,r*=h;var n=i.y*r-i.z*s,o=i.z*a-i.x*r,l=i.x*s-i.y*a,c=s*(l*=h=1/Math.sqrt(n*n+o*o+l*l))-r*(o*=h),m=r*(n*=h)-a*l,u=a*o-s*n;this.copyRawDataFrom([n,o,l,-(n*t.x+o*t.y+l*t.z),c,m,u,-(c*t.x+m*t.y+u*t.z),a,s,r,-(a*t.x+s*t.y+r*t.z),0,0,0,1])}},{key:"lookAtRH",value:function(t,e,i){var a=t.x-e.x,s=t.y-e.y,r=t.z-e.z,h=1/Math.sqrt(a*a+s*s+r*r);a*=h,s*=h,r*=h;var n=i.y*r-i.z*s,o=i.z*a-i.x*r,l=i.x*s-i.y*a,c=s*(l*=h=1/Math.sqrt(n*n+o*o+l*l))-r*(o*=h),m=r*(n*=h)-a*l,u=a*o-s*n;this.copyRawDataFrom([n,o,l,-(n*t.x+o*t.y+l*t.z),c,m,u,-(c*t.x+m*t.y+u*t.z),a,s,r,-(a*t.x+s*t.y+r*t.z),0,0,0,1])}},{key:"perspectiveOffCenterLH",value:function(t,e,i,a,s,r){this.copyRawDataFrom([2*s/(e-t),0,(t+e)/(t-e),0,0,2*s/(a-i),(i+a)/(i-a),0,0,0,(r+s)/(r-s),2*r*s/(s-r),0,0,1,0])}},{key:"perspectiveLH",value:function(t,e,i,a){this.copyRawDataFrom([2*i/t,0,0,0,0,2*i/e,0,0,0,0,(a+i)/(a-i),2*a*i/(i-a),0,0,1,0])}},{key:"perspectiveFieldOfViewLH",value:function(t,e,i,a){var s=1/Math.tan(t/2),r=s/e;this.copyRawDataFrom([r,0,0,0,0,s,0,0,0,0,(a+i)/(a-i),2*a*i/(i-a),0,0,1,0])}},{key:"orthoOffCenterLH",value:function(t,e,i,a,s,r){this.copyRawDataFrom([2/(e-t),0,0,(t+e)/(t-e),0,2/(a-i),0,(i+a)/(i-a),0,0,2/(r-s),(s+r)/(s-r),0,0,0,1])}},{key:"orthoLH",value:function(t,e,i,a){this.copyRawDataFrom([2/t,0,0,0,0,2/e,0,0,0,0,2/(a-i),(i+a)/(i-a),0,0,0,1])}},{key:"perspectiveOffCenterRH",value:function(t,e,i,a,s,r){this.copyRawDataFrom([2*s/(e-t),0,(e+t)/(e-t),0,0,2*s/(a-i),(a+i)/(a-i),0,0,0,(s+r)/(s-r),2*s*r/(s-r),0,0,-1,0])}},{key:"perspectiveRH",value:function(t,e,i,a){this.copyRawDataFrom([2*i/t,0,0,0,0,2*i/e,0,0,0,0,(i+a)/(i-a),2*i*a/(i-a),0,0,-1,0])}},{key:"perspectiveFieldOfViewRH",value:function(t,e,i,a){var s=1/Math.tan(t/2),r=s/e;this.copyRawDataFrom([r,0,0,0,0,s,0,0,0,0,(a+i)/(i-a),2*i*a/(i-a),0,0,-1,0])}},{key:"orthoOffCenterRH",value:function(t,e,i,a,s,r){this.copyRawDataFrom([2/(e-t),0,0,(t+e)/(t-e),0,2/(a-i),0,(i+a)/(i-a),0,0,-2/(r-s),(s+r)/(s-r),0,0,0,1])}},{key:"orthoRH",value:function(t,e,i,a){this.copyRawDataFrom([2/t,0,0,0,0,2/e,0,0,0,0,-2/(a-i),(i+a)/(i-a),0,0,0,1])}}]),e}(t.Matrix3D);t.PerspectiveMatrix3D=e}(t.geom||(t.geom={}))}(d||(d={})),function(t){var e=function t(){Object(g.a)(this,t)};e.BYTES_4="bytes4",e.FLOAT_1="float1",e.FLOAT_2="float2",e.FLOAT_3="float3",e.FLOAT_4="float4",t.Context3DVertexBufferFormat=e}(d||(d={})),function(t){var e=function t(){Object(g.a)(this,t)};e.BGRA="bgra",t.Context3DTextureFormat=e}(d||(d={})),function(t){var e=function t(){Object(g.a)(this,t)};e.ALWAYS="always",e.EQUAL="equal",e.GREATER="greater",e.GREATER_EQUAL="greaterEqual",e.LESS="less",e.LESS_EQUAL="lessEqual",e.NEVER="never",e.NOT_EQUAL="notEqual",t.Context3DCompareMode=e}(d||(d={})),function(t){var e=function(){function e(){Object(g.a)(this,e)}return Object(x.a)(e,null,[{key:"init",value:function(){e.ONE=t.Context3D.GL.ONE,e.ZERO=t.Context3D.GL.ZERO,e.SOURCE_COLOR=t.Context3D.GL.SRC_COLOR,e.DESTINATION_COLOR=t.Context3D.GL.DST_COLOR,e.SOURCE_ALPHA=t.Context3D.GL.SRC_ALPHA,e.DESTINATION_ALPHA=t.Context3D.GL.DST_ALPHA,e.ONE_MINUS_SOURCE_COLOR=t.Context3D.GL.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_DESTINATION_COLOR=t.Context3D.GL.ONE_MINUS_DST_COLOR,e.ONE_MINUS_SOURCE_ALPHA=t.Context3D.GL.ONE_MINUS_SRC_ALPHA,e.ONE_MINUS_DESTINATION_ALPHA=t.Context3D.GL.ONE_MINUS_DST_ALPHA}}]),e}();t.Context3DBlendFactor=e}(d||(d={})),function(t){var e=function t(){Object(g.a)(this,t)};e.BACK="back",e.FRONT="front",e.FRONT_AND_BACK="frontAndBack",e.NONE="none",t.Context3DTriangleFace=e}(d||(d={})),function(t){var e=function(){function e(i,a){if(Object(g.a)(this,e),this._numVertices=i,this._data32PerVertex=a,this._glBuffer=t.Context3D.GL.createBuffer(),!this._glBuffer)throw new Error("Failed to create buffer")}return Object(x.a)(e,[{key:"uploadFromVector",value:function(e,i,a){this._data=e,0==i&&a==this._numVertices||(e=e.slice(i*this._data32PerVertex,a*this._data32PerVertex)),t.Context3D.GL.bindBuffer(t.Context3D.GL.ARRAY_BUFFER,this._glBuffer),t.Context3D.GL.bufferData(t.Context3D.GL.ARRAY_BUFFER,new Float32Array(e),t.Context3D.GL.STATIC_DRAW),t.Context3D.GL.bindBuffer(t.Context3D.GL.ARRAY_BUFFER,null)}},{key:"dispose",value:function(){t.Context3D.GL.deleteBuffer(this._glBuffer),this._glBuffer=null,this._data.length=0,this._numVertices=0,this._data32PerVertex=0}},{key:"rawdata",get:function(){return this._data}},{key:"glBuffer",get:function(){return this._glBuffer}},{key:"data32PerVertex",get:function(){return this._data32PerVertex}}]),e}();t.VertexBuffer3D=e}(d||(d={})),function(t){var e=function(){function e(i){Object(g.a)(this,e),this.numIndices=i,this._glBuffer=t.Context3D.GL.createBuffer()}return Object(x.a)(e,[{key:"uploadFromVector",value:function(e,i,a){this._data=e,0==i&&a==this.numIndices||(e=e.slice(i,i+a)),t.Context3D.GL.bindBuffer(t.Context3D.GL.ELEMENT_ARRAY_BUFFER,this._glBuffer),t.Context3D.GL.bufferData(t.Context3D.GL.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.Context3D.GL.STATIC_DRAW),t.Context3D.GL.bindBuffer(t.Context3D.GL.ELEMENT_ARRAY_BUFFER,null)}},{key:"dispose",value:function(){t.Context3D.GL.deleteBuffer(this._glBuffer),this._glBuffer=null,this.numIndices=0,this._data.length=0}},{key:"glBuffer",get:function(){return this._glBuffer}}]),e}();t.IndexBuffer3D=e}(d||(d={})),function(t){var e=function(){function e(i,a,s,r,h){var n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Object(g.a)(this,e),this.reverse=!1,this._glTexture=t.Context3D.GL.createTexture(),this._streamingLevels=h,this._textureUnit=e.__texUnit++,this.width=i,this.height=a,this._format=s,this._forRTT=r,this.reverse=n,this._forRTT&&(this.imageData=new ImageData(this.width,this.height),this.uploadFromImage(this.imageData,0))}return Object(x.a)(e,[{key:"__getGLTexture",value:function(){return this._glTexture}},{key:"uploadFromBitmapData",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._forRTT&&console.error("rtt texture"),e instanceof t.BitmapData?(this.imageData=e.imageData,this.uploadFromImage(e.imageData,i)):this.uploadFromImage(e,i)}},{key:"uploadFromImage",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.source=e,this.miplevel=i,this.textureUnit<=t.Context3D.MAX_TEXTURE&&this.activate()}},{key:"activate",value:function(){var e=this.source,i=this.miplevel;if(this.textureUnit>t.Context3D.MAX_TEXTURE?t.Context3D.GL.activeTexture(t.Context3D.GL["TEXTURE"+(t.Context3D.MAX_TEXTURE+1)]):t.Context3D.GL.activeTexture(t.Context3D.GL["TEXTURE"+this.textureUnit]),t.Context3D.GL.bindTexture(t.Context3D.GL.TEXTURE_2D,this._glTexture),t.Context3D.GL.pixelStorei(t.Context3D.GL.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),t.Context3D.GL.texParameteri(t.Context3D.GL.TEXTURE_2D,t.Context3D.GL.TEXTURE_WRAP_S,t.Context3D.GL.CLAMP_TO_EDGE),t.Context3D.GL.texParameteri(t.Context3D.GL.TEXTURE_2D,t.Context3D.GL.TEXTURE_WRAP_T,t.Context3D.GL.CLAMP_TO_EDGE),this.reverse,t.Context3D.GL.texParameteri(t.Context3D.GL.TEXTURE_2D,t.Context3D.GL.TEXTURE_MAG_FILTER,t.Context3D.GL.LINEAR),0==this._streamingLevels?t.Context3D.GL.texParameteri(t.Context3D.GL.TEXTURE_2D,t.Context3D.GL.TEXTURE_MIN_FILTER,t.Context3D.GL.LINEAR):(t.Context3D.GL.texParameteri(t.Context3D.GL.TEXTURE_2D,t.Context3D.GL.TEXTURE_MIN_FILTER,t.Context3D.GL.LINEAR_MIPMAP_LINEAR),t.Context3D.GL.generateMipmap(t.Context3D.GL.TEXTURE_2D)),t.Context3D.GL.texImage2D(t.Context3D.GL.TEXTURE_2D,i,t.Context3D.GL.RGBA,t.Context3D.GL.RGBA,t.Context3D.GL.UNSIGNED_BYTE,e),!t.Context3D.GL.isTexture(this._glTexture))throw new Error("Error:Texture is invalid")}},{key:"dispose",value:function(){e._bindingTexture=null,t.Context3D.GL.deleteTexture(this._glTexture),this._glTexture=null,this._streamingLevels=0}},{key:"name",get:function(){return this._name?this._name:"TEXTURE"+this.textureUnit.toString()},set:function(t){this._name=t}},{key:"textureUnit",get:function(){return this._textureUnit}}]),e}();e.__texUnit=0,t.Texture=e}(d||(d={})),function(t){var e=function(){function e(){Object(g.a)(this,e),this._glProgram=t.Context3D.GL.createProgram()}return Object(x.a)(e,[{key:"dispose",value:function(){this._vShader&&(t.Context3D.GL.detachShader(this._glProgram,this._vShader),t.Context3D.GL.deleteShader(this._vShader),this._vShader=null),this._fShader&&(t.Context3D.GL.detachShader(this._glProgram,this._fShader),t.Context3D.GL.deleteShader(this._fShader),this._fShader=null),t.Context3D.GL.deleteProgram(this._glProgram),this._glProgram=null}},{key:"upload",value:function(e,i){if(this._vShader=this.loadShader(e,t.Context3D.GL.VERTEX_SHADER),this._fShader=this.loadShader(i,t.Context3D.GL.FRAGMENT_SHADER),!this._fShader||!this._vShader)throw new Error("loadShader error");if(t.Context3D.GL.attachShader(this._glProgram,this._vShader),t.Context3D.GL.attachShader(this._glProgram,this._fShader),t.Context3D.GL.linkProgram(this._glProgram),!t.Context3D.GL.getProgramParameter(this._glProgram,t.Context3D.GL.LINK_STATUS))throw new Error(t.Context3D.GL.getProgramInfoLog(this._glProgram))}},{key:"loadShader",value:function(e,i){var a=t.Context3D.GL.createShader(i);if(t.Context3D.GL.shaderSource(a,e),t.Context3D.GL.compileShader(a),!t.Context3D.GL.getShaderParameter(a,t.Context3D.GL.COMPILE_STATUS))throw new Error(t.Context3D.GL.getShaderInfoLog(a));return a}},{key:"glProgram",get:function(){return this._glProgram}}]),e}();t.Program3D=e}(d||(d={})),function(t){t.VERSION="0.3.0";var e=function(e){function i(t){var e;return Object(g.a)(this,i),(e=Object(c.a)(this,Object(a.a)(i).call(this)))._context3D=null,e._canvas=t,e}return Object(f.a)(i,e),Object(x.a)(i,[{key:"requestContext3D",value:function(){if(this._canvas)return null!=this._context3D?this.onCreateSuccess():(this._canvas.addEventListener&&this._canvas.addEventListener("webglcontextcreationerror",this.onCreationError,!1),t.Context3D.GL=this.create3DContext(),t.Texture.__texUnit=0,null==t.Context3D.GL?this.onCreationError(null):(this._context3D=new t.Context3D,this.onCreateSuccess()))}},{key:"create3DContext",value:function(){for(var t=["webgl","experimental-webgl","webkit-3d","moz-webgl"],e=null,i=0;i<t.length;i++){try{e=this._canvas.getContext(t[i],{preserveDrawingBuffer:!0})}catch(a){}if(e)break}return e}},{key:"onCreationError",value:function(){null!=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)&&this._canvas.removeEventListener&&this._canvas.removeEventListener("webglcontextcreationerror",this.onCreationError,!1),this.dispatchEvent(new t.events.ErrorEvent)}},{key:"onCreateSuccess",value:function(){var e=new t.events.Event(t.events.Event.CONTEXT3D_CREATE);e.target=this,this.dispatchEvent(e)}},{key:"context3D",get:function(){return this._context3D}},{key:"stageWidth",get:function(){return this._canvas.width}},{key:"stageHeight",get:function(){return this._canvas.height}}]),i}(t.events.EventDispatcher);t.Stage3D=e}(d||(d={})),function(t){var e=function(){function e(){Object(g.a)(this,e),this._bendDisabled=!0,this._depthDisabled=!0,this._linkedProgram=null,this._vaCache={},this._vcCache={},this._vcMCache={},this._texCache={},t.Context3DBlendFactor.init()}return Object(x.a)(e,[{key:"configureBackBuffer",value:function(t,i,a){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.width=t,this.height=i,e.GL.viewport(0,0,t,i),this._depthDisabled=s,s?(this._clearBit=e.GL.COLOR_BUFFER_BIT|e.GL.DEPTH_BUFFER_BIT|e.GL.STENCIL_BUFFER_BIT,e.GL.enable(e.GL.DEPTH_TEST),e.GL.enable(e.GL.STENCIL_TEST)):(this._clearBit=e.GL.COLOR_BUFFER_BIT,e.GL.disable(e.GL.DEPTH_TEST),e.GL.disable(e.GL.STENCIL_TEST))}},{key:"createVertexBuffer",value:function(e,i){return new t.VertexBuffer3D(e,i)}},{key:"createIndexBuffer",value:function(e){return new t.IndexBuffer3D(e)}},{key:"createTexture",value:function(e,i,a,s){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5?arguments[5]:void 0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=new t.Texture(e,i,a,s,r,n);return o.name=h,o}},{key:"setRenderToTexture",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4];i?(this._clearBit=e.GL.COLOR_BUFFER_BIT|e.GL.DEPTH_BUFFER_BIT|e.GL.STENCIL_BUFFER_BIT,e.GL.enable(e.GL.DEPTH_TEST),e.GL.enable(e.GL.STENCIL_TEST)):(this._clearBit=e.GL.COLOR_BUFFER_BIT,e.GL.disable(e.GL.DEPTH_TEST),e.GL.disable(e.GL.STENCIL_TEST)),this._rttFramebuffer||(this._rttFramebuffer=e.GL.createFramebuffer()),e.GL.bindFramebuffer(e.GL.FRAMEBUFFER,this._rttFramebuffer),e.GL.framebufferTexture2D(e.GL.FRAMEBUFFER,e.GL.COLOR_ATTACHMENT0,e.GL.TEXTURE_2D,t.__getGLTexture(),0)}},{key:"setRenderToBackBuffer",value:function(){e.GL.bindFramebuffer(e.GL.FRAMEBUFFER,null)}},{key:"createProgram",value:function(){return new t.Program3D}},{key:"setVertexBufferAt",value:function(e,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=0;switch(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float4"){case t.Context3DVertexBufferFormat.FLOAT_4:s=4;break;case t.Context3DVertexBufferFormat.FLOAT_3:s=3;break;case t.Context3DVertexBufferFormat.FLOAT_2:s=2;break;case t.Context3DVertexBufferFormat.FLOAT_1:s=1;break;case t.Context3DVertexBufferFormat.BYTES_4:s=4}if(s<=0)throw new Error("vertexBuffer format error");var r="va"+e.toString();this._vaCache[r]={size:s,buffer:i.glBuffer,stride:4*i.data32PerVertex,offset:4*a},this._linkedProgram&&this.enableVA(r)}},{key:"setProgramConstantsFromVector",value:function(e,i,a){if(a.length>4)throw new Error("data length > 4");var s=(e==t.Context3DProgramType.VERTEX?"v":"f")+"c"+i.toString();this._vcCache[s]=a,this._linkedProgram&&this.enableVC(s)}},{key:"setProgramConstantsFromMatrix",value:function(e,i,a){arguments.length>3&&void 0!==arguments[3]&&arguments[3]&&a.transpose();var s=(e==t.Context3DProgramType.VERTEX?"v":"f")+"c"+i.toString();this._vcMCache[s]=a.rawData,this._linkedProgram&&this.enableVCM(s)}},{key:"setTextureAt",value:function(t,e){var i="fs"+t.toString();this._texCache[i]=e,this._linkedProgram&&this.enableTex(i)}},{key:"setProgram",value:function(t){if(null!=t&&t!=this._linkedProgram){var i;for(i in this._linkedProgram=t,e.GL.useProgram(t.glProgram),this._vaCache)this.enableVA(i);for(i in this._vcCache)this.enableVC(i);for(i in this._vcMCache)this.enableVCM(i);for(i in this._texCache)this.enableTex(i)}}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;arguments.length>6&&void 0!==arguments[6]&&arguments[6];e.GL.clearColor(t,i,a,s),e.GL.clearDepth(r),e.GL.clearStencil(h),e.GL.clear(this._clearBit)}},{key:"setCulling",value:function(i){switch(e.GL.frontFace(e.GL.CW),i){case t.Context3DTriangleFace.NONE:e.GL.disable(e.GL.CULL_FACE);break;case t.Context3DTriangleFace.BACK:e.GL.enable(e.GL.CULL_FACE),e.GL.cullFace(e.GL.BACK);break;case t.Context3DTriangleFace.FRONT:e.GL.enable(e.GL.CULL_FACE),e.GL.cullFace(e.GL.FRONT);break;case t.Context3DTriangleFace.FRONT_AND_BACK:e.GL.enable(e.GL.CULL_FACE),e.GL.cullFace(e.GL.FRONT_AND_BACK)}}},{key:"setDepthTest",value:function(i,a){switch(this._depthDisabled&&(e.GL.enable(e.GL.DEPTH_TEST),this._depthDisabled=!1),e.GL.depthMask(i),a){case t.Context3DCompareMode.LESS:e.GL.depthFunc(e.GL.LESS);break;case t.Context3DCompareMode.NEVER:e.GL.depthFunc(e.GL.NEVER);break;case t.Context3DCompareMode.EQUAL:e.GL.depthFunc(e.GL.EQUAL);break;case t.Context3DCompareMode.GREATER:e.GL.depthFunc(e.GL.GREATER);break;case t.Context3DCompareMode.NOT_EQUAL:e.GL.depthFunc(e.GL.NOTEQUAL);break;case t.Context3DCompareMode.ALWAYS:e.GL.depthFunc(e.GL.ALWAYS);break;case t.Context3DCompareMode.LESS_EQUAL:e.GL.depthFunc(e.GL.LEQUAL);break;case t.Context3DCompareMode.GREATER_EQUAL:e.GL.depthFunc(e.GL.GEQUAL)}}},{key:"setBlendFactors",value:function(t,i){this._bendDisabled&&(e.GL.enable(e.GL.BLEND),this._bendDisabled=!1),e.GL.blendFunc(t,i)}},{key:"drawTriangles",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;e.GL.bindBuffer(e.GL.ELEMENT_ARRAY_BUFFER,t.glBuffer),e.GL.drawElements(e.GL.TRIANGLES,a<0?t.numIndices:3*a,e.GL.UNSIGNED_SHORT,2*i)}},{key:"drawLines",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;e.GL.bindBuffer(e.GL.ELEMENT_ARRAY_BUFFER,t.glBuffer),e.GL.drawElements(e.GL.LINES,a<0?t.numIndices:2*a,e.GL.UNSIGNED_SHORT,2*i)}},{key:"drawPoints",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;e.GL.bindBuffer(e.GL.ELEMENT_ARRAY_BUFFER,t.glBuffer),e.GL.drawElements(e.GL.POINTS,a<0?t.numIndices:a,e.GL.UNSIGNED_SHORT,2*i)}},{key:"drawLineLoop",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;e.GL.bindBuffer(e.GL.ELEMENT_ARRAY_BUFFER,t.glBuffer),e.GL.drawElements(e.GL.LINE_LOOP,a<0?t.numIndices:a,e.GL.UNSIGNED_SHORT,2*i)}},{key:"drawLineStrip",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;e.GL.bindBuffer(e.GL.ELEMENT_ARRAY_BUFFER,t.glBuffer),e.GL.drawElements(e.GL.LINE_STRIP,a<0?t.numIndices:a,e.GL.UNSIGNED_SHORT,2*i)}},{key:"drawTriangleStrip",value:function(t){e.GL.bindBuffer(e.GL.ELEMENT_ARRAY_BUFFER,t.glBuffer),e.GL.drawElements(e.GL.TRIANGLE_STRIP,t.numIndices,e.GL.UNSIGNED_SHORT,0)}},{key:"drawTriangleFan",value:function(t){e.GL.bindBuffer(e.GL.ELEMENT_ARRAY_BUFFER,t.glBuffer),e.GL.drawElements(e.GL.TRIANGLE_FAN,t.numIndices,e.GL.UNSIGNED_SHORT,0)}},{key:"drawToBitmapData",value:function(t){}},{key:"present",value:function(){}},{key:"enableVA",value:function(t){var i=e.GL.getAttribLocation(this._linkedProgram.glProgram,t);if(i<0)throw new Error("Fail to get the storage location of "+t);var a=this._vaCache[t];e.GL.bindBuffer(e.GL.ARRAY_BUFFER,a.buffer),e.GL.vertexAttribPointer(i,a.size,e.GL.FLOAT,!1,a.stride,a.offset),e.GL.enableVertexAttribArray(i)}},{key:"enableVC",value:function(t){var i=e.GL.getUniformLocation(this._linkedProgram.glProgram,t);if(!i)throw new Error("Fail to get uniform "+t);var a=this._vcCache[t];e.GL["uniform"+a.length+"fv"](i,a)}},{key:"enableVCM",value:function(t){var i=e.GL.getUniformLocation(this._linkedProgram.glProgram,t);if(!i)throw new Error("Fail to get uniform "+t);e.GL.uniformMatrix4fv(i,!1,this._vcMCache[t])}},{key:"enableTex",value:function(t){var i=this._texCache[t];i.textureUnit>e.MAX_TEXTURE?i.activate():e.GL.activeTexture(e.GL["TEXTURE"+i.textureUnit]);var a=e.GL.getUniformLocation(this._linkedProgram.glProgram,t);if(!a)throw new Error("Fail to get tex "+t);i.textureUnit>e.MAX_TEXTURE?e.GL.uniform1i(a,e.MAX_TEXTURE+1):e.GL.uniform1i(a,i.textureUnit)}},{key:"dispose",value:function(){this._rttFramebuffer&&e.GL.deleteFramebuffer(this._rttFramebuffer)}}]),e}();e.MAX_TEXTURE=12,t.Context3D=e}(d||(d={})),function(t){var e=function t(){Object(g.a)(this,t)};e.VERTEX="vertex",e.FRAGMENT="fragment",t.Context3DProgramType=e}(d||(d={})),(d||(d={})).StageQuality=function t(){Object(g.a)(this,t)},function(t){var e=function(){function t(){Object(g.a)(this,t)}return Object(x.a)(t,[{key:"CalculateFinalFlatArray",value:function(){}}]),t}();t.AdjustColor=e}(d||(d={})),function(t){var e=function t(){Object(g.a)(this,t)};e.ADD="add",e.ALPHA="alpha",e.DARKEN="darken",e.DIFFERENCE="difference",e.ERASE="erase",e.HARDLIGHT="hardlight",e.INVERT="invert",e.LAYER="layer",e.LIGHTEN="lighten",e.MULTIPLY="multiply",e.NORMAL="normal",e.OVERLAY="overlay",e.SCREEN="screen",e.SHADER="shader",e.SUBTRACT="subtract";var i=new function(){this.ALPHA=8,this.BLUE=4,this.GREEN=2,this.RED=1};var a=function(){function t(){Object(g.a)(this,t),this.seed=1}return Object(x.a)(t,[{key:"next",value:function(){return this.gen()/2147483647}},{key:"nextRange",value:function(t,e){return t+(e-t)*this.next()}},{key:"gen",value:function(){return this.seed=16807*this.seed%2147483647}}]),t}(),s=function(){function t(e){Object(g.a)(this,t),this.rand=e,this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}return Object(x.a)(t,[{key:"setSeed",value:function(t){this.p=[],this.rand.seed=t;for(var e=0;e<256;e++)this.p[e]=Math.floor(this.rand.nextRange(0,255));this.perm=[];for(e=0;e<512;e++)this.perm[e]=this.p[255&e]}},{key:"dot",value:function(t,e,i){return t[0]*e+t[1]*i}},{key:"noise",value:function(t,e){var i,a,s=(t+e)*(.5*(Math.sqrt(3)-1)),r=Math.floor(t+s),h=Math.floor(e+s),n=(3-Math.sqrt(3))/6,o=(r+h)*n,l=t-(r-o),c=e-(h-o);l>c?(i=1,a=0):(i=0,a=1);var m=l-i+n,u=c-a+n,d=l-1+2*n,f=c-1+2*n,g=255&r,x=255&h,_=this.perm[g+this.perm[x]]%12,p=this.perm[g+i+this.perm[x+a]]%12,M=this.perm[g+1+this.perm[x+1]]%12,D=.5-l*l-c*c,v=.5-m*m-u*u,T=.5-d*d-f*f;return 70*((D<0?0:(D*=D)*D*this.dot(this.grad3[_],l,c))+(v<0?0:(v*=v)*v*this.dot(this.grad3[p],m,u))+(T<0?0:(T*=T)*T*this.dot(this.grad3[M],d,f)))}}]),t}(),r=function(){function t(){Object(g.a)(this,t),this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}return Object(x.a)(t,[{key:"identity",value:function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}},{key:"scale",value:function(t,e){1!==t&&(this.a*=t,this.c*=t,this.tx*=t),1!==e&&(this.b*=e,this.d*=e,this.ty*=e)}},{key:"translate",value:function(t,e){this.tx+=t,this.ty+=e}}]),t}();t.Matrix=r;var h=function(){function h(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null);Object(g.a)(this,h),this.width=Math.floor(t),this.height=Math.floor(e),this.rect=new p(0,0,this.width,this.height),this.transparent=i||!1,this.canvas=a||document.createElement("canvas"),this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.canvas.setAttribute("width",this.width.toString()),this.canvas.setAttribute("height",this.height.toString()),this.drawingCanvas=document.createElement("canvas"),this.drawingContext=this.drawingCanvas.getContext("2d",{willReadFrequently:!0}),i&&(this.context.fillStyle="rgba(0,0,0,0)",this.context.fillRect(0,0,this.width,this.height),this.drawingContext.fillStyle="rgba(0,0,0,0)",this.drawingContext.fillRect(0,0,this.width,this.height)),this.imageData=this.context.getImageData(0,0,this.width,this.height)}return Object(x.a)(h,[{key:"setPixel32",value:function(t,e,i){var a=4*(Math.floor(t)+Math.floor(e)*Math.floor(this.width)),s=this.imageData.data;s[a+0]=i>>16&255,s[a+1]=i>>8&255,s[a+2]=i>>0&255,s[a+3]=i>>24&255}},{key:"getPixel",value:function(t,e){var i=4*(Math.floor(t)+Math.floor(e)*Math.floor(this.width)),a=this.imageData.data;return{r:a[i+0],g:a[i+1],b:a[i+2],a:a[i+3]}}},{key:"getPixel32",value:function(t,e){var i=4*(Math.floor(t)+Math.floor(e)*Math.floor(this.width)),a=this.imageData.data,s=a[i+0],r=a[i+1],h=a[i+2];return a[i+3]<<24|s<<16|r<<8|h}},{key:"clear",value:function(t){t=t||this.rect,this.context.clearRect(t.x,t.y,t.width,t.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height)}},{key:"clone",value:function(){this.context.putImageData(this.imageData,0,0);var t=new h(this.width,this.height,this.transparent);return t.imageData=this.context.getImageData(0,0,this.width,this.height),t}},{key:"copyCanvas",value:function(t,i,a,s){this.context.putImageData(this.imageData,0,0);var r=this.canvas.width-i.width-a.x,h=this.canvas.height-i.height-a.y,n=r<0?i.width+(this.canvas.width-i.width-a.x):i.width,o=h<0?i.height+(this.canvas.height-i.height-a.y):i.height;if(s&&s!=e.NORMAL)for(var l,c,m=t.getContext("2d").getImageData(i.x,i.y,n,o).data,u=this.imageData.data,d=0;d<o;d++)for(var f=0;f<n;f++)switch(l=4*(f+d*n),c=4*(f+a.x+(d+a.y)*this.width),s){case e.ADD:u[c]=Math.min(u[c]+m[l],255),u[c+1]=Math.min(u[c+1]+m[l+1],255),u[c+2]=Math.min(u[c+2]+m[l+2],255);break;case e.SUBTRACT:u[c]=Math.max(m[l]-u[c],0),u[c+1]=Math.max(m[l+1]-u[c+1],0),u[c+2]=Math.max(m[l+2]-u[c+2],0);break;case e.INVERT:u[c]=255-m[l],u[c+1]=255-m[l+1],u[c+2]=255-m[l+1];break;case e.MULTIPLY:u[c]=Math.floor(m[l]*u[c]/255),u[c+1]=Math.floor(m[l+1]*u[c+1]/255),u[c+2]=Math.floor(m[l+2]*u[c+2]/255);break;case e.LIGHTEN:m[l]>u[c]&&(u[c]=m[l]),m[l+1]>u[c+1]&&(u[c+1]=m[l+1]),m[l+2]>u[c+2]&&(u[c+2]=m[l+2]);break;case e.DARKEN:m[l]<u[c]&&(u[c]=m[l]),m[l+1]<u[c+1]&&(u[c+1]=m[l+1]),m[l+2]<u[c+2]&&(u[c+2]=m[l+2]);break;case e.DIFFERENCE:u[c]=Math.abs(m[l]-u[c]),u[c+1]=Math.abs(m[l+1]-u[c+1]),u[c+2]=Math.abs(m[l+2]-u[c+2]);break;case e.SCREEN:u[c]=255-((255-u[c])*(255-m[l])>>8),u[c+1]=255-((255-u[c+1])*(255-m[l+1])>>8),u[c+2]=255-((255-u[c+2])*(255-m[l+2])>>8);break;case e.OVERLAY:m[l]<128?u[c]=u[c]*m[l]*.00784313725:u[c]=255-(255-u[c])*(255-m[l])*.00784313725,m[l+1]<128?u[c+1]=u[c+1]*m[l+1]*.00784313725:u[c+1]=255-(255-u[c+1])*(255-m[l+1])*.00784313725,m[l+2]<128?u[c+2]=u[c+2]*m[l+2]*.00784313725:u[c+2]=255-(255-u[c+2])*(255-m[l+2])*.00784313725;break;case e.HARDLIGHT:u[c]<128?u[c]=u[c]*m[l]*.00784313725:u[c]=255-(255-u[c])*(255-m[l])*.00784313725,u[c+1]<128?u[c+1]=u[c+1]*m[l+1]*.00784313725:u[c+1]=255-(255-u[c+1])*(255-m[l+1])*.00784313725,u[c+2]<128?u[c+2]=u[c+2]*m[l+2]*.00784313725:u[c+2]=255-(255-u[c+2])*(255-m[l+2])*.00784313725}else this.context.drawImage(t,i.x,i.y,n,o,a.x,a.y,n,o),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);this.context.putImageData(this.imageData,0,0)}},{key:"copyPixels",value:function(t,i,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.NORMAL;this.copyCanvas(t.canvas,i,a,s)}},{key:"draw",value:function(t,e,i,a,s,n){var o=t instanceof h?t.canvas:t,l=e||new r,c=s||new p(0,0,t.width,t.height);this.context.transform(l.a,l.b,l.c,l.d,l.tx,l.ty),this.context.drawImage(o,c.x,c.y,c.width,c.height,0,0,c.width,c.height),this.imageData=this.context.getImageData(0,0,this.width,this.height)}},{key:"fillRect",value:function(t,e){this.context.putImageData(this.imageData,0,0);var i,a={r:(16711680&(i=e))>>16,g:(65280&i)>>8,b:255&i};this.context.fillStyle="rgb("+a.r+","+a.g+","+a.b+")",this.context.fillRect(t.x,t.y,t.width,t.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height)}},{key:"perlinNoise",value:function(t,e,r,h,n){this.rand=this.rand||new a,this.rand.seed=r;var o=i.RED,l=i.GREEN,c=i.BLUE;h=h||7,n=n||!1;var m,u,d,f,g=this.imageData.data,x=0;h&o&&(this.simplexR=this.simplexR||new s(this.rand),this.simplexR.setSeed(r),x++),h&l&&(this.simplexG=this.simplexG||new s(this.rand),this.simplexG.setSeed(r+1),x++),h&c&&(this.simplexB=this.simplexB||new s(this.rand),this.simplexB.setSeed(r+2),x++);for(var _=0;_<this.height;_++)for(var p=0;p<this.width;p++){if(m=4*(p+_*this.width),u=h&o?Math.floor(.5*(this.simplexR.noise(p/t,_/e)+1)*255):0,d=h&l?Math.floor(.5*(this.simplexG.noise(p/t,_/e)+1)*255):0,f=h&c?Math.floor(.5*(this.simplexB.noise(p/t,_/e)+1)*255):0,n)u=d=f=(u+d+f)/x;g[m+0]=u,g[m+1]=d,g[m+2]=f}this.context.putImageData(this.imageData,0,0)}},{key:"getColorBoundsRect",value:function(t,e,i){return new p(0,0,this.width,this.height)}},{key:"drawWithQuality",value:function(t,e,i,a,s,r,h){this.draw(t,e,i,a,s,r)}},{key:"lock",value:function(){}},{key:"unlock",value:function(){}},{key:"dispose",value:function(){console.log("dispose")}},{key:"gotoAndStop",value:function(t){}},{key:"getPixels",value:function(e){var i=new t.ByteArray;i.length=Math.floor(e.width)*Math.floor(e.height)*4;for(var a=0;a<e.height;++a)for(var s=0;s<e.width;++s){var r=this.getPixel(e.x+s,e.y+a);i.writeByte(r.a),i.writeByte(r.r),i.writeByte(r.g),i.writeByte(r.b)}return i.position=0,i}},{key:"setPixels",value:function(t,e){e.position=0;for(var i=0;i<t.height;++i)for(var a=0;a<t.width;++a){e.readUnsignedByte();var s=e.readUnsignedByte(),r=e.readUnsignedByte(),h=e.readUnsignedByte();this.setPixel32(t.x+a,t.y+i,(n={r:s,g:r,b:h}).r<<16|n.g<<8|n.b)}var n}}],[{key:"fromImageElement",value:function(t){var e=new h(t.width,t.height);return e.draw(t),e}}]),h}();t.BitmapData=h}(d||(d={})),function(t){var e=function(t){function e(){var t;return Object(g.a)(this,e),(t=Object(c.a)(this,Object(a.a)(e).apply(this,arguments))).position=0,t}return Object(f.a)(e,t),Object(x.a)(e,[{key:"readUnsignedByte",value:function(){return this[this.position++]}},{key:"writeByte",value:function(t){this.position>=this.length||function(t,e,i,a,s){if(!h(t,e,i,a||t)&&s)throw new Error("failed to set property")}(Object(a.a)(e.prototype),this.position++,t,this,!0)}},{key:"length",get:function(){return m(Object(a.a)(e.prototype),"length",this)},set:function(t){if(t<this.length)m(Object(a.a)(e.prototype),"splice",this).call(this,t);else for(var i=m(Object(a.a)(e.prototype),"length",this);i<t;++i)m(Object(a.a)(e.prototype),"push",this).call(this,0)}}]),e}(l(Array));t.ByteArray=e}(d||(d={})),(d||(d={})).ColorMatrixFilter=function t(){Object(g.a)(this,t)},(d||(d={})).DropShadowFilter=function t(e,i,a,s,r,h,n,o){Object(g.a)(this,t)},(d||(d={})).GlowFilter=function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],Object(g.a)(this,t)},function(t){var e=function(){function t(){Object(g.a)(this,t),this.texture=null,this.transformMatrix=new Array,this.colorMatrix=new Array,this.vartex=new Array,this.coords=new Array,this.orgScale=1,this.orgX=0,this.orgY=0,this.transformMatrix.push(0,0,0,1),this.colorMatrix.push(1,1,1,1),this.vartex.push(0,0,_.UTItemManager.IMAGE_WIDTH,0,0,_.UTItemManager.IMAGE_HEIGHT,_.UTItemManager.IMAGE_WIDTH,_.UTItemManager.IMAGE_HEIGHT),this.coords.push(0,1,1,1,0,0,1,0)}return Object(x.a)(t,[{key:"setRectangle",value:function(t,e){this.orgScale=e,this.vartex[0]=this.vartex[4]=.5*t.width*this.orgScale,this.vartex[1]=this.vartex[3]=.5*-t.height*this.orgScale,this.vartex[2]=this.vartex[6]=.5*-t.width*this.orgScale,this.vartex[5]=this.vartex[7]=.5*t.height*this.orgScale,this.coords[0]=this.coords[4]=(t.x+t.width)/_.UTItemManager.IMAGE_WIDTH,this.coords[1]=this.coords[3]=t.y/_.UTItemManager.IMAGE_HEIGHT,this.coords[2]=this.coords[6]=t.x/_.UTItemManager.IMAGE_WIDTH,this.coords[5]=this.coords[7]=(t.y+t.height)/_.UTItemManager.IMAGE_HEIGHT,this.bVartex.uploadFromVector(this.vartex,0,4),this.bCoords.uploadFromVector(this.coords,0,4),this.x=(t.x+.5*t.width)*this.orgScale,this.y=(t.y+.5*t.height)*this.orgScale,this.scale=1,this.angle=0,this.width=t.width*this.orgScale,this.height=t.height*this.orgScale}},{key:"setRectangleType",value:function(t,e,i,a){this.orgScale=a,this.vartex[0]=this.vartex[4]=.5*t.width*this.orgScale,this.vartex[1]=this.vartex[3]=.5*-t.height*this.orgScale,this.vartex[2]=this.vartex[6]=.5*-t.width*this.orgScale,this.vartex[5]=this.vartex[7]=.5*t.height*this.orgScale,this.coords[0]=this.coords[4]=(e+t.width)/_.AppVals.TEXTURE_WIDTH,this.coords[1]=this.coords[3]=i/_.AppVals.TEXTURE_WIDTH,this.coords[2]=this.coords[6]=e/_.AppVals.TEXTURE_WIDTH,this.coords[5]=this.coords[7]=(i+t.height)/_.AppVals.TEXTURE_WIDTH,this.x=(t.x+.5*t.width)*this.orgScale,this.y=(t.y+.5*t.height)*this.orgScale,this.bVartex.uploadFromVector(this.vartex,0,4),this.bCoords.uploadFromVector(this.coords,0,4),this.scale=1,this.angle=0,this.width=t.width*this.orgScale,this.height=t.height*this.orgScale}},{key:"setup",value:function(t,e,i){this.ctx=t,this.indicies=e,this.projectionMatrix=i,this.bVartex=this.ctx.createVertexBuffer(4,2),this.bCoords=this.ctx.createVertexBuffer(4,2),this.bVartex.uploadFromVector(this.vartex,0,4),this.bCoords.uploadFromVector(this.coords,0,4)}},{key:"setTexture",value:function(t){this.texture=t}},{key:"dispose",value:function(){}},{key:"draw",value:function(){this.transformMatrix[0]=this.x,this.transformMatrix[1]=this.y,this.transformMatrix[2]=this.angle,this.transformMatrix[3]=this.scale,_.Stage3DHelper.drawTriangles(this.ctx,this.indicies,this.projectionMatrix,this.texture,this.bVartex,this.bCoords,this.transformMatrix,this.colorMatrix)}}]),t}();t.LayoutObject=e}(d||(d={})),function(t){var e=function(t){function e(){var t;return Object(g.a)(this,e),(t=Object(c.a)(this,Object(a.a)(e).call(this))).filters=[],t}return Object(f.a)(e,t),e}(t.DisplayObject);t.MovieClip=e}(d||(d={})),function(t){var e=function(){function t(e){Object(g.a)(this,t),this.width=e.width,this.height=e.height,this.context=e.getContext("2d"),this.context.fillStyle="rgba(255, 255, 255, 0)"}return Object(x.a)(t,[{key:"beginFill",value:function(t,e){}},{key:"endFill",value:function(){this.context.closePath()}},{key:"drawRoundRect",value:function(t,e,i,a,s,r){}},{key:"drawTriangles",value:function(t){}},{key:"drawRect",value:function(t,e,i,a){}},{key:"clear",value:function(){this.context.fillRect(0,0,this.width,this.height)}}]),t}();t.Graphics=e;var i=function(t){function i(){var t;return Object(g.a)(this,i),(t=Object(c.a)(this,Object(a.a)(i).call(this))).graphics=new e(t.canvas),t}return Object(f.a)(i,t),i}(t.DisplayObject);t.Shape=i}(d||(d={})),(d||(d={})).TextField=function t(){Object(g.a)(this,t)},function(t){var e=function t(){Object(g.a)(this,t)};e.CENTER="center",e.LEFT="left",e.NONE="none",e.RIGHT="right",t.TextFieldAutoSize=e}(d||(d={})),function(t){var e=function(){function t(){Object(g.a)(this,t)}return Object(x.a)(t,null,[{key:"getClassName",value:function(t,e){return"jp.uniqlo.utlab.app.views.Ico"+(e?"Remix":"SRC")+"_"+(t<10?"0"+String(t):String(t))}},{key:"getViewID",value:function(t){return 0}}]),t}();e.VIEW_SRC_PAINT=1,e.VIEW_SRC_TYPO=2,e.VIEW_SRC_PHOTO=3,e.VIEW_SRC_STAMP=4,e.VIEW_REMIX_INK=1,e.VIEW_REMIX_GLITCH=2,e.VIEW_REMIX_MOSIC=3,e.VIEW_REMIX_LAYOUT=4,e.VIEW_REMIX_MOMA01=5,e.VIEW_REMIX_MOMA02=6,t.AppStoryDefs=e}(_||(_={})),function(t){var e=function t(){Object(g.a)(this,t)};e.TEXTURE_WIDTH=1024,e.GLOBAL_SCALE=1,e.STATUSBAR_HEIGHT=0,e.REMIX_MOVE_RIMIT=!1,e.REMIX_MOVE_RIMIT_RATE=.3,e.REMIX_PERTICLE_SPEED=1,e.ERASE_MODE="eraser_selected",e.THICK_BRUSH_MODE="thick_brush_selected",e.THIN_BRUSH_MODE="thin_brush_selected",e.SELECTED_TOOL_MODE=e.THICK_BRUSH_MODE,e.STICKER_SET_THRESHOLD=5,t.AppVals=e}(_||(_={})),function(t){var e=function(){function t(){Object(g.a)(this,t)}return Object(x.a)(t,null,[{key:"loadCache",value:function(t,e,i,a,s){return null}}]),t}();e.LIST_SAVE_DIR="com.uniqlo.utme",e.TEMP_DIR="com.uniqlo.utme",e.assetBasePath="assets/items/",e.androidPath=null,t.FileManager=e}(_||(_={})),function(t){var e=function(){function e(){Object(g.a)(this,e)}return Object(x.a)(e,null,[{key:"saveFoward",value:function(){for(var t=this.viewTree.length-3;t>-1;t--)this.viewTree[t].save(t)}},{key:"getActiveSrcType",value:function(){for(var e=this.viewTree.length-1;e>-1;e--)switch(t.AppStoryDefs.getViewID(this.viewTree[e])){case t.AppStoryDefs.VIEW_SRC_PAINT:case t.AppStoryDefs.VIEW_SRC_TYPO:case t.AppStoryDefs.VIEW_SRC_STAMP:case t.AppStoryDefs.VIEW_SRC_PHOTO:return t.AppStoryDefs.getViewID(this.viewTree[e])}return 0}},{key:"getActiveSrcView",value:function(){for(var e=this.viewTree.length-1;e>-1;e--)switch(t.AppStoryDefs.getViewID(this.viewTree[e])){case t.AppStoryDefs.VIEW_SRC_PAINT:case t.AppStoryDefs.VIEW_SRC_TYPO:case t.AppStoryDefs.VIEW_SRC_STAMP:case t.AppStoryDefs.VIEW_SRC_PHOTO:return this.viewTree[e]}return null}},{key:"getActiveView",value:function(){return this.viewTree[this.viewTree.length-1]}}]),e}();e.viewTree=new Array,t.UTCreateMain=e}(_||(_={})),function(t){var e=function(){function e(){Object(g.a)(this,e)}return Object(x.a)(e,null,[{key:"createPrintedImage",value:function(e,i,a,s,r,h){var n,o,l,c,m=new t.Matrix;if(null!=i)if(s?(n=(o=e.width*t.UTItemManager.outWidth)*t.UTItemManager.IMAGE_HEIGHT/t.UTItemManager.IMAGE_WIDTH,l=e.width*t.UTItemManager.outCenter.x-.5*o,c=e.width*t.UTItemManager.outCenter.y-.5*n):(n=(o=e.width*t.UTItemManager.wkWidth)*t.UTItemManager.IMAGE_HEIGHT/t.UTItemManager.IMAGE_WIDTH,l=e.width*t.UTItemManager.wkCenter.x-.5*o,c=e.width*t.UTItemManager.wkCenter.y-.5*n),a&&0+(null!=i?1:0)>1){var u=new d.BitmapData(o,n,!1,16777215);null!=i&&(m.identity(),m.scale(o/i.width,n/i.height),u.draw(i,m,null,null,null,!0)),m.identity(),m.translate(l,c),e.draw(u,m,null,t.BlendMode.MULTIPLY,null,!0),u.dispose()}else null!=i&&(m.identity(),m.scale(o/i.width,n/i.height),m.translate(l,c),e.draw(i,m,null,a?t.BlendMode.MULTIPLY:null,null,!0))}}]),e}();t.UTImageBuilder=e}(_||(_={})),function(t){var e=function(){function t(){Object(g.a)(this,t)}return Object(x.a)(t,null,[{key:"getZoomRect",value:function(e,i,a){var s=new p;if(e){var r=i*t.wkNearScale;s.height=s.width=r/t.wkWidth,s.x=.5*i-s.width*t.wkCenter.x,s.y=.5*(a-29)-s.height*t.wkCenter.y}else s.height=s.width=i*t.wkFarScale,s.x=.5*(i-s.width),s.y=.5*(a-s.width);return s}},{key:"getZoomRectMotion",value:function(t,e,i){var a=this.getZoomRect(!1,e,i),s=this.getZoomRect(!0,e,i);return a.x=a.x+(s.x-a.x)*t,a.y=a.y+(s.y-a.y)*t,a.width=a.width+(s.width-a.width)*t,a.height=a.height+(s.height-a.height)*t,a}}]),t}();e.IMAGE_WIDTH=1024,e.IMAGE_HEIGHT=1152,e.wkMultiply=!1,e.wkWidth=1,e.wkCenter={x:.5,y:.5},e.outWidth=2048,e.outCenter={x:0,y:0},e.wkFarScale=1,e.wkNearScale=.95,t.UTItemManager=e}(_||(_={})),function(t){var e=function(){function e(t){Object(g.a)(this,e),this.ThumbnailScale=4,this.EdgeWidth=4,this.EdgeColor=16777215}return Object(x.a)(e,null,[{key:"getActive",value:function(){return this.StampLayerList[t.AppVals.HISTORY]}},{key:"getActiveLayerTop",value:function(){return null!=this.getActive()&&e.LayerTopMost}}]),e}();e.StampLayerList=[null,null,null],e.LayerTopMost=!1,t.UTStampManager=e}(_||(_={})),function(t){var e=function(){function e(){Object(g.a)(this,e)}return Object(x.a)(e,null,[{key:"clampi",value:function(t,e,i){return t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),t<e?e:t>i?i:t}},{key:"clampf",value:function(t,e,i){return t<e?e:t>i?i:t}},{key:"blrImage",value:function(t,e){var i,a,s,r,h,n;i=t.width,a=t.height;var o=2*e,l=(o-1)/2,c=new Array;c.length=o;var m=0;for(s=0;s<o;s++)c[s]=Math.sin(Math.PI*(s+1)/(o+1)),m+=c[s];for(s=0;s<o;s++)c[s]=c[s]/m;var u=new Array;u.length=i*a*3;var f=new d.ByteArray;f.length=i*a*4;var g,x,_,p=t.getPixels(t.rect);for(r=0;r<a;r++)for(s=0;s<i;s++){for(g=0,x=0,_=0,n=0;n<o;n++)g+=p[4*(r*i+(h=this.clampi(s+n-l,0,i-1)))+1]*c[n],x+=p[4*(r*i+h)+2]*c[n],_+=p[4*(r*i+h)+3]*c[n];u[3*(s*a+r)]=g,u[3*(s*a+r)+1]=x,u[3*(s*a+r)+2]=_}for(r=0;r<a;r++)for(s=0;s<i;s++){for(g=0,x=0,_=0,n=0;n<o;n++)g+=u[3*(s*a+(h=this.clampi(r+n-l,0,a-1)))]*c[n],x+=u[3*(s*a+h)+1]*c[n],_+=u[3*(s*a+h)+2]*c[n];f[4*(r*i+s)]=255,f[4*(r*i+s)+1]=g,f[4*(r*i+s)+2]=x,f[4*(r*i+s)+3]=_}t.setPixels(t.rect,f),u.length=0,u=null,f.length=0,f=null,p.length=0,p=null,c.length=0,c=null}},{key:"getByIndex",value:function(e){var i=new t.Vec4;switch(e){case 0:i.x=-1,i.y=-1;break;case 1:i.x=0,i.y=-1;break;case 2:i.x=1,i.y=-1;break;case 3:i.x=-1,i.y=0;break;case 4:i.x=1,i.y=0;break;case 5:i.x=-1,i.y=1;break;case 6:i.x=0,i.y=1;break;case 7:i.x=1,i.y=1}return i}},{key:"calcOpticalFlow",value:function(t){var e,i,a,s,r,h;this.blrImage(t,2),e=t.width,i=t.height;var n,o=t.getPixels(t.rect),l=new d.ByteArray;l.length=e*i*4;var c=new Array;for(c.length=8,s=0;s<i;s++)for(a=0;a<e;a++){for(o[(r=4*(s*e+a))+1],o[r+2],o[r+3],0,0,0,255,h=0;h<8;h++)n=this.getByIndex(h),r=4*(this.clampi(s+n.y,0,i-1)*e+this.clampi(a+n.x,0,e-1)),c[h]=.298912*o[r]+.586611*o[r+1]+.114478*o[r+2];n.y=(c[5]+c[6]+c[7])/3-(c[0]+c[1]+c[2])/3,n.x=(c[2]+c[4]+c[7])/3-(c[0]+c[3]+c[5])/3,n.rotate2d(90),n.normalize(),n.multiply(10),l[4*(s*e+a)]=0,l[4*(s*e+a)+1]=this.clampi(n.x+127,0,255),l[4*(s*e+a)+2]=this.clampi(n.y+127,0,255),l[4*(s*e+a)+3]=0}t.setPixels(t.rect,l),this.blrImage(t,5)}},{key:"blrByteArray3",value:function(t,e,i,a){var s,r,h,n,o,l;s=e,r=i;var c=2*a,m=(c-1)/2,u=new Array;u.length=c;var d=0;for(h=0;h<c;h++)u[h]=Math.sin(Math.PI*(h+1)/(c+1)),d+=u[h];for(h=0;h<c;h++)u[h]=u[h]/d;var f,g,x,_=new Array;for(_.length=s*r*3,n=0;n<r;n++)for(h=0;h<s;h++){for(f=0,g=0,x=0,l=0;l<c;l++)f+=t[3*(n*s+(o=this.clampi(h+l-m,0,s-1)))+0]*u[l],g+=t[3*(n*s+o)+1]*u[l],x+=t[3*(n*s+o)+2]*u[l];_[3*(h*r+n)]=f,_[3*(h*r+n)+1]=g,_[3*(h*r+n)+2]=x}for(n=0;n<r;n++)for(h=0;h<s;h++){for(f=0,g=0,x=0,l=0;l<c;l++)f+=_[3*(h*r+(o=this.clampi(n+l-m,0,r-1)))]*u[l],g+=_[3*(h*r+o)+1]*u[l],x+=_[3*(h*r+o)+2]*u[l];t[3*(n*s+h)]=f,t[3*(n*s+h)+1]=g,t[3*(n*s+h)+2]=x}_.length=0,_=null,u.length=0,u=null}},{key:"blrByteArray2",value:function(t,e,i,a){var s,r,h,n,o,l;s=e,r=i;var c=2*a,m=(c-1)/2,u=new Array;u.length=c;var d=0;for(h=0;h<c;h++)u[h]=Math.sin(Math.PI*(h+1)/(c+1)),d+=u[h];for(h=0;h<c;h++)u[h]=u[h]/d;var f,g,x=new Array;for(x.length=s*r*2,n=0;n<r;n++)for(h=0;h<s;h++){for(f=0,g=0,l=0;l<c;l++)f+=t[2*(n*s+(o=this.clampi(h+l-m,0,s-1)))]*u[l],g+=t[2*(n*s+o)+1]*u[l];x[2*(h*r+n)]=f,x[2*(h*r+n)+1]=g}for(n=0;n<r;n++)for(h=0;h<s;h++){for(f=0,g=0,l=0;l<c;l++)f+=x[2*(h*r+(o=this.clampi(n+l-m,0,r-1)))]*u[l],g+=x[2*(h*r+o)+1]*u[l];t[2*(n*s+h)]=f,t[2*(n*s+h)+1]=g}x.length=0,x=null,u.length=0,u=null}},{key:"blrByteArray1",value:function(t,e,i,a){var s,r,h,n,o,l;s=e,r=i;var c=2*a,m=(c-1)/2,u=new Array;u.length=c;var d=0;for(h=0;h<c;h++)u[h]=Math.sin(Math.PI*(h+1)/(c+1)),d+=u[h];for(h=0;h<c;h++)u[h]=u[h]/d;var f,g=new Array;for(g.length=s*r*2,n=0;n<r;n++)for(h=0;h<s;h++){for(f=0,l=0;l<c;l++)o=this.clampi(h+l-m,0,s-1),f+=t[Math.floor(n*s+o)]*u[l];g[Math.floor(h*r+n)]=f}for(n=0;n<r;n++)for(h=0;h<s;h++){for(f=0,l=0;l<c;l++)o=this.clampi(n+l-m,0,r-1),f+=g[Math.floor(h*r+o)]*u[l];t[Math.floor(n*s+h)]=f}g.length=0,g=null,u.length=0,u=null}},{key:"calcOpticalFlowByteArray",value:function(e){var i,a,s,r,h,n;i=Math.floor(e.width),a=Math.floor(e.height);var o=e.getPixels(e.rect),l=new d.ByteArray;for(l.length=i*a,r=0;r<a;r++)for(s=0;s<i;s++)h=4*(r*i+s),l[r*i+s]=.298912*o[h+1]+.586611*o[h+2]+.114478*o[h+3];this.blrByteArray1(l,i,a,2);var c=new d.ByteArray;c.length=i*a*2;var m=new t.Vec4,u=new Array;for(u.length=8,r=0;r<a;r++)for(s=0;s<i;s++){for(n=0;n<8;n++){switch(n){case 0:m.x=-1,m.y=-1;break;case 1:m.x=0,m.y=-1;break;case 2:m.x=1,m.y=-1;break;case 3:m.x=-1,m.y=0;break;case 4:m.x=1,m.y=0;break;case 5:m.x=-1,m.y=1;break;case 6:m.x=0,m.y=1;break;case 7:m.x=1,m.y=1}h=this.clampi(r+m.y,0,a-1)*i+this.clampi(s+m.x,0,i-1),u[n]=l[h]}m.y=(u[5]+u[6]+u[7])/3-(u[0]+u[1]+u[2])/3,m.x=(u[2]+u[4]+u[7])/3-(u[0]+u[3]+u[5])/3,m.length()>0?m.rotate2d(90):(m.x=Math.random()-.5,m.y=Math.random()-.5),m.normalize(),m.multiply(10),c[Math.floor(2*(r*i+s))]=this.clampi(m.x+127,0,255),c[Math.floor(2*(r*i+s)+1)]=this.clampi(m.y+127,0,255)}return this.blrByteArray2(c,i,a,5),c}}]),e}();t.MOMA01ImageUtils=e}(_||(_={})),function(t){var e=function(){function e(){Object(g.a)(this,e),this.uniformMatrix=[0,0,0,1],this.bAllocated=!1,this.hue=0}return Object(x.a)(e,[{key:"setCtx",value:function(t){this.mCtx3D=t}},{key:"setOrgRadWithScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.org_scale=e,this.org_rad=t}},{key:"setPosOrg",value:function(){this.rad=this.org_rad,this.scale=this.org_scale}},{key:"updateTexture",value:function(e){this.bAllocated&&(this._texture&&this._texture.dispose(),this._texture=t.Stage3DHelper.uploadTexture(this.mCtx3D,e,d.Context3DTextureFormat.BGRA,!1,!0))}},{key:"setup",value:function(e,i,a,s,r){var h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;this.dispose();var o=e.getColorBoundsRect(4278190080,0,!1);if(!o||o.width<1||o.height<1)return!1;for(this.texSize=1;this.texSize<o.width||this.texSize<o.height;)this.texSize*=2;var l=new d.BitmapData(this.texSize,this.texSize,!0,0),c=new t.Matrix;return this.tx=o.x+.5*o.width-.5*this.texSize,this.ty=o.y+.5*o.height-.5*this.texSize,c.translate(-this.tx,-this.ty),l.draw(e,c,null,null,null,!0),this.realScale=this.texSize,this.org_x=i-.5*e.width+(o.x+.5*o.width),this.org_y=a-.5*e.height+(o.y+.5*o.height),this.org_scale=this.scale=n,this.org_rad=this.rad=h,this.org_width=s,this.org_height=r,this.scale=0,this.rad=(Math.random()-.5)*Math.PI,this._texture=t.Stage3DHelper.uploadTexture(this.mCtx3D,l,d.Context3DTextureFormat.BGRA,!1,!0),this.bAllocated=null!=this._texture,this.bAllocated}},{key:"dispose",value:function(){this.destory(),this.bAllocated=!1}},{key:"destory",value:function(){this._texture&&this._texture.dispose()}},{key:"draw",value:function(t){this.bAllocated&&(this.rad+=.2*(this.org_rad-this.rad),this.scale+=.2*(this.org_scale-this.scale),this.uniformMatrix[0]=-1024+this.org_x,this.uniformMatrix[1]=1152-this.org_y,this.uniformMatrix[2]=this.rad,this.uniformMatrix[3]=this.realScale*this.scale,this.mCtx3D.setTextureAt(0,this._texture),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,e.uniformColor),this.mCtx3D.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,this.uniformMatrix),this.mCtx3D.setBlendFactors(d.Context3DBlendFactor.SOURCE_ALPHA,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA),this.mCtx3D.drawTriangles(t))}}]),e}();e.uniformColor=[1,1,1,1],t.MOMA02CPerticles=e}(_||(_={})),function(t){var e=function(){function t(){Object(g.a)(this,t),this.damping=.05}return Object(x.a)(t,[{key:"setInitialCondition",value:function(t,e,i,a,s){this.posX=t,this.posY=e,this.velX=i,this.velY=a,this.life=s}},{key:"isAlive",value:function(){return this.life>0}},{key:"update",value:function(){this.velX-=this.velX*this.damping,this.velY-=this.velY*this.damping,this.posX+=this.velX,this.posY+=this.velY,this.life-=1}},{key:"setVFupdate",value:function(t,e){this.velX+=t-this.velX*this.damping,this.velY+=e-this.velY*this.damping,this.posX+=this.velX,this.posY+=this.velY,this.life-=1}}]),t}();t.PVParticle=e}(_||(_={})),function(t){var e=function(){function t(){Object(g.a)(this,t)}return Object(x.a)(t,[{key:"setupField",value:function(t,e,i,a){this.cols=Math.floor(t),this.rows=Math.floor(e),this.cols_m1=this.cols-1,this.rows_m1=this.rows-1,this.width=Math.floor(i),this.height=Math.floor(a),this.nTotal=this.cols*this.rows,this.nTotalx2=2*this.nTotal,this.dispose(),this._buffer=new Array;for(var s=0;s<this.nTotalx2;s++)this._buffer.push(0)}},{key:"dispose",value:function(){this._buffer&&(this._buffer.length=0),this._buffer=null}},{key:"clear",value:function(){for(var t=0;t<this.nTotalx2;t++)this._buffer[t]=0}},{key:"fadeField",value:function(t){for(var e=0;e<this.nTotalx2;e++)this._buffer[e]*=t}},{key:"getIndexFor",value:function(t,e){var i=t/this.width,a=e/this.height;if(i<0||i>1||a<0||a>1)return 0;var s=i*this.cols,r=a*this.rows;return s<0?s=0:s>this.cols_m1&&(s=this.cols_m1),r<0?r=0:r>this.rows_m1&&(r=this.rows_m1),r*this.cols+s}},{key:"getForceFromPosPoint",value:function(t){this.getForceFromPos(t.x,t.y)}},{key:"getForceFromPos",value:function(t,e){if(t/=this.width,e/=this.height,t<0||t>1||e<0||e>1)return this.outX=0,void(this.outY=0);this.fieldPosX=t*this.cols,this.fieldPosY=e*this.rows,this.mPos=Math.floor(2*(this.fieldPosY*this.cols+this.fieldPosX)),this.outX=.1*this._buffer[this.mPos],this.outY=.1*this._buffer[this.mPos+1]}},{key:"addVectorCircle",value:function(t,e,i,a,s,r){var h,n,o,l,c=t/this.width*this.cols,m=e/this.height*this.rows,u=s/this.width*this.cols,d=c-u,f=m-u,g=c+u,x=m+u;for(d<0&&(d=0),f<0&&(f=0),g>this.cols&&(g=this.cols),x>this.rows&&(x=this.rows),h=d;h<g;h++)for(n=f;n<x;n++)o=2*(n*this.cols+h),(l=Math.sqrt((c-h)*(c-h)+(m-n)*(m-n)))<1e-4&&(l=1e-4),l<u&&(l=1-l/u,l*=r,this._buffer[o]+=i*l,this._buffer[o+1]+=a*l)}}]),t}();t.PVVectprField=e}(_||(_={})),function(t){var e=function(){function e(){Object(g.a)(this,e)}return Object(x.a)(e,null,[{key:"drawTriangles",value:function(t,e,i,a,s,r,h,n){t.setProgramConstantsFromVector(d.Context3DProgramType.FRAGMENT,0,n),t.setProgramConstantsFromVector(d.Context3DProgramType.VERTEX,4,h),t.setVertexBufferAt(0,s,0,d.Context3DVertexBufferFormat.FLOAT_2),t.setVertexBufferAt(1,r,0,d.Context3DVertexBufferFormat.FLOAT_2),t.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,i,!0),t.setTextureAt(0,a),t.drawTriangles(e)}},{key:"createMainProgram",value:function(t,e){var i=t.createProgram();return i.upload(this.V_SHADER_CODE,this.F_SHADER_CODE),i}},{key:"uploadTextureWithMipMaps",value:function(e,i,a){var s=i.width,r=i.height,h=i,n=new t.Matrix;n.scale(.5,.5);for(var o=0;s>0&&r>0;)if(e.uploadFromBitmapData(h,o),o++,r>>=1,(s>>=1)>0&&r>0){var l=h;h=null,(h=new d.BitmapData(s,r,!0,16777215)).draw(l,n,null,null,null,!0),(a||l!=i)&&l.dispose(),l=null}(a||h!=i)&&h.dispose()}},{key:"uploadTexture",value:function(t,i,a,s,r,h){var n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=t.createTexture(i.width,i.height,a,!1,0,h,n);return s?e.uploadTextureWithMipMaps(o,i,r):o.uploadFromBitmapData(i),r&&i.dispose(),o}}]),e}();e.F_SHADER_CODE="           precision mediump float;           uniform sampler2D fs0;           uniform vec4 fc0;           varying vec2 v0;           void main(void) {             vec4 ft0 = texture2D(fs0, v0);             gl_FragColor = ft0 * fc0;           }         ",e.V_SHADER_CODE="           attribute vec2 va0;           attribute vec2 va1;           uniform mat4 vc0;           uniform vec4 vc4;           varying vec2 v0;           void main(void) {             vec2 vt0 = va0;              vec4 vt1 = vc4;              vt1.x = cos(vt1.z);             vt1.y = sin(vt1.z);             vt1 = vec4(vt0.x, vt0.x, vt0.y, vt0.y) * vec4(vt1.x, vt1.y, vt1.y, vt1.x);               vt0.x = vt1.x - vt1.z;                vt0.y = vt1.y + vt1.w;                vec2 vt3 = vec2(vt0.x, vt0.y) * vec2(vc4.w, vc4.w);             vt0.x = vt3.x;             vt0.y = vt3.y;             vt0.x = vt0.x + vc4.x;                vt0.y = vt0.y + vc4.y;                gl_Position = vec4(vt0, 0, 1.0) * vc0;             v0 = va1;                           }         ",t.Stage3DHelper=e}(_||(_={})),function(t){var e=function t(){Object(g.a)(this,t)};e.ALPHA="ALPHA",e.ADD="ADD",e.MULTIPLY="MULTIPLY",e.SCREEN="SCREEN",e.ERASE="ERASE",t.BlendMode=e;var i=function(){function t(){Object(g.a)(this,t),this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}return Object(x.a)(t,[{key:"identity",value:function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}},{key:"scale",value:function(t,e){1!==t&&(this.a*=t,this.c*=t,this.tx*=t),1!==e&&(this.b*=e,this.d*=e,this.ty*=e)}},{key:"translate",value:function(t,e){this.tx+=t,this.ty+=e}},{key:"rotate",value:function(t){}}]),t}();t.Matrix=i;t.ColorTransform=function t(e,i,a,s){Object(g.a)(this,t),this.r=e,this.g=i,this.b=a,this.a=s}}(_||(_={}));var _,p=function t(e,i,a,s){Object(g.a)(this,t),this.x=e,this.y=i,this.width=a,this.height=s};!function(t){var e=function(){function e(){Object(g.a)(this,e),this.texture=null,this.transformMatrix=[],this.colorMatrix=[],this.vartex=[],this.coords=[],this.orgScale=1,this.orgX=0,this.orgY=0,this.transformMatrix.push(0,0,0,1),this.colorMatrix.push(1,1,1,1),this.vartex.push(0,0,t.UTItemManager.IMAGE_WIDTH,0,0,t.UTItemManager.IMAGE_HEIGHT,t.UTItemManager.IMAGE_WIDTH,t.UTItemManager.IMAGE_HEIGHT),this.coords.push(0,1,1,1,0,0,1,0)}return Object(x.a)(e,[{key:"setRectangle",value:function(e,i){console.log("setRectangle"),this.orgScale=i,this.vartex[0]=this.vartex[4]=.5*e.width*this.orgScale,this.vartex[1]=this.vartex[3]=.5*-e.height*this.orgScale,this.vartex[2]=this.vartex[6]=.5*-e.width*this.orgScale,this.vartex[5]=this.vartex[7]=.5*e.height*this.orgScale,this.coords[0]=this.coords[4]=(e.x+e.width)/t.UTItemManager.IMAGE_WIDTH,this.coords[1]=this.coords[3]=e.y/t.UTItemManager.IMAGE_HEIGHT,this.coords[2]=this.coords[6]=e.x/t.UTItemManager.IMAGE_WIDTH,this.coords[5]=this.coords[7]=(e.y+e.height)/t.UTItemManager.IMAGE_HEIGHT,this.bVartex.uploadFromVector(this.vartex,0,4),this.bCoords.uploadFromVector(this.coords,0,4),this.x=(e.x+.5*e.width)*this.orgScale,this.y=(e.y+.5*e.height)*this.orgScale,this.scale=1,this.angle=0,this.width=e.width*this.orgScale,this.height=e.height*this.orgScale}},{key:"setRectangleType",value:function(e,i,a,s){console.log("setRectangleType"),this.orgScale=s,this.vartex[0]=this.vartex[4]=.5*e.width*this.orgScale,this.vartex[1]=this.vartex[3]=.5*-e.height*this.orgScale,this.vartex[2]=this.vartex[6]=.5*-e.width*this.orgScale,this.vartex[5]=this.vartex[7]=.5*e.height*this.orgScale,this.coords[0]=this.coords[4]=(i+e.width)/t.UTItemManager.IMAGE_WIDTH*.5,this.coords[1]=this.coords[3]=a/t.UTItemManager.IMAGE_HEIGHT*.5,this.coords[2]=this.coords[6]=i/t.UTItemManager.IMAGE_WIDTH*.5,this.coords[5]=this.coords[7]=(a+e.height)/t.UTItemManager.IMAGE_HEIGHT*.5,this.x=(e.x+.5*e.width)*this.orgScale,this.y=(e.y+.5*e.height)*this.orgScale,this.bVartex.uploadFromVector(this.vartex,0,4),this.bCoords.uploadFromVector(this.coords,0,4),this.scale=1,this.angle=0,this.width=e.width*this.orgScale,this.height=e.height*this.orgScale}},{key:"setup",value:function(t,e,i){this.ctx=t,this.indicies=e,this.projectionMatrix=i,this.bVartex=this.ctx.createVertexBuffer(4,2),this.bCoords=this.ctx.createVertexBuffer(4,2),this.bVartex.uploadFromVector(this.vartex,0,4),this.bCoords.uploadFromVector(this.coords,0,4)}},{key:"setTexture",value:function(t){this.texture=t}},{key:"dispose",value:function(){}},{key:"draw",value:function(){this.transformMatrix[0]=this.x,this.transformMatrix[1]=this.y,this.transformMatrix[2]=this.angle,this.transformMatrix[3]=this.scale,this.ctx.setProgramConstantsFromMatrix(d.Context3DProgramType.VERTEX,0,this.projectionMatrix,!0),this.ctx.setBlendFactors(d.Context3DBlendFactor.SOURCE_ALPHA,d.Context3DBlendFactor.ONE_MINUS_SOURCE_ALPHA),t.Stage3DHelper.drawTriangles(this.ctx,this.indicies,this.projectionMatrix,this.texture,this.bVartex,this.bCoords,this.transformMatrix,this.colorMatrix)}}]),e}();t.LayoutObject=e}(_||(_={})),function(t){var e=function(){function e(){Object(g.a)(this,e)}return Object(x.a)(e,null,[{key:"generateTypgraphyLayouts",value:function(e,i){var a,s,r,h,n,o,l,c,m,u,d,f,g,x,_,p,M,D,v,T,w,y,C,E,I,A,S=0,B=60,R=0;for(f=Math.random()<.5,g=[],x=20+40*this._step,_=25+55*this._step,n=10*x,o=10*_,B=0,R=Math.random()*Math.PI*.5-.25*Math.PI,Math.abs(R/Math.PI*180)<15&&(R=0),a=0;a<x*_;a++)g.push(0);E=R>0,a=Math.floor(Math.random()*i.length);var b=Math.max(i.length,2)+50*this._step,L=!1;for(r=0;r<b;r++){var O=function(){++a+1>i.length&&(a=0)};if(l=i[a],0==r){for(T=l.width/l.height>1.2?2:3,d=!1,p=1,s=0;s<T;s++)p+=p;M=Math.ceil(p*l.width/l.height),m=o/Number(_)*p/l.height,D=.5*(x-M),v=.5*(_-p),I=!0,T=1}else{for(p=0,M=0,L=!1;;){for(d=!!f&&Math.random()<.5,p=1,s=0;s<T;s++)p+=p;if(M=Math.ceil(p*l.width/l.height),m=o/Number(_)*p/l.height,d&&(h=p,p=M,M=h),(p>_||M>x)&&(L=!0),L){if(!(p+1>_||M+1>x)){T=Math.floor(2*Math.random());break}--T<0&&O()}else{if(!(p*M<4)){T=Math.floor(2*Math.random());break}T++}}A=0,C=0,function t(){if(D=1+Math.floor((x-M-2)*Math.random()),v=1+Math.floor((_-p-2)*Math.random()),!(++C>500)){for(S=v;S<v+p;S++)for(c=D;c<D+M;c++)if(g[S*x+c])return void t();for(A=0,S=v;S<v+p;S++)1==g[S*x+(c=D-1)]&&(A++,I=!d||!E),1==g[S*x+(c=D+M)]&&(A++,I=!!d&&!E);if(A<2)for(c=D;c<D+M;c++)1==g[(S=v-1)*x+c]&&(A++,I=!0),1==g[(S=v+p)*x+c]&&(A++,I=!d);A<2&&t()}}()}for(w=v;w<v+p;w++)for(y=D;y<D+M;y++)g[w*x+y]=1,d?I?w==v+p-1&&(g[w*x+y]=2):w==v&&(g[w*x+y]=2):I?y==D+M-1&&(g[w*x+y]=2):y==D&&(g[w*x+y]=2);B=3,d?(c=D/Number(x)*n+.5*l.height*m,m*=(l.height*m-B)/(l.height*m),S=I?v/Number(_)*o+.5*l.width*m+.5*B:(v+p)/Number(_)*o-.5*l.width*m-.5*B):(S=v/Number(_)*o+.5*l.height*m,m*=(l.height*m-B)/(l.height*m),c=I?D/Number(x)*n+.5*l.width*m+.5*B:(D+M)/Number(x)*n-.5*l.width*m-.5*B),u=d?E?.5*-Math.PI:.5*Math.PI:0,t.LayoutsHelper.addPerticleObject(e,i,a,c,S,m,u),O()}t.LayoutsHelper.debugDrawPalette(x,_,g),t.LayoutsHelper.fixLayouts(e,R)}},{key:"generatePictLayouts2",value:function(e,i){var a,s,r,h,n,o,l,c,m,u,d,f,g,x,_,p,M,D,v,T,w=0,y=60,C=0;m=[];var E=0,I=0;for(a=0;a<i.length;a++)o=i[a],E=Math.max(E,o.width),I=Math.max(I,o.height);var A=E>I,S=Math.max(1,Math.round(A?E/I:I/E));for(u=Math.max(20+40*this._step,A?8*S:0),d=Math.max(25+55*this._step,A?0:8*S),h=10*u,n=10*d,y=0,C=Math.random()*Math.PI*.5-.25*Math.PI,Math.abs(C/Math.PI*180)<15&&(C=0),a=0;a<u*d;a++)m.push(0);a=Math.floor(Math.random()*i.length);var B=Math.max(i.length,2)+30*this._step;for(r=0;r<B;r++){if(o=i[a],0==r){for(p=3,f=1,s=0;s<p;s++)f+=f;g=Math.ceil(f*o.width/o.height),c=n/Math.floor(d)*f/o.height,x=.5*(u-g),_=.5*(d-f),p=2}else{for(f=0,g=0;f*g<4;){for(f=1,s=0;s<p;s++)f+=f;g=Math.ceil(f*o.width/o.height),c=n/Number(d)*f/o.height,f*g<4?p++:p=Math.floor(3*Math.random())}T=0,v=0,function t(){if(x=1+Math.floor((u-g-2)*Math.random()),_=1+Math.floor((d-f-2)*Math.random()),!(++v>500)){for(w=_;w<_+f;w++)for(l=x;l<x+g;l++)if(m[w*u+l])return void t();for(T=0,w=_;w<_+f;w++)1==m[w*u+(l=x-1)]&&T++,1==m[w*u+(l=x+g)]&&T++;if(T<2)for(l=x;l<x+g;l++)1==m[(w=_-1)*u+l]&&T++,1==m[(w=_+f)*u+l]&&T++;T<2&&t()}}()}for(M=_;M<_+f;M++)for(D=x;D<x+g;D++)m[M*u+D]=1;y=3,w=_/Number(d)*n+.5*o.height*c,l=x/Number(u)*h+.5*o.width*c,c*=(o.height*c-y)/(o.height*c),t.LayoutsHelper.addPerticleObject(e,i,a,l,w,c,0),++a+1>i.length&&(a=0)}t.LayoutsHelper.debugDrawPalette(u,d,m),t.LayoutsHelper.fixLayouts(e,C)}},{key:"generatePictLayouts2Single",value:function(e,i){var a,s,r,h,n,o,l,c,m,u,d,f,g,x,_,p,M,D,v,T=0,w=60,y=0;c=[];var C=0,E=0;for(a=0;a<i.length;a++)n=i[a],C=Math.max(C,n.width),E=Math.max(E,n.height);var I=C/E,A=C>E,S=Math.max(1,Math.round(A?C/E:E/C));for(m=Math.max(20+40*this._step,A?8*S:0),u=Math.max(25+55*this._step,A?0:8*S),10*m,h=10*u,w=0,y=Math.random()*Math.PI*.5-.25*Math.PI,Math.abs(y/Math.PI*180)<15&&(y=0),a=0;a<m*u;a++)c.push(0);a=Math.floor(Math.random()*i.length);var B=Math.max(i.length,2)+30*this._step;for(r=0;r<B;r++){if(n=i[a],0==r){for(_=3,d=1,s=0;s<_;s++)d+=d;A?f=d*S:d=(f=d)*S,l=h/Number(u)*d/n.height,g=.5*(m-f),x=.5*(u-d),_=2}else{for(d=0,f=0;d*f<4;){for(d=1,s=0;s<_;s++)d+=d;A?f=d*S:d=(f=d)*S,l=h/Number(u)*d/n.height,d*f<4?_++:_=Math.floor(3*Math.random())}v=0,D=0,function t(){if(g=1+Math.floor((m-f-2)*Math.random()),x=1+Math.floor((u-d-2)*Math.random()),!(++D>500)){for(T=x;T<x+d;T++)for(o=g;o<g+f;o++)if(c[T*m+o])return void t();for(v=0,T=x;T<x+d;T++)c[T*m+(o=g-1)]&&v++,c[T*m+(o=g+f)]&&v++;if(v<2)for(o=g;o<g+f;o++)c[(T=x-1)*m+o]&&v++,c[(T=x+d)*m+o]&&v++;v<2&&t()}}()}for(p=x;p<x+d;p++)for(M=g;M<g+f;M++)c[p*m+M]=1;w=3,T=10*x+10*d*.5,o=(10*g+10*f*.5)*I*(A?1/Math.floor(S):S),l*=(n.height*l-w)/(n.height*l),0,t.LayoutsHelper.addPerticleObject(e,i,a,o,T,l,0),++a+1>i.length&&(a=0)}t.LayoutsHelper.debugDrawPalette(m,u,c),t.LayoutsHelper.fixLayouts(e,y)}},{key:"generatePictLayouts",value:function(e,i){var a,s,r,h,n,o,l,c,m,u,d,f,g,x,_=0,p=0,M=0,D=0,v=Number.MAX_VALUE;for(a=0;a<i.length;a++)r=i[a],M=Math.max(M,r.width),D=Math.max(D,r.height);for(a=0;a<i.length;a++)r=i[a],v=Math.min(v,M/r.width),v=Math.min(v,D/r.height);o=[],l=1,c=1;var T=20*Math.pow(this._step,.75)+Math.sqrt(i.length);for(a=0;a<T;a++)l*M<c*D?l++:c++;for(a=0;a<l*c;a++)o.push(0);s=.02*Math.max(l*M,c*D),p=Math.random()*Math.PI*.5-.25*Math.PI,Math.abs(p/Math.PI*180)<15&&(p=0),p=0,a=Math.floor(Math.random()*i.length),d=Math.min(l,c),(d=Math.min(d<5?Math.ceil(.5*d)+(Math.ceil(.5*d)+1)*Math.random():(Math.random(),d)))>1&&d==l&&d==c&&d--,x=0;for(var w=function(){r=i[a];!function T(){for(m=Math.floor((l-d+1)*Math.random()),u=Math.floor((c-d+1)*Math.random()),f=u;f<u+d;f++)for(g=m;g<m+d;g++)if(o[f*l+g]){if(++x>500&&(x=0,--d<2))return;return void T()}for(f=u;f<u+d;f++)for(g=m;g<m+d;g++)o[f*l+g]=1;h=m*M+M*(n=d*v)*.5,_=u*D+D*n*.5,r.width/(M*n)>r.height/(D*n)?(n=M*n/r.width,n*=(r.width*n-s)/(r.width*n)):(n=D*n/r.height,n*=(r.height*n-s)/(r.height*n)),t.LayoutsHelper.addPerticleObject(e,i,a,h,_,n,p),++a+1>i.length&&(a=0)}()};d>1;)w();!function(){for(f=0;f<c;f++)for(g=0;g<l;g++)o[f*l+g]||(r=i[a],h=g*M+M*(n=v)*.5,_=f*D+D*n*.5,r.width/(M*n)>r.height/(D*n)?(n=M*n/r.width,n*=(r.width*n-s)/(r.width*n)):(n=D*n/r.height,n*=(r.height*n-s)/(r.height*n)),t.LayoutsHelper.addPerticleObject(e,i,a,h,_,n,p),++a+1>i.length&&(a=0));t.LayoutsHelper.debugDrawPalette(l,c,o),t.LayoutsHelper.fixLayouts(e,0)}()}},{key:"generateLayout",value:function(e,i,a,s){try{a?this.generateTypgraphyLayouts(e,i):(this.flag?this.generatePictLayouts(e,i):1==i.length?this.generatePictLayouts2Single(e,i):this.generatePictLayouts2(e,i),this.flag=!this.flag)}catch(r){t.LayoutsHelper.fixLayouts(e,0)}this._step+=.003,this._step>1&&(this._step=1),s&&this._step>.05&&(this._step=.05)}},{key:"layoutReset",value:function(){this._step=0}}]),e}();e.flag=!1,e._step=0,t.LayoutPericleGenelator=e}(_||(_={})),function(t){var e=function(){function e(){Object(g.a)(this,e)}return Object(x.a)(e,null,[{key:"addSimplePerts",value:function(e,i,a,s,r,h,n,o,l,c){var m,u,d,f,g,x,_,p,M,D,v,T=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,y=[],C=[],E=0;for(p=a?.5*-Math.PI:0,x=0,m=T,E=0,f=0,u=0,_=0,this.tmpPerticle.length=0,y.length=0,C.length=0,0,g=n/(d=i[0]).height;d=i[m],!(f>0&&f+d.width*g>h&&(y.push(f-l),C.push(u),f=0,u=0,E+=n+o,x++,d=i[m=Math.floor(Math.random()*i.length)],x>c-1));)(v=new t.SimplePerticleObject).flg=0==f,v.lid=m,v.x=f+d.width*g*.5,v.y=E+d.height*g*.5,v.scale=g,v.angle=0,this.tmpPerticle.push(v),u++,_=Math.max(_,f+d.width*g),f+=d.width*g+l,++m+1>i.length&&(m=0);for(g=h/_,u=-1,m=0;m<this.tmpPerticle.length&&((v=this.tmpPerticle[m]).flg?(u++,f=0):f+=(_-(y[u]-(C[u]-1)*l))/Number(C[u]-1)-l,v.x=v.x*g+f*g,v.y=v.y*g,v.scale*=g,!(w>0&&w<v.y-i[v.lid].height*v.scale*.5));m++)M=v.x*Math.cos(p)-v.y*Math.sin(p),D=v.x*Math.sin(p)+v.y*Math.cos(p),v.x=M,v.y=D,v.angle+=p,this.addPerticleObject(e,i,v.lid,v.x+r,v.y+s,v.scale,v.angle);this.tmpPerticle.length=0,y.length=0,C.length=0}},{key:"addPerticleObject",value:function(e,i,a,s,r,h,n){var o,l,c;for(l=!1,o=0;o<e.length;o++)e[o].willDelete&&e[o].index==a&&(c=e[o],l=!0);l||(c=new t.perticleObject(i[a],a)).setPositon(Math.random()*t.UTItemManager.IMAGE_WIDTH,Math.random()*t.UTItemManager.IMAGE_HEIGHT,0,Math.random()*Math.PI*2-Math.PI),c.setPositonWithAnimate(s,r,h,n),c.willDelete=!1,l||e.push(c)}},{key:"fixLayouts",value:function(e){var i,a,s,r,h,n,o,l,c,m,u,d,f,g,x,_,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0!=p)for(a=0;a<e.length;a++)(s=e[a]).willDelete||(n=s.toX*Math.cos(p)-s.toY*Math.sin(p),o=s.toX*Math.sin(p)+s.toY*Math.cos(p),s.toX=n,s.toY=o,s.toAngle+=p);for(i=!1,a=0;a<e.length;a++)(s=e[a]).willDelete||(r=.5*s.height(),h=.5*s.width(),n=Math.max(Math.abs(h*Math.cos(s.toAngle)-r*Math.sin(s.toAngle)),Math.abs(h*Math.cos(s.toAngle)+r*Math.sin(s.toAngle))),o=Math.max(Math.abs(h*Math.sin(s.toAngle)+r*Math.cos(s.toAngle)),Math.abs(h*Math.sin(s.toAngle)-r*Math.cos(s.toAngle))),i?(l=Math.min(l,s.toX-n),c=Math.max(c,s.toX+n),m=Math.min(m,s.toY-o),u=Math.max(u,s.toY+o)):(i=!0,l=s.toX-n,c=s.toX+n,m=s.toY-o,u=s.toY+o));d=c-l,f=u-m;var M=t.UTItemManager.IMAGE_WIDTH-200,D=t.UTItemManager.IMAGE_HEIGHT;for(_=D/f<M/d?D/f:M/d,g=.5*(t.UTItemManager.IMAGE_WIDTH-d*_),x=.2*(t.UTItemManager.IMAGE_HEIGHT-f*_),a=0;a<e.length;a++)(s=e[a]).willDelete||(s.toX-=l,s.toY-=m,s.toScale*=_,s.toX*=_,s.toY*=_,s.toX+=g,s.toY+=x)}},{key:"debugDrawPalette",value:function(t,e,i){var a,s,r=new d.BitmapData(t,e,!0,0);for(a=0;a<e;a++)for(s=0;s<t;s++)r.setPixel32(s,a,1==i[a*t+s]?2566914303:2==i[a*t+s]?2583625728:2583691263);this.debugBmd.bitmapData=r,this.debugBmd.x=0,this.debugBmd.y=200,this.debugBmd.rotation=0,this.debugBmd.smoothing=!1,this.debugBmd.width=2*t,this.debugBmd.height=2*e}}]),e}();e.debugBmd=new d.Bitmap,e.tmpPerticle=[],t.LayoutsHelper=e}(_||(_={})),(_||(_={})).SimplePerticleObject=function t(){Object(g.a)(this,t)},function(t){var e=function(){function t(e,i){Object(g.a)(this,t),this._scale=0,this._angle=0,this._x=0,this._y=0,this.willDelete=!1,this.toX=512,this.toY=512,this.toScale=1,this.toAngle=0,this.accX=0,this.accY=0,this.accScale=0,this.accAngle=0,this.dumpingForce=.98,this.springiness=.2,this._lo=e,this.index=i}return Object(x.a)(t,[{key:"updateLayoutObject",value:function(t){this._lo=t}},{key:"draw",value:function(){var t=.6*(1-this.dumpingForce)+.3;this._x+=(this.toX-this._x)*t,this._y+=(this.toY-this._y)*t,this._angle+=(this.toAngle-this._angle)*t,this._scale+=(this.toScale-this._scale)*t,this._lo.x=this._x,this._lo.y=this._y,this._lo.angle=this._angle,this._lo.scale=this._scale,this._lo.draw()}},{key:"width",value:function(){return this._lo.width*this.toScale}},{key:"height",value:function(){return this._lo.height*this.toScale}},{key:"setPositon",value:function(t,e,i,a){this._x=this.toX=t,this._y=this.toY=e,this._scale=this.toScale=i,this._angle=this.toAngle=a}},{key:"setPositonWithAnimate",value:function(t,e,i,a){this.toX=t,this.toY=e,this.toScale=i,this.toAngle=a}},{key:"updateSpringMotion",value:function(){var t=this._x-this.toX,e=this._y-this.toY,i=Math.sqrt(t*t+e*e),a=this.springiness*-i;t=t/i*a,e=e/i*a,this.accX+=t||0,this.accY+=e||0,this.accScale+=this.springiness*-(this._scale-this.toScale),this.accAngle+=this.springiness*-(this._angle-this.toAngle)}}]),t}();t.perticleObject=e}(_||(_={})),(_||(_={})).IPPerticles=function t(){Object(g.a)(this,t),this.x=0,this.y=0,this.orgX=0,this.orgY=0,this.r=0,this.g=0,this.b=0,this.life=0,this.scale=0,this.alpha=0,this.orgAlpha=0},function(t){var e=function(){function t(){Object(g.a)(this,t)}return Object(x.a)(t,[{key:"save",value:function(t){}}]),t}();t.INavigatedView=e}(_||(_={})),function(t){var e=function(){function t(){Object(g.a)(this,t)}return Object(x.a)(t,[{key:"playStageChange",value:function(t){console.log("playStageChange")}},{key:"motionStateChange",value:function(t){console.log("motionStateChange")}},{key:"showStopAlert",value:function(){console.log("showStopAlert")}}]),t}();t.RemixGlitchView=e}(_||(_={})),(_||(_={})).StampObject=function t(){Object(g.a)(this,t),this.contents={bitmapData:null}},function(t){var e=function(){function t(){Object(g.a)(this,t),this.backToRatateZero=!0,this.backToOrgPosition=!0,this._lockState=!1,this.limitRotateMinRad=0,this.limitRotateMaxRad=0,this._bAllocated=!1,this._orgPos_x=0,this._orgPos_y=0,this.pos_x=0,this.pos_y=0,this._activeForce_x=0,this._activeForce_y=0,this._lastDragPos_x=0,this._lastDragPos_y=0,this._dragPos_x=0,this._dragPos_y=0}return Object(x.a)(t,[{key:"setup",value:function(t,e,i,a,s){this._orgPos_x=t,this._orgPos_y=e,this._activeForce_x=0,this._activeForce_y=0,this._width=a,this._height=s,this.pos_x=t,this.pos_y=e,this.rad=i,this._lastDragPos_x=0,this._lastDragPos_y=0,this._dragPos_x=0,this._dragPos_y=0,this._updateTime=0,this._dragging=!1,this._bAllocated=!0}},{key:"REG_RAD",value:function(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}},{key:"calcDragPos",value:function(t,e){var i,a,s,r,h,n;this._dragPos_x=t,this._dragPos_y=e,this._wk1_x=this._lastDragPos_x-this.pos_x,this._wk1_y=this._lastDragPos_y-this.pos_y,this._wk2_x=this._dragPos_x-this.pos_x,this._wk2_y=this._dragPos_y-this.pos_y,n=Math.sqrt(this._wk1_x*this._wk1_x+this._wk1_y*this._wk1_y),i=Math.atan2(this._wk1_y,this._wk1_x),a=Math.atan2(this._wk2_y,this._wk2_x),s=i-this.rad,r=a-i,h=Math.min(1,n/(.5*Math.sqrt(this._width*this._width+this._height*this._height))),h=1-Math.sin((1-h)*Math.PI*.5),this._lockState&&(h=0),r=this.REG_RAD(r),this.rad=this.rad+r*h,!this._lockState&&this.limitRotateMinRad<this.limitRotateMaxRad&&(this.rad=this.REG_RAD(this.rad),this.rad<this.limitRotateMinRad&&(this.rad=this.limitRotateMinRad),this.rad>this.limitRotateMaxRad&&(this.rad=this.limitRotateMaxRad)),this.pos_x=this._dragPos_x-n*Math.cos(this.rad+s),this.pos_y=this._dragPos_y-n*Math.sin(this.rad+s),this.rad=this.REG_RAD(this.rad),this._lastDragPos_x=this._dragPos_x,this._lastDragPos_y=this._dragPos_y}},{key:"update",value:function(){this._bAllocated&&(this._dragging||Math.sqrt(this._activeForce_x*this._activeForce_x+this._activeForce_y*this._activeForce_y)>.5&&(this.calcDragPos(this._dragPos_x+this._activeForce_x,this._dragPos_y+this._activeForce_y),this._activeForce_x*=.9,this._activeForce_y*=.9),this._updated=!1,this.backToRatateZero&&0!=this.rad&&(this.rad*=.95,Math.abs(this.rad)<.001&&(this.rad=0),this._updated=!0),this.backToOrgPosition&&!this._dragging&&(this.pos_x!=this._orgPos_x&&(this.pos_x=this.pos_x+.2*(this._orgPos_x-this.pos_x),Math.abs(this.pos_x-this._orgPos_x)<.1&&(this.pos_x=this._orgPos_x),this._updated=!0),this.pos_y!=this._orgPos_y&&(this.pos_y=this.pos_y+.2*(this._orgPos_y-this.pos_y),Math.abs(this.pos_y-this._orgPos_y)<.1&&(this.pos_y=this._orgPos_y),this._updated=!0)))}},{key:"drag",value:function(t,e,i,a){if(this._lockState=a,i){if(!this._dragging)return this._lastDragPos_x=t,this._lastDragPos_y=e,void(this._dragging=!0);this._updateTime=(new Date).getTime(),this._activeForce_x=t-this._lastDragPos_x,this._activeForce_y=e-this._lastDragPos_y,this.calcDragPos(t,e)}else this._dragging&&(this._dragging=!1,this._updateTime!=(new Date).getTime()&&(this._activeForce_x=0,this._activeForce_y=0))}}]),t}();t.DraggablePlateRect=e}(_||(_={})),function(t){var e=function(){function t(){Object(g.a)(this,t)}return Object(x.a)(t,null,[{key:"easeLinear",value:function(t,e,i,a){return i*t/a+e}},{key:"easeInSine",value:function(t,e,i,a){return-i*Math.cos(t/a*this.PI_D2)+i+e}},{key:"easeOutSine",value:function(t,e,i,a){return i*Math.sin(t/a*this.PI_D2)+e}},{key:"easeInOutSine",value:function(t,e,i,a){return-i/2*(Math.cos(Math.PI*t/a)-1)+e}},{key:"easeInQuint",value:function(t,e,i,a){return i*(t/=a)*t*t*t*t+e}},{key:"easeOutQuint",value:function(t,e,i,a){return i*((t=t/a-1)*t*t*t*t+1)+e}},{key:"easeInOutQuint",value:function(t,e,i,a){return(t/=a/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e}},{key:"easeInQuart",value:function(t,e,i,a){return i*(t/=a)*t*t*t+e}},{key:"easeOutQuart",value:function(t,e,i,a){return-i*((t=t/a-1)*t*t*t-1)+e}},{key:"easeInOutQuart",value:function(t,e,i,a){return(t/=a/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e}},{key:"easeInQuad",value:function(t,e,i,a){return i*(t/=a)*t+e}},{key:"easeOutQuad",value:function(t,e,i,a){return-i*(t/=a)*(t-2)+e}},{key:"easeInOutQuad",value:function(t,e,i,a){return(t/=a/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e}},{key:"easeInExpo",value:function(t,e,i,a){return 0==t?e:i*Math.pow(2,10*(t/a-1))+e}},{key:"easeOutExpo",value:function(t,e,i,a){return t==a?e+i:i*(1-Math.pow(2,-10*t/a))+e}},{key:"easeInOutExpo",value:function(t,e,i,a){return 0==t?e:t==a?e+i:(t/=a/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e}},{key:"easeInElastic",value:function(t,e,i,a){var s,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;return 0==t?e:1==(t/=a)?e+i:(h||(h=.3*a),!r||r<Math.abs(i)?(r=i,s=h/4):s=h/this.PI_M2*Math.asin(i/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*a-s)*this.PI_M2/h)+e)}},{key:"easeOutElastic",value:function(t,e,i,a){var s,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;return 0==t?e:1==(t/=a)?e+i:(h||(h=.3*a),!r||r<Math.abs(i)?(r=i,s=h/4):s=h/this.PI_M2*Math.asin(i/r),r*Math.pow(2,-10*t)*Math.sin((t*a-s)*this.PI_M2/h)+i+e)}},{key:"easeInOutElastic",value:function(t,e,i,a){var s,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;return 0==t?e:2==(t/=a/2)?e+i:(h||(h=a*(.3*1.5)),!r||r<Math.abs(i)?(r=i,s=h/4):s=h/this.PI_M2*Math.asin(i/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*a-s)*this.PI_M2/h)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*a-s)*this.PI_M2/h)*.5+i+e)}},{key:"easeInCircular",value:function(t,e,i,a){return-i*(Math.sqrt(1-(t/=a)*t)-1)+e}},{key:"easeOutCircular",value:function(t,e,i,a){return i*Math.sqrt(1-(t=t/a-1)*t)+e}},{key:"easeInOutCircular",value:function(t,e,i,a){return(t/=a/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e}},{key:"easeInBack",value:function(t,e,i,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return i*(t/=a)*t*((s+1)*t-s)+e}},{key:"easeOutBack",value:function(t,e,i,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return i*((t=t/a-1)*t*((s+1)*t+s)+1)+e}},{key:"easeInOutBack",value:function(t,e,i,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(t/=a/2)<1?i/2*(t*t*((1+(s*=1.525))*t-s))+e:i/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+e}},{key:"easeInBounce",value:function(t,e,i,a){return i-this.easeOutBounce(a-t,0,i,a)+e}},{key:"easeOutBounce",value:function(t,e,i,a){return(t/=a)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}},{key:"easeInOutBounce",value:function(t,e,i,a){return t<a/2?.5*this.easeInBounce(2*t,0,i,a)+e:.5*this.easeOutBounce(2*t-a,0,i,a)+.5*i+e}},{key:"easeInCubic",value:function(t,e,i,a){return i*(t/=a)*t*t+e}},{key:"easeOutCubic",value:function(t,e,i,a){return i*((t=t/a-1)*t*t+1)+e}},{key:"easeInOutCubic",value:function(t,e,i,a){return(t/=a/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e}}]),t}();e.PI_M2=2*Math.PI,e.PI_D2=Math.PI/2,e.linear=e.easeLinear,e.none=e.easeLinear,t.Easing=e}(_||(_={}))},463:function(t,e,i){"use strict";i.d(e,"a",function(){return d});var a=i(9),s=i(0),r=i.n(s),h=(i(10),i(246),i(455),i(445)),n=i.n(h),o=i(448),l=i.n(o),c=(i(183),i(150)),m=i(20),u=i(16);function d(t){var e=Object(s.useState)(!1),i=Object(a.a)(e,2),h=i[0],o=i[1],d=Object(s.useContext)(m.a),f=Object(s.useState)(!1),g=Object(a.a)(f,2),x=g[0],_=g[1];function p(e){o(!1),"current"===e?t.cancelDesign&&(t.cancelDesign(),t.setShow(!1)):(_(!0),setTimeout(function(){_(!0)},100))}return Object(s.useEffect)(function(){o(t.show)},[t.show]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"revokeMask",style:{display:h?"block":"none"},onClick:function(){t.setShow(!1),setTimeout(function(){t.setShow(!1)},100)}}),r.a.createElement("div",{style:{width:"100%",backgroundColor:"#fff",position:"fixed",zIndex:21,bottom:h?0:-194,fontSize:"ja"===d.current?17:20,fontWeight:500,transition:"bottom 0.2s"}},r.a.createElement("div",{className:"revokeOperation",onClick:function(){return p("current")}},r.a.createElement("div",{className:"revokeOpImg"},r.a.createElement("img",{src:l.a})),r.a.createElement("span",{style:{fontWeight:"ja"===d.current?"":"bold",fontFamily:"ja"===d.current?"NotoSansCJKjp-Bold":"HelveticaNeue-Bold"}},"mix"===t.pageMark?r.a.createElement(u.a,{code:"make.revoke.resetEffect"}):r.a.createElement(u.a,{code:"make.revoke.resetGraphic"}))),r.a.createElement("div",{className:"revokeOperation",onClick:function(){return p("initial")}},r.a.createElement("div",{className:"revokeOpImg"},r.a.createElement("img",{src:n.a})),r.a.createElement("span",{style:{fontWeight:"ja"===d.current?"":"bold",fontFamily:"ja"===d.current?"NotoSansCJKjp-Bold":"HelveticaNeue-Bold"}},r.a.createElement(u.a,{code:"make.revoke.BackToTheOriginalState"}))),r.a.createElement("div",{style:{height:52,padding:15}},r.a.createElement("button",{style:{height:52,lineHeight:"52px",letterSpacing:.4,width:"100%",border:"1px solid #1b1b1b",fontSize:16,backgroundColor:"white",fontFamily:"ja"===d.current?"NotoSansCJKjp-Bold":"UniqloPro-Bold"},onClick:function(){return t.setShow(!1)}},r.a.createElement(u.a,{code:"make.revoke.cancel"})))),r.a.createElement(c.a,{resetLayers:t.resetLayers,status:x,isAgainFu:function(e){_(!1),t.setShow&&t.setShow(!1)}}))}},473:function(t,e,i){"use strict";i.d(e,"a",function(){return m});var a=i(57),s=i(0),r=i.n(s),h=i(449),n=i.n(h),o=i(459),l=i.n(o),c=i(47);function m(t){var e=t.disabled,i=t.onClick,h=t.style;return Object(s.useEffect)(function(){Object(c.a)()},[]),r.a.createElement("div",{onClick:e?null:function(){return Object(c.b)(i)}},r.a.createElement("img",{src:e?l.a:n.a,className:"GotoMixIcon",alt:"",style:Object(a.a)({position:"absolute",right:12,top:2,zIndex:11,width:40,height:40,transition:"all .4s"},h)}))}}}]);
//# sourceMappingURL=2.019de68c.chunk.js.map