{"version":3,"sources":["routes/stamp/StampShowcase/index.js"],"names":["StampShowcase","props","_useState","useState","_useState2","Object","_Users_09013730_git_hand_utme_make_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_4__","stampDom","setStampDom","_useState3","_useState4","isAgainEdit","setIsAgainEdit","make","useContext","MakeContext","layers","router","useRouter","district","LocaleContext","_useState5","_useState6","alertModelVisible","setAlertModelVisible","_showStampModal","_Users_09013730_git_hand_utme_make_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__","_Users_09013730_git_hand_utme_make_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","mark","_callee","s","disabled","over","layerTypes","alertModal","layerTypesString","layerTypesNew","wrap","_context","prev","next","JSON","stringify","parse","pop","forEach","ele","concat","push","length","invoke","t0","setModalVisible","changeSelectedStamp","changePreStamp","stop","this","apply","arguments","useEffect","par","document","getElementsByClassName","parentNode","style","height","window","innerHeight","overflow","stampPer","location","search","searches","qs","substr","passProps","stamp","code","decodeURI","stampIds","map","k","id","sort","b","newStamp","newFilterStamp","filter","item","_Users_09013730_git_hand_utme_make_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_3__","changeStampTitleName","contents_holder_name","element","type","stampRule","stampFlag","flag_can_other_layer_over","stampDomList","Array","from","Set","updated_on","index","flagindex","flag_layer_stamp","indexOf","flag_layer_paint","flag_layer_text","flag_layer_photo","react__WEBPACK_IMPORTED_MODULE_5___default","createElement","className","key","toString","onClick","_x","_x2","_x3","_x4","showStampModal","width","innerWidth","src","main_image_url","alt","is_new","borderRadius","backgroundColor","position","marginRight","textAlign","current","name","myStampModalProps","modalVisible","selectedStamp","background","_navbar__WEBPACK_IMPORTED_MODULE_6__","revoke","page","currentPage","_Users_09013730_git_hand_utme_make_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_1__","display","justifyContent","paddingTop","marginTop","paddingLeft","paddintgRigh","textOverflow","whiteSpace","_StampModal__WEBPACK_IMPORTED_MODULE_9__","_components_isAgainEdit__WEBPACK_IMPORTED_MODULE_13__","status","isAgainFu","e","_components_AlertModal__WEBPACK_IMPORTED_MODULE_16__","visible","title","description","text"],"mappings":"qSA4MeA,UAhMf,SAAwBC,GAAO,IAAAC,EACGC,mBAAS,IADZC,EAAAC,OAAAC,EAAA,EAAAD,CAAAH,EAAA,GACtBK,EADsBH,EAAA,GACZI,EADYJ,EAAA,GAAAK,EAESN,oBAAS,GAFlBO,EAAAL,OAAAC,EAAA,EAAAD,CAAAI,EAAA,GAEtBE,EAFsBD,EAAA,GAETE,EAFSF,EAAA,GAIvBG,EAAOC,qBAAWC,KAEtBC,EACEH,EADFG,OAEIC,EAASC,cACTC,EAAWL,qBAAWM,KATCC,EAUqBlB,oBAAS,GAV9BmB,EAAAjB,OAAAC,EAAA,EAAAD,CAAAgB,EAAA,GAUtBE,EAVsBD,EAAA,GAUHE,EAVGF,EAAA,YAAAG,IAAA,OAAAA,EAAApB,OAAAqB,EAAA,EAAArB,CAAAsB,EAAAC,EAAAC,KA6G7B,SAAAC,EAA+BC,EAAOC,EAAUC,EAAMC,GAAtD,IAAAC,EAAAC,EAAAC,EAAA,OAAAV,EAAAC,EAAAU,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,WACMT,EADN,CAAAO,EAAAE,KAAA,YAEQN,EAAa,GACbC,EAAmBM,KAAKC,UAAUT,IAClCG,EAAgBK,KAAKE,MAAMR,IACjBS,MALlBN,EAAAC,KAAA,EAOMH,EAAcS,QAAQ,SAACC,GACU,OAA3BhB,EAAC,cAAAiB,OAAeD,KAClBZ,EAAWc,KAAKF,OAGhBZ,EAAWe,OAAS,GAZ9B,CAAAX,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,GAacU,YAAO,gBAAiBhB,GAbtC,QAAAI,EAAAE,KAAA,wBAAAF,EAAAE,KAAA,GAecU,YAAO,qBAfrB,QAAAZ,EAAAE,KAAA,oBAAAF,EAAAC,KAAA,GAAAD,EAAAa,GAAAb,EAAA,SAkBMF,EAAcS,QAAQ,SAACC,GACU,OAA3BhB,EAAC,cAAAiB,OAAeD,KAClBZ,EAAWc,KAAKF,OAGhBZ,EAAWe,OAAS,GAvB9B,CAAAX,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,GAwBcU,YAAO,gBAAiBhB,GAxBtC,QAAAI,EAAAE,KAAA,wBAAAF,EAAAE,KAAA,GA0BcU,YAAO,qBA1BrB,QAAAZ,EAAAE,KAAA,iBA8BI5B,EAAKwC,iBAAgB,GAErBxC,EAAKyC,oBAAoBvB,GACzBlB,EAAK0C,eAAexB,GAjCxB,yBAAAQ,EAAAiB,SAAA1B,EAAA2B,KAAA,cA7G6BC,MAAAD,KAAAE,WAW7BC,oBAAU,WACR,IAAMC,EAAMC,SAASC,uBAAuB,aAAa,GAAGC,WAC5DH,EAAII,MAAMC,OAASC,OAAOC,YAC1BP,EAAII,MAAMI,SAAW,QACpB,IACHT,oBAAU,WACR,IAAIU,EAEJ,GAAIrD,EAAOsD,SAASC,OAAQ,CAC1B,IAAMC,EAAWC,IAAG9B,MAAM3B,EAAOsD,SAASC,OAAOG,OAAO,IACxD,GAAIF,EAASG,UAAW,CACtB,IACQC,EADUC,IAAKC,UAAUN,EAASG,WAClCC,MAEFG,EAAWH,EAAMI,IAAI,SAAAC,GAAC,OAAIA,EAAEC,KAAIC,KAAK,SAACxD,EAAGyD,GAAJ,OAAUzD,EAAIyD,IACrDC,EAAyB,GAC7BN,EAASC,IAAI,SAAAE,GACX,IAAMI,EAAqBV,EAAMW,OAAO,SAACC,GAAD,OAAcA,EAAKN,KAAOA,IAClEG,EAASrC,KAATS,MAAA4B,EAAQjF,OAAAqF,EAAA,EAAArF,CAASkF,MAEnB1E,EAAK8E,qBAAqBd,EAAM,GAAGe,sBACnCtB,EAAWgB,GAGf,IAAIrD,EAAO,KACPC,EAAa,GAiBjB,GAdAlB,EAAO8B,QAAQ,SAAA+C,GACb1C,YAAO,MAAO,eAAiB0C,EAAQC,MACvC5D,EAAWe,KAAK4C,EAAQC,MAIpBD,EAAQE,WACoD,OAA1DF,EAAQE,UAAUC,UAAUC,4BAC9BhE,EAAO,QAMTqC,EAASpB,OAAS,EAAG,CACvB,IAEIgD,EAFOC,MAAMC,KAAK,IAAIC,IAAI/B,IAAWc,KAAK,SAACxD,EAAGyD,GAAJ,OAAUA,EAAEiB,WAAa1E,EAAE0E,aAEjDrB,IAAI,SAAClD,EAAGwE,GAC9B,IAAIC,EAAYD,EAAQ,EACpBvE,GAAW,EAUf,MARoC,OAAhCD,EAAEkE,2BAA+C,OAAThE,IAC1CD,GAAW,GAEThB,EAAOkC,OAAS,IACU,OAAvBnB,EAAE0E,kBAA6BvE,EAAWwE,QAAQ,UAAY,GAA8B,OAAvB3E,EAAE4E,kBAA6BzE,EAAWwE,QAAQ,UAAY,GAA6B,OAAtB3E,EAAE6E,iBAA4B1E,EAAWwE,QAAQ,SAAW,GAA8B,OAAvB3E,EAAE8E,kBAA6B3E,EAAWwE,QAAQ,UAAY,KAC9Q1E,GAAW,GAGP8E,EAAAlF,EAAAmF,cAAA,OAAKC,UAAU,OAAOC,IAAKlF,EAAEoD,GAAG+B,WAAYC,QAAS,YApEtC,SAAAC,EAAAC,EAAAC,EAAAC,GAAA9F,EAAAiC,MAAAD,KAAAE,WAoE8C6D,CAAezF,EAAGC,EAAUC,EAAMC,KACrG4E,EAAAlF,EAAAmF,cAAA,OAAK9C,MAAO,CAAEwD,OAAQtD,OAAOuD,WAAa,GAAK,IAAM,EAAGxD,QAASC,OAAOuD,WAAa,GAAK,IAAM,EAAGlC,OAAM,aAAAxC,OAAehB,EAAW,OAAS,KAAnC,OACvG8E,EAAAlF,EAAAmF,cAAA,OAAKY,IAAK5F,EAAE6F,eAAgBC,IAAI,GAAG5D,MAAO,CAAEwD,MAAO,OAAQvD,OAAQ,WAEpEnC,EAAE+F,QAAUhB,EAAAlF,EAAAmF,cAAA,OAAK9C,MAAO,CAAEwD,MAAO,EAAGvD,OAAQ,EAAG6D,aAAc,OAAQC,gBAAiB,MAAOC,SAAU,cACxGnB,EAAAlF,EAAAmF,cAAA,OAAK9C,MAAO,CAAEwD,OAAQtD,OAAOuD,WAAa,GAAK,IAAM,EAAGQ,YAAa1B,EAAY,GAAK,EAAI,EAAI,GAAI2B,UAAW,WACrF,OAArBhH,EAASiH,QAAmBtB,EAAAlF,EAAAmF,cAAA,OAAKC,UAAU,OAAO/C,MAAO,CAAEwD,OAAQtD,OAAOuD,WAAa,GAAK,IAAM,IAAKZ,EAAAlF,EAAAmF,cAAA,KAAGC,UAAU,aAAajF,EAAEsG,OAAkBvB,EAAAlF,EAAAmF,cAAA,OAAKC,UAAU,WAAUF,EAAAlF,EAAAmF,cAAA,KAAGC,UAAU,aAAajF,EAAEsG,WAIjN7H,EAAY0F,KAEb,IAkEH,IAAMoC,EAAoB,CACxBC,aAAc1H,EAAK0H,aACnB1D,MAAOhE,EAAK2H,eAQd,OACE1B,EAAAlF,EAAAmF,cAAA,OAAK9C,MAAO,CAAEI,SAAU,OAAQH,OAAQ,OAAQuE,WAAY,SAC1D3B,EAAAlF,EAAAmF,cAAC2B,EAAA,EAAD,CAAQC,OAAQ,WAPlB/H,GAAe,IAOuBgI,KAAK,gBAAgBC,YAAY,kBACrE/B,EAAAlF,EAAAmF,cAAA,OAAK9C,MAAO,CAAEwE,WAAY,SACxB3B,EAAAlF,EAAAmF,cAAA,OAAKC,UAAU,YAAY/C,MAAK5D,OAAAyI,EAAA,EAAAzI,CAAA,CAE9B6D,OAAQ,OACRG,SAAU1D,GAAeE,EAAK0H,aAAe,SAAW,OACxDQ,QAAS,OACTC,eAAgB,aAGhBC,WAAY,GACZC,UAAW,GACXC,YAAa,GACbC,aAAc,GACdX,WAAY,OAEZY,aAAc,WACdC,WAAY,UAfkB,aAgBlB,SAMX/I,IAGJM,EAAK0H,cAAgBzB,EAAAlF,EAAAmF,cAACwC,EAAA,EAAejB,GACrC3H,EAAcmG,EAAAlF,EAAAmF,cAACyC,EAAA,EAAD,CAAaC,OAAQ9I,EAAa+I,UAjCrD,SAAoBC,GAClB/I,GAAe,MAgC+D,GAC3EW,EAAoBuF,EAAAlF,EAAAmF,cAAC6C,EAAA,EAAD,CAAYC,QAAStI,EAAmBuI,MAAM,sBAAsBC,YAAY,4BAA4BC,KAAK,KAAK7C,QAAS,WAAQ3F,GAAqB,MAAe","file":"static/js/25.a239d794.chunk.js","sourcesContent":["import React, { useContext, useState, useEffect } from 'react'\nimport Navbar from '../../navbar'\nimport useRouter from '../../../hooks/useRouter'\nimport qs from 'querystring'\nimport StampModal from '../StampModal'\nimport './StampShowcase.css'\nimport { MakeContext } from '../../MakeContext'\nimport code from '../../../utils/code'\nimport IsAgainEdit from '../../../components/isAgainEdit'\nimport { LocaleContext } from '../../../contexts/LocaleContext'\nimport invoke from '../../../utils/invoke'\nimport AlertModal from '../../../components/AlertModal'\nfunction StampShowcase (props) {\n  const [stampDom, setStampDom] = useState([])\n  const [isAgainEdit, setIsAgainEdit] = useState(false)\n  // const [stampId, setStampId] = useState([])\n  const make = useContext(MakeContext)\n  const {\n    layers\n  } = make\n  const router = useRouter()\n  const district = useContext(LocaleContext)\n  const [alertModelVisible, setAlertModelVisible] = useState(false)\n  useEffect(() => {\n    const par = document.getElementsByClassName('stampShow')[0].parentNode\n    par.style.height = window.innerHeight\n    par.style.overflow = 'auto'\n  }, [])\n  useEffect(() => {\n    let stampPer:Array\n\n    if (router.location.search) {\n      const searches = qs.parse(router.location.search.substr(1))\n      if (searches.passProps) {\n        const passProps = code.decodeURI(searches.passProps)\n        const { stamp } = passProps\n        // invoke('log', 'stampstamp' + JSON.stringify(stamp))\n        const stampIds = stamp.map(k => k.id).sort((a, b) => a - b)\n        let newStamp:Array<Object> = []\n        stampIds.map(id => {\n          const newFilterStamp:any = stamp.filter((item:any) => item.id === id)\n          newStamp.push(...newFilterStamp)\n        })\n        make.changeStampTitleName(stamp[0].contents_holder_name)\n        stampPer = newStamp\n      }\n    }\n    let over = 'NG'\n    let layerTypes = []\n    // let layerStampId = []\n    // invoke('log', 'layerslayers' + JSON.stringify(layers))\n    layers.forEach(element => {\n      invoke('log', 'element.type' + element.type)\n      layerTypes.push(element.type)\n      // if(element.stampRule){\n      //   layerStampId.push(element.stampRule.stampId)\n      // }\n      if (element.stampRule) {\n        if (element.stampRule.stampFlag.flag_can_other_layer_over === 'NG') {\n          over = 'OK'\n        }\n      }\n    })\n    // setStampId(layerStampId)\n    // let stampDom:any\n    if (stampPer.length > 0) {\n      let list = Array.from(new Set(stampPer)).sort((a, b) => b.updated_on - a.updated_on)\n      // list.reverse()\n      let stampDomList = list.map((s, index) => {\n        let flagindex = index + 1\n        let disabled = false\n\n        if (s.flag_can_other_layer_over === 'NG' && over === 'OK') {\n          disabled = true\n        }\n        if (layers.length > 1) {\n          if ((s.flag_layer_stamp === 'NG' && layerTypes.indexOf('stamp') > -1) || (s.flag_layer_paint === 'NG' && layerTypes.indexOf('paint') > -1) || (s.flag_layer_text === 'NG' && layerTypes.indexOf('text') > -1) || (s.flag_layer_photo === 'NG' && layerTypes.indexOf('photo') > -1)) {\n            disabled = true\n          }\n        }\n        return (<div className='wrap' key={s.id.toString()} onClick={() => { showStampModal(s, disabled, over, layerTypes) }}>\n          <div style={{ width: (window.innerWidth - 40 - 91) / 4, height: (window.innerWidth - 40 - 91) / 4, filter: `grayscale(${disabled ? '100%' : '0%'})` }}>\n            <img src={s.main_image_url} alt='' style={{ width: '100%', height: '100%' }} />\n          </div>\n          {s.is_new && <div style={{ width: 5, height: 5, borderRadius: '100%', backgroundColor: 'red', position: 'absolute' }} />}\n          <div style={{ width: (window.innerWidth - 40 - 91) / 4, marginRight: flagindex % 4 == 0 ? 0 : 30, textAlign: 'center' }}>\n            {district.current === 'en' ? <div className='down' style={{ width: (window.innerWidth - 40 - 91) / 4 }}><p className='wrapbreak'>{s.name}</p></div> : <div className='Jandown'><p className='wrapbreak'>{s.name}</p></div>}</div>\n        </div>)\n      }\n      )\n      setStampDom(stampDomList)\n    }\n  }, [])\n  // let stampPer:Array\n  // const router = useRouter()\n  // const make = useContext(MakeContext)\n  // if (router.location.search) {\n  //   const searches = qs.parse(router.location.search.substr(1))\n  //   if (searches.passProps) {\n  //     const passProps = code.decodeURI(searches.passProps)\n  //     const { stamp } = passProps\n  //     const stampIds = stamp.map(k => k.id).sort((a, b) => a - b)\n  //     let newStamp:Array<Object> = []\n  //     stampIds.map(id => {\n  //       const newFilterStamp:any = stamp.filter((item:any) => item.id === id)\n  //       newStamp.push(...newFilterStamp)\n  //     })\n  //     make.changeStampTitleName(stamp[0].contents_holder_name)\n  //     stampPer = newStamp\n  //   }\n  // }\n\n  // let stampDom:any\n  // if (stampPer.length > 0) {\n  //   stampDom = stampPer.map(s => (\n  //     <div className='wrap' style={{ marginRight: (window.innerWidth - 300) / 5 }} key={s.id.toString()} onClick={() => { showStampModal(s) }}>\n  //       <div className='up'><img src={s.main_image_url} alt='' style={{ width: '75px', height: '75px' }} /></div>\n  //       <div className='down'>{s.name}</div>\n  //     </div>\n  //   ))\n  // }\n  async function showStampModal (s:any, disabled, over, layerTypes) {\n    if (disabled) {\n      let alertModal = []\n      let layerTypesString = JSON.stringify(layerTypes)\n      let layerTypesNew = JSON.parse(layerTypesString)\n      layerTypesNew.pop()\n      try {\n        layerTypesNew.forEach((ele) => {\n          if (s[`flag_layer_${ele}`] === 'NG') {\n            alertModal.push(ele)\n          }\n        })\n        if (alertModal.length > 0) {\n          await invoke('stampDisabled', alertModal)\n        } else {\n          await invoke('stampDisabledOver')\n        }\n      } catch (error) {\n        layerTypesNew.forEach((ele) => {\n          if (s[`flag_layer_${ele}`] === 'NG') {\n            alertModal.push(ele)\n          }\n        })\n        if (alertModal.length > 0) {\n          await invoke('stampDisabled', alertModal)\n        } else {\n          await invoke('stampDisabledOver')\n        }\n      }\n    } else {\n      make.setModalVisible(true)\n      // document.getElementById('root').childNodes[1].style.overflow='hidden'\n      make.changeSelectedStamp(s)\n      make.changePreStamp(s)\n    }\n  }\n\n  const myStampModalProps = {\n    modalVisible: make.modalVisible,\n    stamp: make.selectedStamp\n  }\n  function change () {\n    setIsAgainEdit(true)\n  }\n  function isAgainFu (e) {\n    setIsAgainEdit(false)\n  }\n  return (\n    <div style={{ overflow: 'auto', height: '100%', background: '#fff' }}>\n      <Navbar revoke={() => { change() }} page='stampShowcase' currentPage='stampShowcase' />\n      <div style={{ background: '#fff' }}>\n        <div className='stampShow' style={{\n          // _height: window.innerHeight,\n          height: 'auto',\n          overflow: isAgainEdit || make.modalVisible ? 'hidden' : 'auto',\n          display: 'flex',\n          justifyContent: 'flex-start',\n          // showcase的height覆盖不上\n          // maxHeight: window.innerHeight,\n          paddingTop: 20,\n          marginTop: 44,\n          paddingLeft: 20,\n          paddintgRigh: 21,\n          background: '#fff',\n          // overflow: 'hidden',\n          textOverflow: 'ellipsis',\n          whiteSpace: 'nowrap',\n          background: '#fff'\n\n          // paddingLeft: (window.innerWidth - 300) / 5,\n          // paddingRight: (window.innerWidth - 300) / 5\n        }}\n        >\n          {stampDom}\n        </div>\n      </div>\n      {make.modalVisible && <StampModal {...myStampModalProps} />}\n      {isAgainEdit ? <IsAgainEdit status={isAgainEdit} isAgainFu={isAgainFu} /> : ''}\n      {alertModelVisible ? <AlertModal visible={alertModelVisible} title='error.network.title' description='error.network.description' text='OK' onClick={() => { setAlertModelVisible(false) }} /> : ''}\n    </div>\n  )\n}\n\nexport default StampShowcase\n"],"sourceRoot":""}